<!DOCTYPE html>
<!-- Generated by Cython 0.29.24 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: wfpt.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.cython .hll { background-color: #ffffcc }
.cython { background: #f8f8f8; }
.cython .c { color: #408080; font-style: italic } /* Comment */
.cython .err { border: 1px solid #FF0000 } /* Error */
.cython .k { color: #008000; font-weight: bold } /* Keyword */
.cython .o { color: #666666 } /* Operator */
.cython .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.cython .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cython .cp { color: #BC7A00 } /* Comment.Preproc */
.cython .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.cython .c1 { color: #408080; font-style: italic } /* Comment.Single */
.cython .cs { color: #408080; font-style: italic } /* Comment.Special */
.cython .gd { color: #A00000 } /* Generic.Deleted */
.cython .ge { font-style: italic } /* Generic.Emph */
.cython .gr { color: #FF0000 } /* Generic.Error */
.cython .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.cython .gi { color: #00A000 } /* Generic.Inserted */
.cython .go { color: #888888 } /* Generic.Output */
.cython .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.cython .gs { font-weight: bold } /* Generic.Strong */
.cython .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.cython .gt { color: #0044DD } /* Generic.Traceback */
.cython .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.cython .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.cython .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.cython .kp { color: #008000 } /* Keyword.Pseudo */
.cython .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.cython .kt { color: #B00040 } /* Keyword.Type */
.cython .m { color: #666666 } /* Literal.Number */
.cython .s { color: #BA2121 } /* Literal.String */
.cython .na { color: #7D9029 } /* Name.Attribute */
.cython .nb { color: #008000 } /* Name.Builtin */
.cython .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.cython .no { color: #880000 } /* Name.Constant */
.cython .nd { color: #AA22FF } /* Name.Decorator */
.cython .ni { color: #999999; font-weight: bold } /* Name.Entity */
.cython .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.cython .nf { color: #0000FF } /* Name.Function */
.cython .nl { color: #A0A000 } /* Name.Label */
.cython .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.cython .nt { color: #008000; font-weight: bold } /* Name.Tag */
.cython .nv { color: #19177C } /* Name.Variable */
.cython .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.cython .w { color: #bbbbbb } /* Text.Whitespace */
.cython .mb { color: #666666 } /* Literal.Number.Bin */
.cython .mf { color: #666666 } /* Literal.Number.Float */
.cython .mh { color: #666666 } /* Literal.Number.Hex */
.cython .mi { color: #666666 } /* Literal.Number.Integer */
.cython .mo { color: #666666 } /* Literal.Number.Oct */
.cython .sa { color: #BA2121 } /* Literal.String.Affix */
.cython .sb { color: #BA2121 } /* Literal.String.Backtick */
.cython .sc { color: #BA2121 } /* Literal.String.Char */
.cython .dl { color: #BA2121 } /* Literal.String.Delimiter */
.cython .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.cython .s2 { color: #BA2121 } /* Literal.String.Double */
.cython .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.cython .sh { color: #BA2121 } /* Literal.String.Heredoc */
.cython .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.cython .sx { color: #008000 } /* Literal.String.Other */
.cython .sr { color: #BB6688 } /* Literal.String.Regex */
.cython .s1 { color: #BA2121 } /* Literal.String.Single */
.cython .ss { color: #19177C } /* Literal.String.Symbol */
.cython .bp { color: #008000 } /* Name.Builtin.Pseudo */
.cython .fm { color: #0000FF } /* Name.Function.Magic */
.cython .vc { color: #19177C } /* Name.Variable.Class */
.cython .vg { color: #19177C } /* Name.Variable.Global */
.cython .vi { color: #19177C } /* Name.Variable.Instance */
.cython .vm { color: #19177C } /* Name.Variable.Magic */
.cython .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.24</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="wfpt.c">wfpt.c</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0001</span>: <span class="c"># cython: embedsignature=True</span></pre>
<pre class='cython code score-8 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0002</span>: <span class="c"># cython: cdivision=True</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0003</span>: <span class="c"># cython: wraparound=False</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0004</span>: <span class="c"># cython: boundscheck=False</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0005</span>: <span class="c"># distutils: language = c++</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0006</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0007</span>: <span class="c"># Cython version of the Navarro &amp; Fuss, 2009 DDM PDF. Based on the following code by Navarro &amp; Fuss:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0008</span>: <span class="c"># http://www.psychocmath.logy.adelaide.edu.au/personalpages/staff/danielnavarro/resources/wfpt.m</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0009</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0010</span>: <span class="c"># This implementation is about 170 times faster than the matlab</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0011</span>: <span class="c"># reference version.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0012</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0013</span>: <span class="c"># Copyleft Thomas Wiecki (thomas_wiecki[at]brown.edu) &amp; Imri Sofer, 2011</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0014</span>: <span class="c"># GPLv3</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0015</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0016</span>: <span class="k">import</span> <span class="nn">hddm</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_hddm, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 16, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_hddm, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0017</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0018</span>: <span class="k">import</span> <span class="nn">scipy.integrate</span> <span class="k">as</span> <span class="nn">integrate</span></pre>
<pre class='cython code score-16 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s__9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s__9);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s__9);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_scipy_integrate, __pyx_t_1, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_integrate, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 18, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0019</span>: <span class="k">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">copy</span></pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_copy);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_copy);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s_copy);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_copy, __pyx_t_2, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_1, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_copy, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0020</span>: <span class="k">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0021</span>: <span class="c"># from math import comb</span></pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0022</span>: <span class="k">from</span> <span class="nn">scipy.special</span> <span class="k">import</span> <span class="n">comb</span></pre>
<pre class='cython code score-19 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_comb);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_comb);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_comb);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_scipy_special, __pyx_t_1, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_comb);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_comb, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0023</span>: <span class="c"># cimport math</span></pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0024</span>: <span class="k">import</span> <span class="nn">itertools</span></pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_itertools, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_itertools, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0025</span>: <span class="k">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span></pre>
<pre class='cython code score-16 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 25, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s__9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s__9);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s__9);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_scipy_stats, __pyx_t_2, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_st, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 25, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0026</span>: <span class="k">cimport</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0027</span>: <span class="k">cimport</span> <span class="nn">cython</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0028</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0029</span>: <span class="k">from</span> <span class="nn">cython.parallel</span> <span class="k">import</span> <span class="o">*</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0030</span>: <span class="c"># cimport openmp</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0031</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0032</span>: <span class="c"># include &quot;pdf.pxi&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0033</span>: <span class="k">include</span> <span class="s">&#39;integrate.pxi&#39;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0034</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0035</span>: <span class="c"># Added for Bayesian Q in 2022-08-04:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0036</span>: <span class="c"># import pymc as pm</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0037</span>: <span class="c"># import pymc3 as pm</span></pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0038</span>: <span class="k">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">deque</span></pre>
<pre class='cython code score-19 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 38, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_deque);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_deque);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_deque);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_collections, __pyx_t_1, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 38, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_deque);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 38, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_deque, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 38, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0039</span>: <span class="k">import</span> <span class="nn">random</span></pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_random, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 39, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_random, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 39, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0040</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0041</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0042</span>: <span class="c"># Added for uncertainty modulation in 2022-10-01:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0043</span>: </pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0044</span>: <span class="k">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">entropy</span> <span class="k">as</span> <span class="n">scientropy</span></pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 44, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_entropy);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_entropy);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s_entropy);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_scipy_stats, __pyx_t_2, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 44, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_1, __pyx_n_s_entropy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 44, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_scientropy, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 44, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0045</span>: <span class="c"># from scipy.stats import beta</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0046</span>: </pre>
<pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0047</span>: <span class="n">np</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="s">&#39;(overflow|invalid)&#39;</span><span class="p">)</span></pre>
<pre class='cython code score-17 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_warnings);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 47, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_filterwarnings);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_tuple__10, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 47, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
/* … */
  __pyx_tuple__10 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_s_ignore, __pyx_kp_s_overflow_invalid);<span class='error_goto'> if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 47, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__10);
</pre><pre class="cython line score-0">&#xA0;<span class="">0048</span>: </pre>
<pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0049</span>: <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mf">1234</span><span class="p">)</span></pre>
<pre class='cython code score-20 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 49, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 49, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_seed);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 49, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 49, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_seed, __pyx_int_1234) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 49, __pyx_L1_error)</span>
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_empty_tuple, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 49, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0050</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0051</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0052</span>: <span class="c"># JY added in 2022-10-01 for uncertainty modulation</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0053</span>: <span class="c"># def alphaf(int k):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0054</span>: <span class="c">#     return k+1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0055</span>: <span class="c"># def betaf(int n, int k):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0056</span>: <span class="c">#     return n-k+1</span></pre>
<pre class="cython line score-60" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0057</span>: <span class="k">def</span> <span class="nf">var_beta</span><span class="p">(</span><span class="n">double</span> <span class="n">a</span><span class="p">,</span><span class="n">double</span> <span class="n">b</span><span class="p">):</span></pre>
<pre class='cython code score-60 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_3var_beta(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_2var_beta[] = "var_beta(double a, double b)";
static PyMethodDef __pyx_mdef_4wfpt_3var_beta = {"var_beta", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_3var_beta, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_2var_beta};
static PyObject *__pyx_pw_4wfpt_3var_beta(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_a;
  double __pyx_v_b;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("var_beta (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_a,&amp;__pyx_n_s_b,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_b)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("var_beta", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "var_beta") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_a = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]); if (unlikely((__pyx_v_a == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L3_error)</span>
    __pyx_v_b = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_b == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("var_beta", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.var_beta", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4wfpt_2var_beta(__pyx_self, __pyx_v_a, __pyx_v_b);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_2var_beta(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_a, double __pyx_v_b) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("var_beta", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.var_beta", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__11 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_s_a, __pyx_n_s_b);<span class='error_goto'> if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 57, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__11);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__11);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_3var_beta, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 57, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_var_beta, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__12 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__11, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_var_beta, 57, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__12)) __PYX_ERR(0, 57, __pyx_L1_error)</span>
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0058</span>:     <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(((</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mf">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="mf">1</span><span class="p">))</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(((__pyx_v_a * __pyx_v_b) / (pow((__pyx_v_a + __pyx_v_b), 2.0) * ((__pyx_v_a + __pyx_v_b) + 1.0))));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 58, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0059</span>: <span class="c"># class BayesianQ_Agent:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0060</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0061</span>: <span class="c">#     def __init__(self, state_size, action_size):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0062</span>: <span class="c">#         self.state_size = state_size</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0063</span>: <span class="c">#         self.action_size = action_size</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0064</span>: <span class="c">#         # self.memory_mf = deque(maxlen=20000)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0065</span>: <span class="c">#         # self.memory_mb = deque(maxlen=20000)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0066</span>: <span class="c">#         self.model = None</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0067</span>: <span class="c">#         # self.MIN_VAL = 99.1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0068</span>: <span class="c">#         # self.MAX_VAL = 100.9</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0069</span>: <span class="c">#         # self.D = int(((self.MAX_VAL - self.MIN_VAL) * 10) * 3) + 1  # times 3 for the 3 possible current_position values</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0070</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0071</span>: <span class="c">#         self.Qmb_mus_estimates_mu = np.zeros((self.action_size, self.state_size)) #np.zeros((3, self.D))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0072</span>: <span class="c">#         self.Qmb_mus_estimates_sd = np.ones((self.action_size, self.state_size)) #np.ones((3, self.D))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0073</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0074</span>: <span class="c">#         self.Qmb_sds_estimates_mu = np.ones((self.action_size, self.state_size)) * -2. #np.ones((3, self.D)) * -2.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0075</span>: <span class="c">#         self.Qmb_sds_estimates_sd = np.ones((self.action_size, self.state_size)) * 10. #np.ones((3, self.D)) * 10.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0076</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0077</span>: <span class="c">#         self.Qmf_mus_estimates_mu = np.zeros((self.action_size, comb(self.state_size,2,exact=True))) #np.zeros((3, self.D))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0078</span>: <span class="c">#         self.Qmf_mus_estimates_sd = np.ones((self.action_size, comb(self.state_size,2,exact=True))) #np.ones((3, self.D))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0079</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0080</span>: <span class="c">#         self.Qmf_sds_estimates_mu = np.ones((self.action_size, comb(self.state_size,2,exact=True))) * -2. #np.ones((3, self.D)) * -2.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0081</span>: <span class="c">#         self.Qmf_sds_estimates_sd = np.ones((self.action_size, comb(self.state_size,2,exact=True))) * 10. #np.ones((3, self.D)) * 10.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0082</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0083</span>: <span class="c">#     # def reset_memory(self):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0084</span>: <span class="c">#     #     self.memory = deque(maxlen=20000)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0085</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0086</span>: <span class="c">#     def act(self, stage, state, Tm = np.array([[0.7, 0.3], [0.3, 0.7]]), use_explo=True):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0087</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0088</span>: <span class="c">#         if self.model is None:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0089</span>: <span class="c">#             return random.randrange(self.action_size)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0090</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0091</span>: <span class="c">#         def calculate_VPI(mus, sds):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0092</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0093</span>: <span class="c">#             def gain(i, i2, x):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0094</span>: <span class="c">#                 gains = []</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0095</span>: <span class="c">#                 for j in range(len(mus)):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0096</span>: <span class="c">#                     if j == i:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0097</span>: <span class="c">#                         # special case: this is the best action</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0098</span>: <span class="c">#                         g = mus[i2] - np.minimum(x, mus[i2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0099</span>: <span class="c">#                     else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0100</span>: <span class="c">#                         g = np.maximum(x, mus[i]) - mus[i]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0101</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0102</span>: <span class="c">#                     gains.append(g)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0103</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0104</span>: <span class="c">#                 gains = np.reshape(np.array(gains), [-1, len(x)]).transpose()</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0105</span>: <span class="c">#                 return gains</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0106</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0107</span>: <span class="c">#             SAMPLE_SIZE = 1000</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0108</span>: <span class="c">#             Q_LOW = -1.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0109</span>: <span class="c">#             Q_HIGH = 1.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0110</span>: <span class="c">#             x = np.random.uniform(Q_LOW, Q_HIGH, SAMPLE_SIZE)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0111</span>: <span class="c">#             x = np.reshape(x, [-1, 1])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0112</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0113</span>: <span class="c">#             dist = st.norm(mus, np.exp(sds))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0114</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0115</span>: <span class="c">#             probs = dist.pdf(x)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0116</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0117</span>: <span class="c">#             best_action_idx = np.argmax(mus)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0118</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0119</span>: <span class="c">#             tmp_mus = np.copy(mus)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0120</span>: <span class="c">#             tmp_mus[best_action_idx] = -9999.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0121</span>: <span class="c">#             second_best_action_idx = np.argmax(tmp_mus)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0122</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0123</span>: <span class="c">#             gains = gain(best_action_idx, second_best_action_idx, x)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0124</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0125</span>: <span class="c">#             return np.mean(gains * probs, axis=0)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0126</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0127</span>: <span class="c">#         if stage==1: # 1st stage -&gt; get TM &amp; 2nd-stage Q values,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0128</span>: <span class="c">#             # important: two states (planets) as input, unlike stage 2!</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0129</span>: <span class="c">#             # output is Qmb (next code is dtq = Qmb[1] - Qmb[0])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0130</span>: <span class="c">#             planets = state</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0131</span>: <span class="c">#             # Qmb = np.dot(Tm, [np.max(qs_mb[planets[0], :]), np.max(qs_mb[planets[1], :])])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0132</span>: <span class="c">#             planet1_mus = self.Qmb_mus_estimates[:,planets[0]]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0133</span>: <span class="c">#             planet2_mus = self.Qmb_mus_estimates[:,planets[1]]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0134</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0135</span>: <span class="c">#             planet1_sds = self.Qmb_sds_estimates[:,planets[0]]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0136</span>: <span class="c">#             planet2_sds = self.Qmb_sds_estimates[:,planets[1]]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0137</span>: <span class="c">#             if use_explo:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0138</span>: <span class="c">#                 action_scores_1 =  calculate_VPI(planet1_mus, planet1_sds) + planet1_mus</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0139</span>: <span class="c">#                 action_scores_2 =  calculate_VPI(planet2_mus, planet2_sds) + planet2_mus</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0140</span>: <span class="c">#             else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0141</span>: <span class="c">#                 action_scores_1 = planet1_mus</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0142</span>: <span class="c">#                 action_scores_2 = planet2_mus</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0143</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0144</span>: <span class="c">#             return np.dot(Tm, [np.max(action_scores_1), np.max(action_scores_2)]) # Qmb</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0145</span>: <span class="c">#         elif stage==2: # 2nd stage -&gt; directly pick between 2nd-stage Q values</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0146</span>: <span class="c">#             # important: two states (planets) as input, unlike stage 2!</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0147</span>: <span class="c">#             # output is action score (qs; next code is dtq = qs[0] - qs[1])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0148</span>: <span class="c">#             state_idx = state</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0149</span>: <span class="c">#             state_mus = self.Qmb_mus_estimates[:, state_idx]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0150</span>: <span class="c">#             state_sds = self.Qmb_sds_estimates[:, state_idx]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0151</span>: <span class="c">#             if use_explo:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0152</span>: <span class="c">#                 VPI_per_action = calculate_VPI(state_mus, state_sds)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0153</span>: <span class="c">#                 action_scores = VPI_per_action + state_mus</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0154</span>: <span class="c">#                 # idx_selected_action = np.argmax(action_scores)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0155</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0156</span>: <span class="c">#                 return action_scores</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0157</span>: <span class="c">#             else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0158</span>: <span class="c">#                 return np.argmax(state_mus)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0159</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0160</span>: <span class="c">#             # if use_explo:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0161</span>: <span class="c">#             # VPI_per_action = calculate_VPI(state_mus, state_sds)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0162</span>: <span class="c">#             # action_scores = VPI_per_action + state_mus</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0163</span>: <span class="c">#             # idx_selected_action = np.argmax(action_scores)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0164</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0165</span>: <span class="c">#             # return action_scores</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0166</span>: <span class="c">#             # else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0167</span>: <span class="c">#             #     return np.argmax(state_mus)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0168</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0169</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0170</span>: <span class="c">#     def update(self,state,action,reward):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0171</span>: <span class="c">#         # mem_mb = np.array(self.memory_mb)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0172</span>: <span class="c">#         # mem_mf = np.array(self.memory_mf)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0173</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0174</span>: <span class="c">#         # states = mem_mb[:, :self.state_size]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0175</span>: <span class="c">#         # actions = np.reshape(mem_mb[:, self.state_size], [-1, 1])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0176</span>: <span class="c">#         # rewards = mem_mb[:, -1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0177</span>: <span class="c">#         #</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0178</span>: <span class="c">#         # full_tensor = []</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0179</span>: <span class="c">#         #</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0180</span>: <span class="c">#         # qvalues = [N x 3]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0181</span>: <span class="c">#         # 1 - action index</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0182</span>: <span class="c">#         # 2 - state index</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0183</span>: <span class="c">#         # 3 - reward</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0184</span>: <span class="c">#         # qvalues = np.array(full_tensor)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0185</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0186</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0187</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0188</span>: <span class="c">#         #COMMENT THIS OUT FOR NOW TO RUN OTHER MODELS THAT DON&#39;T USE BAYESIAN-Q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0189</span>: <span class="c">#         with pm.Model() as self.model:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0190</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0191</span>: <span class="c">#             # state_mus = self.Qmus_estimates[:, state_idx]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0192</span>: <span class="c">#             Qmus = pm.Normal(&#39;Qmus&#39;, mu=self.Qmb_mus_estimates_mu, sd=self.Qmb_mus_estimates_sd, shape=[self.action_size, self.state_size])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0193</span>: <span class="c">#             Qsds = pm.Normal(&#39;Qsds&#39;, mu=self.Qmb_sds_estimates_mu, sd=self.Qmb_sds_estimates_sd, shape=[self.action_size, self.state_size])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0194</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0195</span>: <span class="c">#             # idx0 = qvalues[:, 0].astype(int) action</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0196</span>: <span class="c">#             # idx1 = qvalues[:, 1].astype(int) state</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0197</span>: <span class="c">#             idx0 = action</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0198</span>: <span class="c">#             idx1 = state</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0199</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0200</span>: <span class="c">#             # pm.Normal(&#39;likelihood&#39;, mu=Qmus[idx0, idx1], sd=np.exp(Qsds[idx0, idx1]), observed=qvalues[:, 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0201</span>: <span class="c">#             pm.Normal(&#39;likelihood&#39;, mu=Qmus[idx0, idx1], sd=np.exp(Qsds[idx0, idx1]), observed=reward)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0202</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0203</span>: <span class="c">#             mean_field = pm.fit(n=15000, method=&#39;advi&#39;, obj_optimizer=pm.adam(learning_rate=0.1))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0204</span>: <span class="c">#             self.trace = mean_field.sample(5000)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0205</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0206</span>: <span class="c">#         # with VAR = EXPR:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0207</span>: <span class="c">#         #     try:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0208</span>: <span class="c">#         #         BLOCK</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0209</span>: <span class="c">#         #     finally:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0210</span>: <span class="c">#         #         VAR.__exit__()</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0211</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0212</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0213</span>: <span class="c">#         self.Qmb_mus_estimates = np.mean(self.trace[&#39;Qmus&#39;], axis=0)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0214</span>: <span class="c">#         self.Qmb_sds_estimates = np.mean(self.trace[&#39;Qsds&#39;], axis=0)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0215</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0216</span>: <span class="c">#         self.Qmb_mus_estimates_mu = self.Qmb_mus_estimates</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0217</span>: <span class="c">#         self.Qmb_mus_estimates_sd = np.std(self.trace[&#39;Qmus&#39;], axis=0)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0218</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0219</span>: <span class="c">#         self.Qmb_sds_estimates_mu = self.Qmb_sds_estimates</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0220</span>: <span class="c">#         self.Qmb_sds_estimates_sd = np.std(self.trace[&#39;Qsds&#39;], axis=0)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0221</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0222</span>: <span class="c">#         # self.reset_memory()</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0223</span>: <span class="c">#         # return</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0224</span>: <span class="c">#     def forget(self, gamma, state, action):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0225</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0226</span>: <span class="c">#         # qs_mb[s_, a_] *= (1 - gamma_)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0227</span>: <span class="c">#         self.Qmb_mus_estimates_mu[action, state] *= (1-gamma)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0228</span>: <span class="c">#     def uncertainty(self, state):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0229</span>: <span class="c">#         # think of other ways to change this</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0230</span>: <span class="c">#         return np.mean(self.Qmb_sds_estimates_mu[:,state])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0231</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0232</span>: </pre>
<pre class="cython line score-267" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0233</span>: <span class="k">def</span> <span class="nf">pdf_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x</span><span class="p">,</span> <span class="n">double</span> <span class="n">v</span><span class="p">,</span> <span class="n">double</span> <span class="n">sv</span><span class="p">,</span> <span class="n">double</span> <span class="n">a</span><span class="p">,</span> <span class="n">double</span> <span class="n">z</span><span class="p">,</span> <span class="n">double</span> <span class="n">sz</span><span class="p">,</span></pre>
<pre class='cython code score-267 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_5pdf_array(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_4pdf_array[] = "pdf_array(ndarray x, double v, double sv, double a, double z, double sz, double t, double st, double err=1e-4, bool logp=0, int n_st=2, int n_sz=2, bool use_adaptive=1, double simps_err=1e-3, double p_outlier=0, double w_outlier=0)";
static PyMethodDef __pyx_mdef_4wfpt_5pdf_array = {"pdf_array", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_5pdf_array, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_4pdf_array};
static PyObject *__pyx_pw_4wfpt_5pdf_array(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_x = 0;
  double __pyx_v_v;
  double __pyx_v_sv;
  double __pyx_v_a;
  double __pyx_v_z;
  double __pyx_v_sz;
  double __pyx_v_t;
  double __pyx_v_st;
  double __pyx_v_err;
  int __pyx_v_logp;
  int __pyx_v_n_st;
  int __pyx_v_n_sz;
  int __pyx_v_use_adaptive;
  double __pyx_v_simps_err;
  double __pyx_v_p_outlier;
  double __pyx_v_w_outlier;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("pdf_array (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_x,&amp;__pyx_n_s_v,&amp;__pyx_n_s_sv,&amp;__pyx_n_s_a,&amp;__pyx_n_s_z,&amp;__pyx_n_s_sz,&amp;__pyx_n_s_t,&amp;__pyx_n_s_st,&amp;__pyx_n_s_err,&amp;__pyx_n_s_logp,&amp;__pyx_n_s_n_st,&amp;__pyx_n_s_n_sz,&amp;__pyx_n_s_use_adaptive,&amp;__pyx_n_s_simps_err,&amp;__pyx_n_s_p_outlier,&amp;__pyx_n_s_w_outlier,0};
    PyObject* values[16] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("pdf_array", 0, 8, 16, 1); <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sv)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("pdf_array", 0, 8, 16, 2); <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("pdf_array", 0, 8, 16, 3); <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("pdf_array", 0, 8, 16, 4); <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("pdf_array", 0, 8, 16, 5); <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_t)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("pdf_array", 0, 8, 16, 6); <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_st)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("pdf_array", 0, 8, 16, 7); <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_err);
          if (value) { values[8] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_logp);
          if (value) { values[9] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_st);
          if (value) { values[10] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_sz);
          if (value) { values[11] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_use_adaptive);
          if (value) { values[12] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_simps_err);
          if (value) { values[13] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_p_outlier);
          if (value) { values[14] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w_outlier);
          if (value) { values[15] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "pdf_array") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_x = ((PyArrayObject *)values[0]);
    __pyx_v_v = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_v == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L3_error)</span>
    __pyx_v_sv = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_sv == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L3_error)</span>
    __pyx_v_a = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_a == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L3_error)</span>
    __pyx_v_z = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_z == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L3_error)</span>
    __pyx_v_sz = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[5]); if (unlikely((__pyx_v_sz == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L3_error)</span>
    __pyx_v_t = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]); if (unlikely((__pyx_v_t == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 234, __pyx_L3_error)</span>
    __pyx_v_st = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[7]); if (unlikely((__pyx_v_st == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 234, __pyx_L3_error)</span>
    if (values[8]) {
      __pyx_v_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]); if (unlikely((__pyx_v_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 234, __pyx_L3_error)</span>
    } else {
      __pyx_v_err = ((double)1e-4);
    }
    if (values[9]) {
      __pyx_v_logp = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[9]); if (unlikely((__pyx_v_logp == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 234, __pyx_L3_error)</span>
    } else {
      __pyx_v_logp = ((int)0);
    }
    if (values[10]) {
      __pyx_v_n_st = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[10]); if (unlikely((__pyx_v_n_st == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 234, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_st = ((int)2);
    }
    if (values[11]) {
      __pyx_v_n_sz = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[11]); if (unlikely((__pyx_v_n_sz == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 234, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_sz = ((int)2);
    }
    if (values[12]) {
      __pyx_v_use_adaptive = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[12]); if (unlikely((__pyx_v_use_adaptive == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 234, __pyx_L3_error)</span>
    } else {
      __pyx_v_use_adaptive = ((int)1);
    }
    if (values[13]) {
      __pyx_v_simps_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[13]); if (unlikely((__pyx_v_simps_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 235, __pyx_L3_error)</span>
    } else {
      __pyx_v_simps_err = ((double)1e-3);
    }
    if (values[14]) {
      __pyx_v_p_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[14]); if (unlikely((__pyx_v_p_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 235, __pyx_L3_error)</span>
    } else {
      __pyx_v_p_outlier = ((double)0.0);
    }
    if (values[15]) {
      __pyx_v_w_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[15]); if (unlikely((__pyx_v_w_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 235, __pyx_L3_error)</span>
    } else {
      __pyx_v_w_outlier = ((double)0.0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("pdf_array", 0, 8, 16, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.pdf_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x), __pyx_ptype_5numpy_ndarray, 1, "x", 0))) <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4wfpt_4pdf_array(__pyx_self, __pyx_v_x, __pyx_v_v, __pyx_v_sv, __pyx_v_a, __pyx_v_z, __pyx_v_sz, __pyx_v_t, __pyx_v_st, __pyx_v_err, __pyx_v_logp, __pyx_v_n_st, __pyx_v_n_sz, __pyx_v_use_adaptive, __pyx_v_simps_err, __pyx_v_p_outlier, __pyx_v_w_outlier);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_4pdf_array(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_x, double __pyx_v_v, double __pyx_v_sv, double __pyx_v_a, double __pyx_v_z, double __pyx_v_sz, double __pyx_v_t, double __pyx_v_st, double __pyx_v_err, int __pyx_v_logp, int __pyx_v_n_st, int __pyx_v_n_sz, int __pyx_v_use_adaptive, double __pyx_v_simps_err, double __pyx_v_p_outlier, double __pyx_v_w_outlier) {
  Py_ssize_t __pyx_v_size;
  Py_ssize_t __pyx_v_i;
  PyArrayObject *__pyx_v_y = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x;
  __Pyx_Buffer __pyx_pybuffer_x;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_y;
  __Pyx_Buffer __pyx_pybuffer_y;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("pdf_array", 0);
  __pyx_pybuffer_y.pybuffer.buf = NULL;
  __pyx_pybuffer_y.refcount = 0;
  __pyx_pybuffernd_y.data = NULL;
  __pyx_pybuffernd_y.rcbuffer = &amp;__pyx_pybuffer_y;
  __pyx_pybuffer_x.pybuffer.buf = NULL;
  __pyx_pybuffer_x.refcount = 0;
  __pyx_pybuffernd_x.data = NULL;
  __pyx_pybuffernd_x.rcbuffer = &amp;__pyx_pybuffer_x;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_x.diminfo[0].strides = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x.diminfo[0].shape = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_y.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.pdf_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_y.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_y);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__13 = <span class='py_c_api'>PyTuple_Pack</span>(19, __pyx_n_s_x, __pyx_n_s_v, __pyx_n_s_sv, __pyx_n_s_a, __pyx_n_s_z, __pyx_n_s_sz, __pyx_n_s_t, __pyx_n_s_st, __pyx_n_s_err, __pyx_n_s_logp, __pyx_n_s_n_st, __pyx_n_s_n_sz, __pyx_n_s_use_adaptive, __pyx_n_s_simps_err, __pyx_n_s_p_outlier, __pyx_n_s_w_outlier, __pyx_n_s_size, __pyx_n_s_i, __pyx_n_s_y);<span class='error_goto'> if (unlikely(!__pyx_tuple__13)) __PYX_ERR(0, 233, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__13);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__13);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_5pdf_array, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 233, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_pdf_array, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__14 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(16, 0, 19, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__13, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_pdf_array, 233, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__14)) __PYX_ERR(0, 233, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0234</span>:               <span class="n">double</span> <span class="n">t</span><span class="p">,</span> <span class="n">double</span> <span class="n">st</span><span class="p">,</span> <span class="n">double</span> <span class="n">err</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">logp</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_st</span><span class="o">=</span><span class="mf">2</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_sz</span><span class="o">=</span><span class="mf">2</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">use_adaptive</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0235</span>:               <span class="n">double</span> <span class="n">simps_err</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">double</span> <span class="n">p_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="n">double</span> <span class="n">w_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0236</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0237</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">size</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_size = (__pyx_v_x-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0238</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span></pre>
<pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0239</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span></pre>
<pre class='cython code score-39 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 239, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 239, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_size);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 239, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 239, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 239, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 239, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_double);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 239, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 239, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 239, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 239, __pyx_L1_error)</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_y.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_y = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_y.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 239, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_y.diminfo[0].strides = __pyx_pybuffernd_y.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_y.diminfo[0].shape = __pyx_pybuffernd_y.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_y = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0240</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0241</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="k">nogil</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span></pre>
<pre class='cython code score-4 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
        __pyx_t_7 = __pyx_v_size;
        if ((1 == 0)) abort();
        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            __pyx_t_9 = (__pyx_t_7 - 0 + 1 - 1/abs(1)) / 1;
            if (__pyx_t_9 &gt; 0)
            {
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for firstprivate(__pyx_v_i) lastprivate(__pyx_v_i)
                    #endif /* _OPENMP */
                    for (__pyx_t_8 = 0; __pyx_t_8 &lt; __pyx_t_9; __pyx_t_8++){
                        {
                            __pyx_v_i = (Py_ssize_t)(0 + 1 * __pyx_t_8);
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L5;
        }
        __pyx_L5:;
      }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0242</span>:         <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>                            __pyx_t_10 = __pyx_v_i;
/* … */
                            __pyx_t_12.__pyx_n = 4;
                            __pyx_t_12.n_st = __pyx_v_n_st;
                            __pyx_t_12.n_sz = __pyx_v_n_sz;
                            __pyx_t_12.use_adaptive = __pyx_v_use_adaptive;
                            __pyx_t_12.simps_err = __pyx_v_simps_err;
                            __pyx_t_11 = __pyx_f_4wfpt_full_pdf((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.buf, __pyx_t_10, __pyx_pybuffernd_x.diminfo[0].strides)), __pyx_v_v, __pyx_v_sv, __pyx_v_a, __pyx_v_z, __pyx_v_sz, __pyx_v_t, __pyx_v_st, __pyx_v_err, 0, &amp;__pyx_t_12); 
/* … */
                            __pyx_t_10 = __pyx_v_i;
                            *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_y.rcbuffer-&gt;pybuffer.buf, __pyx_t_10, __pyx_pybuffernd_y.diminfo[0].strides) = __pyx_t_11;
                        }
                    }
                }
            }
        }
        #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
            #undef likely
            #undef unlikely
            #define likely(x)   __builtin_expect(!!(x), 1)
            #define unlikely(x) __builtin_expect(!!(x), 0)
        #endif
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">0243</span>:                         <span class="n">n_st</span><span class="p">,</span> <span class="n">n_sz</span><span class="p">,</span> <span class="n">use_adaptive</span><span class="p">,</span> <span class="n">simps_err</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0244</span>: </pre>
<pre class="cython line score-44" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0245</span>:     <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">p_outlier</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">w_outlier</span> <span class="o">*</span> <span class="n">p_outlier</span><span class="p">)</span></pre>
<pre class='cython code score-44 '>  __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>((1.0 - __pyx_v_p_outlier));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 245, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(((PyObject *)__pyx_v_y), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 245, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_w_outlier * __pyx_v_p_outlier));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 245, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_3 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 245, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 245, __pyx_L1_error)</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_y.rcbuffer-&gt;pybuffer);
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_y.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_13 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_14, &amp;__pyx_t_15, &amp;__pyx_t_16);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_y.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_y, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_16);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_14, __pyx_t_15, __pyx_t_16);
      }
      __pyx_t_14 = __pyx_t_15 = __pyx_t_16 = 0;
    }
    __pyx_pybuffernd_y.diminfo[0].strides = __pyx_pybuffernd_y.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_y.diminfo[0].shape = __pyx_pybuffernd_y.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_13 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 245, __pyx_L1_error)</span>
  }
  __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_y, ((PyArrayObject *)__pyx_t_3));
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0246</span>:     <span class="k">if</span> <span class="n">logp</span> <span class="o">==</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_17 = ((__pyx_v_logp == 1) != 0);
  if (__pyx_t_17) {
/* … */
  }
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0247</span>:         <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y</span><span class="p">)</span></pre>
<pre class='cython code score-20 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 247, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_log);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 247, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
      __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
      if (likely(__pyx_t_5)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
      }
    }
    __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, ((PyObject *)__pyx_v_y)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, ((PyObject *)__pyx_v_y));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 247, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0248</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0249</span>:         <span class="k">return</span> <span class="n">y</span></pre>
<pre class='cython code score-2 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_y));
    __pyx_r = ((PyObject *)__pyx_v_y);
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0250</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0251</span>: <span class="k">cdef</span> <span class="kr">inline</span> <span class="kt">bint</span> <span class="nf">p_outlier_in_range</span><span class="p">(</span><span class="n">double</span> <span class="n">p_outlier</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>static CYTHON_INLINE int __pyx_f_4wfpt_p_outlier_in_range(double __pyx_v_p_outlier) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("p_outlier_in_range", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0252</span>:     <span class="k">return</span> <span class="p">(</span><span class="n">p_outlier</span> <span class="o">&gt;=</span> <span class="mf">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">p_outlier</span> <span class="o">&lt;=</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_r = ((__pyx_v_p_outlier &gt;= 0.0) &amp; (__pyx_v_p_outlier &lt;= 1.0));
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0253</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0254</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0255</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0256</span>: <span class="c"># def gain(double best_i, double secondbest_i, double x, double mu):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0257</span>: <span class="c">#     gains = []</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0258</span>: <span class="c">#     for j in range(len(mu)):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0259</span>: <span class="c">#         if j == best_i:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0260</span>: <span class="c">#             # special case: this is the best action</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0261</span>: <span class="c">#             g = mu[secondbest_i] - np.minimum(x,mu[secondbest_i])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0262</span>: <span class="c">#         else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0263</span>: <span class="c">#             g = np.maximum(x, mu[best_i]) - mu[best_i]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0264</span>: <span class="c">#         gains.append(g)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0265</span>: <span class="c">#     gains = np.reshape(np.array(gains), [-1, len(x)]).transpose()</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0266</span>: <span class="c">#     return gains</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0267</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0268</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0269</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0270</span>: <span class="c"># def calculate_VPI(double mu, double std):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0271</span>: <span class="c">#     sample_size = 1000</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0272</span>: <span class="c">#     q_low = 0.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0273</span>: <span class="c">#     q_high = 1.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0274</span>: <span class="c">#     x = np.random.uniform(q_low, q_high, sample_size)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0275</span>: <span class="c">#     x = np.reshape(x,[-1,1])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0276</span>: <span class="c">#     dist = st.norm(mu, np.exp(std))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0277</span>: <span class="c">#     probs = dist.pdf(x)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0278</span>: <span class="c">#     best_action_idx = np.argmax(mu)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0279</span>: <span class="c">#     tmp_mu = np.compy(mu)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0280</span>: <span class="c">#     tmp_mu[best_action_idx] = -9999.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0281</span>: <span class="c">#     second_best_action_idx = np.argmax(tmp_mu)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0282</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0283</span>: <span class="c">#     gains = gain(best_action_idx, second_best_action_idx, x, mu)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0284</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0285</span>: <span class="c">#     return np.mean(gains * probs, axis=0)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0286</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0287</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0288</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0289</span>: </pre>
<pre class="cython line score-250" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0290</span>: <span class="k">def</span> <span class="nf">wiener_like</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x</span><span class="p">,</span> <span class="n">double</span> <span class="n">v</span><span class="p">,</span> <span class="n">double</span> <span class="n">sv</span><span class="p">,</span> <span class="n">double</span> <span class="n">a</span><span class="p">,</span> <span class="n">double</span> <span class="n">z</span><span class="p">,</span> <span class="n">double</span> <span class="n">sz</span><span class="p">,</span> <span class="n">double</span> <span class="n">t</span><span class="p">,</span></pre>
<pre class='cython code score-250 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_7wiener_like(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_6wiener_like[] = "wiener_like(ndarray x, double v, double sv, double a, double z, double sz, double t, double st, double err, int n_st=10, int n_sz=10, bool use_adaptive=1, double simps_err=1e-8, double p_outlier=0, double w_outlier=0.1)";
static PyMethodDef __pyx_mdef_4wfpt_7wiener_like = {"wiener_like", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_7wiener_like, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_6wiener_like};
static PyObject *__pyx_pw_4wfpt_7wiener_like(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_x = 0;
  double __pyx_v_v;
  double __pyx_v_sv;
  double __pyx_v_a;
  double __pyx_v_z;
  double __pyx_v_sz;
  double __pyx_v_t;
  double __pyx_v_st;
  double __pyx_v_err;
  int __pyx_v_n_st;
  int __pyx_v_n_sz;
  int __pyx_v_use_adaptive;
  double __pyx_v_simps_err;
  double __pyx_v_p_outlier;
  double __pyx_v_w_outlier;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_x,&amp;__pyx_n_s_v,&amp;__pyx_n_s_sv,&amp;__pyx_n_s_a,&amp;__pyx_n_s_z,&amp;__pyx_n_s_sz,&amp;__pyx_n_s_t,&amp;__pyx_n_s_st,&amp;__pyx_n_s_err,&amp;__pyx_n_s_n_st,&amp;__pyx_n_s_n_sz,&amp;__pyx_n_s_use_adaptive,&amp;__pyx_n_s_simps_err,&amp;__pyx_n_s_p_outlier,&amp;__pyx_n_s_w_outlier,0};
    PyObject* values[15] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like", 0, 9, 15, 1); <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sv)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like", 0, 9, 15, 2); <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like", 0, 9, 15, 3); <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like", 0, 9, 15, 4); <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like", 0, 9, 15, 5); <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_t)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like", 0, 9, 15, 6); <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_st)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like", 0, 9, 15, 7); <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_err)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like", 0, 9, 15, 8); <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_st);
          if (value) { values[9] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_sz);
          if (value) { values[10] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_use_adaptive);
          if (value) { values[11] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_simps_err);
          if (value) { values[12] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_p_outlier);
          if (value) { values[13] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w_outlier);
          if (value) { values[14] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "wiener_like") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_x = ((PyArrayObject *)values[0]);
    __pyx_v_v = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_v == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L3_error)</span>
    __pyx_v_sv = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_sv == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L3_error)</span>
    __pyx_v_a = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_a == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L3_error)</span>
    __pyx_v_z = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_z == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L3_error)</span>
    __pyx_v_sz = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[5]); if (unlikely((__pyx_v_sz == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L3_error)</span>
    __pyx_v_t = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]); if (unlikely((__pyx_v_t == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L3_error)</span>
    __pyx_v_st = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[7]); if (unlikely((__pyx_v_st == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 291, __pyx_L3_error)</span>
    __pyx_v_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]); if (unlikely((__pyx_v_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 291, __pyx_L3_error)</span>
    if (values[9]) {
      __pyx_v_n_st = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[9]); if (unlikely((__pyx_v_n_st == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 291, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_st = ((int)10);
    }
    if (values[10]) {
      __pyx_v_n_sz = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[10]); if (unlikely((__pyx_v_n_sz == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 291, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_sz = ((int)10);
    }
    if (values[11]) {
      __pyx_v_use_adaptive = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[11]); if (unlikely((__pyx_v_use_adaptive == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 291, __pyx_L3_error)</span>
    } else {
      __pyx_v_use_adaptive = ((int)1);
    }
    if (values[12]) {
      __pyx_v_simps_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[12]); if (unlikely((__pyx_v_simps_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 291, __pyx_L3_error)</span>
    } else {
      __pyx_v_simps_err = ((double)1e-8);
    }
    if (values[13]) {
      __pyx_v_p_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[13]); if (unlikely((__pyx_v_p_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
    } else {
      __pyx_v_p_outlier = ((double)0.0);
    }
    if (values[14]) {
      __pyx_v_w_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[14]); if (unlikely((__pyx_v_w_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
    } else {
      __pyx_v_w_outlier = ((double)0.1);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like", 0, 9, 15, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x), __pyx_ptype_5numpy_ndarray, 1, "x", 0))) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4wfpt_6wiener_like(__pyx_self, __pyx_v_x, __pyx_v_v, __pyx_v_sv, __pyx_v_a, __pyx_v_z, __pyx_v_sz, __pyx_v_t, __pyx_v_st, __pyx_v_err, __pyx_v_n_st, __pyx_v_n_sz, __pyx_v_use_adaptive, __pyx_v_simps_err, __pyx_v_p_outlier, __pyx_v_w_outlier);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_6wiener_like(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_x, double __pyx_v_v, double __pyx_v_sv, double __pyx_v_a, double __pyx_v_z, double __pyx_v_sz, double __pyx_v_t, double __pyx_v_st, double __pyx_v_err, int __pyx_v_n_st, int __pyx_v_n_sz, int __pyx_v_use_adaptive, double __pyx_v_simps_err, double __pyx_v_p_outlier, double __pyx_v_w_outlier) {
  Py_ssize_t __pyx_v_size;
  Py_ssize_t __pyx_v_i;
  double __pyx_v_p;
  double __pyx_v_sum_logp;
  double __pyx_v_wp_outlier;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x;
  __Pyx_Buffer __pyx_pybuffer_x;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like", 0);
  __pyx_pybuffer_x.pybuffer.buf = NULL;
  __pyx_pybuffer_x.refcount = 0;
  __pyx_pybuffernd_x.data = NULL;
  __pyx_pybuffernd_x.rcbuffer = &amp;__pyx_pybuffer_x;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_x.diminfo[0].strides = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x.diminfo[0].shape = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__15 = <span class='py_c_api'>PyTuple_Pack</span>(20, __pyx_n_s_x, __pyx_n_s_v, __pyx_n_s_sv, __pyx_n_s_a, __pyx_n_s_z, __pyx_n_s_sz, __pyx_n_s_t, __pyx_n_s_st, __pyx_n_s_err, __pyx_n_s_n_st, __pyx_n_s_n_sz, __pyx_n_s_use_adaptive, __pyx_n_s_simps_err, __pyx_n_s_p_outlier, __pyx_n_s_w_outlier, __pyx_n_s_size, __pyx_n_s_i, __pyx_n_s_p, __pyx_n_s_sum_logp, __pyx_n_s_wp_outlier);<span class='error_goto'> if (unlikely(!__pyx_tuple__15)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__15);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__15);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_7wiener_like, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_wiener_like, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__16 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(15, 0, 20, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__15, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_wiener_like, 290, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__16)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0291</span>:                 <span class="n">double</span> <span class="n">st</span><span class="p">,</span> <span class="n">double</span> <span class="n">err</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_st</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_sz</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">use_adaptive</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span> <span class="n">double</span> <span class="n">simps_err</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0292</span>:                 <span class="n">double</span> <span class="n">p_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="n">double</span> <span class="n">w_outlier</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0293</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">size</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_size = (__pyx_v_x-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0294</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0295</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">p</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0296</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sum_logp</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sum_logp = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0297</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">wp_outlier</span> <span class="o">=</span> <span class="n">w_outlier</span> <span class="o">*</span> <span class="n">p_outlier</span></pre>
<pre class='cython code score-0 '>  __pyx_v_wp_outlier = (__pyx_v_w_outlier * __pyx_v_p_outlier);
</pre><pre class="cython line score-0">&#xA0;<span class="">0298</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0299</span>:     <span class="k">if</span> <span class="ow">not</span> <span class="n">p_outlier_in_range</span><span class="p">(</span><span class="n">p_outlier</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((!(__pyx_f_4wfpt_p_outlier_in_range(__pyx_v_p_outlier) != 0)) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0300</span>:         <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-12 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 300, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 300, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 300, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0301</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0302</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_4 = __pyx_v_size;
  __pyx_t_5 = __pyx_t_4;
  for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
    __pyx_v_i = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0303</span>:         <span class="n">p</span> <span class="o">=</span> <span class="n">full_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_7 = __pyx_v_i;
/* … */
    __pyx_t_9.__pyx_n = 4;
    __pyx_t_9.n_st = __pyx_v_n_st;
    __pyx_t_9.n_sz = __pyx_v_n_sz;
    __pyx_t_9.use_adaptive = __pyx_v_use_adaptive;
    __pyx_t_9.simps_err = __pyx_v_simps_err;
    __pyx_t_8 = __pyx_f_4wfpt_full_pdf((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_x.diminfo[0].strides)), __pyx_v_v, __pyx_v_sv, __pyx_v_a, __pyx_v_z, __pyx_v_sz, __pyx_v_t, __pyx_v_st, __pyx_v_err, 0, &amp;__pyx_t_9); 
    __pyx_v_p = __pyx_t_8;
</pre><pre class="cython line score-0">&#xA0;<span class="">0304</span>:                      <span class="n">n_st</span><span class="p">,</span> <span class="n">n_sz</span><span class="p">,</span> <span class="n">use_adaptive</span><span class="p">,</span> <span class="n">simps_err</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0305</span>:         <span class="c"># If one probability = 0, the log sum will be -Inf</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0306</span>:         <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">p_outlier</span><span class="p">)</span> <span class="o">+</span> <span class="n">wp_outlier</span></pre>
<pre class='cython code score-0 '>    __pyx_v_p = ((__pyx_v_p * (1.0 - __pyx_v_p_outlier)) + __pyx_v_wp_outlier);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0307</span>:         <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_p == 0.0) != 0);
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0308</span>:             <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-12 '>      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 308, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 308, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 308, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_r = __pyx_t_2;
      __pyx_t_2 = 0;
      goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0309</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0310</span>:         <span class="n">sum_logp</span> <span class="o">+=</span> <span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_sum_logp = (__pyx_v_sum_logp + log(__pyx_v_p));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0311</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0312</span>:     <span class="k">return</span> <span class="n">sum_logp</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_sum_logp);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 312, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0313</span>: </pre>
<pre class="cython line score-368" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0314</span>: <span class="k">def</span> <span class="nf">wiener_like_rlddm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x</span><span class="p">,</span></pre>
<pre class='cython code score-368 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_9wiener_like_rlddm(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_8wiener_like_rlddm[] = "wiener_like_rlddm(ndarray x, ndarray response, ndarray feedback, ndarray split_by, double q, double alpha, double pos_alpha, double v, double sv, double a, double z, double sz, double t, double st, double err, int n_st=10, int n_sz=10, bool use_adaptive=1, double simps_err=1e-8, double p_outlier=0, double w_outlier=0)";
static PyMethodDef __pyx_mdef_4wfpt_9wiener_like_rlddm = {"wiener_like_rlddm", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_9wiener_like_rlddm, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_8wiener_like_rlddm};
static PyObject *__pyx_pw_4wfpt_9wiener_like_rlddm(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_x = 0;
  PyArrayObject *__pyx_v_response = 0;
  PyArrayObject *__pyx_v_feedback = 0;
  PyArrayObject *__pyx_v_split_by = 0;
  double __pyx_v_q;
  double __pyx_v_alpha;
  double __pyx_v_pos_alpha;
  double __pyx_v_v;
  double __pyx_v_sv;
  double __pyx_v_a;
  double __pyx_v_z;
  double __pyx_v_sz;
  double __pyx_v_t;
  double __pyx_v_st;
  double __pyx_v_err;
  int __pyx_v_n_st;
  int __pyx_v_n_sz;
  int __pyx_v_use_adaptive;
  double __pyx_v_simps_err;
  double __pyx_v_p_outlier;
  double __pyx_v_w_outlier;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_rlddm (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_x,&amp;__pyx_n_s_response,&amp;__pyx_n_s_feedback,&amp;__pyx_n_s_split_by,&amp;__pyx_n_s_q,&amp;__pyx_n_s_alpha,&amp;__pyx_n_s_pos_alpha,&amp;__pyx_n_s_v,&amp;__pyx_n_s_sv,&amp;__pyx_n_s_a,&amp;__pyx_n_s_z,&amp;__pyx_n_s_sz,&amp;__pyx_n_s_t,&amp;__pyx_n_s_st,&amp;__pyx_n_s_err,&amp;__pyx_n_s_n_st,&amp;__pyx_n_s_n_sz,&amp;__pyx_n_s_use_adaptive,&amp;__pyx_n_s_simps_err,&amp;__pyx_n_s_p_outlier,&amp;__pyx_n_s_w_outlier,0};
    PyObject* values[21] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 21: values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_response)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm", 0, 15, 21, 1); <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_feedback)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm", 0, 15, 21, 2); <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_split_by)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm", 0, 15, 21, 3); <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_q)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm", 0, 15, 21, 4); <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_alpha)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm", 0, 15, 21, 5); <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_pos_alpha)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm", 0, 15, 21, 6); <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm", 0, 15, 21, 7); <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sv)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm", 0, 15, 21, 8); <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm", 0, 15, 21, 9); <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm", 0, 15, 21, 10); <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm", 0, 15, 21, 11); <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (likely((values[12] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_t)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm", 0, 15, 21, 12); <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (likely((values[13] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_st)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm", 0, 15, 21, 13); <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (likely((values[14] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_err)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm", 0, 15, 21, 14); <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_st);
          if (value) { values[15] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_sz);
          if (value) { values[16] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_use_adaptive);
          if (value) { values[17] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 18:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_simps_err);
          if (value) { values[18] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 19:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_p_outlier);
          if (value) { values[19] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 20:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w_outlier);
          if (value) { values[20] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "wiener_like_rlddm") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 21: values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_x = ((PyArrayObject *)values[0]);
    __pyx_v_response = ((PyArrayObject *)values[1]);
    __pyx_v_feedback = ((PyArrayObject *)values[2]);
    __pyx_v_split_by = ((PyArrayObject *)values[3]);
    __pyx_v_q = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_q == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 318, __pyx_L3_error)</span>
    __pyx_v_alpha = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[5]); if (unlikely((__pyx_v_alpha == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 318, __pyx_L3_error)</span>
    __pyx_v_pos_alpha = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]); if (unlikely((__pyx_v_pos_alpha == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 318, __pyx_L3_error)</span>
    __pyx_v_v = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[7]); if (unlikely((__pyx_v_v == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 318, __pyx_L3_error)</span>
    __pyx_v_sv = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]); if (unlikely((__pyx_v_sv == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 319, __pyx_L3_error)</span>
    __pyx_v_a = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[9]); if (unlikely((__pyx_v_a == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 319, __pyx_L3_error)</span>
    __pyx_v_z = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[10]); if (unlikely((__pyx_v_z == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 319, __pyx_L3_error)</span>
    __pyx_v_sz = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[11]); if (unlikely((__pyx_v_sz == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 319, __pyx_L3_error)</span>
    __pyx_v_t = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[12]); if (unlikely((__pyx_v_t == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 319, __pyx_L3_error)</span>
    __pyx_v_st = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[13]); if (unlikely((__pyx_v_st == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 320, __pyx_L3_error)</span>
    __pyx_v_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[14]); if (unlikely((__pyx_v_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 320, __pyx_L3_error)</span>
    if (values[15]) {
      __pyx_v_n_st = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[15]); if (unlikely((__pyx_v_n_st == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 320, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_st = ((int)10);
    }
    if (values[16]) {
      __pyx_v_n_sz = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[16]); if (unlikely((__pyx_v_n_sz == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 320, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_sz = ((int)10);
    }
    if (values[17]) {
      __pyx_v_use_adaptive = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[17]); if (unlikely((__pyx_v_use_adaptive == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 320, __pyx_L3_error)</span>
    } else {
      __pyx_v_use_adaptive = ((int)1);
    }
    if (values[18]) {
      __pyx_v_simps_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[18]); if (unlikely((__pyx_v_simps_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 320, __pyx_L3_error)</span>
    } else {
      __pyx_v_simps_err = ((double)1e-8);
    }
    if (values[19]) {
      __pyx_v_p_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[19]); if (unlikely((__pyx_v_p_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 321, __pyx_L3_error)</span>
    } else {
      __pyx_v_p_outlier = ((double)0.0);
    }
    if (values[20]) {
      __pyx_v_w_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[20]); if (unlikely((__pyx_v_w_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 321, __pyx_L3_error)</span>
    } else {
      __pyx_v_w_outlier = ((double)0.0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm", 0, 15, 21, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_rlddm", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x), __pyx_ptype_5numpy_ndarray, 1, "x", 0))) <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_response), __pyx_ptype_5numpy_ndarray, 1, "response", 0))) <span class='error_goto'>__PYX_ERR(0, 315, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_feedback), __pyx_ptype_5numpy_ndarray, 1, "feedback", 0))) <span class='error_goto'>__PYX_ERR(0, 316, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_split_by), __pyx_ptype_5numpy_ndarray, 1, "split_by", 0))) <span class='error_goto'>__PYX_ERR(0, 317, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4wfpt_8wiener_like_rlddm(__pyx_self, __pyx_v_x, __pyx_v_response, __pyx_v_feedback, __pyx_v_split_by, __pyx_v_q, __pyx_v_alpha, __pyx_v_pos_alpha, __pyx_v_v, __pyx_v_sv, __pyx_v_a, __pyx_v_z, __pyx_v_sz, __pyx_v_t, __pyx_v_st, __pyx_v_err, __pyx_v_n_st, __pyx_v_n_sz, __pyx_v_use_adaptive, __pyx_v_simps_err, __pyx_v_p_outlier, __pyx_v_w_outlier);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_8wiener_like_rlddm(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_x, PyArrayObject *__pyx_v_response, PyArrayObject *__pyx_v_feedback, PyArrayObject *__pyx_v_split_by, double __pyx_v_q, double __pyx_v_alpha, double __pyx_v_pos_alpha, double __pyx_v_v, double __pyx_v_sv, double __pyx_v_a, double __pyx_v_z, double __pyx_v_sz, double __pyx_v_t, double __pyx_v_st, double __pyx_v_err, int __pyx_v_n_st, int __pyx_v_n_sz, int __pyx_v_use_adaptive, double __pyx_v_simps_err, double __pyx_v_p_outlier, double __pyx_v_w_outlier) {
  CYTHON_UNUSED Py_ssize_t __pyx_v_size;
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_j;
  Py_ssize_t __pyx_v_s_size;
  int __pyx_v_s;
  double __pyx_v_p;
  double __pyx_v_sum_logp;
  double __pyx_v_wp_outlier;
  double __pyx_v_alfa;
  double __pyx_v_pos_alfa;
  PyArrayObject *__pyx_v_qs = 0;
  PyArrayObject *__pyx_v_xs = 0;
  PyArrayObject *__pyx_v_feedbacks = 0;
  PyArrayObject *__pyx_v_responses = 0;
  PyArrayObject *__pyx_v_unique = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_feedback;
  __Pyx_Buffer __pyx_pybuffer_feedback;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_feedbacks;
  __Pyx_Buffer __pyx_pybuffer_feedbacks;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_qs;
  __Pyx_Buffer __pyx_pybuffer_qs;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_response;
  __Pyx_Buffer __pyx_pybuffer_response;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_responses;
  __Pyx_Buffer __pyx_pybuffer_responses;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_split_by;
  __Pyx_Buffer __pyx_pybuffer_split_by;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_unique;
  __Pyx_Buffer __pyx_pybuffer_unique;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x;
  __Pyx_Buffer __pyx_pybuffer_x;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_xs;
  __Pyx_Buffer __pyx_pybuffer_xs;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_rlddm", 0);
  __pyx_pybuffer_qs.pybuffer.buf = NULL;
  __pyx_pybuffer_qs.refcount = 0;
  __pyx_pybuffernd_qs.data = NULL;
  __pyx_pybuffernd_qs.rcbuffer = &amp;__pyx_pybuffer_qs;
  __pyx_pybuffer_xs.pybuffer.buf = NULL;
  __pyx_pybuffer_xs.refcount = 0;
  __pyx_pybuffernd_xs.data = NULL;
  __pyx_pybuffernd_xs.rcbuffer = &amp;__pyx_pybuffer_xs;
  __pyx_pybuffer_feedbacks.pybuffer.buf = NULL;
  __pyx_pybuffer_feedbacks.refcount = 0;
  __pyx_pybuffernd_feedbacks.data = NULL;
  __pyx_pybuffernd_feedbacks.rcbuffer = &amp;__pyx_pybuffer_feedbacks;
  __pyx_pybuffer_responses.pybuffer.buf = NULL;
  __pyx_pybuffer_responses.refcount = 0;
  __pyx_pybuffernd_responses.data = NULL;
  __pyx_pybuffernd_responses.rcbuffer = &amp;__pyx_pybuffer_responses;
  __pyx_pybuffer_unique.pybuffer.buf = NULL;
  __pyx_pybuffer_unique.refcount = 0;
  __pyx_pybuffernd_unique.data = NULL;
  __pyx_pybuffernd_unique.rcbuffer = &amp;__pyx_pybuffer_unique;
  __pyx_pybuffer_x.pybuffer.buf = NULL;
  __pyx_pybuffer_x.refcount = 0;
  __pyx_pybuffernd_x.data = NULL;
  __pyx_pybuffernd_x.rcbuffer = &amp;__pyx_pybuffer_x;
  __pyx_pybuffer_response.pybuffer.buf = NULL;
  __pyx_pybuffer_response.refcount = 0;
  __pyx_pybuffernd_response.data = NULL;
  __pyx_pybuffernd_response.rcbuffer = &amp;__pyx_pybuffer_response;
  __pyx_pybuffer_feedback.pybuffer.buf = NULL;
  __pyx_pybuffer_feedback.refcount = 0;
  __pyx_pybuffernd_feedback.data = NULL;
  __pyx_pybuffernd_feedback.rcbuffer = &amp;__pyx_pybuffer_feedback;
  __pyx_pybuffer_split_by.pybuffer.buf = NULL;
  __pyx_pybuffer_split_by.refcount = 0;
  __pyx_pybuffernd_split_by.data = NULL;
  __pyx_pybuffernd_split_by.rcbuffer = &amp;__pyx_pybuffer_split_by;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_x.diminfo[0].strides = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x.diminfo[0].shape = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_response.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_response, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_response.diminfo[0].strides = __pyx_pybuffernd_response.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_response.diminfo[0].shape = __pyx_pybuffernd_response.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_feedback, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_feedback.diminfo[0].strides = __pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_feedback.diminfo[0].shape = __pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_split_by, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_split_by.diminfo[0].strides = __pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_split_by.diminfo[0].shape = __pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_xs.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_rlddm", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_xs.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_qs);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_xs);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_feedbacks);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_responses);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_unique);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__17 = <span class='py_c_api'>PyTuple_Pack</span>(36, __pyx_n_s_x, __pyx_n_s_response, __pyx_n_s_feedback, __pyx_n_s_split_by, __pyx_n_s_q, __pyx_n_s_alpha, __pyx_n_s_pos_alpha, __pyx_n_s_v, __pyx_n_s_sv, __pyx_n_s_a, __pyx_n_s_z, __pyx_n_s_sz, __pyx_n_s_t, __pyx_n_s_st, __pyx_n_s_err, __pyx_n_s_n_st, __pyx_n_s_n_sz, __pyx_n_s_use_adaptive, __pyx_n_s_simps_err, __pyx_n_s_p_outlier, __pyx_n_s_w_outlier, __pyx_n_s_size, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_s_size, __pyx_n_s_s, __pyx_n_s_p, __pyx_n_s_sum_logp, __pyx_n_s_wp_outlier, __pyx_n_s_alfa, __pyx_n_s_pos_alfa, __pyx_n_s_qs, __pyx_n_s_xs, __pyx_n_s_feedbacks, __pyx_n_s_responses, __pyx_n_s_unique);<span class='error_goto'> if (unlikely(!__pyx_tuple__17)) __PYX_ERR(0, 314, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__17);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__17);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_9wiener_like_rlddm, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 314, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_wiener_like_rlddm, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__18 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(21, 0, 36, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__17, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_wiener_like_rlddm, 314, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__18)) __PYX_ERR(0, 314, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0315</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">response</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0316</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">feedback</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0317</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">split_by</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0318</span>:                       <span class="n">double</span> <span class="n">q</span><span class="p">,</span> <span class="n">double</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">double</span> <span class="n">pos_alpha</span><span class="p">,</span> <span class="n">double</span> <span class="n">v</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0319</span>:                       <span class="n">double</span> <span class="n">sv</span><span class="p">,</span> <span class="n">double</span> <span class="n">a</span><span class="p">,</span> <span class="n">double</span> <span class="n">z</span><span class="p">,</span> <span class="n">double</span> <span class="n">sz</span><span class="p">,</span> <span class="n">double</span> <span class="n">t</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0320</span>:                       <span class="n">double</span> <span class="n">st</span><span class="p">,</span> <span class="n">double</span> <span class="n">err</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_st</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_sz</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">use_adaptive</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span> <span class="n">double</span> <span class="n">simps_err</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0321</span>:                       <span class="n">double</span> <span class="n">p_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="n">double</span> <span class="n">w_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">):</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0322</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">size</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_size = (__pyx_v_x-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0323</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0324</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">s_size</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0325</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0326</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">p</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0327</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sum_logp</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sum_logp = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0328</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">wp_outlier</span> <span class="o">=</span> <span class="n">w_outlier</span> <span class="o">*</span> <span class="n">p_outlier</span></pre>
<pre class='cython code score-0 '>  __pyx_v_wp_outlier = (__pyx_v_w_outlier * __pyx_v_p_outlier);
</pre><pre class="cython line score-0">&#xA0;<span class="">0329</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">alfa</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0330</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">pos_alfa</span></pre>
<pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0331</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span></pre>
<pre class='cython code score-42 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4);
  __pyx_t_2 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 331, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 331, __pyx_L1_error)</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_qs = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 331, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_qs.diminfo[0].strides = __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_qs.diminfo[0].shape = __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_qs = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0332</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">xs</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0333</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">feedbacks</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0334</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">responses</span></pre>
<pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0335</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">split_by</span><span class="p">)</span></pre>
<pre class='cython code score-24 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_unique);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_3, ((PyObject *)__pyx_v_split_by)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, ((PyObject *)__pyx_v_split_by));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 335, __pyx_L1_error)</span>
  __pyx_t_7 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_7, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_unique = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 335, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_unique.diminfo[0].strides = __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_unique.diminfo[0].shape = __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_7 = 0;
  __pyx_v_unique = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0336</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0337</span>:     <span class="k">if</span> <span class="ow">not</span> <span class="n">p_outlier_in_range</span><span class="p">(</span><span class="n">p_outlier</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_8 = ((!(__pyx_f_4wfpt_p_outlier_in_range(__pyx_v_p_outlier) != 0)) != 0);
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0338</span>:         <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-12 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 338, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 338, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 338, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0339</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0340</span>:     <span class="k">if</span> <span class="n">pos_alpha</span><span class="o">==</span><span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_8 = ((__pyx_v_pos_alpha == 100.00) != 0);
  if (__pyx_t_8) {
/* … */
    goto __pyx_L4;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0341</span>:         <span class="n">pos_alfa</span> <span class="o">=</span> <span class="n">alpha</span></pre>
<pre class='cython code score-0 '>    __pyx_v_pos_alfa = __pyx_v_alpha;
</pre><pre class="cython line score-0">&#xA0;<span class="">0342</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0343</span>:         <span class="n">pos_alfa</span> <span class="o">=</span> <span class="n">pos_alpha</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_pos_alfa = __pyx_v_pos_alpha;
  }
  __pyx_L4:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0344</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0345</span>:     <span class="c"># unique represent # of conditions</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0346</span>:     <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">unique</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_9 = (__pyx_v_unique-&gt;dimensions[0]);
  __pyx_t_10 = __pyx_t_9;
  for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_10; __pyx_t_11+=1) {
    __pyx_v_j = __pyx_t_11;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0347</span>:         <span class="n">s</span> <span class="o">=</span> <span class="n">unique</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = __pyx_v_j;
    __pyx_v_s = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_unique.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">0348</span>:         <span class="c"># select trials for current condition, identified by the split_by-array</span></pre>
<pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0349</span>:         <span class="n">feedbacks</span> <span class="o">=</span> <span class="n">feedback</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 349, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_1, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 349, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_feedback), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 349, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 349, __pyx_L1_error)</span>
    __pyx_t_13 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer);
      __pyx_t_14 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_13, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_14 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_15, &amp;__pyx_t_16, &amp;__pyx_t_17);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_feedbacks, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_17);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_15, __pyx_t_16, __pyx_t_17);
        }
        __pyx_t_15 = __pyx_t_16 = __pyx_t_17 = 0;
      }
      __pyx_pybuffernd_feedbacks.diminfo[0].strides = __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_feedbacks.diminfo[0].shape = __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_14 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 349, __pyx_L1_error)</span>
    }
    __pyx_t_13 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_feedbacks, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0350</span>:         <span class="n">responses</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 350, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_1, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 350, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_response), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 350, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 350, __pyx_L1_error)</span>
    __pyx_t_18 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer);
      __pyx_t_14 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_18, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_14 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_17, &amp;__pyx_t_16, &amp;__pyx_t_15);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_responses, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_17); Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_15);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_17, __pyx_t_16, __pyx_t_15);
        }
        __pyx_t_17 = __pyx_t_16 = __pyx_t_15 = 0;
      }
      __pyx_pybuffernd_responses.diminfo[0].strides = __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_responses.diminfo[0].shape = __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_14 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 350, __pyx_L1_error)</span>
    }
    __pyx_t_18 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_responses, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0351</span>:         <span class="n">xs</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 351, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_1, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 351, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_x), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 351, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L1_error)</span>
    __pyx_t_19 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_xs.rcbuffer-&gt;pybuffer);
      __pyx_t_14 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_xs.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_19, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_14 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_15, &amp;__pyx_t_16, &amp;__pyx_t_17);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_xs.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_xs, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_17);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_15, __pyx_t_16, __pyx_t_17);
        }
        __pyx_t_15 = __pyx_t_16 = __pyx_t_17 = 0;
      }
      __pyx_pybuffernd_xs.diminfo[0].strides = __pyx_pybuffernd_xs.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_xs.diminfo[0].shape = __pyx_pybuffernd_xs.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_14 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L1_error)</span>
    }
    __pyx_t_19 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_xs, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0352</span>:         <span class="n">s_size</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_v_s_size = (__pyx_v_xs-&gt;dimensions[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0353</span>:         <span class="n">qs</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = 0;
    *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_qs.diminfo[0].strides) = __pyx_v_q;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0354</span>:         <span class="n">qs</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = 1;
    *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_qs.diminfo[0].strides) = __pyx_v_q;
</pre><pre class="cython line score-0">&#xA0;<span class="">0355</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0356</span>:         <span class="c"># don&#39;t calculate pdf for first trial but still update q</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0357</span>:         <span class="k">if</span> <span class="n">feedbacks</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">qs</span><span class="p">[</span><span class="n">responses</span><span class="p">[</span><span class="mf">0</span><span class="p">]]:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = 0;
    __pyx_t_20 = 0;
    __pyx_t_21 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_responses.diminfo[0].strides));
    __pyx_t_8 = (((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_feedbacks.diminfo[0].strides)) &gt; (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_qs.diminfo[0].strides))) != 0);
    if (__pyx_t_8) {
/* … */
      goto __pyx_L7;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0358</span>:             <span class="n">alfa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">pos_alfa</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">pos_alfa</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_alfa = (pow(2.718281828459, __pyx_v_pos_alfa) / (1.0 + pow(2.718281828459, __pyx_v_pos_alfa)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0359</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0360</span>:             <span class="n">alfa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_alfa = (pow(2.718281828459, __pyx_v_alpha) / (1.0 + pow(2.718281828459, __pyx_v_alpha)));
    }
    __pyx_L7:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0361</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0362</span>:         <span class="c"># qs[1] is upper bound, qs[0] is lower bound. feedbacks is reward</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0363</span>:         <span class="c"># received on current trial.</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0364</span>:         <span class="n">qs</span><span class="p">[</span><span class="n">responses</span><span class="p">[</span><span class="mf">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="n">responses</span><span class="p">[</span><span class="mf">0</span><span class="p">]]</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>    __pyx_t_20 = 0;
    __pyx_t_21 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_responses.diminfo[0].strides));
/* … */
    __pyx_t_24 = 0;
    __pyx_t_25 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_responses.diminfo[0].strides));
    *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_25, __pyx_pybuffernd_qs.diminfo[0].strides) = ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_qs.diminfo[0].strides)) + (__pyx_v_alfa * ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_feedbacks.diminfo[0].strides)) - (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_23, __pyx_pybuffernd_qs.diminfo[0].strides)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0365</span>:             <span class="n">alfa</span> <span class="o">*</span> <span class="p">(</span><span class="n">feedbacks</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs</span><span class="p">[</span><span class="n">responses</span><span class="p">[</span><span class="mf">0</span><span class="p">]])</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = 0;
    __pyx_t_22 = 0;
    __pyx_t_23 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_responses.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">0366</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0367</span>:         <span class="c"># loop through all trials in current condition</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0368</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span> <span class="n">s_size</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_26 = __pyx_v_s_size;
    __pyx_t_27 = __pyx_t_26;
    for (__pyx_t_28 = 1; __pyx_t_28 &lt; __pyx_t_27; __pyx_t_28+=1) {
      __pyx_v_i = __pyx_t_28;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0369</span>:             <span class="n">p</span> <span class="o">=</span> <span class="n">full_pdf</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">((</span><span class="n">qs</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">v</span><span class="p">),</span> <span class="n">sv</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>      __pyx_t_22 = __pyx_v_i;
      __pyx_t_23 = 1;
      __pyx_t_12 = 0;
/* … */
      __pyx_t_30.__pyx_n = 4;
      __pyx_t_30.n_st = __pyx_v_n_st;
      __pyx_t_30.n_sz = __pyx_v_n_sz;
      __pyx_t_30.use_adaptive = __pyx_v_use_adaptive;
      __pyx_t_30.simps_err = __pyx_v_simps_err;
      __pyx_t_29 = __pyx_f_4wfpt_full_pdf((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_xs.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_xs.diminfo[0].strides)), (((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_23, __pyx_pybuffernd_qs.diminfo[0].strides)) - (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_qs.diminfo[0].strides))) * __pyx_v_v), __pyx_v_sv, __pyx_v_a, __pyx_v_z, __pyx_v_sz, __pyx_v_t, __pyx_v_st, __pyx_v_err, 0, &amp;__pyx_t_30); 
      __pyx_v_p = __pyx_t_29;
</pre><pre class="cython line score-0">&#xA0;<span class="">0370</span>:                          <span class="n">sz</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">n_st</span><span class="p">,</span> <span class="n">n_sz</span><span class="p">,</span> <span class="n">use_adaptive</span><span class="p">,</span> <span class="n">simps_err</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0371</span>:             <span class="c"># If one probability = 0, the log sum will be -Inf</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0372</span>:             <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">p_outlier</span><span class="p">)</span> <span class="o">+</span> <span class="n">wp_outlier</span></pre>
<pre class='cython code score-0 '>      __pyx_v_p = ((__pyx_v_p * (1.0 - __pyx_v_p_outlier)) + __pyx_v_wp_outlier);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0373</span>:             <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_8 = ((__pyx_v_p == 0.0) != 0);
      if (__pyx_t_8) {
/* … */
      }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0374</span>:                 <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-12 '>        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
        <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_r = __pyx_t_1;
        __pyx_t_1 = 0;
        goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0375</span>:             <span class="n">sum_logp</span> <span class="o">+=</span> <span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_sum_logp = (__pyx_v_sum_logp + log(__pyx_v_p));
</pre><pre class="cython line score-0">&#xA0;<span class="">0376</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0377</span>:             <span class="c"># get learning rate for current trial. if pos_alpha is not in</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0378</span>:             <span class="c"># include it will be same as alpha so can still use this</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0379</span>:             <span class="c"># calculation:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0380</span>:             <span class="k">if</span> <span class="n">feedbacks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">qs</span><span class="p">[</span><span class="n">responses</span><span class="p">[</span><span class="n">i</span><span class="p">]]:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = __pyx_v_i;
      __pyx_t_23 = __pyx_v_i;
      __pyx_t_22 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_23, __pyx_pybuffernd_responses.diminfo[0].strides));
      __pyx_t_8 = (((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_feedbacks.diminfo[0].strides)) &gt; (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_qs.diminfo[0].strides))) != 0);
      if (__pyx_t_8) {
/* … */
        goto __pyx_L11;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0381</span>:                 <span class="n">alfa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">pos_alfa</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">pos_alfa</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_v_alfa = (pow(2.718281828459, __pyx_v_pos_alfa) / (1.0 + pow(2.718281828459, __pyx_v_pos_alfa)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0382</span>:             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0383</span>:                 <span class="n">alfa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      /*else*/ {
        __pyx_v_alfa = (pow(2.718281828459, __pyx_v_alpha) / (1.0 + pow(2.718281828459, __pyx_v_alpha)));
      }
      __pyx_L11:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0384</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0385</span>:             <span class="c"># qs[1] is upper bound, qs[0] is lower bound. feedbacks is reward</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0386</span>:             <span class="c"># received on current trial.</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0387</span>:             <span class="n">qs</span><span class="p">[</span><span class="n">responses</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="n">responses</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>      __pyx_t_23 = __pyx_v_i;
      __pyx_t_22 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_23, __pyx_pybuffernd_responses.diminfo[0].strides));
/* … */
      __pyx_t_24 = __pyx_v_i;
      __pyx_t_25 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_responses.diminfo[0].strides));
      *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_25, __pyx_pybuffernd_qs.diminfo[0].strides) = ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_qs.diminfo[0].strides)) + (__pyx_v_alfa * ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_feedbacks.diminfo[0].strides)) - (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_qs.diminfo[0].strides)))));
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0388</span>:                 <span class="n">alfa</span> <span class="o">*</span> <span class="p">(</span><span class="n">feedbacks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs</span><span class="p">[</span><span class="n">responses</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = __pyx_v_i;
      __pyx_t_20 = __pyx_v_i;
      __pyx_t_21 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_responses.diminfo[0].strides));
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0389</span>:     <span class="k">return</span> <span class="n">sum_logp</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_sum_logp);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 389, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0390</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0391</span>: <span class="c"># JY added on 2022-01-03 for simultaneous regression on two-step tasks</span></pre>
<pre class="cython line score-885" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0392</span>: <span class="k">def</span> <span class="nf">wiener_like_rlddm_2step</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x1</span><span class="p">,</span> <span class="c"># 1st-stage RT</span></pre>
<pre class='cython code score-885 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_11wiener_like_rlddm_2step(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_10wiener_like_rlddm_2step[] = "wiener_like_rlddm_2step(ndarray x1, ndarray x2, ndarray s1, ndarray s2, ndarray response1, ndarray response2, ndarray feedback, ndarray split_by, double q, double alpha, double pos_alpha, double gamma, double gamma2, double lambda_, double v0, double v1, double v2, double v, double a, double z0, double z1, double z2, double z, double t, int nstates, double v_interaction, double z_interaction, double two_stage, double a_2, double z_2, double t_2, double v_2, double alpha2, double w, double w2, double z_scaler, double z_sigma, double z_sigma2, double window_start, double window_size, double beta_ndt, double beta_ndt2, double beta_ndt3, double err, int n_st=10, int n_sz=10, bool use_adaptive=1, double simps_err=1e-8, double p_outlier=0, double w_outlier=0)";
static PyMethodDef __pyx_mdef_4wfpt_11wiener_like_rlddm_2step = {"wiener_like_rlddm_2step", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_11wiener_like_rlddm_2step, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_10wiener_like_rlddm_2step};
static PyObject *__pyx_pw_4wfpt_11wiener_like_rlddm_2step(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_x1 = 0;
  PyArrayObject *__pyx_v_x2 = 0;
  PyArrayObject *__pyx_v_s1 = 0;
  PyArrayObject *__pyx_v_s2 = 0;
  PyArrayObject *__pyx_v_response1 = 0;
  PyArrayObject *__pyx_v_response2 = 0;
  PyArrayObject *__pyx_v_feedback = 0;
  PyArrayObject *__pyx_v_split_by = 0;
  double __pyx_v_q;
  double __pyx_v_alpha;
  double __pyx_v_pos_alpha;
  double __pyx_v_gamma;
  double __pyx_v_gamma2;
  double __pyx_v_lambda_;
  double __pyx_v_v0;
  double __pyx_v_v1;
  double __pyx_v_v2;
  double __pyx_v_v;
  double __pyx_v_a;
  double __pyx_v_z0;
  double __pyx_v_z1;
  double __pyx_v_z2;
  CYTHON_UNUSED double __pyx_v_z;
  double __pyx_v_t;
  int __pyx_v_nstates;
  double __pyx_v_v_interaction;
  double __pyx_v_z_interaction;
  double __pyx_v_two_stage;
  double __pyx_v_a_2;
  double __pyx_v_z_2;
  double __pyx_v_t_2;
  double __pyx_v_v_2;
  double __pyx_v_alpha2;
  double __pyx_v_w;
  double __pyx_v_w2;
  double __pyx_v_z_scaler;
  double __pyx_v_z_sigma;
  double __pyx_v_z_sigma2;
  double __pyx_v_window_start;
  double __pyx_v_window_size;
  double __pyx_v_beta_ndt;
  double __pyx_v_beta_ndt2;
  CYTHON_UNUSED double __pyx_v_beta_ndt3;
  double __pyx_v_err;
  int __pyx_v_n_st;
  int __pyx_v_n_sz;
  int __pyx_v_use_adaptive;
  double __pyx_v_simps_err;
  double __pyx_v_p_outlier;
  double __pyx_v_w_outlier;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_rlddm_2step (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_x1,&amp;__pyx_n_s_x2,&amp;__pyx_n_s_s1,&amp;__pyx_n_s_s2,&amp;__pyx_n_s_response1,&amp;__pyx_n_s_response2,&amp;__pyx_n_s_feedback,&amp;__pyx_n_s_split_by,&amp;__pyx_n_s_q,&amp;__pyx_n_s_alpha,&amp;__pyx_n_s_pos_alpha,&amp;__pyx_n_s_gamma,&amp;__pyx_n_s_gamma2,&amp;__pyx_n_s_lambda,&amp;__pyx_n_s_v0,&amp;__pyx_n_s_v1,&amp;__pyx_n_s_v2,&amp;__pyx_n_s_v,&amp;__pyx_n_s_a,&amp;__pyx_n_s_z0,&amp;__pyx_n_s_z1,&amp;__pyx_n_s_z2,&amp;__pyx_n_s_z,&amp;__pyx_n_s_t,&amp;__pyx_n_s_nstates,&amp;__pyx_n_s_v_interaction,&amp;__pyx_n_s_z_interaction,&amp;__pyx_n_s_two_stage,&amp;__pyx_n_s_a_2,&amp;__pyx_n_s_z_2,&amp;__pyx_n_s_t_2,&amp;__pyx_n_s_v_2,&amp;__pyx_n_s_alpha2,&amp;__pyx_n_s_w,&amp;__pyx_n_s_w2,&amp;__pyx_n_s_z_scaler,&amp;__pyx_n_s_z_sigma,&amp;__pyx_n_s_z_sigma2,&amp;__pyx_n_s_window_start,&amp;__pyx_n_s_window_size,&amp;__pyx_n_s_beta_ndt,&amp;__pyx_n_s_beta_ndt2,&amp;__pyx_n_s_beta_ndt3,&amp;__pyx_n_s_err,&amp;__pyx_n_s_n_st,&amp;__pyx_n_s_n_sz,&amp;__pyx_n_s_use_adaptive,&amp;__pyx_n_s_simps_err,&amp;__pyx_n_s_p_outlier,&amp;__pyx_n_s_w_outlier,0};
    PyObject* values[50] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 50: values[49] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 49);
        CYTHON_FALLTHROUGH;
        case 49: values[48] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 48);
        CYTHON_FALLTHROUGH;
        case 48: values[47] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 47);
        CYTHON_FALLTHROUGH;
        case 47: values[46] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 46);
        CYTHON_FALLTHROUGH;
        case 46: values[45] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 45);
        CYTHON_FALLTHROUGH;
        case 45: values[44] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 44);
        CYTHON_FALLTHROUGH;
        case 44: values[43] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 43);
        CYTHON_FALLTHROUGH;
        case 43: values[42] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 42);
        CYTHON_FALLTHROUGH;
        case 42: values[41] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 41);
        CYTHON_FALLTHROUGH;
        case 41: values[40] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 40);
        CYTHON_FALLTHROUGH;
        case 40: values[39] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 39);
        CYTHON_FALLTHROUGH;
        case 39: values[38] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 38);
        CYTHON_FALLTHROUGH;
        case 38: values[37] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 37);
        CYTHON_FALLTHROUGH;
        case 37: values[36] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 36);
        CYTHON_FALLTHROUGH;
        case 36: values[35] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 35);
        CYTHON_FALLTHROUGH;
        case 35: values[34] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 34);
        CYTHON_FALLTHROUGH;
        case 34: values[33] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 33);
        CYTHON_FALLTHROUGH;
        case 33: values[32] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 32);
        CYTHON_FALLTHROUGH;
        case 32: values[31] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 31);
        CYTHON_FALLTHROUGH;
        case 31: values[30] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 30);
        CYTHON_FALLTHROUGH;
        case 30: values[29] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 29);
        CYTHON_FALLTHROUGH;
        case 29: values[28] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 28);
        CYTHON_FALLTHROUGH;
        case 28: values[27] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 27);
        CYTHON_FALLTHROUGH;
        case 27: values[26] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 26);
        CYTHON_FALLTHROUGH;
        case 26: values[25] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 25);
        CYTHON_FALLTHROUGH;
        case 25: values[24] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 24);
        CYTHON_FALLTHROUGH;
        case 24: values[23] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 23);
        CYTHON_FALLTHROUGH;
        case 23: values[22] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 22);
        CYTHON_FALLTHROUGH;
        case 22: values[21] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 21);
        CYTHON_FALLTHROUGH;
        case 21: values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x1)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 1); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_s1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 2); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_s2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 3); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_response1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 4); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_response2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 5); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_feedback)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 6); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_split_by)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 7); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_q)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 8); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_alpha)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 9); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_pos_alpha)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 10); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_gamma)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 11); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (likely((values[12] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_gamma2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 12); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (likely((values[13] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lambda)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 13); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (likely((values[14] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v0)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 14); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (likely((values[15] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 15); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (likely((values[16] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 16); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (likely((values[17] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 17); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 18:
        if (likely((values[18] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 18); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 19:
        if (likely((values[19] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z0)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 19); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 20:
        if (likely((values[20] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 20); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 21:
        if (likely((values[21] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 21); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 22:
        if (likely((values[22] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 22); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 23:
        if (likely((values[23] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_t)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 23); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 24:
        if (likely((values[24] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nstates)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 24); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 25:
        if (likely((values[25] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v_interaction)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 25); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 26:
        if (likely((values[26] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z_interaction)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 26); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 27:
        if (likely((values[27] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_two_stage)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 27); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 28:
        if (likely((values[28] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_a_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 28); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 29:
        if (likely((values[29] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 29); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 30:
        if (likely((values[30] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_t_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 30); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 31:
        if (likely((values[31] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 31); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 32:
        if (likely((values[32] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_alpha2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 32); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 33:
        if (likely((values[33] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 33); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 34:
        if (likely((values[34] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 34); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 35:
        if (likely((values[35] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z_scaler)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 35); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 36:
        if (likely((values[36] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z_sigma)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 36); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 37:
        if (likely((values[37] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z_sigma2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 37); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 38:
        if (likely((values[38] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_window_start)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 38); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 39:
        if (likely((values[39] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_window_size)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 39); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 40:
        if (likely((values[40] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_beta_ndt)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 40); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 41:
        if (likely((values[41] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_beta_ndt2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 41); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 42:
        if (likely((values[42] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_beta_ndt3)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 42); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 43:
        if (likely((values[43] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_err)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, 43); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 44:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_st);
          if (value) { values[44] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 45:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_sz);
          if (value) { values[45] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 46:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_use_adaptive);
          if (value) { values[46] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 47:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_simps_err);
          if (value) { values[47] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 48:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_p_outlier);
          if (value) { values[48] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 49:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w_outlier);
          if (value) { values[49] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "wiener_like_rlddm_2step") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 50: values[49] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 49);
        CYTHON_FALLTHROUGH;
        case 49: values[48] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 48);
        CYTHON_FALLTHROUGH;
        case 48: values[47] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 47);
        CYTHON_FALLTHROUGH;
        case 47: values[46] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 46);
        CYTHON_FALLTHROUGH;
        case 46: values[45] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 45);
        CYTHON_FALLTHROUGH;
        case 45: values[44] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 44);
        CYTHON_FALLTHROUGH;
        case 44: values[43] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 43);
        values[42] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 42);
        values[41] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 41);
        values[40] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 40);
        values[39] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 39);
        values[38] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 38);
        values[37] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 37);
        values[36] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 36);
        values[35] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 35);
        values[34] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 34);
        values[33] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 33);
        values[32] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 32);
        values[31] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 31);
        values[30] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 30);
        values[29] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 29);
        values[28] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 28);
        values[27] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 27);
        values[26] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 26);
        values[25] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 25);
        values[24] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 24);
        values[23] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 23);
        values[22] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 22);
        values[21] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 21);
        values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_x1 = ((PyArrayObject *)values[0]);
    __pyx_v_x2 = ((PyArrayObject *)values[1]);
    __pyx_v_s1 = ((PyArrayObject *)values[2]);
    __pyx_v_s2 = ((PyArrayObject *)values[3]);
    __pyx_v_response1 = ((PyArrayObject *)values[4]);
    __pyx_v_response2 = ((PyArrayObject *)values[5]);
    __pyx_v_feedback = ((PyArrayObject *)values[6]);
    __pyx_v_split_by = ((PyArrayObject *)values[7]);
    __pyx_v_q = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]); if (unlikely((__pyx_v_q == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L3_error)</span>
    __pyx_v_alpha = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[9]); if (unlikely((__pyx_v_alpha == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L3_error)</span>
    __pyx_v_pos_alpha = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[10]); if (unlikely((__pyx_v_pos_alpha == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L3_error)</span>
    __pyx_v_gamma = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[11]); if (unlikely((__pyx_v_gamma == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L3_error)</span>
    __pyx_v_gamma2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[12]); if (unlikely((__pyx_v_gamma2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L3_error)</span>
    __pyx_v_lambda_ = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[13]); if (unlikely((__pyx_v_lambda_ == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
    __pyx_v_v0 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[14]); if (unlikely((__pyx_v_v0 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 409, __pyx_L3_error)</span>
    __pyx_v_v1 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[15]); if (unlikely((__pyx_v_v1 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 409, __pyx_L3_error)</span>
    __pyx_v_v2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[16]); if (unlikely((__pyx_v_v2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 409, __pyx_L3_error)</span>
    __pyx_v_v = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[17]); if (unlikely((__pyx_v_v == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 410, __pyx_L3_error)</span>
    __pyx_v_a = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[18]); if (unlikely((__pyx_v_a == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 412, __pyx_L3_error)</span>
    __pyx_v_z0 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[19]); if (unlikely((__pyx_v_z0 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 413, __pyx_L3_error)</span>
    __pyx_v_z1 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[20]); if (unlikely((__pyx_v_z1 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 413, __pyx_L3_error)</span>
    __pyx_v_z2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[21]); if (unlikely((__pyx_v_z2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 413, __pyx_L3_error)</span>
    __pyx_v_z = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[22]); if (unlikely((__pyx_v_z == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 414, __pyx_L3_error)</span>
    __pyx_v_t = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[23]); if (unlikely((__pyx_v_t == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 416, __pyx_L3_error)</span>
    __pyx_v_nstates = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[24]); if (unlikely((__pyx_v_nstates == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 417, __pyx_L3_error)</span>
    __pyx_v_v_interaction = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[25]); if (unlikely((__pyx_v_v_interaction == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 419, __pyx_L3_error)</span>
    __pyx_v_z_interaction = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[26]); if (unlikely((__pyx_v_z_interaction == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 419, __pyx_L3_error)</span>
    __pyx_v_two_stage = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[27]); if (unlikely((__pyx_v_two_stage == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 420, __pyx_L3_error)</span>
    __pyx_v_a_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[28]); if (unlikely((__pyx_v_a_2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 422, __pyx_L3_error)</span>
    __pyx_v_z_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[29]); if (unlikely((__pyx_v_z_2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 423, __pyx_L3_error)</span>
    __pyx_v_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[30]); if (unlikely((__pyx_v_t_2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 424, __pyx_L3_error)</span>
    __pyx_v_v_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[31]); if (unlikely((__pyx_v_v_2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 425, __pyx_L3_error)</span>
    __pyx_v_alpha2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[32]); if (unlikely((__pyx_v_alpha2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 426, __pyx_L3_error)</span>
    __pyx_v_w = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[33]); if (unlikely((__pyx_v_w == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 427, __pyx_L3_error)</span>
    __pyx_v_w2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[34]); if (unlikely((__pyx_v_w2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 427, __pyx_L3_error)</span>
    __pyx_v_z_scaler = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[35]); if (unlikely((__pyx_v_z_scaler == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 427, __pyx_L3_error)</span>
    __pyx_v_z_sigma = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[36]); if (unlikely((__pyx_v_z_sigma == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 428, __pyx_L3_error)</span>
    __pyx_v_z_sigma2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[37]); if (unlikely((__pyx_v_z_sigma2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 428, __pyx_L3_error)</span>
    __pyx_v_window_start = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[38]); if (unlikely((__pyx_v_window_start == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 429, __pyx_L3_error)</span>
    __pyx_v_window_size = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[39]); if (unlikely((__pyx_v_window_size == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 429, __pyx_L3_error)</span>
    __pyx_v_beta_ndt = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[40]); if (unlikely((__pyx_v_beta_ndt == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 430, __pyx_L3_error)</span>
    __pyx_v_beta_ndt2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[41]); if (unlikely((__pyx_v_beta_ndt2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 430, __pyx_L3_error)</span>
    __pyx_v_beta_ndt3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[42]); if (unlikely((__pyx_v_beta_ndt3 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 430, __pyx_L3_error)</span>
    __pyx_v_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[43]); if (unlikely((__pyx_v_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
    if (values[44]) {
      __pyx_v_n_st = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[44]); if (unlikely((__pyx_v_n_st == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_st = ((int)10);
    }
    if (values[45]) {
      __pyx_v_n_sz = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[45]); if (unlikely((__pyx_v_n_sz == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_sz = ((int)10);
    }
    if (values[46]) {
      __pyx_v_use_adaptive = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[46]); if (unlikely((__pyx_v_use_adaptive == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
    } else {
      __pyx_v_use_adaptive = ((int)1);
    }
    if (values[47]) {
      __pyx_v_simps_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[47]); if (unlikely((__pyx_v_simps_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
    } else {
      __pyx_v_simps_err = ((double)1e-8);
    }
    if (values[48]) {
      __pyx_v_p_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[48]); if (unlikely((__pyx_v_p_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 436, __pyx_L3_error)</span>
    } else {
      __pyx_v_p_outlier = ((double)0.0);
    }
    if (values[49]) {
      __pyx_v_w_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[49]); if (unlikely((__pyx_v_w_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 436, __pyx_L3_error)</span>
    } else {
      __pyx_v_w_outlier = ((double)0.0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_2step", 0, 44, 50, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_rlddm_2step", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x1), __pyx_ptype_5numpy_ndarray, 1, "x1", 0))) <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x2), __pyx_ptype_5numpy_ndarray, 1, "x2", 0))) <span class='error_goto'>__PYX_ERR(0, 394, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_s1), __pyx_ptype_5numpy_ndarray, 1, "s1", 0))) <span class='error_goto'>__PYX_ERR(0, 397, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_s2), __pyx_ptype_5numpy_ndarray, 1, "s2", 0))) <span class='error_goto'>__PYX_ERR(0, 398, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_response1), __pyx_ptype_5numpy_ndarray, 1, "response1", 0))) <span class='error_goto'>__PYX_ERR(0, 399, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_response2), __pyx_ptype_5numpy_ndarray, 1, "response2", 0))) <span class='error_goto'>__PYX_ERR(0, 400, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_feedback), __pyx_ptype_5numpy_ndarray, 1, "feedback", 0))) <span class='error_goto'>__PYX_ERR(0, 401, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_split_by), __pyx_ptype_5numpy_ndarray, 1, "split_by", 0))) <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4wfpt_10wiener_like_rlddm_2step(__pyx_self, __pyx_v_x1, __pyx_v_x2, __pyx_v_s1, __pyx_v_s2, __pyx_v_response1, __pyx_v_response2, __pyx_v_feedback, __pyx_v_split_by, __pyx_v_q, __pyx_v_alpha, __pyx_v_pos_alpha, __pyx_v_gamma, __pyx_v_gamma2, __pyx_v_lambda_, __pyx_v_v0, __pyx_v_v1, __pyx_v_v2, __pyx_v_v, __pyx_v_a, __pyx_v_z0, __pyx_v_z1, __pyx_v_z2, __pyx_v_z, __pyx_v_t, __pyx_v_nstates, __pyx_v_v_interaction, __pyx_v_z_interaction, __pyx_v_two_stage, __pyx_v_a_2, __pyx_v_z_2, __pyx_v_t_2, __pyx_v_v_2, __pyx_v_alpha2, __pyx_v_w, __pyx_v_w2, __pyx_v_z_scaler, __pyx_v_z_sigma, __pyx_v_z_sigma2, __pyx_v_window_start, __pyx_v_window_size, __pyx_v_beta_ndt, __pyx_v_beta_ndt2, __pyx_v_beta_ndt3, __pyx_v_err, __pyx_v_n_st, __pyx_v_n_sz, __pyx_v_use_adaptive, __pyx_v_simps_err, __pyx_v_p_outlier, __pyx_v_w_outlier);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_10wiener_like_rlddm_2step(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_x1, PyArrayObject *__pyx_v_x2, PyArrayObject *__pyx_v_s1, PyArrayObject *__pyx_v_s2, PyArrayObject *__pyx_v_response1, PyArrayObject *__pyx_v_response2, PyArrayObject *__pyx_v_feedback, PyArrayObject *__pyx_v_split_by, double __pyx_v_q, double __pyx_v_alpha, double __pyx_v_pos_alpha, double __pyx_v_gamma, double __pyx_v_gamma2, double __pyx_v_lambda_, double __pyx_v_v0, double __pyx_v_v1, double __pyx_v_v2, double __pyx_v_v, double __pyx_v_a, double __pyx_v_z0, double __pyx_v_z1, double __pyx_v_z2, CYTHON_UNUSED double __pyx_v_z, double __pyx_v_t, int __pyx_v_nstates, double __pyx_v_v_interaction, double __pyx_v_z_interaction, double __pyx_v_two_stage, double __pyx_v_a_2, double __pyx_v_z_2, double __pyx_v_t_2, double __pyx_v_v_2, double __pyx_v_alpha2, double __pyx_v_w, double __pyx_v_w2, double __pyx_v_z_scaler, double __pyx_v_z_sigma, double __pyx_v_z_sigma2, double __pyx_v_window_start, double __pyx_v_window_size, double __pyx_v_beta_ndt, double __pyx_v_beta_ndt2, CYTHON_UNUSED double __pyx_v_beta_ndt3, double __pyx_v_err, int __pyx_v_n_st, int __pyx_v_n_sz, int __pyx_v_use_adaptive, double __pyx_v_simps_err, double __pyx_v_p_outlier, double __pyx_v_w_outlier) {
  double __pyx_v_sz;
  double __pyx_v_st;
  double __pyx_v_sv;
  CYTHON_UNUSED Py_ssize_t __pyx_v_size;
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_j;
  Py_ssize_t __pyx_v_s_size;
  int __pyx_v_s;
  double __pyx_v_p;
  double __pyx_v_sum_logp;
  double __pyx_v_wp_outlier;
  double __pyx_v_alfa;
  CYTHON_UNUSED double __pyx_v_pos_alfa;
  double __pyx_v_alfa2;
  double __pyx_v_gamma_;
  double __pyx_v_gamma__;
  double __pyx_v_lambda__;
  PyArrayObject *__pyx_v_qs_mf = 0;
  PyArrayObject *__pyx_v_qs_mb = 0;
  PyArrayObject *__pyx_v_ndt_counter_set = 0;
  PyArrayObject *__pyx_v_ndt_counter_ind = 0;
  double __pyx_v_dtQ1;
  double __pyx_v_dtQ2;
  double __pyx_v_dtq_mb;
  double __pyx_v_dtq_mf;
  long __pyx_v_s_;
  long __pyx_v_a_;
  double __pyx_v_v_;
  double __pyx_v_z_;
  double __pyx_v_t_;
  double __pyx_v_sig;
  double __pyx_v_v_2_;
  double __pyx_v_z_2_;
  double __pyx_v_a_2_;
  double __pyx_v_t_2_;
  PyArrayObject *__pyx_v_x1s = 0;
  PyArrayObject *__pyx_v_x2s = 0;
  PyArrayObject *__pyx_v_feedbacks = 0;
  PyArrayObject *__pyx_v_responses1 = 0;
  PyArrayObject *__pyx_v_responses2 = 0;
  PyArrayObject *__pyx_v_unique = 0;
  PyArrayObject *__pyx_v_s1s = 0;
  PyArrayObject *__pyx_v_s2s = 0;
  PyArrayObject *__pyx_v_planets = 0;
  PyArrayObject *__pyx_v_counter = 0;
  PyArrayObject *__pyx_v_Qmb = 0;
  double __pyx_v_dtq;
  double __pyx_v_rt;
  PyArrayObject *__pyx_v_Tm = 0;
  PyArrayObject *__pyx_v_state_combinations = 0;
  PyObject *__pyx_v_qs = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Qmb;
  __Pyx_Buffer __pyx_pybuffer_Qmb;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Tm;
  __Pyx_Buffer __pyx_pybuffer_Tm;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_counter;
  __Pyx_Buffer __pyx_pybuffer_counter;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_feedback;
  __Pyx_Buffer __pyx_pybuffer_feedback;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_feedbacks;
  __Pyx_Buffer __pyx_pybuffer_feedbacks;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ndt_counter_ind;
  __Pyx_Buffer __pyx_pybuffer_ndt_counter_ind;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ndt_counter_set;
  __Pyx_Buffer __pyx_pybuffer_ndt_counter_set;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_planets;
  __Pyx_Buffer __pyx_pybuffer_planets;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_qs_mb;
  __Pyx_Buffer __pyx_pybuffer_qs_mb;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_qs_mf;
  __Pyx_Buffer __pyx_pybuffer_qs_mf;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_response1;
  __Pyx_Buffer __pyx_pybuffer_response1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_response2;
  __Pyx_Buffer __pyx_pybuffer_response2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_responses1;
  __Pyx_Buffer __pyx_pybuffer_responses1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_responses2;
  __Pyx_Buffer __pyx_pybuffer_responses2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_s1;
  __Pyx_Buffer __pyx_pybuffer_s1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_s1s;
  __Pyx_Buffer __pyx_pybuffer_s1s;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_s2;
  __Pyx_Buffer __pyx_pybuffer_s2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_s2s;
  __Pyx_Buffer __pyx_pybuffer_s2s;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_split_by;
  __Pyx_Buffer __pyx_pybuffer_split_by;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_state_combinations;
  __Pyx_Buffer __pyx_pybuffer_state_combinations;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_unique;
  __Pyx_Buffer __pyx_pybuffer_unique;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x1;
  __Pyx_Buffer __pyx_pybuffer_x1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x1s;
  __Pyx_Buffer __pyx_pybuffer_x1s;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x2;
  __Pyx_Buffer __pyx_pybuffer_x2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x2s;
  __Pyx_Buffer __pyx_pybuffer_x2s;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_rlddm_2step", 0);
  __pyx_pybuffer_qs_mf.pybuffer.buf = NULL;
  __pyx_pybuffer_qs_mf.refcount = 0;
  __pyx_pybuffernd_qs_mf.data = NULL;
  __pyx_pybuffernd_qs_mf.rcbuffer = &amp;__pyx_pybuffer_qs_mf;
  __pyx_pybuffer_qs_mb.pybuffer.buf = NULL;
  __pyx_pybuffer_qs_mb.refcount = 0;
  __pyx_pybuffernd_qs_mb.data = NULL;
  __pyx_pybuffernd_qs_mb.rcbuffer = &amp;__pyx_pybuffer_qs_mb;
  __pyx_pybuffer_ndt_counter_set.pybuffer.buf = NULL;
  __pyx_pybuffer_ndt_counter_set.refcount = 0;
  __pyx_pybuffernd_ndt_counter_set.data = NULL;
  __pyx_pybuffernd_ndt_counter_set.rcbuffer = &amp;__pyx_pybuffer_ndt_counter_set;
  __pyx_pybuffer_ndt_counter_ind.pybuffer.buf = NULL;
  __pyx_pybuffer_ndt_counter_ind.refcount = 0;
  __pyx_pybuffernd_ndt_counter_ind.data = NULL;
  __pyx_pybuffernd_ndt_counter_ind.rcbuffer = &amp;__pyx_pybuffer_ndt_counter_ind;
  __pyx_pybuffer_x1s.pybuffer.buf = NULL;
  __pyx_pybuffer_x1s.refcount = 0;
  __pyx_pybuffernd_x1s.data = NULL;
  __pyx_pybuffernd_x1s.rcbuffer = &amp;__pyx_pybuffer_x1s;
  __pyx_pybuffer_x2s.pybuffer.buf = NULL;
  __pyx_pybuffer_x2s.refcount = 0;
  __pyx_pybuffernd_x2s.data = NULL;
  __pyx_pybuffernd_x2s.rcbuffer = &amp;__pyx_pybuffer_x2s;
  __pyx_pybuffer_feedbacks.pybuffer.buf = NULL;
  __pyx_pybuffer_feedbacks.refcount = 0;
  __pyx_pybuffernd_feedbacks.data = NULL;
  __pyx_pybuffernd_feedbacks.rcbuffer = &amp;__pyx_pybuffer_feedbacks;
  __pyx_pybuffer_responses1.pybuffer.buf = NULL;
  __pyx_pybuffer_responses1.refcount = 0;
  __pyx_pybuffernd_responses1.data = NULL;
  __pyx_pybuffernd_responses1.rcbuffer = &amp;__pyx_pybuffer_responses1;
  __pyx_pybuffer_responses2.pybuffer.buf = NULL;
  __pyx_pybuffer_responses2.refcount = 0;
  __pyx_pybuffernd_responses2.data = NULL;
  __pyx_pybuffernd_responses2.rcbuffer = &amp;__pyx_pybuffer_responses2;
  __pyx_pybuffer_unique.pybuffer.buf = NULL;
  __pyx_pybuffer_unique.refcount = 0;
  __pyx_pybuffernd_unique.data = NULL;
  __pyx_pybuffernd_unique.rcbuffer = &amp;__pyx_pybuffer_unique;
  __pyx_pybuffer_s1s.pybuffer.buf = NULL;
  __pyx_pybuffer_s1s.refcount = 0;
  __pyx_pybuffernd_s1s.data = NULL;
  __pyx_pybuffernd_s1s.rcbuffer = &amp;__pyx_pybuffer_s1s;
  __pyx_pybuffer_s2s.pybuffer.buf = NULL;
  __pyx_pybuffer_s2s.refcount = 0;
  __pyx_pybuffernd_s2s.data = NULL;
  __pyx_pybuffernd_s2s.rcbuffer = &amp;__pyx_pybuffer_s2s;
  __pyx_pybuffer_planets.pybuffer.buf = NULL;
  __pyx_pybuffer_planets.refcount = 0;
  __pyx_pybuffernd_planets.data = NULL;
  __pyx_pybuffernd_planets.rcbuffer = &amp;__pyx_pybuffer_planets;
  __pyx_pybuffer_counter.pybuffer.buf = NULL;
  __pyx_pybuffer_counter.refcount = 0;
  __pyx_pybuffernd_counter.data = NULL;
  __pyx_pybuffernd_counter.rcbuffer = &amp;__pyx_pybuffer_counter;
  __pyx_pybuffer_Qmb.pybuffer.buf = NULL;
  __pyx_pybuffer_Qmb.refcount = 0;
  __pyx_pybuffernd_Qmb.data = NULL;
  __pyx_pybuffernd_Qmb.rcbuffer = &amp;__pyx_pybuffer_Qmb;
  __pyx_pybuffer_Tm.pybuffer.buf = NULL;
  __pyx_pybuffer_Tm.refcount = 0;
  __pyx_pybuffernd_Tm.data = NULL;
  __pyx_pybuffernd_Tm.rcbuffer = &amp;__pyx_pybuffer_Tm;
  __pyx_pybuffer_state_combinations.pybuffer.buf = NULL;
  __pyx_pybuffer_state_combinations.refcount = 0;
  __pyx_pybuffernd_state_combinations.data = NULL;
  __pyx_pybuffernd_state_combinations.rcbuffer = &amp;__pyx_pybuffer_state_combinations;
  __pyx_pybuffer_x1.pybuffer.buf = NULL;
  __pyx_pybuffer_x1.refcount = 0;
  __pyx_pybuffernd_x1.data = NULL;
  __pyx_pybuffernd_x1.rcbuffer = &amp;__pyx_pybuffer_x1;
  __pyx_pybuffer_x2.pybuffer.buf = NULL;
  __pyx_pybuffer_x2.refcount = 0;
  __pyx_pybuffernd_x2.data = NULL;
  __pyx_pybuffernd_x2.rcbuffer = &amp;__pyx_pybuffer_x2;
  __pyx_pybuffer_s1.pybuffer.buf = NULL;
  __pyx_pybuffer_s1.refcount = 0;
  __pyx_pybuffernd_s1.data = NULL;
  __pyx_pybuffernd_s1.rcbuffer = &amp;__pyx_pybuffer_s1;
  __pyx_pybuffer_s2.pybuffer.buf = NULL;
  __pyx_pybuffer_s2.refcount = 0;
  __pyx_pybuffernd_s2.data = NULL;
  __pyx_pybuffernd_s2.rcbuffer = &amp;__pyx_pybuffer_s2;
  __pyx_pybuffer_response1.pybuffer.buf = NULL;
  __pyx_pybuffer_response1.refcount = 0;
  __pyx_pybuffernd_response1.data = NULL;
  __pyx_pybuffernd_response1.rcbuffer = &amp;__pyx_pybuffer_response1;
  __pyx_pybuffer_response2.pybuffer.buf = NULL;
  __pyx_pybuffer_response2.refcount = 0;
  __pyx_pybuffernd_response2.data = NULL;
  __pyx_pybuffernd_response2.rcbuffer = &amp;__pyx_pybuffer_response2;
  __pyx_pybuffer_feedback.pybuffer.buf = NULL;
  __pyx_pybuffer_feedback.refcount = 0;
  __pyx_pybuffernd_feedback.data = NULL;
  __pyx_pybuffernd_feedback.rcbuffer = &amp;__pyx_pybuffer_feedback;
  __pyx_pybuffer_split_by.pybuffer.buf = NULL;
  __pyx_pybuffer_split_by.refcount = 0;
  __pyx_pybuffernd_split_by.data = NULL;
  __pyx_pybuffernd_split_by.rcbuffer = &amp;__pyx_pybuffer_split_by;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x1, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_x1.diminfo[0].strides = __pyx_pybuffernd_x1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x1.diminfo[0].shape = __pyx_pybuffernd_x1.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x2, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_x2.diminfo[0].strides = __pyx_pybuffernd_x2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x2.diminfo[0].shape = __pyx_pybuffernd_x2.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_s1, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_s1.diminfo[0].strides = __pyx_pybuffernd_s1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_s1.diminfo[0].shape = __pyx_pybuffernd_s1.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_s2, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_s2.diminfo[0].strides = __pyx_pybuffernd_s2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_s2.diminfo[0].shape = __pyx_pybuffernd_s2.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_response1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_response1, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_response1.diminfo[0].strides = __pyx_pybuffernd_response1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_response1.diminfo[0].shape = __pyx_pybuffernd_response1.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_response2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_response2, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_response2.diminfo[0].strides = __pyx_pybuffernd_response2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_response2.diminfo[0].shape = __pyx_pybuffernd_response2.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_feedback, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_feedback.diminfo[0].strides = __pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_feedback.diminfo[0].shape = __pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_split_by, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_split_by.diminfo[0].strides = __pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_split_by.diminfo[0].shape = __pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response2.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s2.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x2.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_rlddm_2step", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_qs_mf);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_qs_mb);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_ndt_counter_set);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_ndt_counter_ind);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_x1s);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_x2s);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_feedbacks);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_responses1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_responses2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_unique);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_s1s);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_s2s);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_planets);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_counter);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Qmb);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Tm);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_state_combinations);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_qs);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__19 = <span class='py_c_api'>PyTuple_Pack</span>(101, __pyx_n_s_x1, __pyx_n_s_x2, __pyx_n_s_s1, __pyx_n_s_s2, __pyx_n_s_response1, __pyx_n_s_response2, __pyx_n_s_feedback, __pyx_n_s_split_by, __pyx_n_s_q, __pyx_n_s_alpha, __pyx_n_s_pos_alpha, __pyx_n_s_gamma, __pyx_n_s_gamma2, __pyx_n_s_lambda, __pyx_n_s_v0, __pyx_n_s_v1, __pyx_n_s_v2, __pyx_n_s_v, __pyx_n_s_a, __pyx_n_s_z0, __pyx_n_s_z1, __pyx_n_s_z2, __pyx_n_s_z, __pyx_n_s_t, __pyx_n_s_nstates, __pyx_n_s_v_interaction, __pyx_n_s_z_interaction, __pyx_n_s_two_stage, __pyx_n_s_a_2, __pyx_n_s_z_2, __pyx_n_s_t_2, __pyx_n_s_v_2, __pyx_n_s_alpha2, __pyx_n_s_w, __pyx_n_s_w2, __pyx_n_s_z_scaler, __pyx_n_s_z_sigma, __pyx_n_s_z_sigma2, __pyx_n_s_window_start, __pyx_n_s_window_size, __pyx_n_s_beta_ndt, __pyx_n_s_beta_ndt2, __pyx_n_s_beta_ndt3, __pyx_n_s_err, __pyx_n_s_n_st, __pyx_n_s_n_sz, __pyx_n_s_use_adaptive, __pyx_n_s_simps_err, __pyx_n_s_p_outlier, __pyx_n_s_w_outlier, __pyx_n_s_sz, __pyx_n_s_st, __pyx_n_s_sv, __pyx_n_s_size, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_s_size, __pyx_n_s_s, __pyx_n_s_p, __pyx_n_s_sum_logp, __pyx_n_s_wp_outlier, __pyx_n_s_alfa, __pyx_n_s_pos_alfa, __pyx_n_s_alfa2, __pyx_n_s_gamma_2, __pyx_n_s_gamma_3, __pyx_n_s_lambda_2, __pyx_n_s_qs_mf, __pyx_n_s_qs_mb, __pyx_n_s_ndt_counter_set, __pyx_n_s_ndt_counter_ind, __pyx_n_s_dtQ1, __pyx_n_s_dtQ2, __pyx_n_s_dtq_mb, __pyx_n_s_dtq_mf, __pyx_n_s_s_2, __pyx_n_s_a_3, __pyx_n_s_v_3, __pyx_n_s_z_3, __pyx_n_s_t_3, __pyx_n_s_sig, __pyx_n_s_v_2_2, __pyx_n_s_z_2_2, __pyx_n_s_a_2_2, __pyx_n_s_t_2_2, __pyx_n_s_x1s, __pyx_n_s_x2s, __pyx_n_s_feedbacks, __pyx_n_s_responses1, __pyx_n_s_responses2, __pyx_n_s_unique, __pyx_n_s_s1s, __pyx_n_s_s2s, __pyx_n_s_planets, __pyx_n_s_counter, __pyx_n_s_Qmb, __pyx_n_s_dtq, __pyx_n_s_rt, __pyx_n_s_Tm, __pyx_n_s_state_combinations, __pyx_n_s_qs);<span class='error_goto'> if (unlikely(!__pyx_tuple__19)) __PYX_ERR(0, 392, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__19);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__19);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_11wiener_like_rlddm_2step, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 392, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_wiener_like_rlddm_2step, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__20 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(50, 0, 101, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__19, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_wiener_like_rlddm_2step, 392, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__20)) __PYX_ERR(0, 392, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0393</span>: <span class="c"># def wiener_like_rlddm_2step_reg_sliding_window(np.ndarray[double, ndim=1] x1, # 1st-stage RT</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0394</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x2</span><span class="p">,</span> <span class="c"># 2nd-stage RT</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0395</span>:                       <span class="c"># np.ndarray[long, ndim=1] isleft1, # whether left response 1st-stage,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0396</span>:                       <span class="c"># np.ndarray[long, ndim=1] isleft2, # whether left response 2nd-stage</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0397</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span><span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">s1</span><span class="p">,</span> <span class="c"># 1st-stage state</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0398</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span><span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">s2</span><span class="p">,</span> <span class="c"># 2nd-stage state</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0399</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">response1</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0400</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">response2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0401</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">feedback</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0402</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">split_by</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0403</span>:                       <span class="n">double</span> <span class="n">q</span><span class="p">,</span> <span class="n">double</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">double</span> <span class="n">pos_alpha</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0404</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0405</span>:                       <span class="c"># double w,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0406</span>:                       <span class="n">double</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">double</span> <span class="n">gamma2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0407</span>:                       <span class="n">double</span> <span class="n">lambda_</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0408</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0409</span>:                       <span class="n">double</span> <span class="n">v0</span><span class="p">,</span> <span class="n">double</span> <span class="n">v1</span><span class="p">,</span> <span class="n">double</span> <span class="n">v2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0410</span>:                       <span class="n">double</span> <span class="n">v</span><span class="p">,</span> <span class="c"># don&#39;t use second stage</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0411</span>:                       <span class="c"># double sv,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0412</span>:                       <span class="n">double</span> <span class="n">a</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0413</span>:                       <span class="n">double</span> <span class="n">z0</span><span class="p">,</span> <span class="n">double</span> <span class="n">z1</span><span class="p">,</span> <span class="n">double</span> <span class="n">z2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0414</span>:                       <span class="n">double</span> <span class="n">z</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0415</span>:                       <span class="c"># double sz,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0416</span>:                       <span class="n">double</span> <span class="n">t</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0417</span>:                       <span class="nb">int</span> <span class="n">nstates</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0418</span>:                       <span class="c"># double v_qval, double z_qval,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0419</span>:                       <span class="n">double</span> <span class="n">v_interaction</span><span class="p">,</span> <span class="n">double</span> <span class="n">z_interaction</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0420</span>:                       <span class="n">double</span> <span class="n">two_stage</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0421</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0422</span>:                       <span class="n">double</span> <span class="n">a_2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0423</span>:                       <span class="n">double</span> <span class="n">z_2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0424</span>:                       <span class="n">double</span> <span class="n">t_2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0425</span>:                       <span class="n">double</span> <span class="n">v_2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0426</span>:                       <span class="n">double</span> <span class="n">alpha2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0427</span>:                       <span class="n">double</span> <span class="n">w</span><span class="p">,</span> <span class="n">double</span> <span class="n">w2</span><span class="p">,</span> <span class="n">double</span> <span class="n">z_scaler</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0428</span>:                       <span class="n">double</span> <span class="n">z_sigma</span><span class="p">,</span> <span class="n">double</span> <span class="n">z_sigma2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0429</span>:                       <span class="n">double</span> <span class="n">window_start</span><span class="p">,</span> <span class="n">double</span> <span class="n">window_size</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0430</span>:                       <span class="n">double</span> <span class="n">beta_ndt</span><span class="p">,</span> <span class="n">double</span> <span class="n">beta_ndt2</span><span class="p">,</span> <span class="n">double</span> <span class="n">beta_ndt3</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0431</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0432</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0433</span>:                       <span class="c"># double st,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0434</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0435</span>:                       <span class="n">double</span> <span class="n">err</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_st</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_sz</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">use_adaptive</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span> <span class="n">double</span> <span class="n">simps_err</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0436</span>:                       <span class="n">double</span> <span class="n">p_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="n">double</span> <span class="n">w_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0437</span>:                       <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0438</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0439</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0440</span>:     <span class="c"># cdef double a = 1</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0441</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sz</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sz = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0442</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">st</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_st = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0443</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sv</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sv = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0444</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0445</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0446</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">size</span> <span class="o">=</span> <span class="n">x1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_size = (__pyx_v_x1-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0447</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0448</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">s_size</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0449</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0450</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">p</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0451</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sum_logp</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sum_logp = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0452</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">wp_outlier</span> <span class="o">=</span> <span class="n">w_outlier</span> <span class="o">*</span> <span class="n">p_outlier</span></pre>
<pre class='cython code score-0 '>  __pyx_v_wp_outlier = (__pyx_v_w_outlier * __pyx_v_p_outlier);
</pre><pre class="cython line score-0">&#xA0;<span class="">0453</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">alfa</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0454</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">pos_alfa</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0455</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">alfa2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0456</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0457</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">gamma_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0458</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">gamma__</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0459</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">lambda__</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0460</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0461</span>:     <span class="c"># cdef np.ndarray[double, ndim=1] qs = np.array([q, q])</span></pre>
<pre class="cython line score-69" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0462</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">qs_mf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">comb</span><span class="p">(</span><span class="n">nstates</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="n">exact</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="mf">2</span><span class="p">))</span><span class="o">*</span><span class="n">q</span> <span class="c"># first-stage MF Q-values</span></pre>
<pre class='cython code score-69 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 462, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 462, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_comb);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 462, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 462, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 462, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_int_2);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 462, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_exact, Py_True) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 462, __pyx_L1_error)</span>
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_5, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 462, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 462, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_int_2);
  __pyx_t_6 = 0;
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 462, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 462, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_1, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 462, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 462, __pyx_L1_error)</span>
  __pyx_t_7 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_7, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_qs_mf = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 462, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_qs_mf.diminfo[0].strides = __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_qs_mf.diminfo[0].shape = __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_qs_mf.diminfo[1].strides = __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_qs_mf.diminfo[1].shape = __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_7 = 0;
  __pyx_v_qs_mf = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-47" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0463</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">qs_mb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nstates</span><span class="p">,</span> <span class="mf">2</span><span class="p">))</span><span class="o">*</span><span class="n">q</span> <span class="c"># second-stage Q-values</span></pre>
<pre class='cython code score-47 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 463, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 463, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 463, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 463, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_int_2);
  __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_3, __pyx_t_6) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 463, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 463, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_6 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_4, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 463, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 463, __pyx_L1_error)</span>
  __pyx_t_8 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_8, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_qs_mb = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 463, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_qs_mb.diminfo[0].strides = __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_qs_mb.diminfo[0].shape = __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_qs_mb.diminfo[1].strides = __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_qs_mb.diminfo[1].shape = __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_8 = 0;
  __pyx_v_qs_mb = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0464</span>: </pre>
<pre class="cython line score-57" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0465</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">ndt_counter_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">comb</span><span class="p">(</span><span class="n">nstates</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="n">exact</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="mf">1</span><span class="p">))</span> <span class="c"># first-stage MF Q-values</span></pre>
<pre class='cython code score-57 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 465, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 465, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_comb);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 465, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 465, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 465, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_int_2);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 465, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_exact, Py_True) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 465, __pyx_L1_error)</span>
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_5, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 465, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 465, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_int_1);
  __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_6 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 465, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 465, __pyx_L1_error)</span>
  __pyx_t_9 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_9, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_ndt_counter_set = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 465, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_ndt_counter_set.diminfo[0].strides = __pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_ndt_counter_set.diminfo[0].shape = __pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_ndt_counter_set.diminfo[1].strides = __pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_ndt_counter_set.diminfo[1].shape = __pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_9 = 0;
  __pyx_v_ndt_counter_set = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-35" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0466</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">ndt_counter_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nstates</span><span class="p">,</span> <span class="mf">1</span><span class="p">))</span> <span class="c"># first-stage MF Q-values</span></pre>
<pre class='cython code score-35 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 466, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 466, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 466, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 466, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_int_1);
  __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_6 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_2) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 466, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 466, __pyx_L1_error)</span>
  __pyx_t_10 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_10, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_ndt_counter_ind = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 466, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_ndt_counter_ind.diminfo[0].strides = __pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_ndt_counter_ind.diminfo[0].shape = __pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_ndt_counter_ind.diminfo[1].strides = __pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_ndt_counter_ind.diminfo[1].shape = __pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_10 = 0;
  __pyx_v_ndt_counter_ind = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0467</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0468</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0469</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dtQ1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0470</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dtQ2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0471</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0472</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dtq_mb</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0473</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dtq_mf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0474</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0475</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">s_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0476</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">a_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0477</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">v_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0478</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">z_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0479</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">t_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0480</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sig</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0481</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">v_2_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0482</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">z_2_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0483</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">a_2_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0484</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">t_2_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0485</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0486</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0487</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x1s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0488</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x2s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0489</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">feedbacks</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0490</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">responses1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0491</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">responses2</span></pre>
<pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0492</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">split_by</span><span class="p">)</span></pre>
<pre class='cython code score-24 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 492, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_unique);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 492, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_6 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, ((PyObject *)__pyx_v_split_by)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, ((PyObject *)__pyx_v_split_by));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 492, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 492, __pyx_L1_error)</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_unique = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 492, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_unique.diminfo[0].strides = __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_unique.diminfo[0].shape = __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_11 = 0;
  __pyx_v_unique = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0493</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0494</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">s1s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0495</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">s2s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0496</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0497</span>:     <span class="c"># Added by Jungsun Yoo on 2021-11-27 for two-step tasks</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0498</span>:     <span class="c"># parameters added for two-step</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0499</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0500</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0501</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">planets</span></pre>
<pre class="cython line score-49" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0502</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">comb</span><span class="p">(</span><span class="n">nstates</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="n">exact</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span></pre>
<pre class='cython code score-49 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_comb);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_int_2);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_exact, Py_True) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 502, __pyx_L1_error)</span>
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_5, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_6 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 502, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 502, __pyx_L1_error)</span>
  __pyx_t_12 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_12, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_counter = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 502, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_counter.diminfo[0].strides = __pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_counter.diminfo[0].shape = __pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_12 = 0;
  __pyx_v_counter = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0503</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">Qmb</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0504</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dtq</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0505</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">rt</span></pre>
<pre class="cython line score-50" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0506</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">Tm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">]])</span> <span class="c"># transition matrix</span></pre>
<pre class='cython code score-50 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 506, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 506, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 506, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_7);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_3, 0, __pyx_float_0_7);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_3);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_3, 1, __pyx_float_0_3);
  __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 506, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_3);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 0, __pyx_float_0_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_7);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 1, __pyx_float_0_7);
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 506, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4);
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_6 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_4, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 506, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 506, __pyx_L1_error)</span>
  __pyx_t_13 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_13, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_Tm = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 506, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_Tm.diminfo[0].strides = __pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Tm.diminfo[0].shape = __pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Tm.diminfo[1].strides = __pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Tm.diminfo[1].shape = __pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_13 = 0;
  __pyx_v_Tm = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-96" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0507</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">state_combinations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nstates</span><span class="p">),</span><span class="mf">2</span><span class="p">)))</span></pre>
<pre class='cython code score-96 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_itertools);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_combinations);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_arange);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_15 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_14))) {
    __pyx_t_15 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_14);
    if (likely(__pyx_t_15)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_14);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_15);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_14, function);
    }
  }
  __pyx_t_4 = (__pyx_t_15) ? __Pyx_PyObject_Call2Args(__pyx_t_14, __pyx_t_15, __pyx_t_2) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_14, __pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  __pyx_t_14 = NULL;
  __pyx_t_16 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_14 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_14)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_16 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_14, __pyx_t_4, __pyx_int_2};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_16, 2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_14, __pyx_t_4, __pyx_int_2};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_16, 2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  {
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    if (__pyx_t_14) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_14); __pyx_t_14 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0+__pyx_t_16, __pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1+__pyx_t_16, __pyx_int_2);
    __pyx_t_4 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PySequence_List</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_1)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
    }
  }
  __pyx_t_6 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_1, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
  __pyx_t_17 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_17, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_state_combinations = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_state_combinations.diminfo[0].strides = __pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_state_combinations.diminfo[0].shape = __pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_state_combinations.diminfo[1].strides = __pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_state_combinations.diminfo[1].shape = __pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_17 = 0;
  __pyx_v_state_combinations = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0508</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0509</span>:     <span class="k">if</span> <span class="ow">not</span> <span class="n">p_outlier_in_range</span><span class="p">(</span><span class="n">p_outlier</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_18 = ((!(__pyx_f_4wfpt_p_outlier_in_range(__pyx_v_p_outlier) != 0)) != 0);
  if (__pyx_t_18) {
/* … */
  }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0510</span>:         <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-12 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 510, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 510, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 510, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_r = __pyx_t_6;
    __pyx_t_6 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0511</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0512</span>:     <span class="k">if</span> <span class="n">pos_alpha</span><span class="o">==</span><span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_18 = ((__pyx_v_pos_alpha == 100.00) != 0);
  if (__pyx_t_18) {
/* … */
    goto __pyx_L4;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0513</span>:         <span class="n">pos_alfa</span> <span class="o">=</span> <span class="n">alpha</span></pre>
<pre class='cython code score-0 '>    __pyx_v_pos_alfa = __pyx_v_alpha;
</pre><pre class="cython line score-0">&#xA0;<span class="">0514</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0515</span>:         <span class="n">pos_alfa</span> <span class="o">=</span> <span class="n">pos_alpha</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_pos_alfa = __pyx_v_pos_alpha;
  }
  __pyx_L4:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0516</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0517</span>:     <span class="c"># unique represent # of conditions</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0518</span>:     <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">unique</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_19 = (__pyx_v_unique-&gt;dimensions[0]);
  __pyx_t_20 = __pyx_t_19;
  for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_20; __pyx_t_21+=1) {
    __pyx_v_j = __pyx_t_21;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0519</span>:         <span class="n">s</span> <span class="o">=</span> <span class="n">unique</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_22 = __pyx_v_j;
    __pyx_v_s = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_unique.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">0520</span>:         <span class="c"># select trials for current condition, identified by the split_by-array</span></pre>
<pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0521</span>:         <span class="n">feedbacks</span> <span class="o">=</span> <span class="n">feedback</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 521, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 521, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_feedback), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 521, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 521, __pyx_L1_error)</span>
    __pyx_t_23 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer);
      __pyx_t_16 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_23, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_16 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_24, &amp;__pyx_t_25, &amp;__pyx_t_26);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_feedbacks, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_26);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_24, __pyx_t_25, __pyx_t_26);
        }
        __pyx_t_24 = __pyx_t_25 = __pyx_t_26 = 0;
      }
      __pyx_pybuffernd_feedbacks.diminfo[0].strides = __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_feedbacks.diminfo[0].shape = __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_16 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 521, __pyx_L1_error)</span>
    }
    __pyx_t_23 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_feedbacks, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0522</span>:         <span class="n">responses1</span> <span class="o">=</span> <span class="n">response1</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_response1), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L1_error)</span>
    __pyx_t_27 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer);
      __pyx_t_16 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_27, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_16 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_26, &amp;__pyx_t_25, &amp;__pyx_t_24);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_responses1, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_26, __pyx_t_25, __pyx_t_24);
        }
        __pyx_t_26 = __pyx_t_25 = __pyx_t_24 = 0;
      }
      __pyx_pybuffernd_responses1.diminfo[0].strides = __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_responses1.diminfo[0].shape = __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_16 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L1_error)</span>
    }
    __pyx_t_27 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_responses1, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0523</span>:         <span class="n">responses2</span> <span class="o">=</span> <span class="n">response2</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 523, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 523, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_response2), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 523, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 523, __pyx_L1_error)</span>
    __pyx_t_28 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer);
      __pyx_t_16 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_28, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_16 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_24, &amp;__pyx_t_25, &amp;__pyx_t_26);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_responses2, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_26);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_24, __pyx_t_25, __pyx_t_26);
        }
        __pyx_t_24 = __pyx_t_25 = __pyx_t_26 = 0;
      }
      __pyx_pybuffernd_responses2.diminfo[0].strides = __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_responses2.diminfo[0].shape = __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_16 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 523, __pyx_L1_error)</span>
    }
    __pyx_t_28 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_responses2, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0524</span>:         <span class="n">x1s</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 524, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 524, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_x1), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 524, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 524, __pyx_L1_error)</span>
    __pyx_t_29 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer);
      __pyx_t_16 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_29, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_16 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_26, &amp;__pyx_t_25, &amp;__pyx_t_24);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x1s, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_26, __pyx_t_25, __pyx_t_24);
        }
        __pyx_t_26 = __pyx_t_25 = __pyx_t_24 = 0;
      }
      __pyx_pybuffernd_x1s.diminfo[0].strides = __pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x1s.diminfo[0].shape = __pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_16 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 524, __pyx_L1_error)</span>
    }
    __pyx_t_29 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_x1s, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0525</span>:         <span class="n">x2s</span> <span class="o">=</span> <span class="n">x2</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_x2), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 525, __pyx_L1_error)</span>
    __pyx_t_30 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer);
      __pyx_t_16 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_30, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_16 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_24, &amp;__pyx_t_25, &amp;__pyx_t_26);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x2s, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_26);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_24, __pyx_t_25, __pyx_t_26);
        }
        __pyx_t_24 = __pyx_t_25 = __pyx_t_26 = 0;
      }
      __pyx_pybuffernd_x2s.diminfo[0].strides = __pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x2s.diminfo[0].shape = __pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_16 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 525, __pyx_L1_error)</span>
    }
    __pyx_t_30 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_x2s, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0526</span>:         <span class="n">s1s</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 526, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_s1), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 526, __pyx_L1_error)</span>
    __pyx_t_31 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer);
      __pyx_t_16 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_31, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_16 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_26, &amp;__pyx_t_25, &amp;__pyx_t_24);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_s1s, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_26, __pyx_t_25, __pyx_t_24);
        }
        __pyx_t_26 = __pyx_t_25 = __pyx_t_24 = 0;
      }
      __pyx_pybuffernd_s1s.diminfo[0].strides = __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_s1s.diminfo[0].shape = __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_16 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 526, __pyx_L1_error)</span>
    }
    __pyx_t_31 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_s1s, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0527</span>:         <span class="n">s2s</span> <span class="o">=</span> <span class="n">s2</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 527, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 527, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_s2), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 527, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 527, __pyx_L1_error)</span>
    __pyx_t_32 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer);
      __pyx_t_16 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_32, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_16 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_24, &amp;__pyx_t_25, &amp;__pyx_t_26);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_s2s, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_26);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_24, __pyx_t_25, __pyx_t_26);
        }
        __pyx_t_24 = __pyx_t_25 = __pyx_t_26 = 0;
      }
      __pyx_pybuffernd_s2s.diminfo[0].strides = __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_s2s.diminfo[0].shape = __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_16 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 527, __pyx_L1_error)</span>
    }
    __pyx_t_32 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_s2s, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0528</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0529</span>:         <span class="n">s_size</span> <span class="o">=</span> <span class="n">x1s</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_v_s_size = (__pyx_v_x1s-&gt;dimensions[0]);
</pre><pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0530</span>:         <span class="n">qs_mf</span><span class="p">[:,</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-21 '>    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 530, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
/* … */
  __pyx_slice_ = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice_)) __PYX_ERR(0, 530, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
    if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_qs_mf), __pyx_tuple__2, __pyx_t_6) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 530, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_tuple__2 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_slice_, __pyx_int_0);<span class='error_goto'> if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 530, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__2);
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0531</span>:         <span class="n">qs_mf</span><span class="p">[:,</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-16 '>    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 531, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_qs_mf), __pyx_tuple__3, __pyx_t_6) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 531, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
/* … */
  __pyx_tuple__3 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_slice_, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 531, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__3);
</pre><pre class="cython line score-0">&#xA0;<span class="">0532</span>: </pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0533</span>:         <span class="n">qs_mb</span><span class="p">[:,</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-11 '>    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 533, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_qs_mb), __pyx_tuple__2, __pyx_t_6) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 533, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0534</span>:         <span class="n">qs_mb</span><span class="p">[:,</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-11 '>    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 534, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_qs_mb), __pyx_tuple__3, __pyx_t_6) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 534, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0535</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0536</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0537</span>:         <span class="n">alfa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_alfa = (pow(2.718281828459, __pyx_v_alpha) / (1.0 + pow(2.718281828459, __pyx_v_alpha)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0538</span>:         <span class="n">gamma_</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">gamma</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">gamma</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_gamma_ = (pow(2.718281828459, __pyx_v_gamma) / (1.0 + pow(2.718281828459, __pyx_v_gamma)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0539</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0540</span>:         <span class="k">if</span> <span class="n">gamma2</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_18 = ((__pyx_v_gamma2 != 100.00) != 0);
    if (__pyx_t_18) {
/* … */
      goto __pyx_L7;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0541</span>:             <span class="n">gamma__</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">gamma2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">gamma2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_gamma__ = (pow(2.718281828459, __pyx_v_gamma2) / (1.0 + pow(2.718281828459, __pyx_v_gamma2)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0542</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0543</span>:             <span class="n">gamma__</span> <span class="o">=</span> <span class="n">gamma_</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_gamma__ = __pyx_v_gamma_;
    }
    __pyx_L7:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0544</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0545</span>:         <span class="k">if</span> <span class="n">alpha2</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_18 = ((__pyx_v_alpha2 != 100.00) != 0);
    if (__pyx_t_18) {
/* … */
      goto __pyx_L8;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0546</span>:             <span class="n">alfa2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_alfa2 = (pow(2.718281828459, __pyx_v_alpha2) / (1.0 + pow(2.718281828459, __pyx_v_alpha2)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0547</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0548</span>:             <span class="n">alfa2</span> <span class="o">=</span> <span class="n">alfa</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_alfa2 = __pyx_v_alfa;
    }
    __pyx_L8:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0549</span>:         <span class="k">if</span> <span class="n">lambda_</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_18 = ((__pyx_v_lambda_ != 100.00) != 0);
    if (__pyx_t_18) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0550</span>:             <span class="n">lambda__</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">lambda_</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">lambda_</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_lambda__ = (pow(2.718281828459, __pyx_v_lambda_) / (1.0 + pow(2.718281828459, __pyx_v_lambda_)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0551</span>:         <span class="k">if</span> <span class="n">w</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_18 = ((__pyx_v_w != 100.00) != 0);
    if (__pyx_t_18) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0552</span>:             <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">w</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_w = (pow(2.718281828459, __pyx_v_w) / (1.0 + pow(2.718281828459, __pyx_v_w)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0553</span>:         <span class="k">if</span> <span class="n">w2</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_18 = ((__pyx_v_w2 != 100.00) != 0);
    if (__pyx_t_18) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0554</span>:             <span class="n">w2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">w2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">w2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_w2 = (pow(2.718281828459, __pyx_v_w2) / (1.0 + pow(2.718281828459, __pyx_v_w2)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0555</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0556</span>:         <span class="c"># if beta_ndt != 100.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0557</span>:         <span class="c">#     beta_ndt = (2.718281828459**beta_ndt) / (1 + 2.718281828459**beta_ndt)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0558</span>:         <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0559</span>:         <span class="c"># if beta_ndt2 != 100.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0560</span>:         <span class="c">#     beta_ndt2 = (2.718281828459**beta_ndt2) / (1 + 2.718281828459**beta_ndt2)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0561</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0562</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0563</span>:         <span class="c"># don&#39;t calculate pdf for first trial but still update q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0564</span>:         <span class="c"># if feedbacks[0] &gt; qs[responses[0]]:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0565</span>:             <span class="c"># alfa = (2.718281828459**pos_alfa) / (1 + 2.718281828459**pos_alfa)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0566</span>:         <span class="c"># else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0567</span>:             <span class="c"># alfa = (2.718281828459**alpha) / (1 + 2.718281828459**alpha)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0568</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0569</span>:         <span class="c"># # qs[1] is upper bound, qs[0] is lower bound. feedbacks is reward</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0570</span>:         <span class="c"># # received on current trial.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0571</span>:         <span class="c"># qs[responses[0]] = qs[responses[0]] + \</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0572</span>:         <span class="c">#     alfa * (feedbacks[0] - qs[responses[0]])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0573</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0574</span>:         <span class="c"># loop through all trials in current condition</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0575</span>:         <span class="c"># print(window_size, window_start)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0576</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="n">s_size</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_33 = __pyx_v_s_size;
    __pyx_t_34 = __pyx_t_33;
    for (__pyx_t_35 = 0; __pyx_t_35 &lt; __pyx_t_34; __pyx_t_35+=1) {
      __pyx_v_i = __pyx_t_35;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0577</span>:             <span class="k">if</span> <span class="n">window_start</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">window_start</span> <span class="o">+</span> <span class="n">window_size</span><span class="p">:</span>  <span class="c"># and (window_start &lt;= i &lt; window_start+window_size):</span></pre>
<pre class='cython code score-0 '>      __pyx_t_18 = (__pyx_v_window_start &lt;= __pyx_v_i);
      if (__pyx_t_18) {
        __pyx_t_18 = (__pyx_v_i &lt; (__pyx_v_window_start + __pyx_v_window_size));
      }
      __pyx_t_36 = (__pyx_t_18 != 0);
      if (__pyx_t_36) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0578</span>:                 <span class="k">if</span> <span class="n">counter</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">x1s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.15</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_22 = __pyx_v_i;
        __pyx_t_37 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_s1s.diminfo[0].strides));
        __pyx_t_18 = (((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer.buf, __pyx_t_37, __pyx_pybuffernd_counter.diminfo[0].strides)) &gt; 0.0) != 0);
        if (__pyx_t_18) {
        } else {
          __pyx_t_36 = __pyx_t_18;
          goto __pyx_L16_bool_binop_done;
        }
        __pyx_t_22 = __pyx_v_i;
        __pyx_t_18 = (((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_x1s.diminfo[0].strides)) &gt; 0.15) != 0);
        __pyx_t_36 = __pyx_t_18;
        __pyx_L16_bool_binop_done:;
        if (__pyx_t_36) {
/* … */
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">0579</span>:                 <span class="c"># proceed with pdf only if 1) the current 1st-stage state have been updated and 2) &quot;plausible&quot; RT (150 ms)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0580</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0581</span>:                     <span class="c"># 1st stage</span></pre>
<pre class="cython line score-23" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0582</span>:                     <span class="n">planets</span> <span class="o">=</span> <span class="n">state_combinations</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span></pre>
<pre class='cython code score-23 '>          __pyx_t_22 = __pyx_v_i;
          __pyx_t_38 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_s1s.diminfo[0].strides));
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_state_combinations), __pyx_t_38, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 582, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 582, __pyx_L1_error)</span>
          __pyx_t_39 = ((PyArrayObject *)__pyx_t_6);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer);
            __pyx_t_16 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_39, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_16 &lt; 0)) {
              <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_26, &amp;__pyx_t_25, &amp;__pyx_t_24);
              if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_planets, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24);
                <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
              } else {
                <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_26, __pyx_t_25, __pyx_t_24);
              }
              __pyx_t_26 = __pyx_t_25 = __pyx_t_24 = 0;
            }
            __pyx_pybuffernd_planets.diminfo[0].strides = __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_planets.diminfo[0].shape = __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.shape[0];
            if (unlikely(__pyx_t_16 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 582, __pyx_L1_error)</span>
          }
          __pyx_t_39 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_planets, ((PyArrayObject *)__pyx_t_6));
          __pyx_t_6 = 0;
</pre><pre class="cython line score-137" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0583</span>:                     <span class="n">Qmb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Tm</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">qs_mb</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">0</span><span class="p">],:]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">qs_mb</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">1</span><span class="p">],:])])</span></pre>
<pre class='cython code score-137 '>          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_max);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_22 = 0;
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_planets.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_slice_);
          __pyx_t_1 = 0;
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_qs_mb), __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = NULL;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
            __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
            if (likely(__pyx_t_4)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
            }
          }
          __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 583, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_max);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_22 = 1;
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_planets.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 1, __pyx_slice_);
          __pyx_t_1 = 0;
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_qs_mb), __pyx_t_14);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
          __pyx_t_14 = NULL;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
            __pyx_t_14 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
            if (likely(__pyx_t_14)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
            }
          }
          __pyx_t_2 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_14, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 583, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
          <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_5);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
          <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_2);
          __pyx_t_5 = 0;
          __pyx_t_2 = 0;
          __pyx_t_2 = NULL;
          __pyx_t_16 = 0;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
            __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
            if (likely(__pyx_t_2)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
              __pyx_t_16 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
            PyObject *__pyx_temp[3] = {__pyx_t_2, ((PyObject *)__pyx_v_Tm), __pyx_t_4};
            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_16, 2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
            PyObject *__pyx_temp[3] = {__pyx_t_2, ((PyObject *)__pyx_v_Tm), __pyx_t_4};
            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_16, 2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          } else
          #endif
          {
            __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            if (__pyx_t_2) {
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2); __pyx_t_2 = NULL;
            }
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_Tm));
            <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_Tm));
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0+__pyx_t_16, ((PyObject *)__pyx_v_Tm));
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1+__pyx_t_16, __pyx_t_4);
            __pyx_t_4 = 0;
            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 583, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 583, __pyx_L1_error)</span>
          __pyx_t_40 = ((PyArrayObject *)__pyx_t_6);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer);
            __pyx_t_16 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_40, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_16 &lt; 0)) {
              <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_24, &amp;__pyx_t_25, &amp;__pyx_t_26);
              if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Qmb, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_26);
                <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
              } else {
                <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_24, __pyx_t_25, __pyx_t_26);
              }
              __pyx_t_24 = __pyx_t_25 = __pyx_t_26 = 0;
            }
            __pyx_pybuffernd_Qmb.diminfo[0].strides = __pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Qmb.diminfo[0].shape = __pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer.shape[0];
            if (unlikely(__pyx_t_16 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 583, __pyx_L1_error)</span>
          }
          __pyx_t_40 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_Qmb, ((PyArrayObject *)__pyx_t_6));
          __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0584</span>:                     <span class="c"># qs = w * Qmb + (1-w) * qs_mf[s1s[i],:] # Update for 1st trial</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0585</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0586</span>:                     <span class="c"># dtq = qs[1] - qs[0]</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0587</span>:                     <span class="n">dtq_mb</span> <span class="o">=</span> <span class="n">Qmb</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Qmb</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="c"># 1 is upper, 0 is lower</span></pre>
<pre class='cython code score-0 '>          __pyx_t_22 = 1;
          __pyx_t_37 = 0;
          __pyx_v_dtq_mb = ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_Qmb.diminfo[0].strides)) - (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer.buf, __pyx_t_37, __pyx_pybuffernd_Qmb.diminfo[0].strides)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0588</span>:                     <span class="n">dtq_mf</span> <span class="o">=</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_37 = __pyx_v_i;
          __pyx_t_22 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_37, __pyx_pybuffernd_s1s.diminfo[0].strides));
          __pyx_t_41 = 1;
          __pyx_t_42 = __pyx_v_i;
          __pyx_t_43 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_s1s.diminfo[0].strides));
          __pyx_t_44 = 0;
          __pyx_v_dtq_mf = ((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_41, __pyx_pybuffernd_qs_mf.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_44, __pyx_pybuffernd_qs_mf.diminfo[1].strides)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0589</span>:                     <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mf">100.00</span><span class="p">:</span> <span class="c"># if v_reg</span></pre>
<pre class='cython code score-0 '>          __pyx_t_36 = ((__pyx_v_v == 100.00) != 0);
          if (__pyx_t_36) {
/* … */
            goto __pyx_L18;
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0590</span>:                         <span class="n">v_</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">+</span> <span class="p">(</span><span class="n">dtq_mb</span> <span class="o">*</span> <span class="n">v1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dtq_mf</span> <span class="o">*</span> <span class="n">v2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">v_interaction</span> <span class="o">*</span> <span class="n">dtq_mb</span> <span class="o">*</span> <span class="n">dtq_mf</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            __pyx_v_v_ = (((__pyx_v_v0 + (__pyx_v_dtq_mb * __pyx_v_v1)) + (__pyx_v_dtq_mf * __pyx_v_v2)) + ((__pyx_v_v_interaction * __pyx_v_dtq_mb) * __pyx_v_dtq_mf));
</pre><pre class="cython line score-0">&#xA0;<span class="">0591</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0592</span>:                     <span class="k">else</span><span class="p">:</span> <span class="c"># if don&#39;t use v_reg:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0593</span>:                         <span class="c"># if v_qval == 0: # use both qmb and qmf</span></pre>
<pre class="cython line score-44" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0594</span>:                         <span class="n">qs</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">Qmb</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],:]</span> <span class="c"># Update for 1st trial</span></pre>
<pre class='cython code score-44 '>          /*else*/ {
            __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_w);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_6, ((PyObject *)__pyx_v_Qmb));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((1.0 - __pyx_v_w));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            __pyx_t_42 = __pyx_v_i;
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_s1s.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_slice_);
            __pyx_t_5 = 0;
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_qs_mf), __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_t_4 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_6, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_3, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_qs, __pyx_t_5);
            __pyx_t_5 = 0;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0595</span>:                         <span class="n">dtq</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-22 '>            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_qs, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 595, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_qs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 595, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            __pyx_t_3 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_5, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 595, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_t_45 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_45 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 595, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            __pyx_v_dtq = __pyx_t_45;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0596</span>:                         <span class="n">v_</span> <span class="o">=</span> <span class="n">dtq</span> <span class="o">*</span> <span class="n">v</span></pre>
<pre class='cython code score-0 '>            __pyx_v_v_ = (__pyx_v_dtq * __pyx_v_v);
          }
          __pyx_L18:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0597</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0598</span>:                     <span class="c"># if z == 0.5: # if use z_reg:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0599</span>:                     <span class="k">if</span> <span class="n">w2</span> <span class="o">==</span> <span class="mf">100.00</span><span class="p">:</span> <span class="c"># if use z_reg</span></pre>
<pre class='cython code score-0 '>          __pyx_t_36 = ((__pyx_v_w2 == 100.00) != 0);
          if (__pyx_t_36) {
/* … */
            goto __pyx_L19;
          }
</pre><pre class="cython line score-0">&#xA0;<span class="">0600</span>:                         <span class="c"># Transform regression parameters so that &gt;0</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0601</span>:                         <span class="n">z_</span> <span class="o">=</span> <span class="n">z0</span> <span class="o">+</span> <span class="p">(</span><span class="n">dtq_mb</span> <span class="o">*</span> <span class="n">z1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dtq_mf</span> <span class="o">*</span> <span class="n">z2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">z_interaction</span> <span class="o">*</span> <span class="n">dtq_mb</span> <span class="o">*</span> <span class="n">dtq_mf</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            __pyx_v_z_ = (((__pyx_v_z0 + (__pyx_v_dtq_mb * __pyx_v_z1)) + (__pyx_v_dtq_mf * __pyx_v_z2)) + ((__pyx_v_z_interaction * __pyx_v_dtq_mb) * __pyx_v_dtq_mf));
</pre><pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0602</span>:                         <span class="n">sig</span> <span class="o">=</span> <span class="mf">1</span><span class="o">/</span><span class="p">(</span><span class="mf">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">z_</span><span class="p">))</span></pre>
<pre class='cython code score-42 '>            <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 602, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_exp);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 602, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((-__pyx_v_z_));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 602, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            __pyx_t_6 = NULL;
            if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
              __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
              if (likely(__pyx_t_6)) {
                PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
              }
            }
            __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 602, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_AddCObj</span>(__pyx_int_1, __pyx_t_3, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 602, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_int_1, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 602, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_t_45 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_45 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 602, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            __pyx_v_sig = __pyx_t_45;
</pre><pre class="cython line score-0">&#xA0;<span class="">0603</span>:                     <span class="k">else</span><span class="p">:</span> <span class="c"># if don&#39;t use z_reg:</span></pre>
<pre class="cython line score-44" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0604</span>:                         <span class="n">qs</span> <span class="o">=</span> <span class="n">w2</span> <span class="o">*</span> <span class="n">Qmb</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">w2</span><span class="p">)</span> <span class="o">*</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],:]</span> <span class="c"># Update for 1st trial</span></pre>
<pre class='cython code score-44 '>          /*else*/ {
            __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_w2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 604, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            __pyx_t_5 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_3, ((PyObject *)__pyx_v_Qmb));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 604, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>((1.0 - __pyx_v_w2));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 604, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            __pyx_t_42 = __pyx_v_i;
            __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_s1s.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 604, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 604, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_slice_);
            __pyx_t_4 = 0;
            __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_qs_mf), __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 604, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            __pyx_t_6 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_3, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 604, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_t_4 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_5, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 604, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_qs, __pyx_t_4);
            __pyx_t_4 = 0;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0605</span>:                         <span class="n">dtq</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-22 '>            __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_qs, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 605, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_qs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 605, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            __pyx_t_5 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_4, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 605, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            __pyx_t_45 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_5); if (unlikely((__pyx_t_45 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 605, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_v_dtq = __pyx_t_45;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0606</span>:                         <span class="n">z_</span> <span class="o">=</span> <span class="n">dtq</span> <span class="o">*</span> <span class="n">z_scaler</span></pre>
<pre class='cython code score-0 '>            __pyx_v_z_ = (__pyx_v_dtq * __pyx_v_z_scaler);
</pre><pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0607</span>:                         <span class="n">sig</span> <span class="o">=</span> <span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">z_</span><span class="p">))</span></pre>
<pre class='cython code score-42 '>            <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_exp);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((-__pyx_v_z_));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            __pyx_t_3 = NULL;
            if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
              __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
              if (likely(__pyx_t_3)) {
                PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
              }
            }
            __pyx_t_5 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_t_6) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_6);
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 607, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_AddCObj</span>(__pyx_int_1, __pyx_t_5, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_int_1, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_t_45 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_5); if (unlikely((__pyx_t_45 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 607, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_v_sig = __pyx_t_45;
          }
          __pyx_L19:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0608</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0609</span>:                     <span class="n">rt</span> <span class="o">=</span> <span class="n">x1s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_42 = __pyx_v_i;
          __pyx_v_rt = (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_x1s.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">0610</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0611</span>:                     <span class="c"># Modeling ndt</span></pre>
<pre class="cython line score-79" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0612</span>:                     <span class="n">t_</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ndt_counter_ind</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span><span class="mf">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ndt_counter_ind</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span><span class="mf">0</span><span class="p">]))</span><span class="o">/</span><span class="mf">2</span><span class="p">)</span><span class="o">*</span><span class="n">beta_ndt</span> <span class="o">+</span> \</pre>
<pre class='cython code score-79 '>          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_log);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_42 = 0;
          __pyx_t_44 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_planets.diminfo[0].strides));
          __pyx_t_43 = 0;
          __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_ndt_counter_ind.diminfo[0].strides, __pyx_t_43, __pyx_pybuffernd_ndt_counter_ind.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          __pyx_t_3 = NULL;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
            __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
            if (likely(__pyx_t_3)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
            }
          }
          __pyx_t_5 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_3, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 612, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_log);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_42 = 1;
          __pyx_t_43 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_planets.diminfo[0].strides));
          __pyx_t_44 = 0;
          __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_ndt_counter_ind.diminfo[0].strides, __pyx_t_44, __pyx_pybuffernd_ndt_counter_ind.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          __pyx_t_2 = NULL;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
            __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
            if (likely(__pyx_t_2)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
            }
          }
          __pyx_t_6 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 612, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_5, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_t_3, __pyx_int_2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_beta_ndt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          __pyx_t_5 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_6, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
/* … */
          __pyx_t_4 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_5, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class="cython line score-55" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0613</span>:                          <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ndt_counter_set</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mf">0</span><span class="p">])</span><span class="o">*</span><span class="n">beta_ndt2</span> <span class="o">+</span> \</pre>
<pre class='cython code score-55 '>          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 613, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_log);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 613, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_t_42 = __pyx_v_i;
          __pyx_t_44 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_s1s.diminfo[0].strides));
          __pyx_t_43 = 0;
          __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_ndt_counter_set.diminfo[0].strides, __pyx_t_43, __pyx_pybuffernd_ndt_counter_set.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 613, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          __pyx_t_2 = NULL;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
            __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
            if (likely(__pyx_t_2)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
            }
          }
          __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_6) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 613, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_beta_ndt2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 613, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          __pyx_t_6 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_3, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 613, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
/* … */
          __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_4, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 613, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_t_45 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_5); if (unlikely((__pyx_t_45 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 613, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_v_t_ = __pyx_t_45;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0614</span>:                          <span class="n">t</span></pre>
<pre class='cython code score-5 '>          __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_t);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 614, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
</pre><pre class="cython line score-0">&#xA0;<span class="">0615</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0616</span>:                     <span class="n">p</span> <span class="o">=</span> <span class="n">full_pdf</span><span class="p">(</span><span class="n">rt</span><span class="p">,</span> <span class="n">v_</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">sig</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>          __pyx_t_46.__pyx_n = 4;
          __pyx_t_46.n_st = __pyx_v_n_st;
          __pyx_t_46.n_sz = __pyx_v_n_sz;
          __pyx_t_46.use_adaptive = __pyx_v_use_adaptive;
          __pyx_t_46.simps_err = __pyx_v_simps_err;
          __pyx_t_45 = __pyx_f_4wfpt_full_pdf(__pyx_v_rt, __pyx_v_v_, __pyx_v_sv, __pyx_v_a, (__pyx_v_sig * __pyx_v_a), __pyx_v_sz, __pyx_v_t_, __pyx_v_st, __pyx_v_err, 0, &amp;__pyx_t_46); 
          __pyx_v_p = __pyx_t_45;
</pre><pre class="cython line score-0">&#xA0;<span class="">0617</span>:                                  <span class="n">sz</span><span class="p">,</span> <span class="n">t_</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">n_st</span><span class="p">,</span> <span class="n">n_sz</span><span class="p">,</span> <span class="n">use_adaptive</span><span class="p">,</span> <span class="n">simps_err</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0618</span>:                     <span class="c"># If one probability = 0, the log sum will be -Inf</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0619</span>:                     <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">p_outlier</span><span class="p">)</span> <span class="o">+</span> <span class="n">wp_outlier</span></pre>
<pre class='cython code score-0 '>          __pyx_v_p = ((__pyx_v_p * (1.0 - __pyx_v_p_outlier)) + __pyx_v_wp_outlier);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0620</span>:                     <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          __pyx_t_36 = ((__pyx_v_p == 0.0) != 0);
          if (__pyx_t_36) {
/* … */
          }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0621</span>:                         <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-12 '>            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
            <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 621, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 621, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_t_5 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 621, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            __pyx_r = __pyx_t_5;
            __pyx_t_5 = 0;
            goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0622</span>:                     <span class="n">sum_logp</span> <span class="o">+=</span> <span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_v_sum_logp = (__pyx_v_sum_logp + log(__pyx_v_p));
</pre><pre class="cython line score-0">&#xA0;<span class="">0623</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0624</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0625</span>:                     <span class="c"># # # 2nd stage</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0626</span>:                     <span class="k">if</span> <span class="n">two_stage</span> <span class="o">==</span> <span class="mf">1.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          __pyx_t_36 = ((__pyx_v_two_stage == 1.00) != 0);
          if (__pyx_t_36) {
/* … */
          }
</pre><pre class="cython line score-0">&#xA0;<span class="">0627</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0628</span>:                         <span class="n">v_2_</span> <span class="o">=</span> <span class="n">v</span> <span class="k">if</span> <span class="n">v_2</span><span class="o">==</span><span class="mf">100.00</span> <span class="k">else</span> <span class="n">v_2</span></pre>
<pre class='cython code score-0 '>            if (((__pyx_v_v_2 == 100.00) != 0)) {
              __pyx_t_45 = __pyx_v_v;
            } else {
              __pyx_t_45 = __pyx_v_v_2;
            }
            __pyx_v_v_2_ = __pyx_t_45;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0629</span>:                         <span class="n">a_2_</span> <span class="o">=</span> <span class="n">a</span> <span class="k">if</span> <span class="n">a_2</span> <span class="o">==</span> <span class="mf">100.00</span> <span class="k">else</span> <span class="n">a_2</span></pre>
<pre class='cython code score-0 '>            if (((__pyx_v_a_2 == 100.00) != 0)) {
              __pyx_t_45 = __pyx_v_a;
            } else {
              __pyx_t_45 = __pyx_v_a_2;
            }
            __pyx_v_a_2_ = __pyx_t_45;
</pre><pre class="cython line score-0">&#xA0;<span class="">0630</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0631</span>:                         <span class="c"># CONFIGURE Z_2 USING Z_SIGMA AND V HERE!!!</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0632</span>:                         <span class="k">if</span> <span class="n">z_sigma</span> <span class="o">==</span><span class="mf">100.00</span><span class="p">:</span> <span class="c"># if don&#39;t use 1st-stage dependent drift rate</span></pre>
<pre class='cython code score-0 '>            __pyx_t_36 = ((__pyx_v_z_sigma == 100.00) != 0);
            if (__pyx_t_36) {
/* … */
              goto __pyx_L22;
            }
</pre><pre class="cython line score-0">&#xA0;<span class="">0633</span>:                             <span class="c"># z_2_ = z if z_2 == 0.5 else z_2</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0634</span>:                             <span class="n">z_2_</span> <span class="o">=</span> <span class="n">z_2</span></pre>
<pre class='cython code score-0 '>              __pyx_v_z_2_ = __pyx_v_z_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">0635</span>:                         <span class="k">else</span><span class="p">:</span> <span class="c"># if use 1st-stage dependent dr</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0636</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0637</span>:                             <span class="k">if</span> <span class="n">z_sigma2</span> <span class="o">==</span> <span class="mf">100.00</span><span class="p">:</span> <span class="c"># don&#39;t use baseline</span></pre>
<pre class='cython code score-0 '>            /*else*/ {
              __pyx_t_36 = ((__pyx_v_z_sigma2 == 100.00) != 0);
              if (__pyx_t_36) {
/* … */
                goto __pyx_L23;
              }
</pre><pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0638</span>:                                 <span class="n">z_2_</span> <span class="o">=</span> <span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">v_</span><span class="o">*</span><span class="n">z_sigma</span><span class="p">))</span></pre>
<pre class='cython code score-42 '>                <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 638, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
                __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_exp);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 638, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
                __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(((-__pyx_v_v_) * __pyx_v_z_sigma));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 638, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
                __pyx_t_3 = NULL;
                if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
                  __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
                  if (likely(__pyx_t_3)) {
                    PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
                  }
                }
                __pyx_t_5 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_t_6) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_6);
                <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
                if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 638, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_AddCObj</span>(__pyx_int_1, __pyx_t_5, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 638, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
                __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_int_1, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 638, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                __pyx_t_45 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_5); if (unlikely((__pyx_t_45 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 638, __pyx_L1_error)</span>
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
                __pyx_v_z_2_ = __pyx_t_45;
</pre><pre class="cython line score-0">&#xA0;<span class="">0639</span>:                             <span class="k">else</span><span class="p">:</span> <span class="c"># use baseline</span></pre>
<pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0640</span>:                                 <span class="n">z_2_</span> <span class="o">=</span> <span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">v_</span> <span class="o">*</span> <span class="n">z_sigma</span> <span class="o">+</span> <span class="n">z_sigma2</span><span class="p">)))</span></pre>
<pre class='cython code score-42 '>              /*else*/ {
                <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 640, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_exp);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 640, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((-((__pyx_v_v_ * __pyx_v_z_sigma) + __pyx_v_z_sigma2)));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 640, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
                __pyx_t_3 = NULL;
                if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
                  __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
                  if (likely(__pyx_t_3)) {
                    PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
                  }
                }
                __pyx_t_5 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_3, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_t_4);
                <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
                if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 640, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
                __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_AddCObj</span>(__pyx_int_1, __pyx_t_5, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 640, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
                __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_int_1, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 640, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
                __pyx_t_45 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_5); if (unlikely((__pyx_t_45 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 640, __pyx_L1_error)</span>
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
                __pyx_v_z_2_ = __pyx_t_45;
              }
              __pyx_L23:;
            }
            __pyx_L22:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0641</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0642</span>:                         <span class="n">t_2_</span> <span class="o">=</span> <span class="n">t</span> <span class="k">if</span> <span class="n">t_2</span> <span class="o">==</span> <span class="mf">100.00</span> <span class="k">else</span> <span class="n">t_2</span></pre>
<pre class='cython code score-0 '>            if (((__pyx_v_t_2 == 100.00) != 0)) {
              __pyx_t_45 = __pyx_v_t;
            } else {
              __pyx_t_45 = __pyx_v_t_2;
            }
            __pyx_v_t_2_ = __pyx_t_45;
</pre><pre class="cython line score-0">&#xA0;<span class="">0643</span>: </pre>
<pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0644</span>:                         <span class="n">qs</span> <span class="o">=</span> <span class="n">qs_mb</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],:]</span></pre>
<pre class='cython code score-14 '>            __pyx_t_42 = __pyx_v_i;
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_s2s.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 644, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 644, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_slice_);
            __pyx_t_5 = 0;
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_qs_mb), __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 644, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_qs, __pyx_t_5);
            __pyx_t_5 = 0;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0645</span>:                         <span class="n">dtq</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-22 '>            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_qs, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 645, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_qs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 645, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            __pyx_t_4 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_5, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 645, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            __pyx_t_45 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_4); if (unlikely((__pyx_t_45 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 645, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_v_dtq = __pyx_t_45;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0646</span>:                         <span class="n">rt</span> <span class="o">=</span> <span class="n">x2s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            __pyx_t_42 = __pyx_v_i;
            __pyx_v_rt = (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_x2s.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">0647</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0648</span>:                         <span class="n">p</span> <span class="o">=</span> <span class="n">full_pdf</span><span class="p">(</span><span class="n">rt</span><span class="p">,</span> <span class="p">(</span><span class="n">dtq</span> <span class="o">*</span> <span class="n">v_2_</span><span class="p">),</span> <span class="n">sv</span><span class="p">,</span> <span class="n">a_2_</span><span class="p">,</span> <span class="n">z_2_</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">t_2_</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">n_st</span><span class="p">,</span> <span class="n">n_sz</span><span class="p">,</span> <span class="n">use_adaptive</span><span class="p">,</span> <span class="n">simps_err</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            __pyx_t_46.__pyx_n = 4;
            __pyx_t_46.n_st = __pyx_v_n_st;
            __pyx_t_46.n_sz = __pyx_v_n_sz;
            __pyx_t_46.use_adaptive = __pyx_v_use_adaptive;
            __pyx_t_46.simps_err = __pyx_v_simps_err;
            __pyx_t_45 = __pyx_f_4wfpt_full_pdf(__pyx_v_rt, (__pyx_v_dtq * __pyx_v_v_2_), __pyx_v_sv, __pyx_v_a_2_, __pyx_v_z_2_, __pyx_v_sz, __pyx_v_t_2_, __pyx_v_st, __pyx_v_err, 0, &amp;__pyx_t_46); 
            __pyx_v_p = __pyx_t_45;
</pre><pre class="cython line score-0">&#xA0;<span class="">0649</span>:                         <span class="c"># If one probability = 0, the log sum will be -Inf</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0650</span>:                         <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">p_outlier</span><span class="p">)</span> <span class="o">+</span> <span class="n">wp_outlier</span></pre>
<pre class='cython code score-0 '>            __pyx_v_p = ((__pyx_v_p * (1.0 - __pyx_v_p_outlier)) + __pyx_v_wp_outlier);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0651</span>:                         <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>            __pyx_t_36 = ((__pyx_v_p == 0.0) != 0);
            if (__pyx_t_36) {
/* … */
            }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0652</span>:                             <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-12 '>              <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
              <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 652, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
              __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 652, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
              __pyx_t_4 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 652, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
              __pyx_r = __pyx_t_4;
              __pyx_t_4 = 0;
              goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0653</span>:                         <span class="n">sum_logp</span> <span class="o">+=</span> <span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            __pyx_v_sum_logp = (__pyx_v_sum_logp + log(__pyx_v_p));
</pre><pre class="cython line score-0">&#xA0;<span class="">0654</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0655</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0656</span>:             <span class="c"># update Q values, regardless of pdf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0657</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0658</span>:             <span class="n">ndt_counter_set</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mf">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>      __pyx_t_42 = __pyx_v_i;
      __pyx_t_43 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_s1s.diminfo[0].strides));
      __pyx_t_44 = 0;
      *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_ndt_counter_set.diminfo[0].strides, __pyx_t_44, __pyx_pybuffernd_ndt_counter_set.diminfo[1].strides) += 1.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0659</span>:             <span class="n">ndt_counter_ind</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mf">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>      __pyx_t_42 = __pyx_v_i;
      __pyx_t_44 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_s2s.diminfo[0].strides));
      __pyx_t_43 = 0;
      *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_ndt_counter_ind.diminfo[0].strides, __pyx_t_43, __pyx_pybuffernd_ndt_counter_ind.diminfo[1].strides) += 1.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0660</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0661</span>:             <span class="c"># just update 1st-stage MF values if estimating</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0662</span>:             <span class="n">dtQ1</span> <span class="o">=</span> <span class="n">qs_mb</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">responses2</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">-</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="c"># delta stage 1</span></pre>
<pre class='cython code score-0 '>      __pyx_t_42 = __pyx_v_i;
      __pyx_t_43 = __pyx_v_i;
      __pyx_t_44 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_s2s.diminfo[0].strides));
      __pyx_t_37 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_responses2.diminfo[0].strides));
      __pyx_t_41 = __pyx_v_i;
      __pyx_t_22 = __pyx_v_i;
      __pyx_t_47 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_41, __pyx_pybuffernd_s1s.diminfo[0].strides));
      __pyx_t_48 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_responses1.diminfo[0].strides));
      __pyx_v_dtQ1 = ((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_37, __pyx_pybuffernd_qs_mb.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_47, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_48, __pyx_pybuffernd_qs_mf.diminfo[1].strides)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0663</span>:             <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">alfa</span> <span class="o">*</span> <span class="n">dtQ1</span> <span class="c"># delta update for qmf</span></pre>
<pre class='cython code score-0 '>      __pyx_t_22 = __pyx_v_i;
      __pyx_t_41 = __pyx_v_i;
      __pyx_t_48 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_s1s.diminfo[0].strides));
      __pyx_t_47 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_41, __pyx_pybuffernd_responses1.diminfo[0].strides));
      __pyx_t_43 = __pyx_v_i;
      __pyx_t_42 = __pyx_v_i;
      __pyx_t_37 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_s1s.diminfo[0].strides));
      __pyx_t_44 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_responses1.diminfo[0].strides));
      *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_37, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_44, __pyx_pybuffernd_qs_mf.diminfo[1].strides) = ((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_48, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_47, __pyx_pybuffernd_qs_mf.diminfo[1].strides)) + (__pyx_v_alfa * __pyx_v_dtQ1));
</pre><pre class="cython line score-0">&#xA0;<span class="">0664</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0665</span>:             <span class="n">dtQ2</span> <span class="o">=</span> <span class="n">feedbacks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs_mb</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">responses2</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="c"># delta stage 2</span></pre>
<pre class='cython code score-0 '>      __pyx_t_41 = __pyx_v_i;
      __pyx_t_22 = __pyx_v_i;
      __pyx_t_47 = __pyx_v_i;
      __pyx_t_48 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_s2s.diminfo[0].strides));
      __pyx_t_42 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.buf, __pyx_t_47, __pyx_pybuffernd_responses2.diminfo[0].strides));
      __pyx_v_dtQ2 = ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.buf, __pyx_t_41, __pyx_pybuffernd_feedbacks.diminfo[0].strides)) - (*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_48, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_42, __pyx_pybuffernd_qs_mb.diminfo[1].strides)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0666</span>:             <span class="n">qs_mb</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses2</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">qs_mb</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">responses2</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">alfa2</span> <span class="o">*</span> <span class="n">dtQ2</span> <span class="c"># delta update for qmb</span></pre>
<pre class='cython code score-0 '>      __pyx_t_47 = __pyx_v_i;
      __pyx_t_22 = __pyx_v_i;
      __pyx_t_42 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_47, __pyx_pybuffernd_s2s.diminfo[0].strides));
      __pyx_t_48 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_responses2.diminfo[0].strides));
      __pyx_t_41 = __pyx_v_i;
      __pyx_t_43 = __pyx_v_i;
      __pyx_t_44 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_41, __pyx_pybuffernd_s2s.diminfo[0].strides));
      __pyx_t_37 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_responses2.diminfo[0].strides));
      *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_37, __pyx_pybuffernd_qs_mb.diminfo[1].strides) = ((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_48, __pyx_pybuffernd_qs_mb.diminfo[1].strides)) + (__pyx_v_alfa2 * __pyx_v_dtQ2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0667</span>:             <span class="k">if</span> <span class="n">lambda_</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span> <span class="c"># if using eligibility trace</span></pre>
<pre class='cython code score-0 '>      __pyx_t_36 = ((__pyx_v_lambda_ != 100.00) != 0);
      if (__pyx_t_36) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0668</span>:                 <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">lambda__</span> <span class="o">*</span> <span class="n">dtQ2</span> <span class="c"># eligibility trace</span></pre>
<pre class='cython code score-0 '>        __pyx_t_22 = __pyx_v_i;
        __pyx_t_47 = __pyx_v_i;
        __pyx_t_48 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_s1s.diminfo[0].strides));
        __pyx_t_42 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_47, __pyx_pybuffernd_responses1.diminfo[0].strides));
        __pyx_t_43 = __pyx_v_i;
        __pyx_t_41 = __pyx_v_i;
        __pyx_t_37 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_s1s.diminfo[0].strides));
        __pyx_t_44 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_41, __pyx_pybuffernd_responses1.diminfo[0].strides));
        *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_37, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_44, __pyx_pybuffernd_qs_mf.diminfo[1].strides) = ((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_48, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_42, __pyx_pybuffernd_qs_mf.diminfo[1].strides)) + (__pyx_v_lambda__ * __pyx_v_dtQ2));
</pre><pre class="cython line score-0">&#xA0;<span class="">0669</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0670</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0671</span>:             <span class="c"># memory decay for unexperienced options in this trial</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0672</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0673</span>:             <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstates</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>      __pyx_t_16 = __pyx_v_nstates;
      __pyx_t_49 = __pyx_t_16;
      for (__pyx_t_38 = 0; __pyx_t_38 &lt; __pyx_t_49; __pyx_t_38+=1) {
        __pyx_v_s_ = __pyx_t_38;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0674</span>:                 <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">2</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>        for (__pyx_t_50 = 0; __pyx_t_50 &lt; 2; __pyx_t_50+=1) {
          __pyx_v_a_ = __pyx_t_50;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0675</span>:                     <span class="k">if</span> <span class="p">(</span><span class="n">s_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">a_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">responses2</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>          __pyx_t_47 = __pyx_v_i;
          __pyx_t_18 = ((__pyx_v_s_ != (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_47, __pyx_pybuffernd_s2s.diminfo[0].strides))) != 0);
          if (!__pyx_t_18) {
          } else {
            __pyx_t_36 = __pyx_t_18;
            goto __pyx_L31_bool_binop_done;
          }
          __pyx_t_47 = __pyx_v_i;
          __pyx_t_18 = ((__pyx_v_a_ != (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.buf, __pyx_t_47, __pyx_pybuffernd_responses2.diminfo[0].strides))) != 0);
          __pyx_t_36 = __pyx_t_18;
          __pyx_L31_bool_binop_done:;
          if (__pyx_t_36) {
/* … */
          }
        }
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">0676</span>:                         <span class="c"># qs_mb[s_, a_] = qs_mb[s_, a_] * (1-gamma)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0677</span>:                         <span class="n">qs_mb</span><span class="p">[</span><span class="n">s_</span><span class="p">,</span><span class="n">a_</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">gamma__</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            __pyx_t_47 = __pyx_v_s_;
            __pyx_t_22 = __pyx_v_a_;
            *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_47, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_22, __pyx_pybuffernd_qs_mb.diminfo[1].strides) *= (1.0 - __pyx_v_gamma__);
</pre><pre class="cython line score-0">&#xA0;<span class="">0678</span>: </pre>
<pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0679</span>:             <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">comb</span><span class="p">(</span><span class="n">nstates</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="n">exact</span><span class="o">=</span><span class="bp">True</span><span class="p">)):</span></pre>
<pre class='cython code score-32 '>      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_comb);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 679, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 679, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 679, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_int_2);
      __pyx_t_6 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 679, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_6, __pyx_n_s_exact, Py_True) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 679, __pyx_L1_error)</span>
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_5, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 679, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_38 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_3); if (unlikely((__pyx_t_38 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 679, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_50 = __pyx_t_38;
      for (__pyx_t_51 = 0; __pyx_t_51 &lt; __pyx_t_50; __pyx_t_51+=1) {
        __pyx_v_s_ = __pyx_t_51;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0680</span>:                 <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">2</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>        for (__pyx_t_52 = 0; __pyx_t_52 &lt; 2; __pyx_t_52+=1) {
          __pyx_v_a_ = __pyx_t_52;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0681</span>:                     <span class="k">if</span> <span class="p">(</span><span class="n">s_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">a_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>          __pyx_t_22 = __pyx_v_i;
          __pyx_t_18 = ((__pyx_v_s_ != (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_s1s.diminfo[0].strides))) != 0);
          if (!__pyx_t_18) {
          } else {
            __pyx_t_36 = __pyx_t_18;
            goto __pyx_L38_bool_binop_done;
          }
          __pyx_t_22 = __pyx_v_i;
          __pyx_t_18 = ((__pyx_v_a_ != (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_responses1.diminfo[0].strides))) != 0);
          __pyx_t_36 = __pyx_t_18;
          __pyx_L38_bool_binop_done:;
          if (__pyx_t_36) {
/* … */
          }
        }
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0682</span>:                         <span class="n">qs_mf</span><span class="p">[</span><span class="n">s_</span><span class="p">,</span><span class="n">a_</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">gamma_</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            __pyx_t_22 = __pyx_v_s_;
            __pyx_t_47 = __pyx_v_a_;
            *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_47, __pyx_pybuffernd_qs_mf.diminfo[1].strides) *= (1.0 - __pyx_v_gamma_);
</pre><pre class="cython line score-0">&#xA0;<span class="">0683</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0684</span>:             <span class="n">counter</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>      __pyx_t_47 = __pyx_v_i;
      __pyx_t_22 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_47, __pyx_pybuffernd_s1s.diminfo[0].strides));
      *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_counter.diminfo[0].strides) += 1.0;
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0685</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0686</span>:     <span class="k">return</span> <span class="n">sum_logp</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_sum_logp);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 686, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0687</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0688</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0689</span>: <span class="c"># JY added on 2022-06-22 for choice model</span></pre>
<pre class="cython line score-575" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0690</span>: <span class="k">def</span> <span class="nf">wiener_like_rl_2step</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x1</span><span class="p">,</span> <span class="c"># 1st-stage RT</span></pre>
<pre class='cython code score-575 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_13wiener_like_rl_2step(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_12wiener_like_rl_2step[] = "wiener_like_rl_2step(ndarray x1, ndarray x2, ndarray s1, ndarray s2, ndarray response1, ndarray response2, ndarray feedback, ndarray split_by, double q, double alpha, double pos_alpha, double gamma, double gamma2, double lambda_, double v, double z, int nstates, double two_stage, double z_2, double v_2, double alpha2, double w, double window_start, double window_size, double err, int n_st=10, int n_sz=10, bool use_adaptive=1, double simps_err=1e-8, double p_outlier=0, double w_outlier=0)";
static PyMethodDef __pyx_mdef_4wfpt_13wiener_like_rl_2step = {"wiener_like_rl_2step", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_13wiener_like_rl_2step, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_12wiener_like_rl_2step};
static PyObject *__pyx_pw_4wfpt_13wiener_like_rl_2step(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_x1 = 0;
  PyArrayObject *__pyx_v_x2 = 0;
  PyArrayObject *__pyx_v_s1 = 0;
  PyArrayObject *__pyx_v_s2 = 0;
  PyArrayObject *__pyx_v_response1 = 0;
  PyArrayObject *__pyx_v_response2 = 0;
  PyArrayObject *__pyx_v_feedback = 0;
  PyArrayObject *__pyx_v_split_by = 0;
  double __pyx_v_q;
  double __pyx_v_alpha;
  double __pyx_v_pos_alpha;
  double __pyx_v_gamma;
  double __pyx_v_gamma2;
  double __pyx_v_lambda_;
  double __pyx_v_v;
  double __pyx_v_z;
  int __pyx_v_nstates;
  double __pyx_v_two_stage;
  double __pyx_v_z_2;
  double __pyx_v_v_2;
  double __pyx_v_alpha2;
  double __pyx_v_w;
  double __pyx_v_window_start;
  double __pyx_v_window_size;
  CYTHON_UNUSED double __pyx_v_err;
  CYTHON_UNUSED int __pyx_v_n_st;
  CYTHON_UNUSED int __pyx_v_n_sz;
  CYTHON_UNUSED int __pyx_v_use_adaptive;
  CYTHON_UNUSED double __pyx_v_simps_err;
  double __pyx_v_p_outlier;
  double __pyx_v_w_outlier;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_rl_2step (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_x1,&amp;__pyx_n_s_x2,&amp;__pyx_n_s_s1,&amp;__pyx_n_s_s2,&amp;__pyx_n_s_response1,&amp;__pyx_n_s_response2,&amp;__pyx_n_s_feedback,&amp;__pyx_n_s_split_by,&amp;__pyx_n_s_q,&amp;__pyx_n_s_alpha,&amp;__pyx_n_s_pos_alpha,&amp;__pyx_n_s_gamma,&amp;__pyx_n_s_gamma2,&amp;__pyx_n_s_lambda,&amp;__pyx_n_s_v,&amp;__pyx_n_s_z,&amp;__pyx_n_s_nstates,&amp;__pyx_n_s_two_stage,&amp;__pyx_n_s_z_2,&amp;__pyx_n_s_v_2,&amp;__pyx_n_s_alpha2,&amp;__pyx_n_s_w,&amp;__pyx_n_s_window_start,&amp;__pyx_n_s_window_size,&amp;__pyx_n_s_err,&amp;__pyx_n_s_n_st,&amp;__pyx_n_s_n_sz,&amp;__pyx_n_s_use_adaptive,&amp;__pyx_n_s_simps_err,&amp;__pyx_n_s_p_outlier,&amp;__pyx_n_s_w_outlier,0};
    PyObject* values[31] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 31: values[30] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 30);
        CYTHON_FALLTHROUGH;
        case 30: values[29] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 29);
        CYTHON_FALLTHROUGH;
        case 29: values[28] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 28);
        CYTHON_FALLTHROUGH;
        case 28: values[27] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 27);
        CYTHON_FALLTHROUGH;
        case 27: values[26] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 26);
        CYTHON_FALLTHROUGH;
        case 26: values[25] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 25);
        CYTHON_FALLTHROUGH;
        case 25: values[24] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 24);
        CYTHON_FALLTHROUGH;
        case 24: values[23] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 23);
        CYTHON_FALLTHROUGH;
        case 23: values[22] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 22);
        CYTHON_FALLTHROUGH;
        case 22: values[21] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 21);
        CYTHON_FALLTHROUGH;
        case 21: values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x1)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 1); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_s1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 2); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_s2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 3); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_response1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 4); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_response2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 5); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_feedback)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 6); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_split_by)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 7); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_q)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 8); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_alpha)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 9); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_pos_alpha)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 10); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_gamma)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 11); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (likely((values[12] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_gamma2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 12); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (likely((values[13] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lambda)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 13); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (likely((values[14] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 14); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (likely((values[15] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 15); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (likely((values[16] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nstates)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 16); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (likely((values[17] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_two_stage)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 17); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 18:
        if (likely((values[18] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 18); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 19:
        if (likely((values[19] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 19); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 20:
        if (likely((values[20] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_alpha2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 20); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 21:
        if (likely((values[21] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 21); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 22:
        if (likely((values[22] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_window_start)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 22); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 23:
        if (likely((values[23] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_window_size)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 23); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 24:
        if (likely((values[24] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_err)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, 24); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 25:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_st);
          if (value) { values[25] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 26:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_sz);
          if (value) { values[26] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 27:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_use_adaptive);
          if (value) { values[27] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 28:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_simps_err);
          if (value) { values[28] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 29:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_p_outlier);
          if (value) { values[29] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 30:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w_outlier);
          if (value) { values[30] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "wiener_like_rl_2step") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 31: values[30] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 30);
        CYTHON_FALLTHROUGH;
        case 30: values[29] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 29);
        CYTHON_FALLTHROUGH;
        case 29: values[28] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 28);
        CYTHON_FALLTHROUGH;
        case 28: values[27] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 27);
        CYTHON_FALLTHROUGH;
        case 27: values[26] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 26);
        CYTHON_FALLTHROUGH;
        case 26: values[25] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 25);
        CYTHON_FALLTHROUGH;
        case 25: values[24] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 24);
        values[23] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 23);
        values[22] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 22);
        values[21] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 21);
        values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_x1 = ((PyArrayObject *)values[0]);
    __pyx_v_x2 = ((PyArrayObject *)values[1]);
    __pyx_v_s1 = ((PyArrayObject *)values[2]);
    __pyx_v_s2 = ((PyArrayObject *)values[3]);
    __pyx_v_response1 = ((PyArrayObject *)values[4]);
    __pyx_v_response2 = ((PyArrayObject *)values[5]);
    __pyx_v_feedback = ((PyArrayObject *)values[6]);
    __pyx_v_split_by = ((PyArrayObject *)values[7]);
    __pyx_v_q = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]); if (unlikely((__pyx_v_q == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 698, __pyx_L3_error)</span>
    __pyx_v_alpha = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[9]); if (unlikely((__pyx_v_alpha == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 698, __pyx_L3_error)</span>
    __pyx_v_pos_alpha = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[10]); if (unlikely((__pyx_v_pos_alpha == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 698, __pyx_L3_error)</span>
    __pyx_v_gamma = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[11]); if (unlikely((__pyx_v_gamma == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 700, __pyx_L3_error)</span>
    __pyx_v_gamma2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[12]); if (unlikely((__pyx_v_gamma2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 700, __pyx_L3_error)</span>
    __pyx_v_lambda_ = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[13]); if (unlikely((__pyx_v_lambda_ == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 701, __pyx_L3_error)</span>
    __pyx_v_v = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[14]); if (unlikely((__pyx_v_v == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 703, __pyx_L3_error)</span>
    __pyx_v_z = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[15]); if (unlikely((__pyx_v_z == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 704, __pyx_L3_error)</span>
    __pyx_v_nstates = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[16]); if (unlikely((__pyx_v_nstates == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 706, __pyx_L3_error)</span>
    __pyx_v_two_stage = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[17]); if (unlikely((__pyx_v_two_stage == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 707, __pyx_L3_error)</span>
    __pyx_v_z_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[18]); if (unlikely((__pyx_v_z_2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 709, __pyx_L3_error)</span>
    __pyx_v_v_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[19]); if (unlikely((__pyx_v_v_2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 710, __pyx_L3_error)</span>
    __pyx_v_alpha2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[20]); if (unlikely((__pyx_v_alpha2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 711, __pyx_L3_error)</span>
    __pyx_v_w = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[21]); if (unlikely((__pyx_v_w == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 712, __pyx_L3_error)</span>
    __pyx_v_window_start = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[22]); if (unlikely((__pyx_v_window_start == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 712, __pyx_L3_error)</span>
    __pyx_v_window_size = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[23]); if (unlikely((__pyx_v_window_size == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 712, __pyx_L3_error)</span>
    __pyx_v_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[24]); if (unlikely((__pyx_v_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 715, __pyx_L3_error)</span>
    if (values[25]) {
      __pyx_v_n_st = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[25]); if (unlikely((__pyx_v_n_st == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 715, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_st = ((int)10);
    }
    if (values[26]) {
      __pyx_v_n_sz = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[26]); if (unlikely((__pyx_v_n_sz == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 715, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_sz = ((int)10);
    }
    if (values[27]) {
      __pyx_v_use_adaptive = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[27]); if (unlikely((__pyx_v_use_adaptive == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 715, __pyx_L3_error)</span>
    } else {
      __pyx_v_use_adaptive = ((int)1);
    }
    if (values[28]) {
      __pyx_v_simps_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[28]); if (unlikely((__pyx_v_simps_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 715, __pyx_L3_error)</span>
    } else {
      __pyx_v_simps_err = ((double)1e-8);
    }
    if (values[29]) {
      __pyx_v_p_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[29]); if (unlikely((__pyx_v_p_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 716, __pyx_L3_error)</span>
    } else {
      __pyx_v_p_outlier = ((double)0.0);
    }
    if (values[30]) {
      __pyx_v_w_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[30]); if (unlikely((__pyx_v_w_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 716, __pyx_L3_error)</span>
    } else {
      __pyx_v_w_outlier = ((double)0.0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl_2step", 0, 25, 31, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_rl_2step", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x1), __pyx_ptype_5numpy_ndarray, 1, "x1", 0))) <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x2), __pyx_ptype_5numpy_ndarray, 1, "x2", 0))) <span class='error_goto'>__PYX_ERR(0, 691, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_s1), __pyx_ptype_5numpy_ndarray, 1, "s1", 0))) <span class='error_goto'>__PYX_ERR(0, 692, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_s2), __pyx_ptype_5numpy_ndarray, 1, "s2", 0))) <span class='error_goto'>__PYX_ERR(0, 693, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_response1), __pyx_ptype_5numpy_ndarray, 1, "response1", 0))) <span class='error_goto'>__PYX_ERR(0, 694, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_response2), __pyx_ptype_5numpy_ndarray, 1, "response2", 0))) <span class='error_goto'>__PYX_ERR(0, 695, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_feedback), __pyx_ptype_5numpy_ndarray, 1, "feedback", 0))) <span class='error_goto'>__PYX_ERR(0, 696, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_split_by), __pyx_ptype_5numpy_ndarray, 1, "split_by", 0))) <span class='error_goto'>__PYX_ERR(0, 697, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4wfpt_12wiener_like_rl_2step(__pyx_self, __pyx_v_x1, __pyx_v_x2, __pyx_v_s1, __pyx_v_s2, __pyx_v_response1, __pyx_v_response2, __pyx_v_feedback, __pyx_v_split_by, __pyx_v_q, __pyx_v_alpha, __pyx_v_pos_alpha, __pyx_v_gamma, __pyx_v_gamma2, __pyx_v_lambda_, __pyx_v_v, __pyx_v_z, __pyx_v_nstates, __pyx_v_two_stage, __pyx_v_z_2, __pyx_v_v_2, __pyx_v_alpha2, __pyx_v_w, __pyx_v_window_start, __pyx_v_window_size, __pyx_v_err, __pyx_v_n_st, __pyx_v_n_sz, __pyx_v_use_adaptive, __pyx_v_simps_err, __pyx_v_p_outlier, __pyx_v_w_outlier);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_12wiener_like_rl_2step(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_x1, PyArrayObject *__pyx_v_x2, PyArrayObject *__pyx_v_s1, PyArrayObject *__pyx_v_s2, PyArrayObject *__pyx_v_response1, PyArrayObject *__pyx_v_response2, PyArrayObject *__pyx_v_feedback, PyArrayObject *__pyx_v_split_by, double __pyx_v_q, double __pyx_v_alpha, double __pyx_v_pos_alpha, double __pyx_v_gamma, double __pyx_v_gamma2, double __pyx_v_lambda_, double __pyx_v_v, double __pyx_v_z, int __pyx_v_nstates, double __pyx_v_two_stage, double __pyx_v_z_2, double __pyx_v_v_2, double __pyx_v_alpha2, double __pyx_v_w, double __pyx_v_window_start, double __pyx_v_window_size, CYTHON_UNUSED double __pyx_v_err, CYTHON_UNUSED int __pyx_v_n_st, CYTHON_UNUSED int __pyx_v_n_sz, CYTHON_UNUSED int __pyx_v_use_adaptive, CYTHON_UNUSED double __pyx_v_simps_err, double __pyx_v_p_outlier, double __pyx_v_w_outlier) {
  CYTHON_UNUSED double __pyx_v_sz;
  CYTHON_UNUSED double __pyx_v_st;
  CYTHON_UNUSED double __pyx_v_sv;
  CYTHON_UNUSED Py_ssize_t __pyx_v_size;
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_j;
  Py_ssize_t __pyx_v_s_size;
  int __pyx_v_s;
  double __pyx_v_p;
  double __pyx_v_drift;
  double __pyx_v_sum_logp;
  double __pyx_v_wp_outlier;
  double __pyx_v_alfa;
  CYTHON_UNUSED double __pyx_v_pos_alfa;
  double __pyx_v_alfa2;
  double __pyx_v_gamma_;
  double __pyx_v_gamma__;
  double __pyx_v_lambda__;
  PyArrayObject *__pyx_v_qs = 0;
  PyArrayObject *__pyx_v_qs_mf = 0;
  PyArrayObject *__pyx_v_qs_mb = 0;
  double __pyx_v_dtQ1;
  double __pyx_v_dtQ2;
  long __pyx_v_s_;
  long __pyx_v_a_;
  PyArrayObject *__pyx_v_x1s = 0;
  CYTHON_UNUSED PyArrayObject *__pyx_v_x2s = 0;
  PyArrayObject *__pyx_v_feedbacks = 0;
  PyArrayObject *__pyx_v_responses1 = 0;
  PyArrayObject *__pyx_v_responses2 = 0;
  PyArrayObject *__pyx_v_unique = 0;
  PyArrayObject *__pyx_v_s1s = 0;
  PyArrayObject *__pyx_v_s2s = 0;
  PyArrayObject *__pyx_v_planets = 0;
  PyArrayObject *__pyx_v_counter = 0;
  PyArrayObject *__pyx_v_Qmb = 0;
  PyArrayObject *__pyx_v_Tm = 0;
  PyArrayObject *__pyx_v_state_combinations = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Qmb;
  __Pyx_Buffer __pyx_pybuffer_Qmb;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Tm;
  __Pyx_Buffer __pyx_pybuffer_Tm;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_counter;
  __Pyx_Buffer __pyx_pybuffer_counter;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_feedback;
  __Pyx_Buffer __pyx_pybuffer_feedback;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_feedbacks;
  __Pyx_Buffer __pyx_pybuffer_feedbacks;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_planets;
  __Pyx_Buffer __pyx_pybuffer_planets;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_qs;
  __Pyx_Buffer __pyx_pybuffer_qs;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_qs_mb;
  __Pyx_Buffer __pyx_pybuffer_qs_mb;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_qs_mf;
  __Pyx_Buffer __pyx_pybuffer_qs_mf;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_response1;
  __Pyx_Buffer __pyx_pybuffer_response1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_response2;
  __Pyx_Buffer __pyx_pybuffer_response2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_responses1;
  __Pyx_Buffer __pyx_pybuffer_responses1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_responses2;
  __Pyx_Buffer __pyx_pybuffer_responses2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_s1;
  __Pyx_Buffer __pyx_pybuffer_s1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_s1s;
  __Pyx_Buffer __pyx_pybuffer_s1s;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_s2;
  __Pyx_Buffer __pyx_pybuffer_s2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_s2s;
  __Pyx_Buffer __pyx_pybuffer_s2s;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_split_by;
  __Pyx_Buffer __pyx_pybuffer_split_by;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_state_combinations;
  __Pyx_Buffer __pyx_pybuffer_state_combinations;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_unique;
  __Pyx_Buffer __pyx_pybuffer_unique;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x1;
  __Pyx_Buffer __pyx_pybuffer_x1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x1s;
  __Pyx_Buffer __pyx_pybuffer_x1s;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x2;
  __Pyx_Buffer __pyx_pybuffer_x2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x2s;
  __Pyx_Buffer __pyx_pybuffer_x2s;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_rl_2step", 0);
  __pyx_pybuffer_qs.pybuffer.buf = NULL;
  __pyx_pybuffer_qs.refcount = 0;
  __pyx_pybuffernd_qs.data = NULL;
  __pyx_pybuffernd_qs.rcbuffer = &amp;__pyx_pybuffer_qs;
  __pyx_pybuffer_qs_mf.pybuffer.buf = NULL;
  __pyx_pybuffer_qs_mf.refcount = 0;
  __pyx_pybuffernd_qs_mf.data = NULL;
  __pyx_pybuffernd_qs_mf.rcbuffer = &amp;__pyx_pybuffer_qs_mf;
  __pyx_pybuffer_qs_mb.pybuffer.buf = NULL;
  __pyx_pybuffer_qs_mb.refcount = 0;
  __pyx_pybuffernd_qs_mb.data = NULL;
  __pyx_pybuffernd_qs_mb.rcbuffer = &amp;__pyx_pybuffer_qs_mb;
  __pyx_pybuffer_x1s.pybuffer.buf = NULL;
  __pyx_pybuffer_x1s.refcount = 0;
  __pyx_pybuffernd_x1s.data = NULL;
  __pyx_pybuffernd_x1s.rcbuffer = &amp;__pyx_pybuffer_x1s;
  __pyx_pybuffer_x2s.pybuffer.buf = NULL;
  __pyx_pybuffer_x2s.refcount = 0;
  __pyx_pybuffernd_x2s.data = NULL;
  __pyx_pybuffernd_x2s.rcbuffer = &amp;__pyx_pybuffer_x2s;
  __pyx_pybuffer_feedbacks.pybuffer.buf = NULL;
  __pyx_pybuffer_feedbacks.refcount = 0;
  __pyx_pybuffernd_feedbacks.data = NULL;
  __pyx_pybuffernd_feedbacks.rcbuffer = &amp;__pyx_pybuffer_feedbacks;
  __pyx_pybuffer_responses1.pybuffer.buf = NULL;
  __pyx_pybuffer_responses1.refcount = 0;
  __pyx_pybuffernd_responses1.data = NULL;
  __pyx_pybuffernd_responses1.rcbuffer = &amp;__pyx_pybuffer_responses1;
  __pyx_pybuffer_responses2.pybuffer.buf = NULL;
  __pyx_pybuffer_responses2.refcount = 0;
  __pyx_pybuffernd_responses2.data = NULL;
  __pyx_pybuffernd_responses2.rcbuffer = &amp;__pyx_pybuffer_responses2;
  __pyx_pybuffer_unique.pybuffer.buf = NULL;
  __pyx_pybuffer_unique.refcount = 0;
  __pyx_pybuffernd_unique.data = NULL;
  __pyx_pybuffernd_unique.rcbuffer = &amp;__pyx_pybuffer_unique;
  __pyx_pybuffer_s1s.pybuffer.buf = NULL;
  __pyx_pybuffer_s1s.refcount = 0;
  __pyx_pybuffernd_s1s.data = NULL;
  __pyx_pybuffernd_s1s.rcbuffer = &amp;__pyx_pybuffer_s1s;
  __pyx_pybuffer_s2s.pybuffer.buf = NULL;
  __pyx_pybuffer_s2s.refcount = 0;
  __pyx_pybuffernd_s2s.data = NULL;
  __pyx_pybuffernd_s2s.rcbuffer = &amp;__pyx_pybuffer_s2s;
  __pyx_pybuffer_planets.pybuffer.buf = NULL;
  __pyx_pybuffer_planets.refcount = 0;
  __pyx_pybuffernd_planets.data = NULL;
  __pyx_pybuffernd_planets.rcbuffer = &amp;__pyx_pybuffer_planets;
  __pyx_pybuffer_counter.pybuffer.buf = NULL;
  __pyx_pybuffer_counter.refcount = 0;
  __pyx_pybuffernd_counter.data = NULL;
  __pyx_pybuffernd_counter.rcbuffer = &amp;__pyx_pybuffer_counter;
  __pyx_pybuffer_Qmb.pybuffer.buf = NULL;
  __pyx_pybuffer_Qmb.refcount = 0;
  __pyx_pybuffernd_Qmb.data = NULL;
  __pyx_pybuffernd_Qmb.rcbuffer = &amp;__pyx_pybuffer_Qmb;
  __pyx_pybuffer_Tm.pybuffer.buf = NULL;
  __pyx_pybuffer_Tm.refcount = 0;
  __pyx_pybuffernd_Tm.data = NULL;
  __pyx_pybuffernd_Tm.rcbuffer = &amp;__pyx_pybuffer_Tm;
  __pyx_pybuffer_state_combinations.pybuffer.buf = NULL;
  __pyx_pybuffer_state_combinations.refcount = 0;
  __pyx_pybuffernd_state_combinations.data = NULL;
  __pyx_pybuffernd_state_combinations.rcbuffer = &amp;__pyx_pybuffer_state_combinations;
  __pyx_pybuffer_x1.pybuffer.buf = NULL;
  __pyx_pybuffer_x1.refcount = 0;
  __pyx_pybuffernd_x1.data = NULL;
  __pyx_pybuffernd_x1.rcbuffer = &amp;__pyx_pybuffer_x1;
  __pyx_pybuffer_x2.pybuffer.buf = NULL;
  __pyx_pybuffer_x2.refcount = 0;
  __pyx_pybuffernd_x2.data = NULL;
  __pyx_pybuffernd_x2.rcbuffer = &amp;__pyx_pybuffer_x2;
  __pyx_pybuffer_s1.pybuffer.buf = NULL;
  __pyx_pybuffer_s1.refcount = 0;
  __pyx_pybuffernd_s1.data = NULL;
  __pyx_pybuffernd_s1.rcbuffer = &amp;__pyx_pybuffer_s1;
  __pyx_pybuffer_s2.pybuffer.buf = NULL;
  __pyx_pybuffer_s2.refcount = 0;
  __pyx_pybuffernd_s2.data = NULL;
  __pyx_pybuffernd_s2.rcbuffer = &amp;__pyx_pybuffer_s2;
  __pyx_pybuffer_response1.pybuffer.buf = NULL;
  __pyx_pybuffer_response1.refcount = 0;
  __pyx_pybuffernd_response1.data = NULL;
  __pyx_pybuffernd_response1.rcbuffer = &amp;__pyx_pybuffer_response1;
  __pyx_pybuffer_response2.pybuffer.buf = NULL;
  __pyx_pybuffer_response2.refcount = 0;
  __pyx_pybuffernd_response2.data = NULL;
  __pyx_pybuffernd_response2.rcbuffer = &amp;__pyx_pybuffer_response2;
  __pyx_pybuffer_feedback.pybuffer.buf = NULL;
  __pyx_pybuffer_feedback.refcount = 0;
  __pyx_pybuffernd_feedback.data = NULL;
  __pyx_pybuffernd_feedback.rcbuffer = &amp;__pyx_pybuffer_feedback;
  __pyx_pybuffer_split_by.pybuffer.buf = NULL;
  __pyx_pybuffer_split_by.refcount = 0;
  __pyx_pybuffernd_split_by.data = NULL;
  __pyx_pybuffernd_split_by.rcbuffer = &amp;__pyx_pybuffer_split_by;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x1, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_x1.diminfo[0].strides = __pyx_pybuffernd_x1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x1.diminfo[0].shape = __pyx_pybuffernd_x1.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x2, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_x2.diminfo[0].strides = __pyx_pybuffernd_x2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x2.diminfo[0].shape = __pyx_pybuffernd_x2.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_s1, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_s1.diminfo[0].strides = __pyx_pybuffernd_s1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_s1.diminfo[0].shape = __pyx_pybuffernd_s1.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_s2, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_s2.diminfo[0].strides = __pyx_pybuffernd_s2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_s2.diminfo[0].shape = __pyx_pybuffernd_s2.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_response1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_response1, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_response1.diminfo[0].strides = __pyx_pybuffernd_response1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_response1.diminfo[0].shape = __pyx_pybuffernd_response1.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_response2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_response2, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_response2.diminfo[0].strides = __pyx_pybuffernd_response2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_response2.diminfo[0].shape = __pyx_pybuffernd_response2.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_feedback, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_feedback.diminfo[0].strides = __pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_feedback.diminfo[0].shape = __pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_split_by, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_split_by.diminfo[0].strides = __pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_split_by.diminfo[0].shape = __pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response2.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s2.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x2.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_rl_2step", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_qs);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_qs_mf);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_qs_mb);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_x1s);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_x2s);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_feedbacks);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_responses1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_responses2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_unique);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_s1s);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_s2s);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_planets);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_counter);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Qmb);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Tm);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_state_combinations);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__21 = <span class='py_c_api'>PyTuple_Pack</span>(73, __pyx_n_s_x1, __pyx_n_s_x2, __pyx_n_s_s1, __pyx_n_s_s2, __pyx_n_s_response1, __pyx_n_s_response2, __pyx_n_s_feedback, __pyx_n_s_split_by, __pyx_n_s_q, __pyx_n_s_alpha, __pyx_n_s_pos_alpha, __pyx_n_s_gamma, __pyx_n_s_gamma2, __pyx_n_s_lambda, __pyx_n_s_v, __pyx_n_s_z, __pyx_n_s_nstates, __pyx_n_s_two_stage, __pyx_n_s_z_2, __pyx_n_s_v_2, __pyx_n_s_alpha2, __pyx_n_s_w, __pyx_n_s_window_start, __pyx_n_s_window_size, __pyx_n_s_err, __pyx_n_s_n_st, __pyx_n_s_n_sz, __pyx_n_s_use_adaptive, __pyx_n_s_simps_err, __pyx_n_s_p_outlier, __pyx_n_s_w_outlier, __pyx_n_s_sz, __pyx_n_s_st, __pyx_n_s_sv, __pyx_n_s_size, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_s_size, __pyx_n_s_s, __pyx_n_s_p, __pyx_n_s_drift, __pyx_n_s_sum_logp, __pyx_n_s_wp_outlier, __pyx_n_s_alfa, __pyx_n_s_pos_alfa, __pyx_n_s_alfa2, __pyx_n_s_gamma_2, __pyx_n_s_gamma_3, __pyx_n_s_lambda_2, __pyx_n_s_qs, __pyx_n_s_qs_mf, __pyx_n_s_qs_mb, __pyx_n_s_dtQ1, __pyx_n_s_dtQ2, __pyx_n_s_dtq_mb, __pyx_n_s_dtq_mf, __pyx_n_s_s_2, __pyx_n_s_a_3, __pyx_n_s_x1s, __pyx_n_s_x2s, __pyx_n_s_feedbacks, __pyx_n_s_responses1, __pyx_n_s_responses2, __pyx_n_s_unique, __pyx_n_s_s1s, __pyx_n_s_s2s, __pyx_n_s_planets, __pyx_n_s_counter, __pyx_n_s_Qmb, __pyx_n_s_dtq, __pyx_n_s_rt, __pyx_n_s_Tm, __pyx_n_s_state_combinations);<span class='error_goto'> if (unlikely(!__pyx_tuple__21)) __PYX_ERR(0, 690, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__21);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__21);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_13wiener_like_rl_2step, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 690, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_wiener_like_rl_2step, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 690, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__22 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(31, 0, 73, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__21, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_wiener_like_rl_2step, 690, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__22)) __PYX_ERR(0, 690, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0691</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x2</span><span class="p">,</span> <span class="c"># 2nd-stage RT</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0692</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span><span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">s1</span><span class="p">,</span> <span class="c"># 1st-stage state</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0693</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span><span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">s2</span><span class="p">,</span> <span class="c"># 2nd-stage state</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0694</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">response1</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0695</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">response2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0696</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">feedback</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0697</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">split_by</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0698</span>:                       <span class="n">double</span> <span class="n">q</span><span class="p">,</span> <span class="n">double</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">double</span> <span class="n">pos_alpha</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0699</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0700</span>:                       <span class="n">double</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">double</span> <span class="n">gamma2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0701</span>:                       <span class="n">double</span> <span class="n">lambda_</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0702</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0703</span>:                       <span class="n">double</span> <span class="n">v</span><span class="p">,</span> <span class="c"># don&#39;t use second stage</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0704</span>:                       <span class="n">double</span> <span class="n">z</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0705</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0706</span>:                       <span class="nb">int</span> <span class="n">nstates</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0707</span>:                       <span class="n">double</span> <span class="n">two_stage</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0708</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0709</span>:                       <span class="n">double</span> <span class="n">z_2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0710</span>:                       <span class="n">double</span> <span class="n">v_2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0711</span>:                       <span class="n">double</span> <span class="n">alpha2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0712</span>:                       <span class="n">double</span> <span class="n">w</span><span class="p">,</span> <span class="n">double</span> <span class="n">window_start</span><span class="p">,</span> <span class="n">double</span> <span class="n">window_size</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0713</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0714</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0715</span>:                       <span class="n">double</span> <span class="n">err</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_st</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_sz</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">use_adaptive</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span> <span class="n">double</span> <span class="n">simps_err</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0716</span>:                       <span class="n">double</span> <span class="n">p_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="n">double</span> <span class="n">w_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0717</span>:                       <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0718</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0719</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sz</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sz = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0720</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">st</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_st = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0721</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sv</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sv = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0722</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0723</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0724</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">size</span> <span class="o">=</span> <span class="n">x1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_size = (__pyx_v_x1-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0725</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0726</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">s_size</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0727</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0728</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">p</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0729</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">drift</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0730</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0731</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sum_logp</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sum_logp = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0732</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">wp_outlier</span> <span class="o">=</span> <span class="n">w_outlier</span> <span class="o">*</span> <span class="n">p_outlier</span></pre>
<pre class='cython code score-0 '>  __pyx_v_wp_outlier = (__pyx_v_w_outlier * __pyx_v_p_outlier);
</pre><pre class="cython line score-0">&#xA0;<span class="">0733</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">alfa</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0734</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">pos_alfa</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0735</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">alfa2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0736</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0737</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">gamma_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0738</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">gamma__</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0739</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">lambda__</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0740</span>: </pre>
<pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0741</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span></pre>
<pre class='cython code score-42 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 741, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 741, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 741, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 741, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 741, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4);
  __pyx_t_2 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 741, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 741, __pyx_L1_error)</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_qs = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 741, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_qs.diminfo[0].strides = __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_qs.diminfo[0].shape = __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_qs = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-69" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0742</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">qs_mf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">comb</span><span class="p">(</span><span class="n">nstates</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="n">exact</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="mf">2</span><span class="p">))</span><span class="o">*</span><span class="n">q</span> <span class="c"># first-stage MF Q-values</span></pre>
<pre class='cython code score-69 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 742, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 742, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_comb);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 742, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 742, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 742, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_int_2);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 742, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_exact, Py_True) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 742, __pyx_L1_error)</span>
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_2, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 742, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 742, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_int_2);
  __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_7)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
    }
  }
  __pyx_t_1 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_7, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 742, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 742, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_4 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_1, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 742, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 742, __pyx_L1_error)</span>
  __pyx_t_8 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_8, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_qs_mf = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 742, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_qs_mf.diminfo[0].strides = __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_qs_mf.diminfo[0].shape = __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_qs_mf.diminfo[1].strides = __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_qs_mf.diminfo[1].shape = __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_8 = 0;
  __pyx_v_qs_mf = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-47" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0743</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">qs_mb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nstates</span><span class="p">,</span> <span class="mf">2</span><span class="p">))</span><span class="o">*</span><span class="n">q</span> <span class="c"># second-stage Q-values</span></pre>
<pre class='cython code score-47 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 743, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 743, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 743, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 743, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 1, __pyx_int_2);
  __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, __pyx_t_7) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 743, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 743, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_7 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_4, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 743, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 743, __pyx_L1_error)</span>
  __pyx_t_9 = ((PyArrayObject *)__pyx_t_7);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_9, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_qs_mb = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 743, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_qs_mb.diminfo[0].strides = __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_qs_mb.diminfo[0].shape = __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_qs_mb.diminfo[1].strides = __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_qs_mb.diminfo[1].shape = __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_9 = 0;
  __pyx_v_qs_mb = ((PyArrayObject *)__pyx_t_7);
  __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0744</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0745</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dtQ1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0746</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dtQ2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0747</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0748</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dtq_mb</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0749</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dtq_mf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0750</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0751</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">s_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0752</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">a_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0753</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0754</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x1s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0755</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x2s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0756</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">feedbacks</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0757</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">responses1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0758</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">responses2</span></pre>
<pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0759</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">split_by</span><span class="p">)</span></pre>
<pre class='cython code score-24 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 759, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_unique);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 759, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_1)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_7 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_1, ((PyObject *)__pyx_v_split_by)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, ((PyObject *)__pyx_v_split_by));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 759, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 759, __pyx_L1_error)</span>
  __pyx_t_10 = ((PyArrayObject *)__pyx_t_7);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_10, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_unique = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 759, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_unique.diminfo[0].strides = __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_unique.diminfo[0].shape = __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_10 = 0;
  __pyx_v_unique = ((PyArrayObject *)__pyx_t_7);
  __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0760</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0761</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">s1s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0762</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">s2s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0763</span>:     <span class="c"># cdef np.ndarray[long, ndim=1] isleft1s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0764</span>:     <span class="c"># cdef np.ndarray[long, ndim=1] isleft2s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0765</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0766</span>:     <span class="c"># Added by Jungsun Yoo on 2021-11-27 for two-step tasks</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0767</span>:     <span class="c"># parameters added for two-step</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0768</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0769</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0770</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">planets</span></pre>
<pre class="cython line score-49" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0771</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">comb</span><span class="p">(</span><span class="n">nstates</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="n">exact</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span></pre>
<pre class='cython code score-49 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 771, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 771, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_comb);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 771, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 771, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 771, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_int_2);
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 771, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_exact, Py_True) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 771, __pyx_L1_error)</span>
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_2, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 771, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_7 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 771, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 771, __pyx_L1_error)</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_7);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_counter = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 771, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_counter.diminfo[0].strides = __pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_counter.diminfo[0].shape = __pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_11 = 0;
  __pyx_v_counter = ((PyArrayObject *)__pyx_t_7);
  __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0772</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">Qmb</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0773</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dtq</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0774</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">rt</span></pre>
<pre class="cython line score-50" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0775</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">Tm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">]])</span> <span class="c"># transition matrix</span></pre>
<pre class='cython code score-50 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 775, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 775, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 775, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_7);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_float_0_7);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_3);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 1, __pyx_float_0_3);
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 775, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_3);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_float_0_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_7);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_float_0_7);
  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 775, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_5);
  __pyx_t_1 = 0;
  __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_7 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_2) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 775, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 775, __pyx_L1_error)</span>
  __pyx_t_12 = ((PyArrayObject *)__pyx_t_7);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_12, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_Tm = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 775, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_Tm.diminfo[0].strides = __pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Tm.diminfo[0].shape = __pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Tm.diminfo[1].strides = __pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Tm.diminfo[1].shape = __pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_12 = 0;
  __pyx_v_Tm = ((PyArrayObject *)__pyx_t_7);
  __pyx_t_7 = 0;
</pre><pre class="cython line score-96" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0776</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">state_combinations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nstates</span><span class="p">),</span><span class="mf">2</span><span class="p">)))</span></pre>
<pre class='cython code score-96 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 776, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 776, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_itertools);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 776, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_combinations);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 776, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 776, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_arange);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 776, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 776, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_14 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
    __pyx_t_14 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
    if (likely(__pyx_t_14)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
    }
  }
  __pyx_t_5 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_13, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 776, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  __pyx_t_13 = NULL;
  __pyx_t_15 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_13 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_13)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
      __pyx_t_15 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_1)) {
    PyObject *__pyx_temp[3] = {__pyx_t_13, __pyx_t_5, __pyx_int_2};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 776, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_1)) {
    PyObject *__pyx_temp[3] = {__pyx_t_13, __pyx_t_5, __pyx_int_2};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 776, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  {
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 776, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    if (__pyx_t_13) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_13); __pyx_t_13 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0+__pyx_t_15, __pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1+__pyx_t_15, __pyx_int_2);
    __pyx_t_5 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_4, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 776, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PySequence_List</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 776, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_7 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 776, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 776, __pyx_L1_error)</span>
  __pyx_t_16 = ((PyArrayObject *)__pyx_t_7);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_16, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_state_combinations = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 776, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_state_combinations.diminfo[0].strides = __pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_state_combinations.diminfo[0].shape = __pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_state_combinations.diminfo[1].strides = __pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_state_combinations.diminfo[1].shape = __pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_16 = 0;
  __pyx_v_state_combinations = ((PyArrayObject *)__pyx_t_7);
  __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0777</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0778</span>:     <span class="k">if</span> <span class="ow">not</span> <span class="n">p_outlier_in_range</span><span class="p">(</span><span class="n">p_outlier</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_17 = ((!(__pyx_f_4wfpt_p_outlier_in_range(__pyx_v_p_outlier) != 0)) != 0);
  if (__pyx_t_17) {
/* … */
  }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0779</span>:         <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-12 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 779, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 779, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 779, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_r = __pyx_t_7;
    __pyx_t_7 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0780</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0781</span>:     <span class="k">if</span> <span class="n">pos_alpha</span><span class="o">==</span><span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_17 = ((__pyx_v_pos_alpha == 100.00) != 0);
  if (__pyx_t_17) {
/* … */
    goto __pyx_L4;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0782</span>:         <span class="n">pos_alfa</span> <span class="o">=</span> <span class="n">alpha</span></pre>
<pre class='cython code score-0 '>    __pyx_v_pos_alfa = __pyx_v_alpha;
</pre><pre class="cython line score-0">&#xA0;<span class="">0783</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0784</span>:         <span class="n">pos_alfa</span> <span class="o">=</span> <span class="n">pos_alpha</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_pos_alfa = __pyx_v_pos_alpha;
  }
  __pyx_L4:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0785</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0786</span>:     <span class="c"># if alpha2==100.00: # if either only 1st stage or don&#39;t share lr:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0787</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0788</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0789</span>:     <span class="c"># unique represent # of conditions</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0790</span>:     <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">unique</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_18 = (__pyx_v_unique-&gt;dimensions[0]);
  __pyx_t_19 = __pyx_t_18;
  for (__pyx_t_20 = 0; __pyx_t_20 &lt; __pyx_t_19; __pyx_t_20+=1) {
    __pyx_v_j = __pyx_t_20;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0791</span>:         <span class="n">s</span> <span class="o">=</span> <span class="n">unique</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_21 = __pyx_v_j;
    __pyx_v_s = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_unique.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">0792</span>:         <span class="c"># select trials for current condition, identified by the split_by-array</span></pre>
<pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0793</span>:         <span class="n">feedbacks</span> <span class="o">=</span> <span class="n">feedback</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 793, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_7, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 793, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_feedback), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 793, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 793, __pyx_L1_error)</span>
    __pyx_t_22 = ((PyArrayObject *)__pyx_t_7);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer);
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_22, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_15 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_23, &amp;__pyx_t_24, &amp;__pyx_t_25);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_feedbacks, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_23); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_23, __pyx_t_24, __pyx_t_25);
        }
        __pyx_t_23 = __pyx_t_24 = __pyx_t_25 = 0;
      }
      __pyx_pybuffernd_feedbacks.diminfo[0].strides = __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_feedbacks.diminfo[0].shape = __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_15 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 793, __pyx_L1_error)</span>
    }
    __pyx_t_22 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_feedbacks, ((PyArrayObject *)__pyx_t_7));
    __pyx_t_7 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0794</span>:         <span class="n">responses1</span> <span class="o">=</span> <span class="n">response1</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 794, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_7, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 794, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_response1), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 794, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 794, __pyx_L1_error)</span>
    __pyx_t_26 = ((PyArrayObject *)__pyx_t_7);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer);
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_26, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_15 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_25, &amp;__pyx_t_24, &amp;__pyx_t_23);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_responses1, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_23);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_25, __pyx_t_24, __pyx_t_23);
        }
        __pyx_t_25 = __pyx_t_24 = __pyx_t_23 = 0;
      }
      __pyx_pybuffernd_responses1.diminfo[0].strides = __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_responses1.diminfo[0].shape = __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_15 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 794, __pyx_L1_error)</span>
    }
    __pyx_t_26 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_responses1, ((PyArrayObject *)__pyx_t_7));
    __pyx_t_7 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0795</span>:         <span class="n">responses2</span> <span class="o">=</span> <span class="n">response2</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 795, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_7, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 795, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_response2), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 795, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 795, __pyx_L1_error)</span>
    __pyx_t_27 = ((PyArrayObject *)__pyx_t_7);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer);
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_27, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_15 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_23, &amp;__pyx_t_24, &amp;__pyx_t_25);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_responses2, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_23); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_23, __pyx_t_24, __pyx_t_25);
        }
        __pyx_t_23 = __pyx_t_24 = __pyx_t_25 = 0;
      }
      __pyx_pybuffernd_responses2.diminfo[0].strides = __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_responses2.diminfo[0].shape = __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_15 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 795, __pyx_L1_error)</span>
    }
    __pyx_t_27 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_responses2, ((PyArrayObject *)__pyx_t_7));
    __pyx_t_7 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0796</span>:         <span class="n">x1s</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 796, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_7, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 796, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_x1), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 796, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 796, __pyx_L1_error)</span>
    __pyx_t_28 = ((PyArrayObject *)__pyx_t_7);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer);
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_28, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_15 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_25, &amp;__pyx_t_24, &amp;__pyx_t_23);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x1s, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_23);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_25, __pyx_t_24, __pyx_t_23);
        }
        __pyx_t_25 = __pyx_t_24 = __pyx_t_23 = 0;
      }
      __pyx_pybuffernd_x1s.diminfo[0].strides = __pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x1s.diminfo[0].shape = __pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_15 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 796, __pyx_L1_error)</span>
    }
    __pyx_t_28 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_x1s, ((PyArrayObject *)__pyx_t_7));
    __pyx_t_7 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0797</span>:         <span class="n">x2s</span> <span class="o">=</span> <span class="n">x2</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 797, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_7, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 797, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_x2), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 797, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 797, __pyx_L1_error)</span>
    __pyx_t_29 = ((PyArrayObject *)__pyx_t_7);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer);
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_29, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_15 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_23, &amp;__pyx_t_24, &amp;__pyx_t_25);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x2s, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_23); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_23, __pyx_t_24, __pyx_t_25);
        }
        __pyx_t_23 = __pyx_t_24 = __pyx_t_25 = 0;
      }
      __pyx_pybuffernd_x2s.diminfo[0].strides = __pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x2s.diminfo[0].shape = __pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_15 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 797, __pyx_L1_error)</span>
    }
    __pyx_t_29 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_x2s, ((PyArrayObject *)__pyx_t_7));
    __pyx_t_7 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0798</span>:         <span class="n">s1s</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 798, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_7, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 798, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_s1), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 798, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 798, __pyx_L1_error)</span>
    __pyx_t_30 = ((PyArrayObject *)__pyx_t_7);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer);
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_30, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_15 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_25, &amp;__pyx_t_24, &amp;__pyx_t_23);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_s1s, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_23);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_25, __pyx_t_24, __pyx_t_23);
        }
        __pyx_t_25 = __pyx_t_24 = __pyx_t_23 = 0;
      }
      __pyx_pybuffernd_s1s.diminfo[0].strides = __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_s1s.diminfo[0].shape = __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_15 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 798, __pyx_L1_error)</span>
    }
    __pyx_t_30 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_s1s, ((PyArrayObject *)__pyx_t_7));
    __pyx_t_7 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0799</span>:         <span class="n">s2s</span> <span class="o">=</span> <span class="n">s2</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 799, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_7, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 799, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_s2), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 799, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 799, __pyx_L1_error)</span>
    __pyx_t_31 = ((PyArrayObject *)__pyx_t_7);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer);
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_31, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_15 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_23, &amp;__pyx_t_24, &amp;__pyx_t_25);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_s2s, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_23); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_23, __pyx_t_24, __pyx_t_25);
        }
        __pyx_t_23 = __pyx_t_24 = __pyx_t_25 = 0;
      }
      __pyx_pybuffernd_s2s.diminfo[0].strides = __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_s2s.diminfo[0].shape = __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_15 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 799, __pyx_L1_error)</span>
    }
    __pyx_t_31 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_s2s, ((PyArrayObject *)__pyx_t_7));
    __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0800</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0801</span>:         <span class="c"># isleft1s = isleft1[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0802</span>:         <span class="c"># isleft2s = isleft2[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0803</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0804</span>:         <span class="n">s_size</span> <span class="o">=</span> <span class="n">x1s</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_v_s_size = (__pyx_v_x1s-&gt;dimensions[0]);
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0805</span>:         <span class="n">qs_mf</span><span class="p">[:,</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-11 '>    __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 805, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_qs_mf), __pyx_tuple__2, __pyx_t_7) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 805, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0806</span>:         <span class="n">qs_mf</span><span class="p">[:,</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-11 '>    __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 806, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_qs_mf), __pyx_tuple__3, __pyx_t_7) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 806, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0807</span>: </pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0808</span>:         <span class="n">qs_mb</span><span class="p">[:,</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-11 '>    __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 808, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_qs_mb), __pyx_tuple__2, __pyx_t_7) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 808, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0809</span>:         <span class="n">qs_mb</span><span class="p">[:,</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-11 '>    __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 809, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_qs_mb), __pyx_tuple__3, __pyx_t_7) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 809, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0810</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0811</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0812</span>:         <span class="n">alfa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_alfa = (pow(2.718281828459, __pyx_v_alpha) / (1.0 + pow(2.718281828459, __pyx_v_alpha)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0813</span>:         <span class="n">gamma_</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">gamma</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">gamma</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_gamma_ = (pow(2.718281828459, __pyx_v_gamma) / (1.0 + pow(2.718281828459, __pyx_v_gamma)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0814</span>:         <span class="k">if</span> <span class="n">gamma2</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_17 = ((__pyx_v_gamma2 != 100.00) != 0);
    if (__pyx_t_17) {
/* … */
      goto __pyx_L7;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0815</span>:             <span class="n">gamma__</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">gamma2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">gamma2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_gamma__ = (pow(2.718281828459, __pyx_v_gamma2) / (1.0 + pow(2.718281828459, __pyx_v_gamma2)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0816</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0817</span>:             <span class="n">gamma__</span> <span class="o">=</span> <span class="n">gamma_</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_gamma__ = __pyx_v_gamma_;
    }
    __pyx_L7:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0818</span>:         <span class="k">if</span> <span class="n">alpha2</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_17 = ((__pyx_v_alpha2 != 100.00) != 0);
    if (__pyx_t_17) {
/* … */
      goto __pyx_L8;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0819</span>:             <span class="n">alfa2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_alfa2 = (pow(2.718281828459, __pyx_v_alpha2) / (1.0 + pow(2.718281828459, __pyx_v_alpha2)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0820</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0821</span>:             <span class="n">alfa2</span> <span class="o">=</span> <span class="n">alfa</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_alfa2 = __pyx_v_alfa;
    }
    __pyx_L8:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0822</span>:         <span class="k">if</span> <span class="n">lambda_</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_17 = ((__pyx_v_lambda_ != 100.00) != 0);
    if (__pyx_t_17) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0823</span>:             <span class="n">lambda__</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">lambda_</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">lambda_</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_lambda__ = (pow(2.718281828459, __pyx_v_lambda_) / (1.0 + pow(2.718281828459, __pyx_v_lambda_)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0824</span>:         <span class="k">if</span> <span class="n">w</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_17 = ((__pyx_v_w != 100.00) != 0);
    if (__pyx_t_17) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0825</span>:             <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">w</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_w = (pow(2.718281828459, __pyx_v_w) / (1.0 + pow(2.718281828459, __pyx_v_w)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0826</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0827</span>:         <span class="c"># loop through all trials in current condition</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0828</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="n">s_size</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_32 = __pyx_v_s_size;
    __pyx_t_33 = __pyx_t_32;
    for (__pyx_t_34 = 0; __pyx_t_34 &lt; __pyx_t_33; __pyx_t_34+=1) {
      __pyx_v_i = __pyx_t_34;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0829</span>:             <span class="k">if</span> <span class="n">window_start</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">window_start</span> <span class="o">+</span> <span class="n">window_size</span><span class="p">:</span>  <span class="c"># and (window_start &lt;= i &lt; window_start+window_size):</span></pre>
<pre class='cython code score-0 '>      __pyx_t_17 = (__pyx_v_window_start &lt;= __pyx_v_i);
      if (__pyx_t_17) {
        __pyx_t_17 = (__pyx_v_i &lt; (__pyx_v_window_start + __pyx_v_window_size));
      }
      __pyx_t_35 = (__pyx_t_17 != 0);
      if (__pyx_t_35) {
/* … */
      }
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0830</span>:                 <span class="k">if</span> <span class="n">counter</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">x1s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.15</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_21 = __pyx_v_i;
        __pyx_t_36 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_s1s.diminfo[0].strides));
        __pyx_t_17 = (((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer.buf, __pyx_t_36, __pyx_pybuffernd_counter.diminfo[0].strides)) &gt; 0.0) != 0);
        if (__pyx_t_17) {
        } else {
          __pyx_t_35 = __pyx_t_17;
          goto __pyx_L15_bool_binop_done;
        }
        __pyx_t_21 = __pyx_v_i;
        __pyx_t_17 = (((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_x1s.diminfo[0].strides)) &gt; 0.15) != 0);
        __pyx_t_35 = __pyx_t_17;
        __pyx_L15_bool_binop_done:;
        if (__pyx_t_35) {
/* … */
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">0831</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0832</span>:                     <span class="c"># proceed with pdf only if 1) the current 1st-stage state have been updated and 2) &quot;plausible&quot; RT (150 ms)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0833</span>:                     <span class="c"># 1st stage</span></pre>
<pre class="cython line score-23" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0834</span>:                     <span class="n">planets</span> <span class="o">=</span> <span class="n">state_combinations</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span></pre>
<pre class='cython code score-23 '>          __pyx_t_21 = __pyx_v_i;
          __pyx_t_37 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_s1s.diminfo[0].strides));
          __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_state_combinations), __pyx_t_37, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 834, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 834, __pyx_L1_error)</span>
          __pyx_t_38 = ((PyArrayObject *)__pyx_t_7);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer);
            __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_38, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 &lt; 0)) {
              <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_25, &amp;__pyx_t_24, &amp;__pyx_t_23);
              if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_planets, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_23);
                <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
              } else {
                <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_25, __pyx_t_24, __pyx_t_23);
              }
              __pyx_t_25 = __pyx_t_24 = __pyx_t_23 = 0;
            }
            __pyx_pybuffernd_planets.diminfo[0].strides = __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_planets.diminfo[0].shape = __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.shape[0];
            if (unlikely(__pyx_t_15 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 834, __pyx_L1_error)</span>
          }
          __pyx_t_38 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_planets, ((PyArrayObject *)__pyx_t_7));
          __pyx_t_7 = 0;
</pre><pre class="cython line score-137" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0835</span>:                     <span class="n">Qmb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Tm</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">qs_mb</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">0</span><span class="p">],:]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">qs_mb</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">1</span><span class="p">],:])])</span></pre>
<pre class='cython code score-137 '>          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_max);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_21 = 0;
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_planets.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_slice_);
          __pyx_t_3 = 0;
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_qs_mb), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = NULL;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
            __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
            if (likely(__pyx_t_5)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
            }
          }
          __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 835, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_max);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_21 = 1;
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_planets.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 1, __pyx_slice_);
          __pyx_t_3 = 0;
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_qs_mb), __pyx_t_13);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
          __pyx_t_13 = NULL;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
            __pyx_t_13 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
            if (likely(__pyx_t_13)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
            }
          }
          __pyx_t_4 = (__pyx_t_13) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_13, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 835, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
          <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
          <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4);
          __pyx_t_2 = 0;
          __pyx_t_4 = 0;
          __pyx_t_4 = NULL;
          __pyx_t_15 = 0;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
            __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
            if (likely(__pyx_t_4)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
              __pyx_t_15 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_1)) {
            PyObject *__pyx_temp[3] = {__pyx_t_4, ((PyObject *)__pyx_v_Tm), __pyx_t_5};
            __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_1)) {
            PyObject *__pyx_temp[3] = {__pyx_t_4, ((PyObject *)__pyx_v_Tm), __pyx_t_5};
            __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          } else
          #endif
          {
            __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            if (__pyx_t_4) {
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_4); __pyx_t_4 = NULL;
            }
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_Tm));
            <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_Tm));
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0+__pyx_t_15, ((PyObject *)__pyx_v_Tm));
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1+__pyx_t_15, __pyx_t_5);
            __pyx_t_5 = 0;
            __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 835, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 835, __pyx_L1_error)</span>
          __pyx_t_39 = ((PyArrayObject *)__pyx_t_7);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer);
            __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_39, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 &lt; 0)) {
              <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_23, &amp;__pyx_t_24, &amp;__pyx_t_25);
              if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Qmb, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_23); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25);
                <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
              } else {
                <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_23, __pyx_t_24, __pyx_t_25);
              }
              __pyx_t_23 = __pyx_t_24 = __pyx_t_25 = 0;
            }
            __pyx_pybuffernd_Qmb.diminfo[0].strides = __pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Qmb.diminfo[0].shape = __pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer.shape[0];
            if (unlikely(__pyx_t_15 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 835, __pyx_L1_error)</span>
          }
          __pyx_t_39 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_Qmb, ((PyArrayObject *)__pyx_t_7));
          __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0836</span>: </pre>
<pre class="cython line score-64" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0837</span>:                     <span class="n">qs</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">Qmb</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">:]</span>  <span class="c"># Update for 1st trial</span></pre>
<pre class='cython code score-64 '>          __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_w);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 837, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_7, ((PyObject *)__pyx_v_Qmb));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 837, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>((1.0 - __pyx_v_w));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 837, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          __pyx_t_21 = __pyx_v_i;
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_s1s.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 837, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 837, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_slice_);
          __pyx_t_2 = 0;
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_qs_mf), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 837, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_7, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 837, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 837, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 837, __pyx_L1_error)</span>
          __pyx_t_6 = ((PyArrayObject *)__pyx_t_2);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer);
            __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 &lt; 0)) {
              <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_25, &amp;__pyx_t_24, &amp;__pyx_t_23);
              if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_qs, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_23);
                <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
              } else {
                <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_25, __pyx_t_24, __pyx_t_23);
              }
              __pyx_t_25 = __pyx_t_24 = __pyx_t_23 = 0;
            }
            __pyx_pybuffernd_qs.diminfo[0].strides = __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_qs.diminfo[0].shape = __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.shape[0];
            if (unlikely(__pyx_t_15 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 837, __pyx_L1_error)</span>
          }
          __pyx_t_6 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_qs, ((PyArrayObject *)__pyx_t_2));
          __pyx_t_2 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0838</span>:                     <span class="n">drift</span> <span class="o">=</span> <span class="p">(</span><span class="n">qs</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">v</span></pre>
<pre class='cython code score-0 '>          __pyx_t_21 = 1;
          __pyx_t_36 = 0;
          __pyx_v_drift = (((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_qs.diminfo[0].strides)) - (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_36, __pyx_pybuffernd_qs.diminfo[0].strides))) * __pyx_v_v);
</pre><pre class="cython line score-0">&#xA0;<span class="">0839</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0840</span>:                     <span class="k">if</span> <span class="n">drift</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          __pyx_t_35 = ((__pyx_v_drift == 0.0) != 0);
          if (__pyx_t_35) {
/* … */
            goto __pyx_L17;
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0841</span>:                         <span class="n">p</span> <span class="o">=</span> <span class="mf">0.5</span></pre>
<pre class='cython code score-0 '>            __pyx_v_p = 0.5;
</pre><pre class="cython line score-0">&#xA0;<span class="">0842</span>:                     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0843</span>:                         <span class="k">if</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          /*else*/ {
            __pyx_t_36 = __pyx_v_i;
            __pyx_t_35 = (((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_36, __pyx_pybuffernd_responses1.diminfo[0].strides)) == 1) != 0);
            if (__pyx_t_35) {
/* … */
              goto __pyx_L18;
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0844</span>:                             <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">drift</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span> <span class="o">/</span> \</pre>
<pre class='cython code score-0 '>              __pyx_v_p = ((pow(2.718281828459, ((-2.0 * __pyx_v_z) * __pyx_v_drift)) - 1.0) / (pow(2.718281828459, (-2.0 * __pyx_v_drift)) - 1.0));
</pre><pre class="cython line score-0">&#xA0;<span class="">0845</span>:                                 <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">drift</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0846</span>:                         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0847</span>:                             <span class="n">p</span> <span class="o">=</span> <span class="mf">1</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">drift</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span> <span class="o">/</span> \</pre>
<pre class='cython code score-0 '>            /*else*/ {
/* … */
              __pyx_v_p = (1.0 - ((pow(2.718281828459, ((-2.0 * __pyx_v_z) * __pyx_v_drift)) - 1.0) / (pow(2.718281828459, (-2.0 * __pyx_v_drift)) - 1.0)));
            }
            __pyx_L18:;
          }
          __pyx_L17:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0848</span>:                                 <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">drift</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0849</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0850</span>:                     <span class="c"># If one probability = 0, the log sum will be -Inf</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0851</span>:                     <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">p_outlier</span><span class="p">)</span> <span class="o">+</span> <span class="n">wp_outlier</span></pre>
<pre class='cython code score-0 '>          __pyx_v_p = ((__pyx_v_p * (1.0 - __pyx_v_p_outlier)) + __pyx_v_wp_outlier);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0852</span>:                     <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          __pyx_t_35 = ((__pyx_v_p == 0.0) != 0);
          if (__pyx_t_35) {
/* … */
          }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0853</span>:                         <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-12 '>            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
            <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 853, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 853, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
            __pyx_t_2 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 853, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_r = __pyx_t_2;
            __pyx_t_2 = 0;
            goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0854</span>:                     <span class="n">sum_logp</span> <span class="o">+=</span> <span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_v_sum_logp = (__pyx_v_sum_logp + log(__pyx_v_p));
</pre><pre class="cython line score-0">&#xA0;<span class="">0855</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0856</span>:                     <span class="c"># # # # 2nd stage</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0857</span>:                     <span class="k">if</span> <span class="n">two_stage</span> <span class="o">==</span> <span class="mf">1.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          __pyx_t_35 = ((__pyx_v_two_stage == 1.00) != 0);
          if (__pyx_t_35) {
/* … */
          }
</pre><pre class="cython line score-0">&#xA0;<span class="">0858</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0859</span>:                         <span class="c"># v_2_ =  v if v_2 = 100.00 else v_2</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0860</span>:                         <span class="k">if</span> <span class="n">v_2</span> <span class="o">==</span> <span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>            __pyx_t_35 = ((__pyx_v_v_2 == 100.00) != 0);
            if (__pyx_t_35) {
/* … */
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0861</span>:                             <span class="n">v_2</span> <span class="o">=</span> <span class="n">v</span></pre>
<pre class='cython code score-0 '>              __pyx_v_v_2 = __pyx_v_v;
</pre><pre class="cython line score-0">&#xA0;<span class="">0862</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0863</span>: </pre>
<pre class="cython line score-34" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0864</span>:                         <span class="n">qs</span> <span class="o">=</span> <span class="n">qs_mb</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],:]</span></pre>
<pre class='cython code score-34 '>            __pyx_t_36 = __pyx_v_i;
            __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_36, __pyx_pybuffernd_s2s.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 864, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 864, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_slice_);
            __pyx_t_2 = 0;
            __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_qs_mb), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 864, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 864, __pyx_L1_error)</span>
            __pyx_t_6 = ((PyArrayObject *)__pyx_t_2);
            {
              __Pyx_BufFmt_StackElem __pyx_stack[1];
              <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer);
              __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
              if (unlikely(__pyx_t_15 &lt; 0)) {
                <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_23, &amp;__pyx_t_24, &amp;__pyx_t_25);
                if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_qs, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                  Py_XDECREF(__pyx_t_23); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25);
                  <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
                } else {
                  <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_23, __pyx_t_24, __pyx_t_25);
                }
                __pyx_t_23 = __pyx_t_24 = __pyx_t_25 = 0;
              }
              __pyx_pybuffernd_qs.diminfo[0].strides = __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_qs.diminfo[0].shape = __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.shape[0];
              if (unlikely(__pyx_t_15 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 864, __pyx_L1_error)</span>
            }
            __pyx_t_6 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_qs, ((PyArrayObject *)__pyx_t_2));
            __pyx_t_2 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0865</span>:                         <span class="n">drift</span> <span class="o">=</span> <span class="p">(</span><span class="n">qs</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">v_2</span></pre>
<pre class='cython code score-0 '>            __pyx_t_36 = 1;
            __pyx_t_21 = 0;
            __pyx_v_drift = (((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_36, __pyx_pybuffernd_qs.diminfo[0].strides)) - (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_qs.diminfo[0].strides))) * __pyx_v_v_2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0866</span>:                         <span class="k">if</span> <span class="n">drift</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>            __pyx_t_35 = ((__pyx_v_drift == 0.0) != 0);
            if (__pyx_t_35) {
/* … */
              goto __pyx_L22;
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0867</span>:                             <span class="n">p</span> <span class="o">=</span> <span class="mf">0.5</span></pre>
<pre class='cython code score-0 '>              __pyx_v_p = 0.5;
</pre><pre class="cython line score-0">&#xA0;<span class="">0868</span>:                         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0869</span>:                             <span class="k">if</span> <span class="n">responses2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>            /*else*/ {
              __pyx_t_21 = __pyx_v_i;
              __pyx_t_35 = (((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_responses2.diminfo[0].strides)) == 1) != 0);
              if (__pyx_t_35) {
/* … */
                goto __pyx_L23;
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0870</span>:                                 <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">z_2</span> <span class="o">*</span> <span class="n">drift</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span> <span class="o">/</span> \</pre>
<pre class='cython code score-0 '>                __pyx_v_p = ((pow(2.718281828459, ((-2.0 * __pyx_v_z_2) * __pyx_v_drift)) - 1.0) / (pow(2.718281828459, (-2.0 * __pyx_v_drift)) - 1.0));
</pre><pre class="cython line score-0">&#xA0;<span class="">0871</span>:                                     <span class="p">(</span><span class="mf">2.718281828459</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">drift</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0872</span>:                             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0873</span>:                                 <span class="n">p</span> <span class="o">=</span> <span class="mf">1</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2.718281828459</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">z_2</span> <span class="o">*</span> <span class="n">drift</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span> <span class="o">/</span> \</pre>
<pre class='cython code score-0 '>              /*else*/ {
/* … */
                __pyx_v_p = (1.0 - ((pow(2.718281828459, ((-2.0 * __pyx_v_z_2) * __pyx_v_drift)) - 1.0) / (pow(2.718281828459, (-2.0 * __pyx_v_drift)) - 1.0)));
              }
              __pyx_L23:;
            }
            __pyx_L22:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0874</span>:                                     <span class="p">(</span><span class="mf">2.718281828459</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">drift</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0875</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0876</span>:                         <span class="c"># If one probability = 0, the log sum will be -Inf</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0877</span>:                         <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">p_outlier</span><span class="p">)</span> <span class="o">+</span> <span class="n">wp_outlier</span></pre>
<pre class='cython code score-0 '>            __pyx_v_p = ((__pyx_v_p * (1.0 - __pyx_v_p_outlier)) + __pyx_v_wp_outlier);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0878</span>:                         <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>            __pyx_t_35 = ((__pyx_v_p == 0.0) != 0);
            if (__pyx_t_35) {
/* … */
            }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0879</span>:                             <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-12 '>              <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
              <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 879, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
              __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 879, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
              __pyx_t_2 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 879, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
              __pyx_r = __pyx_t_2;
              __pyx_t_2 = 0;
              goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0880</span>:                         <span class="n">sum_logp</span> <span class="o">+=</span> <span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            __pyx_v_sum_logp = (__pyx_v_sum_logp + log(__pyx_v_p));
</pre><pre class="cython line score-0">&#xA0;<span class="">0881</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0882</span>:                 <span class="c"># update Q values, regardless of pdf</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0883</span>:                 <span class="n">dtQ1</span> <span class="o">=</span> <span class="n">qs_mb</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">responses2</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">-</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="c"># delta stage 1</span></pre>
<pre class='cython code score-0 '>        __pyx_t_21 = __pyx_v_i;
        __pyx_t_36 = __pyx_v_i;
        __pyx_t_40 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_s2s.diminfo[0].strides));
        __pyx_t_41 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.buf, __pyx_t_36, __pyx_pybuffernd_responses2.diminfo[0].strides));
        __pyx_t_42 = __pyx_v_i;
        __pyx_t_43 = __pyx_v_i;
        __pyx_t_44 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_s1s.diminfo[0].strides));
        __pyx_t_45 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_responses1.diminfo[0].strides));
        __pyx_v_dtQ1 = ((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_40, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_41, __pyx_pybuffernd_qs_mb.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_45, __pyx_pybuffernd_qs_mf.diminfo[1].strides)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0884</span>:                 <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">alfa</span> <span class="o">*</span> <span class="n">dtQ1</span> <span class="c"># delta update for qmf</span></pre>
<pre class='cython code score-0 '>        __pyx_t_43 = __pyx_v_i;
        __pyx_t_42 = __pyx_v_i;
        __pyx_t_45 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_s1s.diminfo[0].strides));
        __pyx_t_44 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_responses1.diminfo[0].strides));
        __pyx_t_36 = __pyx_v_i;
        __pyx_t_21 = __pyx_v_i;
        __pyx_t_41 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_36, __pyx_pybuffernd_s1s.diminfo[0].strides));
        __pyx_t_40 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_responses1.diminfo[0].strides));
        *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_41, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_40, __pyx_pybuffernd_qs_mf.diminfo[1].strides) = ((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_45, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_44, __pyx_pybuffernd_qs_mf.diminfo[1].strides)) + (__pyx_v_alfa * __pyx_v_dtQ1));
</pre><pre class="cython line score-0">&#xA0;<span class="">0885</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0886</span>:                 <span class="n">dtQ2</span> <span class="o">=</span> <span class="n">feedbacks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs_mb</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">responses2</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="c"># delta stage 2</span></pre>
<pre class='cython code score-0 '>        __pyx_t_42 = __pyx_v_i;
        __pyx_t_43 = __pyx_v_i;
        __pyx_t_44 = __pyx_v_i;
        __pyx_t_45 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_s2s.diminfo[0].strides));
        __pyx_t_21 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_responses2.diminfo[0].strides));
        __pyx_v_dtQ2 = ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_feedbacks.diminfo[0].strides)) - (*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_45, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_qs_mb.diminfo[1].strides)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0887</span>:                 <span class="n">qs_mb</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses2</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">qs_mb</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">responses2</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">alfa2</span> <span class="o">*</span> <span class="n">dtQ2</span> <span class="c"># delta update for qmb</span></pre>
<pre class='cython code score-0 '>        __pyx_t_44 = __pyx_v_i;
        __pyx_t_43 = __pyx_v_i;
        __pyx_t_21 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_s2s.diminfo[0].strides));
        __pyx_t_45 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_responses2.diminfo[0].strides));
        __pyx_t_42 = __pyx_v_i;
        __pyx_t_36 = __pyx_v_i;
        __pyx_t_40 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_s2s.diminfo[0].strides));
        __pyx_t_41 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.buf, __pyx_t_36, __pyx_pybuffernd_responses2.diminfo[0].strides));
        *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_40, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_41, __pyx_pybuffernd_qs_mb.diminfo[1].strides) = ((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_45, __pyx_pybuffernd_qs_mb.diminfo[1].strides)) + (__pyx_v_alfa2 * __pyx_v_dtQ2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0888</span>:                 <span class="k">if</span> <span class="n">lambda_</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span> <span class="c"># if using eligibility trace</span></pre>
<pre class='cython code score-0 '>        __pyx_t_35 = ((__pyx_v_lambda_ != 100.00) != 0);
        if (__pyx_t_35) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0889</span>:                     <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">lambda__</span> <span class="o">*</span> <span class="n">dtQ2</span> <span class="c"># eligibility trace</span></pre>
<pre class='cython code score-0 '>          __pyx_t_43 = __pyx_v_i;
          __pyx_t_44 = __pyx_v_i;
          __pyx_t_45 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_s1s.diminfo[0].strides));
          __pyx_t_21 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_responses1.diminfo[0].strides));
          __pyx_t_36 = __pyx_v_i;
          __pyx_t_42 = __pyx_v_i;
          __pyx_t_41 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_36, __pyx_pybuffernd_s1s.diminfo[0].strides));
          __pyx_t_40 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_responses1.diminfo[0].strides));
          *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_41, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_40, __pyx_pybuffernd_qs_mf.diminfo[1].strides) = ((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_45, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_qs_mf.diminfo[1].strides)) + (__pyx_v_lambda__ * __pyx_v_dtQ2));
</pre><pre class="cython line score-0">&#xA0;<span class="">0890</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0891</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0892</span>:                 <span class="c"># memory decay for unexperienced options in this trial</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0893</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0894</span>:                 <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstates</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>        __pyx_t_15 = __pyx_v_nstates;
        __pyx_t_46 = __pyx_t_15;
        for (__pyx_t_37 = 0; __pyx_t_37 &lt; __pyx_t_46; __pyx_t_37+=1) {
          __pyx_v_s_ = __pyx_t_37;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0895</span>:                     <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">2</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>          for (__pyx_t_47 = 0; __pyx_t_47 &lt; 2; __pyx_t_47+=1) {
            __pyx_v_a_ = __pyx_t_47;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0896</span>:                         <span class="k">if</span> <span class="p">(</span><span class="n">s_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">a_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">responses2</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>            __pyx_t_44 = __pyx_v_i;
            __pyx_t_17 = ((__pyx_v_s_ != (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_s2s.diminfo[0].strides))) != 0);
            if (!__pyx_t_17) {
            } else {
              __pyx_t_35 = __pyx_t_17;
              goto __pyx_L31_bool_binop_done;
            }
            __pyx_t_44 = __pyx_v_i;
            __pyx_t_17 = ((__pyx_v_a_ != (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_responses2.diminfo[0].strides))) != 0);
            __pyx_t_35 = __pyx_t_17;
            __pyx_L31_bool_binop_done:;
            if (__pyx_t_35) {
/* … */
            }
          }
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">0897</span>:                             <span class="c"># qs_mb[s_, a_] = qs_mb[s_, a_] * (1-gamma)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0898</span>:                             <span class="n">qs_mb</span><span class="p">[</span><span class="n">s_</span><span class="p">,</span><span class="n">a_</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">gamma__</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>              __pyx_t_44 = __pyx_v_s_;
              __pyx_t_43 = __pyx_v_a_;
              *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_43, __pyx_pybuffernd_qs_mb.diminfo[1].strides) *= (1.0 - __pyx_v_gamma__);
</pre><pre class="cython line score-0">&#xA0;<span class="">0899</span>: </pre>
<pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0900</span>:                 <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">comb</span><span class="p">(</span><span class="n">nstates</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="n">exact</span><span class="o">=</span><span class="bp">True</span><span class="p">)):</span></pre>
<pre class='cython code score-32 '>        <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_comb);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 900, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 900, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 900, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_int_2);
        __pyx_t_5 = 0;
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 900, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_exact, Py_True) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 900, __pyx_L1_error)</span>
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_1, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 900, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_37 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_7); if (unlikely((__pyx_t_37 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 900, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_47 = __pyx_t_37;
        for (__pyx_t_48 = 0; __pyx_t_48 &lt; __pyx_t_47; __pyx_t_48+=1) {
          __pyx_v_s_ = __pyx_t_48;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0901</span>:                     <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">2</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>          for (__pyx_t_49 = 0; __pyx_t_49 &lt; 2; __pyx_t_49+=1) {
            __pyx_v_a_ = __pyx_t_49;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0902</span>:                         <span class="k">if</span> <span class="p">(</span><span class="n">s_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">a_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>            __pyx_t_43 = __pyx_v_i;
            __pyx_t_17 = ((__pyx_v_s_ != (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_s1s.diminfo[0].strides))) != 0);
            if (!__pyx_t_17) {
            } else {
              __pyx_t_35 = __pyx_t_17;
              goto __pyx_L38_bool_binop_done;
            }
            __pyx_t_43 = __pyx_v_i;
            __pyx_t_17 = ((__pyx_v_a_ != (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_responses1.diminfo[0].strides))) != 0);
            __pyx_t_35 = __pyx_t_17;
            __pyx_L38_bool_binop_done:;
            if (__pyx_t_35) {
/* … */
            }
          }
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0903</span>:                             <span class="n">qs_mf</span><span class="p">[</span><span class="n">s_</span><span class="p">,</span><span class="n">a_</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">gamma_</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>              __pyx_t_43 = __pyx_v_s_;
              __pyx_t_44 = __pyx_v_a_;
              *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_44, __pyx_pybuffernd_qs_mf.diminfo[1].strides) *= (1.0 - __pyx_v_gamma_);
</pre><pre class="cython line score-0">&#xA0;<span class="">0904</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0905</span>:                 <span class="n">counter</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>        __pyx_t_44 = __pyx_v_i;
        __pyx_t_43 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_s1s.diminfo[0].strides));
        *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_counter.diminfo[0].strides) += 1.0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0906</span>:     <span class="k">return</span> <span class="n">sum_logp</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_sum_logp);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 906, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_r = __pyx_t_7;
  __pyx_t_7 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0907</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0908</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0909</span>: <span class="c"># # COMMENT OUT FOR NOW</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0910</span>: <span class="c"># # JY added on 2022-04-14 for incorporating bayesian Q learning into RLDDM</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0911</span>: <span class="c"># def wiener_like_rlddm_bayesianQ(np.ndarray[double, ndim=1] x1, # 1st-stage RT</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0912</span>: <span class="c">#                       np.ndarray[double, ndim=1] x2, # 2nd-stage RT</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0913</span>: <span class="c">#                       # np.ndarray[long, ndim=1] isleft1, # whether left response 1st-stage,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0914</span>: <span class="c">#                       # np.ndarray[long, ndim=1] isleft2, # whether left response 2nd-stage</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0915</span>: <span class="c">#                       np.ndarray[long,ndim=1] s1, # 1st-stage state</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0916</span>: <span class="c">#                       np.ndarray[long,ndim=1] s2, # 2nd-stage state</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0917</span>: <span class="c">#                       np.ndarray[long, ndim=1] response1,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0918</span>: <span class="c">#                       np.ndarray[long, ndim=1] response2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0919</span>: <span class="c">#                       np.ndarray[double, ndim=1] feedback,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0920</span>: <span class="c">#                       np.ndarray[long, ndim=1] split_by,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0921</span>: <span class="c">#                       double q, double alpha, double pos_alpha,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0922</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0923</span>: <span class="c">#                       # double w,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0924</span>: <span class="c">#                       double gamma, double gamma2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0925</span>: <span class="c">#                       double lambda_,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0926</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0927</span>: <span class="c">#                       double v0, double v1, double v2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0928</span>: <span class="c">#                       double v, # don&#39;t use second stage</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0929</span>: <span class="c">#                       # double sv,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0930</span>: <span class="c">#                       double a,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0931</span>: <span class="c">#                       double z0, double z1, double z2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0932</span>: <span class="c">#                       double z,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0933</span>: <span class="c">#                       # double sz,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0934</span>: <span class="c">#                       double t,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0935</span>: <span class="c">#                       int nstates,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0936</span>: <span class="c">#                       # double v_qval, double z_qval,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0937</span>: <span class="c">#                       double v_interaction, double z_interaction,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0938</span>: <span class="c">#                       double two_stage,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0939</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0940</span>: <span class="c">#                       double a_2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0941</span>: <span class="c">#                       double z_2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0942</span>: <span class="c">#                       double t_2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0943</span>: <span class="c">#                       double v_2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0944</span>: <span class="c">#                       double alpha2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0945</span>: <span class="c">#                       double w, double w2, double z_scaler,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0946</span>: <span class="c">#                       double z_sigma, double z_sigma2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0947</span>: <span class="c">#                       double window_start, double window_size,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0948</span>: <span class="c">#                       double beta_ndt, double beta_ndt2, double beta_ndt3,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0949</span>: <span class="c">#                       # double st,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0950</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0951</span>: <span class="c">#                       double err, int n_st=10, int n_sz=10, bint use_adaptive=1, double simps_err=1e-8,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0952</span>: <span class="c">#                       double p_outlier=0, double w_outlier=0,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0953</span>: <span class="c">#                       ):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0954</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0955</span>: <span class="c">#     # cdef double a = 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0956</span>: <span class="c">#     cdef double sz = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0957</span>: <span class="c">#     cdef double st = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0958</span>: <span class="c">#     cdef double sv = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0959</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0960</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0961</span>: <span class="c">#     cdef Py_ssize_t size = x1.shape[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0962</span>: <span class="c">#     cdef Py_ssize_t i, j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0963</span>: <span class="c">#     cdef Py_ssize_t s_size</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0964</span>: <span class="c">#     cdef int s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0965</span>: <span class="c">#     cdef double p</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0966</span>: <span class="c">#     cdef double sum_logp = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0967</span>: <span class="c">#     cdef double wp_outlier = w_outlier * p_outlier</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0968</span>: <span class="c">#     cdef double alfa</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0969</span>: <span class="c">#     cdef double pos_alfa</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0970</span>: <span class="c">#     cdef double alfa2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0971</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0972</span>: <span class="c">#     cdef double gamma_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0973</span>: <span class="c">#     cdef double gamma__</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0974</span>: <span class="c">#     cdef double lambda__</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0975</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0976</span>: <span class="c">#     # cdef np.ndarray[double, ndim=1] qs = np.array([q, q])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0977</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0978</span>: <span class="c">#     # cdef np.ndarray[double, ndim=2] qs_mf = np.ones((comb(nstates,2,exact=True),2))*q # first-stage MF Q-values</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0979</span>: <span class="c">#     # cdef np.ndarray[double, ndim=2] qs_mb = np.ones((nstates, 2))*q # second-stage Q-values</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0980</span>: <span class="c">#     #</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0981</span>: <span class="c">#     # cdef np.ndarray[double, ndim=2] qs_mf_mu = np.ones((comb(nstates,2,exact=True),2))*q # first-stage MF Q-values</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0982</span>: <span class="c">#     # cdef np.ndarray[double, ndim=2] qs_mb_mu = np.ones((nstates, 2))*q # second-stage Q-values</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0983</span>: <span class="c">#     #</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0984</span>: <span class="c">#     # cdef np.ndarray[double, ndim=2] qs_mf_sd = np.ones((comb(nstates,2,exact=True),2))*q # first-stage MF Q-values</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0985</span>: <span class="c">#     # cdef np.ndarray[double, ndim=2] qs_mb_sd = np.ones((nstates, 2))*q # second-stage Q-values</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0986</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0987</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0988</span>: <span class="c">#     cdef np.ndarray[double, ndim=2] ndt_counter_set = np.ones((comb(nstates,2,exact=True),1)) # first-stage MF Q-values</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0989</span>: <span class="c">#     cdef np.ndarray[double, ndim=2] ndt_counter_ind = np.ones((nstates, 1)) # first-stage MF Q-values</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0990</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0991</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0992</span>: <span class="c">#     cdef double dtQ1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0993</span>: <span class="c">#     cdef double dtQ2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0994</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0995</span>: <span class="c">#     cdef double dtq_mb</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0996</span>: <span class="c">#     cdef double dtq_mf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0997</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0998</span>: <span class="c">#     cdef long s_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0999</span>: <span class="c">#     cdef long a_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1000</span>: <span class="c">#     cdef double v_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1001</span>: <span class="c">#     cdef double z_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1002</span>: <span class="c">#     cdef double t_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1003</span>: <span class="c">#     cdef double sig</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1004</span>: <span class="c">#     cdef double v_2_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1005</span>: <span class="c">#     cdef double z_2_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1006</span>: <span class="c">#     cdef double a_2_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1007</span>: <span class="c">#     cdef double t_2_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1008</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1009</span>: <span class="c">#     cdef double t1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1010</span>: <span class="c">#     cdef double t2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1011</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1012</span>: <span class="c">#     cdef np.ndarray[double, ndim=1] x1s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1013</span>: <span class="c">#     cdef np.ndarray[double, ndim=1] x2s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1014</span>: <span class="c">#     cdef np.ndarray[double, ndim=1] feedbacks</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1015</span>: <span class="c">#     cdef np.ndarray[long, ndim=1] responses1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1016</span>: <span class="c">#     cdef np.ndarray[long, ndim=1] responses2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1017</span>: <span class="c">#     cdef np.ndarray[long, ndim=1] unique = np.unique(split_by)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1018</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1019</span>: <span class="c">#     cdef np.ndarray[long, ndim=1] s1s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1020</span>: <span class="c">#     cdef np.ndarray[long, ndim=1] s2s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1021</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1022</span>: <span class="c">#     cdef np.ndarray[long, ndim=1] planets</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1023</span>: <span class="c">#     cdef np.ndarray[double, ndim=1] counter = np.zeros(comb(nstates,2,exact=True))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1024</span>: <span class="c">#     cdef np.ndarray[double, ndim=1] Qmb</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1025</span>: <span class="c">#     cdef double dtq</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1026</span>: <span class="c">#     cdef double rt</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1027</span>: <span class="c">#     cdef np.ndarray[double, ndim=2] Tm = np.array([[0.7, 0.3], [0.3, 0.7]]) # transition matrix</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1028</span>: <span class="c">#     cdef np.ndarray[long, ndim=2] state_combinations = np.array(list(itertools.combinations(np.arange(nstates),2)))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1029</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1030</span>: <span class="c">#     if not p_outlier_in_range(p_outlier):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1031</span>: <span class="c">#         return -np.inf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1032</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1033</span>: <span class="c">#     if pos_alpha==100.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1034</span>: <span class="c">#         pos_alfa = alpha</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1035</span>: <span class="c">#     else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1036</span>: <span class="c">#         pos_alfa = pos_alpha</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1037</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1038</span>: <span class="c">#     # unique represent # of conditions</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1039</span>: <span class="c">#     for j in range(unique.shape[0]):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1040</span>: <span class="c">#         s = unique[j]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1041</span>: <span class="c">#         # select trials for current condition, identified by the split_by-array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1042</span>: <span class="c">#         feedbacks = feedback[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1043</span>: <span class="c">#         responses1 = response1[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1044</span>: <span class="c">#         responses2 = response2[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1045</span>: <span class="c">#         x1s = x1[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1046</span>: <span class="c">#         x2s = x2[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1047</span>: <span class="c">#         s1s = s1[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1048</span>: <span class="c">#         s2s = s2[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1049</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1050</span>: <span class="c">#         s_size = x1s.shape[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1051</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1052</span>: <span class="c">#         # qs_mf[:,0] = q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1053</span>: <span class="c">#         # qs_mf[:,1] = q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1054</span>: <span class="c">#         #</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1055</span>: <span class="c">#         # qs_mb[:,0] = q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1056</span>: <span class="c">#         # qs_mb[:,1] = q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1057</span>: <span class="c">#         #</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1058</span>: <span class="c">#         # qs_mf_mu[:,0] = q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1059</span>: <span class="c">#         # qs_mf_mu[:,1] = q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1060</span>: <span class="c">#         #</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1061</span>: <span class="c">#         # qs_mb_mu[:,0] = q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1062</span>: <span class="c">#         # qs_mb_mu[:,1] = q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1063</span>: <span class="c">#         #</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1064</span>: <span class="c">#         # qs_mf_sd[:,0] = q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1065</span>: <span class="c">#         # qs_mf_sd[:,1] = q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1066</span>: <span class="c">#         #</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1067</span>: <span class="c">#         # qs_mb_sd[:,0] = q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1068</span>: <span class="c">#         # qs_mb_sd[:,1] = q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1069</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1070</span>: <span class="c">#         alfa = (2.718281828459**alpha) / (1 + 2.718281828459**alpha)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1071</span>: <span class="c">#         gamma_ = (2.718281828459**gamma) / (1 + 2.718281828459**gamma)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1072</span>: <span class="c">#         if gamma2 != 100.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1073</span>: <span class="c">#             gamma__ = (2.718281828459**gamma2) / (1 + 2.718281828459**gamma2)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1074</span>: <span class="c">#         else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1075</span>: <span class="c">#             gamma__ = gamma_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1076</span>: <span class="c">#         if alpha2 != 100.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1077</span>: <span class="c">#             alfa2 = (2.718281828459**alpha2) / (1 + 2.718281828459**alpha2)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1078</span>: <span class="c">#         else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1079</span>: <span class="c">#             alfa2 = alfa</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1080</span>: <span class="c">#         if lambda_ != 100.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1081</span>: <span class="c">#             lambda__ = (2.718281828459**lambda_) / (1 + 2.718281828459**lambda_)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1082</span>: <span class="c">#         if w != 100.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1083</span>: <span class="c">#             w = (2.718281828459**w) / (1 + 2.718281828459**w)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1084</span>: <span class="c">#         if w2 != 100.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1085</span>: <span class="c">#             w2 = (2.718281828459**w2) / (1 + 2.718281828459**w2)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1086</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1087</span>: <span class="c">#         # if beta_ndt != 100.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1088</span>: <span class="c">#         #     beta_ndt = (2.718281828459**beta_ndt) / (1 + 2.718281828459**beta_ndt)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1089</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1090</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1091</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1092</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1093</span>: <span class="c">#         # don&#39;t calculate pdf for first trial but still update q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1094</span>: <span class="c">#         # if feedbacks[0] &gt; qs[responses[0]]:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1095</span>: <span class="c">#             # alfa = (2.718281828459**pos_alfa) / (1 + 2.718281828459**pos_alfa)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1096</span>: <span class="c">#         # else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1097</span>: <span class="c">#             # alfa = (2.718281828459**alpha) / (1 + 2.718281828459**alpha)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1098</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1099</span>: <span class="c">#         # # qs[1] is upper bound, qs[0] is lower bound. feedbacks is reward</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1100</span>: <span class="c">#         # # received on current trial.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1101</span>: <span class="c">#         # qs[responses[0]] = qs[responses[0]] + \</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1102</span>: <span class="c">#         #     alfa * (feedbacks[0] - qs[responses[0]])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1103</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1104</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1105</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1106</span>: <span class="c">#         agent = BayesianQ_Agent(nstates,2)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1107</span>: <span class="c">#         # def act(self, stage, state, Tm = np.array([[0.7, 0.3], [0.3, 0.7]]), use_explo=True):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1108</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1109</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1110</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1111</span>: <span class="c">#         # loop through all trials in current condition</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1112</span>: <span class="c">#         # print(window_size, window_start)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1113</span>: <span class="c">#         for i in range(0, s_size):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1114</span>: <span class="c">#             if window_start &lt;= i &lt; window_start + window_size:  # and (window_start &lt;= i &lt; window_start+window_size):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1115</span>: <span class="c">#                 if counter[s1s[i]] &gt; 0 and x1s[i]&gt;0.15:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1116</span>: <span class="c">#                 # proceed with pdf only if 1) the current 1st-stage state have been updated and 2) &quot;plausible&quot; RT (150 ms)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1117</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1118</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1119</span>: <span class="c">#                     # 1st stage</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1120</span>: <span class="c">#                     planets = state_combinations[s1s[i]]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1121</span>: <span class="c">#                     Qmb = agent.act(1, planets)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1122</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1123</span>: <span class="c">#                     dtq_mb = Qmb[1] - Qmb[0] # 1 is upper, 0 is lower</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1124</span>: <span class="c">#                     # dtq_mf = qs_mf[s1s[i],1] - qs_mf[s1s[i],0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1125</span>: <span class="c">#                     if v == 100.00: # if v_reg</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1126</span>: <span class="c">#                         # v_ = v0 + (dtq_mb * v1) + (dtq_mf * v2) + (v_interaction * dtq_mb * dtq_mf)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1127</span>: <span class="c">#                         v_ = dtq_mb * v1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1128</span>: <span class="c">#                     # else: # if don&#39;t use v_reg:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1129</span>: <span class="c">#                     #     # if v_qval == 0: # use both qmb and qmf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1130</span>: <span class="c">#                     #     qs = w * Qmb + (1-w) * qs_mf[s1s[i],:] # Update for 1st trial</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1131</span>: <span class="c">#                     #     dtq = qs[1] - qs[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1132</span>: <span class="c">#                     #     v_ = dtq * v</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1133</span>: <span class="c">#                     # if z == 0.5: # if use z_reg:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1134</span>: <span class="c">#                     if w2 == 100.00: # if use z_reg</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1135</span>: <span class="c">#                         # Transform regression parameters so that &gt;0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1136</span>: <span class="c">#                         # z_ = z0 + (dtq_mb * z1) + (dtq_mf * z2) + (z_interaction * dtq_mb * dtq_mf)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1137</span>: <span class="c">#                         z_ = dtq_mb * z1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1138</span>: <span class="c">#                         sig = 1/(1+np.exp(-z_))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1139</span>: <span class="c">#                     # else: # if don&#39;t use z_reg:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1140</span>: <span class="c">#                     #     qs = w2 * Qmb + (1-w2) * qs_mf[s1s[i],:] # Update for 1st trial</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1141</span>: <span class="c">#                     #     dtq = qs[1] - qs[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1142</span>: <span class="c">#                     #     z_ = dtq * z_scaler</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1143</span>: <span class="c">#                     #     sig = 1 / (1 + np.exp(-z_))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1144</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1145</span>: <span class="c">#                     rt = x1s[i]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1146</span>: <span class="c">#                     # think about how uncertainty could be correlated with ndt</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1147</span>: <span class="c">#                     # 1. ndt &lt;- negatively correlated with experience</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1148</span>: <span class="c">#                     # 2. ndt &lt;- positively correlated with uncertainty</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1149</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1150</span>: <span class="c">#                     t1 = ((np.log(ndt_counter_ind[planets[0],0]) + np.log(ndt_counter_ind[planets[1],0]))/2)*beta_ndt + np.log(ndt_counter_set[s1s[i],0])*beta_ndt2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1151</span>: <span class="c">#                     t2 = agent.uncertainty(planets[0]) + agent.uncertainty(planets[1])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1152</span>: <span class="c">#                     t_  = t1 + t2*beta_ndt3 + t</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1153</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1154</span>: <span class="c">#                     p = full_pdf(rt, v_, sv, a, sig * a,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1155</span>: <span class="c">#                                  sz, t_, st, err, n_st, n_sz, use_adaptive, simps_err)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1156</span>: <span class="c">#                     # If one probability = 0, the log sum will be -Inf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1157</span>: <span class="c">#                     p = p * (1 - p_outlier) + wp_outlier</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1158</span>: <span class="c">#                     if p == 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1159</span>: <span class="c">#                         return -np.inf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1160</span>: <span class="c">#                     sum_logp += log(p)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1161</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1162</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1163</span>: <span class="c">#                     # # # 2nd stage</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1164</span>: <span class="c">#                     if two_stage == 1.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1165</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1166</span>: <span class="c">#                         v_2_ = v if v_2==100.00 else v_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1167</span>: <span class="c">#                         a_2_ = a if a_2 == 100.00 else a_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1168</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1169</span>: <span class="c">#                         # CONFIGURE Z_2 USING Z_SIGMA AND V HERE!!!</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1170</span>: <span class="c">#                         if z_sigma ==100.00: # if don&#39;t use 1st-stage dependent drift rate</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1171</span>: <span class="c">#                             # z_2_ = z if z_2 == 0.5 else z_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1172</span>: <span class="c">#                             z_2_ = z_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1173</span>: <span class="c">#                         else: # if use 1st-stage dependent dr</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1174</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1175</span>: <span class="c">#                             if z_sigma2 == 100.00: # don&#39;t use baseline</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1176</span>: <span class="c">#                                 z_2_ = 1 / (1 + np.exp(-v_*z_sigma))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1177</span>: <span class="c">#                             else: # use baseline</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1178</span>: <span class="c">#                                 z_2_ = 1 / (1 + np.exp(-(v_ * z_sigma + z_sigma2)))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1179</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1180</span>: <span class="c">#                         t_2_ = t if t_2 == 100.00 else t_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1181</span>: <span class="c">#                         # def act(self, stage, state, Tm = np.array([[0.7, 0.3], [0.3, 0.7]]), use_explo=True):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1182</span>: <span class="c">#                         qs = agent.act(2, s2s[i])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1183</span>: <span class="c">#                         # qs = qs_mb[s2s[i],:]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1184</span>: <span class="c">#                         dtq = qs[1] - qs[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1185</span>: <span class="c">#                         rt = x2s[i]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1186</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1187</span>: <span class="c">#                         p = full_pdf(rt, (dtq * v_2_), sv, a_2_, z_2_, sz, t_2_, st, err, n_st, n_sz, use_adaptive, simps_err)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1188</span>: <span class="c">#                         # If one probability = 0, the log sum will be -Inf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1189</span>: <span class="c">#                         p = p * (1 - p_outlier) + wp_outlier</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1190</span>: <span class="c">#                         if p == 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1191</span>: <span class="c">#                             return -np.inf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1192</span>: <span class="c">#                         sum_logp += log(p)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1193</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1194</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1195</span>: <span class="c">#             # update Q values, regardless of pdf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1196</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1197</span>: <span class="c">#             ndt_counter_set[s1s[i],0] += 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1198</span>: <span class="c">#             ndt_counter_ind[s2s[i],0] += 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1199</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1200</span>: <span class="c">#             # def update(self, state, action, reward):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1201</span>: <span class="c">#             agent.update(s2s[i], responses2[i], feedbacks[i])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1202</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1203</span>: <span class="c">#             # memory decay for unexperienced options in this trial</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1204</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1205</span>: <span class="c">#             for s_ in range(nstates):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1206</span>: <span class="c">#                 for a_ in range(2):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1207</span>: <span class="c">#                     if (s_ is not s2s[i]) or (a_ is not responses2[i]):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1208</span>: <span class="c">#                         # qs_mb[s_, a_] = qs_mb[s_, a_] * (1-gamma)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1209</span>: <span class="c">#                         # qs_mb[s_,a_] *= (1-gamma_)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1210</span>: <span class="c">#                         agent.forget(gamma_, s_, a_)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1211</span>: <span class="c">#             # for s_ in range(comb(nstates,2,exact=True)):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1212</span>: <span class="c">#             #     for a_ in range(2):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1213</span>: <span class="c">#             #         if (s_ is not s1s[i]) or (a_ is not responses1[i]):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1214</span>: <span class="c">#             #             qs_mf[s_,a_] *= (1-gamma_)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1215</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1216</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1217</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1218</span>: <span class="c">#             # agent.forget(gamma, state, action)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1219</span>: <span class="c">#             # # just update 1st-stage MF values if estimating</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1220</span>: <span class="c">#             # dtQ1 = qs_mb[s2s[i],responses2[i]] - qs_mf[s1s[i], responses1[i]] # delta stage 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1221</span>: <span class="c">#             # qs_mf[s1s[i], responses1[i]] = qs_mf[s1s[i], responses1[i]] + alfa * dtQ1 # delta update for qmf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1222</span>: <span class="c">#             #</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1223</span>: <span class="c">#             # dtQ2 = feedbacks[i] - qs_mb[s2s[i],responses2[i]] # delta stage 2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1224</span>: <span class="c">#             # qs_mb[s2s[i], responses2[i]] = qs_mb[s2s[i],responses2[i]] + alfa2 * dtQ2 # delta update for qmb</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1225</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1226</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1227</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1228</span>: <span class="c">#             counter[s1s[i]] += 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1229</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1230</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1231</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1232</span>: <span class="c">#     return sum_logp</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1233</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1234</span>: <span class="c"># JY added on 2022-10-01 for modeling ndt as a function of uncertainty &amp; entropy</span></pre>
<pre class="cython line score-896" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1235</span>: <span class="k">def</span> <span class="nf">wiener_like_rlddm_uncertainty</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x1</span><span class="p">,</span> <span class="c"># 1st-stage RT</span></pre>
<pre class='cython code score-896 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_15wiener_like_rlddm_uncertainty(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_14wiener_like_rlddm_uncertainty[] = "wiener_like_rlddm_uncertainty(ndarray x1, ndarray x2, ndarray s1, ndarray s2, ndarray response1, ndarray response2, ndarray feedback, ndarray split_by, double q, double alpha, double pos_alpha, double gamma, double gamma2, double lambda_, double v0, double v1, double v2, double v, double a, double z0, double z1, double z2, double z, double t, int nstates, double v_interaction, double z_interaction, double two_stage, double a_2, double z_2, double t_2, double v_2, double alpha2, double w, double w2, double z_scaler, double z_sigma, double z_sigma2, double window_start, double window_size, double beta_ndt, double beta_ndt2, double beta_ndt3, double err, int n_st=10, int n_sz=10, bool use_adaptive=1, double simps_err=1e-8, double p_outlier=0, double w_outlier=0)";
static PyMethodDef __pyx_mdef_4wfpt_15wiener_like_rlddm_uncertainty = {"wiener_like_rlddm_uncertainty", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_15wiener_like_rlddm_uncertainty, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_14wiener_like_rlddm_uncertainty};
static PyObject *__pyx_pw_4wfpt_15wiener_like_rlddm_uncertainty(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_x1 = 0;
  PyArrayObject *__pyx_v_x2 = 0;
  PyArrayObject *__pyx_v_s1 = 0;
  PyArrayObject *__pyx_v_s2 = 0;
  PyArrayObject *__pyx_v_response1 = 0;
  PyArrayObject *__pyx_v_response2 = 0;
  PyArrayObject *__pyx_v_feedback = 0;
  PyArrayObject *__pyx_v_split_by = 0;
  double __pyx_v_q;
  double __pyx_v_alpha;
  double __pyx_v_pos_alpha;
  double __pyx_v_gamma;
  double __pyx_v_gamma2;
  double __pyx_v_lambda_;
  double __pyx_v_v0;
  double __pyx_v_v1;
  double __pyx_v_v2;
  double __pyx_v_v;
  double __pyx_v_a;
  double __pyx_v_z0;
  double __pyx_v_z1;
  double __pyx_v_z2;
  CYTHON_UNUSED double __pyx_v_z;
  double __pyx_v_t;
  int __pyx_v_nstates;
  double __pyx_v_v_interaction;
  double __pyx_v_z_interaction;
  double __pyx_v_two_stage;
  double __pyx_v_a_2;
  double __pyx_v_z_2;
  double __pyx_v_t_2;
  double __pyx_v_v_2;
  double __pyx_v_alpha2;
  double __pyx_v_w;
  double __pyx_v_w2;
  double __pyx_v_z_scaler;
  double __pyx_v_z_sigma;
  double __pyx_v_z_sigma2;
  double __pyx_v_window_start;
  double __pyx_v_window_size;
  double __pyx_v_beta_ndt;
  double __pyx_v_beta_ndt2;
  double __pyx_v_beta_ndt3;
  double __pyx_v_err;
  int __pyx_v_n_st;
  int __pyx_v_n_sz;
  int __pyx_v_use_adaptive;
  double __pyx_v_simps_err;
  double __pyx_v_p_outlier;
  double __pyx_v_w_outlier;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_rlddm_uncertainty (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_x1,&amp;__pyx_n_s_x2,&amp;__pyx_n_s_s1,&amp;__pyx_n_s_s2,&amp;__pyx_n_s_response1,&amp;__pyx_n_s_response2,&amp;__pyx_n_s_feedback,&amp;__pyx_n_s_split_by,&amp;__pyx_n_s_q,&amp;__pyx_n_s_alpha,&amp;__pyx_n_s_pos_alpha,&amp;__pyx_n_s_gamma,&amp;__pyx_n_s_gamma2,&amp;__pyx_n_s_lambda,&amp;__pyx_n_s_v0,&amp;__pyx_n_s_v1,&amp;__pyx_n_s_v2,&amp;__pyx_n_s_v,&amp;__pyx_n_s_a,&amp;__pyx_n_s_z0,&amp;__pyx_n_s_z1,&amp;__pyx_n_s_z2,&amp;__pyx_n_s_z,&amp;__pyx_n_s_t,&amp;__pyx_n_s_nstates,&amp;__pyx_n_s_v_interaction,&amp;__pyx_n_s_z_interaction,&amp;__pyx_n_s_two_stage,&amp;__pyx_n_s_a_2,&amp;__pyx_n_s_z_2,&amp;__pyx_n_s_t_2,&amp;__pyx_n_s_v_2,&amp;__pyx_n_s_alpha2,&amp;__pyx_n_s_w,&amp;__pyx_n_s_w2,&amp;__pyx_n_s_z_scaler,&amp;__pyx_n_s_z_sigma,&amp;__pyx_n_s_z_sigma2,&amp;__pyx_n_s_window_start,&amp;__pyx_n_s_window_size,&amp;__pyx_n_s_beta_ndt,&amp;__pyx_n_s_beta_ndt2,&amp;__pyx_n_s_beta_ndt3,&amp;__pyx_n_s_err,&amp;__pyx_n_s_n_st,&amp;__pyx_n_s_n_sz,&amp;__pyx_n_s_use_adaptive,&amp;__pyx_n_s_simps_err,&amp;__pyx_n_s_p_outlier,&amp;__pyx_n_s_w_outlier,0};
    PyObject* values[50] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 50: values[49] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 49);
        CYTHON_FALLTHROUGH;
        case 49: values[48] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 48);
        CYTHON_FALLTHROUGH;
        case 48: values[47] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 47);
        CYTHON_FALLTHROUGH;
        case 47: values[46] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 46);
        CYTHON_FALLTHROUGH;
        case 46: values[45] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 45);
        CYTHON_FALLTHROUGH;
        case 45: values[44] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 44);
        CYTHON_FALLTHROUGH;
        case 44: values[43] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 43);
        CYTHON_FALLTHROUGH;
        case 43: values[42] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 42);
        CYTHON_FALLTHROUGH;
        case 42: values[41] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 41);
        CYTHON_FALLTHROUGH;
        case 41: values[40] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 40);
        CYTHON_FALLTHROUGH;
        case 40: values[39] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 39);
        CYTHON_FALLTHROUGH;
        case 39: values[38] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 38);
        CYTHON_FALLTHROUGH;
        case 38: values[37] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 37);
        CYTHON_FALLTHROUGH;
        case 37: values[36] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 36);
        CYTHON_FALLTHROUGH;
        case 36: values[35] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 35);
        CYTHON_FALLTHROUGH;
        case 35: values[34] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 34);
        CYTHON_FALLTHROUGH;
        case 34: values[33] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 33);
        CYTHON_FALLTHROUGH;
        case 33: values[32] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 32);
        CYTHON_FALLTHROUGH;
        case 32: values[31] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 31);
        CYTHON_FALLTHROUGH;
        case 31: values[30] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 30);
        CYTHON_FALLTHROUGH;
        case 30: values[29] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 29);
        CYTHON_FALLTHROUGH;
        case 29: values[28] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 28);
        CYTHON_FALLTHROUGH;
        case 28: values[27] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 27);
        CYTHON_FALLTHROUGH;
        case 27: values[26] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 26);
        CYTHON_FALLTHROUGH;
        case 26: values[25] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 25);
        CYTHON_FALLTHROUGH;
        case 25: values[24] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 24);
        CYTHON_FALLTHROUGH;
        case 24: values[23] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 23);
        CYTHON_FALLTHROUGH;
        case 23: values[22] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 22);
        CYTHON_FALLTHROUGH;
        case 22: values[21] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 21);
        CYTHON_FALLTHROUGH;
        case 21: values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x1)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 1); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_s1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 2); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_s2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 3); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_response1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 4); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_response2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 5); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_feedback)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 6); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_split_by)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 7); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_q)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 8); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_alpha)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 9); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_pos_alpha)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 10); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_gamma)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 11); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (likely((values[12] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_gamma2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 12); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (likely((values[13] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lambda)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 13); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (likely((values[14] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v0)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 14); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (likely((values[15] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 15); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (likely((values[16] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 16); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (likely((values[17] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 17); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 18:
        if (likely((values[18] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 18); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 19:
        if (likely((values[19] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z0)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 19); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 20:
        if (likely((values[20] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 20); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 21:
        if (likely((values[21] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 21); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 22:
        if (likely((values[22] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 22); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 23:
        if (likely((values[23] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_t)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 23); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 24:
        if (likely((values[24] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nstates)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 24); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 25:
        if (likely((values[25] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v_interaction)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 25); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 26:
        if (likely((values[26] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z_interaction)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 26); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 27:
        if (likely((values[27] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_two_stage)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 27); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 28:
        if (likely((values[28] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_a_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 28); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 29:
        if (likely((values[29] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 29); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 30:
        if (likely((values[30] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_t_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 30); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 31:
        if (likely((values[31] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 31); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 32:
        if (likely((values[32] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_alpha2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 32); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 33:
        if (likely((values[33] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 33); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 34:
        if (likely((values[34] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 34); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 35:
        if (likely((values[35] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z_scaler)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 35); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 36:
        if (likely((values[36] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z_sigma)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 36); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 37:
        if (likely((values[37] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z_sigma2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 37); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 38:
        if (likely((values[38] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_window_start)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 38); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 39:
        if (likely((values[39] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_window_size)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 39); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 40:
        if (likely((values[40] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_beta_ndt)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 40); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 41:
        if (likely((values[41] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_beta_ndt2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 41); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 42:
        if (likely((values[42] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_beta_ndt3)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 42); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 43:
        if (likely((values[43] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_err)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, 43); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 44:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_st);
          if (value) { values[44] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 45:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_sz);
          if (value) { values[45] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 46:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_use_adaptive);
          if (value) { values[46] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 47:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_simps_err);
          if (value) { values[47] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 48:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_p_outlier);
          if (value) { values[48] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 49:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w_outlier);
          if (value) { values[49] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "wiener_like_rlddm_uncertainty") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 50: values[49] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 49);
        CYTHON_FALLTHROUGH;
        case 49: values[48] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 48);
        CYTHON_FALLTHROUGH;
        case 48: values[47] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 47);
        CYTHON_FALLTHROUGH;
        case 47: values[46] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 46);
        CYTHON_FALLTHROUGH;
        case 46: values[45] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 45);
        CYTHON_FALLTHROUGH;
        case 45: values[44] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 44);
        CYTHON_FALLTHROUGH;
        case 44: values[43] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 43);
        values[42] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 42);
        values[41] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 41);
        values[40] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 40);
        values[39] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 39);
        values[38] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 38);
        values[37] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 37);
        values[36] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 36);
        values[35] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 35);
        values[34] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 34);
        values[33] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 33);
        values[32] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 32);
        values[31] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 31);
        values[30] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 30);
        values[29] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 29);
        values[28] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 28);
        values[27] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 27);
        values[26] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 26);
        values[25] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 25);
        values[24] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 24);
        values[23] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 23);
        values[22] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 22);
        values[21] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 21);
        values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_x1 = ((PyArrayObject *)values[0]);
    __pyx_v_x2 = ((PyArrayObject *)values[1]);
    __pyx_v_s1 = ((PyArrayObject *)values[2]);
    __pyx_v_s2 = ((PyArrayObject *)values[3]);
    __pyx_v_response1 = ((PyArrayObject *)values[4]);
    __pyx_v_response2 = ((PyArrayObject *)values[5]);
    __pyx_v_feedback = ((PyArrayObject *)values[6]);
    __pyx_v_split_by = ((PyArrayObject *)values[7]);
    __pyx_v_q = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]); if (unlikely((__pyx_v_q == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1243, __pyx_L3_error)</span>
    __pyx_v_alpha = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[9]); if (unlikely((__pyx_v_alpha == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1243, __pyx_L3_error)</span>
    __pyx_v_pos_alpha = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[10]); if (unlikely((__pyx_v_pos_alpha == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1243, __pyx_L3_error)</span>
    __pyx_v_gamma = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[11]); if (unlikely((__pyx_v_gamma == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1246, __pyx_L3_error)</span>
    __pyx_v_gamma2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[12]); if (unlikely((__pyx_v_gamma2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1246, __pyx_L3_error)</span>
    __pyx_v_lambda_ = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[13]); if (unlikely((__pyx_v_lambda_ == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1247, __pyx_L3_error)</span>
    __pyx_v_v0 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[14]); if (unlikely((__pyx_v_v0 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1249, __pyx_L3_error)</span>
    __pyx_v_v1 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[15]); if (unlikely((__pyx_v_v1 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1249, __pyx_L3_error)</span>
    __pyx_v_v2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[16]); if (unlikely((__pyx_v_v2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1249, __pyx_L3_error)</span>
    __pyx_v_v = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[17]); if (unlikely((__pyx_v_v == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1250, __pyx_L3_error)</span>
    __pyx_v_a = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[18]); if (unlikely((__pyx_v_a == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1252, __pyx_L3_error)</span>
    __pyx_v_z0 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[19]); if (unlikely((__pyx_v_z0 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1253, __pyx_L3_error)</span>
    __pyx_v_z1 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[20]); if (unlikely((__pyx_v_z1 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1253, __pyx_L3_error)</span>
    __pyx_v_z2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[21]); if (unlikely((__pyx_v_z2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1253, __pyx_L3_error)</span>
    __pyx_v_z = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[22]); if (unlikely((__pyx_v_z == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1254, __pyx_L3_error)</span>
    __pyx_v_t = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[23]); if (unlikely((__pyx_v_t == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1256, __pyx_L3_error)</span>
    __pyx_v_nstates = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[24]); if (unlikely((__pyx_v_nstates == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1257, __pyx_L3_error)</span>
    __pyx_v_v_interaction = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[25]); if (unlikely((__pyx_v_v_interaction == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1259, __pyx_L3_error)</span>
    __pyx_v_z_interaction = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[26]); if (unlikely((__pyx_v_z_interaction == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1259, __pyx_L3_error)</span>
    __pyx_v_two_stage = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[27]); if (unlikely((__pyx_v_two_stage == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1260, __pyx_L3_error)</span>
    __pyx_v_a_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[28]); if (unlikely((__pyx_v_a_2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1262, __pyx_L3_error)</span>
    __pyx_v_z_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[29]); if (unlikely((__pyx_v_z_2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1263, __pyx_L3_error)</span>
    __pyx_v_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[30]); if (unlikely((__pyx_v_t_2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1264, __pyx_L3_error)</span>
    __pyx_v_v_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[31]); if (unlikely((__pyx_v_v_2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1265, __pyx_L3_error)</span>
    __pyx_v_alpha2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[32]); if (unlikely((__pyx_v_alpha2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1266, __pyx_L3_error)</span>
    __pyx_v_w = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[33]); if (unlikely((__pyx_v_w == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1267, __pyx_L3_error)</span>
    __pyx_v_w2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[34]); if (unlikely((__pyx_v_w2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1267, __pyx_L3_error)</span>
    __pyx_v_z_scaler = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[35]); if (unlikely((__pyx_v_z_scaler == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1267, __pyx_L3_error)</span>
    __pyx_v_z_sigma = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[36]); if (unlikely((__pyx_v_z_sigma == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1268, __pyx_L3_error)</span>
    __pyx_v_z_sigma2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[37]); if (unlikely((__pyx_v_z_sigma2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1268, __pyx_L3_error)</span>
    __pyx_v_window_start = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[38]); if (unlikely((__pyx_v_window_start == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1269, __pyx_L3_error)</span>
    __pyx_v_window_size = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[39]); if (unlikely((__pyx_v_window_size == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1269, __pyx_L3_error)</span>
    __pyx_v_beta_ndt = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[40]); if (unlikely((__pyx_v_beta_ndt == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1270, __pyx_L3_error)</span>
    __pyx_v_beta_ndt2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[41]); if (unlikely((__pyx_v_beta_ndt2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1270, __pyx_L3_error)</span>
    __pyx_v_beta_ndt3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[42]); if (unlikely((__pyx_v_beta_ndt3 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1270, __pyx_L3_error)</span>
    __pyx_v_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[43]); if (unlikely((__pyx_v_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1275, __pyx_L3_error)</span>
    if (values[44]) {
      __pyx_v_n_st = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[44]); if (unlikely((__pyx_v_n_st == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1275, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_st = ((int)10);
    }
    if (values[45]) {
      __pyx_v_n_sz = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[45]); if (unlikely((__pyx_v_n_sz == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1275, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_sz = ((int)10);
    }
    if (values[46]) {
      __pyx_v_use_adaptive = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[46]); if (unlikely((__pyx_v_use_adaptive == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1275, __pyx_L3_error)</span>
    } else {
      __pyx_v_use_adaptive = ((int)1);
    }
    if (values[47]) {
      __pyx_v_simps_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[47]); if (unlikely((__pyx_v_simps_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1275, __pyx_L3_error)</span>
    } else {
      __pyx_v_simps_err = ((double)1e-8);
    }
    if (values[48]) {
      __pyx_v_p_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[48]); if (unlikely((__pyx_v_p_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1276, __pyx_L3_error)</span>
    } else {
      __pyx_v_p_outlier = ((double)0.0);
    }
    if (values[49]) {
      __pyx_v_w_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[49]); if (unlikely((__pyx_v_w_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1276, __pyx_L3_error)</span>
    } else {
      __pyx_v_w_outlier = ((double)0.0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rlddm_uncertainty", 0, 44, 50, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_rlddm_uncertainty", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x1), __pyx_ptype_5numpy_ndarray, 1, "x1", 0))) <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x2), __pyx_ptype_5numpy_ndarray, 1, "x2", 0))) <span class='error_goto'>__PYX_ERR(0, 1236, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_s1), __pyx_ptype_5numpy_ndarray, 1, "s1", 0))) <span class='error_goto'>__PYX_ERR(0, 1237, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_s2), __pyx_ptype_5numpy_ndarray, 1, "s2", 0))) <span class='error_goto'>__PYX_ERR(0, 1238, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_response1), __pyx_ptype_5numpy_ndarray, 1, "response1", 0))) <span class='error_goto'>__PYX_ERR(0, 1239, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_response2), __pyx_ptype_5numpy_ndarray, 1, "response2", 0))) <span class='error_goto'>__PYX_ERR(0, 1240, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_feedback), __pyx_ptype_5numpy_ndarray, 1, "feedback", 0))) <span class='error_goto'>__PYX_ERR(0, 1241, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_split_by), __pyx_ptype_5numpy_ndarray, 1, "split_by", 0))) <span class='error_goto'>__PYX_ERR(0, 1242, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4wfpt_14wiener_like_rlddm_uncertainty(__pyx_self, __pyx_v_x1, __pyx_v_x2, __pyx_v_s1, __pyx_v_s2, __pyx_v_response1, __pyx_v_response2, __pyx_v_feedback, __pyx_v_split_by, __pyx_v_q, __pyx_v_alpha, __pyx_v_pos_alpha, __pyx_v_gamma, __pyx_v_gamma2, __pyx_v_lambda_, __pyx_v_v0, __pyx_v_v1, __pyx_v_v2, __pyx_v_v, __pyx_v_a, __pyx_v_z0, __pyx_v_z1, __pyx_v_z2, __pyx_v_z, __pyx_v_t, __pyx_v_nstates, __pyx_v_v_interaction, __pyx_v_z_interaction, __pyx_v_two_stage, __pyx_v_a_2, __pyx_v_z_2, __pyx_v_t_2, __pyx_v_v_2, __pyx_v_alpha2, __pyx_v_w, __pyx_v_w2, __pyx_v_z_scaler, __pyx_v_z_sigma, __pyx_v_z_sigma2, __pyx_v_window_start, __pyx_v_window_size, __pyx_v_beta_ndt, __pyx_v_beta_ndt2, __pyx_v_beta_ndt3, __pyx_v_err, __pyx_v_n_st, __pyx_v_n_sz, __pyx_v_use_adaptive, __pyx_v_simps_err, __pyx_v_p_outlier, __pyx_v_w_outlier);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_14wiener_like_rlddm_uncertainty(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_x1, PyArrayObject *__pyx_v_x2, PyArrayObject *__pyx_v_s1, PyArrayObject *__pyx_v_s2, PyArrayObject *__pyx_v_response1, PyArrayObject *__pyx_v_response2, PyArrayObject *__pyx_v_feedback, PyArrayObject *__pyx_v_split_by, double __pyx_v_q, double __pyx_v_alpha, double __pyx_v_pos_alpha, double __pyx_v_gamma, double __pyx_v_gamma2, double __pyx_v_lambda_, double __pyx_v_v0, double __pyx_v_v1, double __pyx_v_v2, double __pyx_v_v, double __pyx_v_a, double __pyx_v_z0, double __pyx_v_z1, double __pyx_v_z2, CYTHON_UNUSED double __pyx_v_z, double __pyx_v_t, int __pyx_v_nstates, double __pyx_v_v_interaction, double __pyx_v_z_interaction, double __pyx_v_two_stage, double __pyx_v_a_2, double __pyx_v_z_2, double __pyx_v_t_2, double __pyx_v_v_2, double __pyx_v_alpha2, double __pyx_v_w, double __pyx_v_w2, double __pyx_v_z_scaler, double __pyx_v_z_sigma, double __pyx_v_z_sigma2, double __pyx_v_window_start, double __pyx_v_window_size, double __pyx_v_beta_ndt, double __pyx_v_beta_ndt2, double __pyx_v_beta_ndt3, double __pyx_v_err, int __pyx_v_n_st, int __pyx_v_n_sz, int __pyx_v_use_adaptive, double __pyx_v_simps_err, double __pyx_v_p_outlier, double __pyx_v_w_outlier) {
  double __pyx_v_sz;
  double __pyx_v_st;
  double __pyx_v_sv;
  CYTHON_UNUSED Py_ssize_t __pyx_v_size;
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_j;
  Py_ssize_t __pyx_v_s_size;
  int __pyx_v_s;
  double __pyx_v_p;
  double __pyx_v_sum_logp;
  double __pyx_v_wp_outlier;
  double __pyx_v_alfa;
  CYTHON_UNUSED double __pyx_v_pos_alfa;
  double __pyx_v_alfa2;
  double __pyx_v_gamma_;
  double __pyx_v_gamma__;
  double __pyx_v_lambda__;
  PyArrayObject *__pyx_v_qs_mf = 0;
  PyArrayObject *__pyx_v_qs_mb = 0;
  PyArrayObject *__pyx_v_ndt_counter_set = 0;
  PyArrayObject *__pyx_v_ndt_counter_ind = 0;
  PyArrayObject *__pyx_v_beta_n = 0;
  PyArrayObject *__pyx_v_beta_success = 0;
  double __pyx_v_dtQ1;
  double __pyx_v_dtQ2;
  double __pyx_v_dtq_mb;
  double __pyx_v_dtq_mf;
  long __pyx_v_s_;
  long __pyx_v_a_;
  double __pyx_v_v_;
  double __pyx_v_z_;
  double __pyx_v_t_;
  double __pyx_v_sig;
  double __pyx_v_v_2_;
  double __pyx_v_z_2_;
  double __pyx_v_a_2_;
  double __pyx_v_t_2_;
  double __pyx_v_var1;
  double __pyx_v_var2;
  double __pyx_v_entropy1;
  double __pyx_v_entropy2;
  PyArrayObject *__pyx_v_x1s = 0;
  PyArrayObject *__pyx_v_x2s = 0;
  PyArrayObject *__pyx_v_feedbacks = 0;
  PyArrayObject *__pyx_v_responses1 = 0;
  PyArrayObject *__pyx_v_responses2 = 0;
  PyArrayObject *__pyx_v_unique = 0;
  PyArrayObject *__pyx_v_s1s = 0;
  PyArrayObject *__pyx_v_s2s = 0;
  PyArrayObject *__pyx_v_planets = 0;
  PyArrayObject *__pyx_v_counter = 0;
  PyArrayObject *__pyx_v_Qmb = 0;
  double __pyx_v_dtq;
  double __pyx_v_rt;
  PyArrayObject *__pyx_v_Tm = 0;
  PyArrayObject *__pyx_v_state_combinations = 0;
  PyObject *__pyx_v_qs = NULL;
  PyObject *__pyx_v_chosen_state = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Qmb;
  __Pyx_Buffer __pyx_pybuffer_Qmb;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Tm;
  __Pyx_Buffer __pyx_pybuffer_Tm;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_beta_n;
  __Pyx_Buffer __pyx_pybuffer_beta_n;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_beta_success;
  __Pyx_Buffer __pyx_pybuffer_beta_success;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_counter;
  __Pyx_Buffer __pyx_pybuffer_counter;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_feedback;
  __Pyx_Buffer __pyx_pybuffer_feedback;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_feedbacks;
  __Pyx_Buffer __pyx_pybuffer_feedbacks;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ndt_counter_ind;
  __Pyx_Buffer __pyx_pybuffer_ndt_counter_ind;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ndt_counter_set;
  __Pyx_Buffer __pyx_pybuffer_ndt_counter_set;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_planets;
  __Pyx_Buffer __pyx_pybuffer_planets;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_qs_mb;
  __Pyx_Buffer __pyx_pybuffer_qs_mb;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_qs_mf;
  __Pyx_Buffer __pyx_pybuffer_qs_mf;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_response1;
  __Pyx_Buffer __pyx_pybuffer_response1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_response2;
  __Pyx_Buffer __pyx_pybuffer_response2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_responses1;
  __Pyx_Buffer __pyx_pybuffer_responses1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_responses2;
  __Pyx_Buffer __pyx_pybuffer_responses2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_s1;
  __Pyx_Buffer __pyx_pybuffer_s1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_s1s;
  __Pyx_Buffer __pyx_pybuffer_s1s;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_s2;
  __Pyx_Buffer __pyx_pybuffer_s2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_s2s;
  __Pyx_Buffer __pyx_pybuffer_s2s;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_split_by;
  __Pyx_Buffer __pyx_pybuffer_split_by;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_state_combinations;
  __Pyx_Buffer __pyx_pybuffer_state_combinations;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_unique;
  __Pyx_Buffer __pyx_pybuffer_unique;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x1;
  __Pyx_Buffer __pyx_pybuffer_x1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x1s;
  __Pyx_Buffer __pyx_pybuffer_x1s;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x2;
  __Pyx_Buffer __pyx_pybuffer_x2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x2s;
  __Pyx_Buffer __pyx_pybuffer_x2s;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_rlddm_uncertainty", 0);
  __pyx_pybuffer_qs_mf.pybuffer.buf = NULL;
  __pyx_pybuffer_qs_mf.refcount = 0;
  __pyx_pybuffernd_qs_mf.data = NULL;
  __pyx_pybuffernd_qs_mf.rcbuffer = &amp;__pyx_pybuffer_qs_mf;
  __pyx_pybuffer_qs_mb.pybuffer.buf = NULL;
  __pyx_pybuffer_qs_mb.refcount = 0;
  __pyx_pybuffernd_qs_mb.data = NULL;
  __pyx_pybuffernd_qs_mb.rcbuffer = &amp;__pyx_pybuffer_qs_mb;
  __pyx_pybuffer_ndt_counter_set.pybuffer.buf = NULL;
  __pyx_pybuffer_ndt_counter_set.refcount = 0;
  __pyx_pybuffernd_ndt_counter_set.data = NULL;
  __pyx_pybuffernd_ndt_counter_set.rcbuffer = &amp;__pyx_pybuffer_ndt_counter_set;
  __pyx_pybuffer_ndt_counter_ind.pybuffer.buf = NULL;
  __pyx_pybuffer_ndt_counter_ind.refcount = 0;
  __pyx_pybuffernd_ndt_counter_ind.data = NULL;
  __pyx_pybuffernd_ndt_counter_ind.rcbuffer = &amp;__pyx_pybuffer_ndt_counter_ind;
  __pyx_pybuffer_beta_n.pybuffer.buf = NULL;
  __pyx_pybuffer_beta_n.refcount = 0;
  __pyx_pybuffernd_beta_n.data = NULL;
  __pyx_pybuffernd_beta_n.rcbuffer = &amp;__pyx_pybuffer_beta_n;
  __pyx_pybuffer_beta_success.pybuffer.buf = NULL;
  __pyx_pybuffer_beta_success.refcount = 0;
  __pyx_pybuffernd_beta_success.data = NULL;
  __pyx_pybuffernd_beta_success.rcbuffer = &amp;__pyx_pybuffer_beta_success;
  __pyx_pybuffer_x1s.pybuffer.buf = NULL;
  __pyx_pybuffer_x1s.refcount = 0;
  __pyx_pybuffernd_x1s.data = NULL;
  __pyx_pybuffernd_x1s.rcbuffer = &amp;__pyx_pybuffer_x1s;
  __pyx_pybuffer_x2s.pybuffer.buf = NULL;
  __pyx_pybuffer_x2s.refcount = 0;
  __pyx_pybuffernd_x2s.data = NULL;
  __pyx_pybuffernd_x2s.rcbuffer = &amp;__pyx_pybuffer_x2s;
  __pyx_pybuffer_feedbacks.pybuffer.buf = NULL;
  __pyx_pybuffer_feedbacks.refcount = 0;
  __pyx_pybuffernd_feedbacks.data = NULL;
  __pyx_pybuffernd_feedbacks.rcbuffer = &amp;__pyx_pybuffer_feedbacks;
  __pyx_pybuffer_responses1.pybuffer.buf = NULL;
  __pyx_pybuffer_responses1.refcount = 0;
  __pyx_pybuffernd_responses1.data = NULL;
  __pyx_pybuffernd_responses1.rcbuffer = &amp;__pyx_pybuffer_responses1;
  __pyx_pybuffer_responses2.pybuffer.buf = NULL;
  __pyx_pybuffer_responses2.refcount = 0;
  __pyx_pybuffernd_responses2.data = NULL;
  __pyx_pybuffernd_responses2.rcbuffer = &amp;__pyx_pybuffer_responses2;
  __pyx_pybuffer_unique.pybuffer.buf = NULL;
  __pyx_pybuffer_unique.refcount = 0;
  __pyx_pybuffernd_unique.data = NULL;
  __pyx_pybuffernd_unique.rcbuffer = &amp;__pyx_pybuffer_unique;
  __pyx_pybuffer_s1s.pybuffer.buf = NULL;
  __pyx_pybuffer_s1s.refcount = 0;
  __pyx_pybuffernd_s1s.data = NULL;
  __pyx_pybuffernd_s1s.rcbuffer = &amp;__pyx_pybuffer_s1s;
  __pyx_pybuffer_s2s.pybuffer.buf = NULL;
  __pyx_pybuffer_s2s.refcount = 0;
  __pyx_pybuffernd_s2s.data = NULL;
  __pyx_pybuffernd_s2s.rcbuffer = &amp;__pyx_pybuffer_s2s;
  __pyx_pybuffer_planets.pybuffer.buf = NULL;
  __pyx_pybuffer_planets.refcount = 0;
  __pyx_pybuffernd_planets.data = NULL;
  __pyx_pybuffernd_planets.rcbuffer = &amp;__pyx_pybuffer_planets;
  __pyx_pybuffer_counter.pybuffer.buf = NULL;
  __pyx_pybuffer_counter.refcount = 0;
  __pyx_pybuffernd_counter.data = NULL;
  __pyx_pybuffernd_counter.rcbuffer = &amp;__pyx_pybuffer_counter;
  __pyx_pybuffer_Qmb.pybuffer.buf = NULL;
  __pyx_pybuffer_Qmb.refcount = 0;
  __pyx_pybuffernd_Qmb.data = NULL;
  __pyx_pybuffernd_Qmb.rcbuffer = &amp;__pyx_pybuffer_Qmb;
  __pyx_pybuffer_Tm.pybuffer.buf = NULL;
  __pyx_pybuffer_Tm.refcount = 0;
  __pyx_pybuffernd_Tm.data = NULL;
  __pyx_pybuffernd_Tm.rcbuffer = &amp;__pyx_pybuffer_Tm;
  __pyx_pybuffer_state_combinations.pybuffer.buf = NULL;
  __pyx_pybuffer_state_combinations.refcount = 0;
  __pyx_pybuffernd_state_combinations.data = NULL;
  __pyx_pybuffernd_state_combinations.rcbuffer = &amp;__pyx_pybuffer_state_combinations;
  __pyx_pybuffer_x1.pybuffer.buf = NULL;
  __pyx_pybuffer_x1.refcount = 0;
  __pyx_pybuffernd_x1.data = NULL;
  __pyx_pybuffernd_x1.rcbuffer = &amp;__pyx_pybuffer_x1;
  __pyx_pybuffer_x2.pybuffer.buf = NULL;
  __pyx_pybuffer_x2.refcount = 0;
  __pyx_pybuffernd_x2.data = NULL;
  __pyx_pybuffernd_x2.rcbuffer = &amp;__pyx_pybuffer_x2;
  __pyx_pybuffer_s1.pybuffer.buf = NULL;
  __pyx_pybuffer_s1.refcount = 0;
  __pyx_pybuffernd_s1.data = NULL;
  __pyx_pybuffernd_s1.rcbuffer = &amp;__pyx_pybuffer_s1;
  __pyx_pybuffer_s2.pybuffer.buf = NULL;
  __pyx_pybuffer_s2.refcount = 0;
  __pyx_pybuffernd_s2.data = NULL;
  __pyx_pybuffernd_s2.rcbuffer = &amp;__pyx_pybuffer_s2;
  __pyx_pybuffer_response1.pybuffer.buf = NULL;
  __pyx_pybuffer_response1.refcount = 0;
  __pyx_pybuffernd_response1.data = NULL;
  __pyx_pybuffernd_response1.rcbuffer = &amp;__pyx_pybuffer_response1;
  __pyx_pybuffer_response2.pybuffer.buf = NULL;
  __pyx_pybuffer_response2.refcount = 0;
  __pyx_pybuffernd_response2.data = NULL;
  __pyx_pybuffernd_response2.rcbuffer = &amp;__pyx_pybuffer_response2;
  __pyx_pybuffer_feedback.pybuffer.buf = NULL;
  __pyx_pybuffer_feedback.refcount = 0;
  __pyx_pybuffernd_feedback.data = NULL;
  __pyx_pybuffernd_feedback.rcbuffer = &amp;__pyx_pybuffer_feedback;
  __pyx_pybuffer_split_by.pybuffer.buf = NULL;
  __pyx_pybuffer_split_by.refcount = 0;
  __pyx_pybuffernd_split_by.data = NULL;
  __pyx_pybuffernd_split_by.rcbuffer = &amp;__pyx_pybuffer_split_by;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x1, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_x1.diminfo[0].strides = __pyx_pybuffernd_x1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x1.diminfo[0].shape = __pyx_pybuffernd_x1.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x2, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_x2.diminfo[0].strides = __pyx_pybuffernd_x2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x2.diminfo[0].shape = __pyx_pybuffernd_x2.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_s1, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_s1.diminfo[0].strides = __pyx_pybuffernd_s1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_s1.diminfo[0].shape = __pyx_pybuffernd_s1.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_s2, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_s2.diminfo[0].strides = __pyx_pybuffernd_s2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_s2.diminfo[0].shape = __pyx_pybuffernd_s2.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_response1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_response1, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_response1.diminfo[0].strides = __pyx_pybuffernd_response1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_response1.diminfo[0].shape = __pyx_pybuffernd_response1.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_response2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_response2, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_response2.diminfo[0].strides = __pyx_pybuffernd_response2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_response2.diminfo[0].shape = __pyx_pybuffernd_response2.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_feedback, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_feedback.diminfo[0].strides = __pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_feedback.diminfo[0].shape = __pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_split_by, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_split_by.diminfo[0].strides = __pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_split_by.diminfo[0].shape = __pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_beta_n.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_beta_success.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response2.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s2.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x2.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_rlddm_uncertainty", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_beta_n.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_beta_success.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_qs_mf);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_qs_mb);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_ndt_counter_set);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_ndt_counter_ind);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_beta_n);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_beta_success);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_x1s);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_x2s);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_feedbacks);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_responses1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_responses2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_unique);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_s1s);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_s2s);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_planets);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_counter);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Qmb);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Tm);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_state_combinations);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_qs);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_chosen_state);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__23 = <span class='py_c_api'>PyTuple_Pack</span>(108, __pyx_n_s_x1, __pyx_n_s_x2, __pyx_n_s_s1, __pyx_n_s_s2, __pyx_n_s_response1, __pyx_n_s_response2, __pyx_n_s_feedback, __pyx_n_s_split_by, __pyx_n_s_q, __pyx_n_s_alpha, __pyx_n_s_pos_alpha, __pyx_n_s_gamma, __pyx_n_s_gamma2, __pyx_n_s_lambda, __pyx_n_s_v0, __pyx_n_s_v1, __pyx_n_s_v2, __pyx_n_s_v, __pyx_n_s_a, __pyx_n_s_z0, __pyx_n_s_z1, __pyx_n_s_z2, __pyx_n_s_z, __pyx_n_s_t, __pyx_n_s_nstates, __pyx_n_s_v_interaction, __pyx_n_s_z_interaction, __pyx_n_s_two_stage, __pyx_n_s_a_2, __pyx_n_s_z_2, __pyx_n_s_t_2, __pyx_n_s_v_2, __pyx_n_s_alpha2, __pyx_n_s_w, __pyx_n_s_w2, __pyx_n_s_z_scaler, __pyx_n_s_z_sigma, __pyx_n_s_z_sigma2, __pyx_n_s_window_start, __pyx_n_s_window_size, __pyx_n_s_beta_ndt, __pyx_n_s_beta_ndt2, __pyx_n_s_beta_ndt3, __pyx_n_s_err, __pyx_n_s_n_st, __pyx_n_s_n_sz, __pyx_n_s_use_adaptive, __pyx_n_s_simps_err, __pyx_n_s_p_outlier, __pyx_n_s_w_outlier, __pyx_n_s_sz, __pyx_n_s_st, __pyx_n_s_sv, __pyx_n_s_size, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_s_size, __pyx_n_s_s, __pyx_n_s_p, __pyx_n_s_sum_logp, __pyx_n_s_wp_outlier, __pyx_n_s_alfa, __pyx_n_s_pos_alfa, __pyx_n_s_alfa2, __pyx_n_s_gamma_2, __pyx_n_s_gamma_3, __pyx_n_s_lambda_2, __pyx_n_s_qs_mf, __pyx_n_s_qs_mb, __pyx_n_s_ndt_counter_set, __pyx_n_s_ndt_counter_ind, __pyx_n_s_beta_n, __pyx_n_s_beta_success, __pyx_n_s_dtQ1, __pyx_n_s_dtQ2, __pyx_n_s_dtq_mb, __pyx_n_s_dtq_mf, __pyx_n_s_s_2, __pyx_n_s_a_3, __pyx_n_s_v_3, __pyx_n_s_z_3, __pyx_n_s_t_3, __pyx_n_s_sig, __pyx_n_s_v_2_2, __pyx_n_s_z_2_2, __pyx_n_s_a_2_2, __pyx_n_s_t_2_2, __pyx_n_s_var1, __pyx_n_s_var2, __pyx_n_s_entropy1, __pyx_n_s_entropy2, __pyx_n_s_x1s, __pyx_n_s_x2s, __pyx_n_s_feedbacks, __pyx_n_s_responses1, __pyx_n_s_responses2, __pyx_n_s_unique, __pyx_n_s_s1s, __pyx_n_s_s2s, __pyx_n_s_planets, __pyx_n_s_counter, __pyx_n_s_Qmb, __pyx_n_s_dtq, __pyx_n_s_rt, __pyx_n_s_Tm, __pyx_n_s_state_combinations, __pyx_n_s_qs, __pyx_n_s_chosen_state);<span class='error_goto'> if (unlikely(!__pyx_tuple__23)) __PYX_ERR(0, 1235, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__23);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__23);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_15wiener_like_rlddm_uncertainty, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1235, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_wiener_like_rlddm_uncertainty, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1235, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__24 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(50, 0, 108, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__23, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_wiener_like_rlddm_uncertainty, 1235, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__24)) __PYX_ERR(0, 1235, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">1236</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x2</span><span class="p">,</span> <span class="c"># 2nd-stage RT</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1237</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span><span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">s1</span><span class="p">,</span> <span class="c"># 1st-stage state</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1238</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span><span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">s2</span><span class="p">,</span> <span class="c"># 2nd-stage state</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1239</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">response1</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1240</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">response2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1241</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">feedback</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1242</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">split_by</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1243</span>:                       <span class="n">double</span> <span class="n">q</span><span class="p">,</span> <span class="n">double</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">double</span> <span class="n">pos_alpha</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1244</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1245</span>:                       <span class="c"># double w,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1246</span>:                       <span class="n">double</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">double</span> <span class="n">gamma2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1247</span>:                       <span class="n">double</span> <span class="n">lambda_</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1248</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1249</span>:                       <span class="n">double</span> <span class="n">v0</span><span class="p">,</span> <span class="n">double</span> <span class="n">v1</span><span class="p">,</span> <span class="n">double</span> <span class="n">v2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1250</span>:                       <span class="n">double</span> <span class="n">v</span><span class="p">,</span> <span class="c"># don&#39;t use second stage</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1251</span>:                       <span class="c"># double sv,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1252</span>:                       <span class="n">double</span> <span class="n">a</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1253</span>:                       <span class="n">double</span> <span class="n">z0</span><span class="p">,</span> <span class="n">double</span> <span class="n">z1</span><span class="p">,</span> <span class="n">double</span> <span class="n">z2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1254</span>:                       <span class="n">double</span> <span class="n">z</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1255</span>:                       <span class="c"># double sz,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1256</span>:                       <span class="n">double</span> <span class="n">t</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1257</span>:                       <span class="nb">int</span> <span class="n">nstates</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1258</span>:                       <span class="c"># double v_qval, double z_qval,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1259</span>:                       <span class="n">double</span> <span class="n">v_interaction</span><span class="p">,</span> <span class="n">double</span> <span class="n">z_interaction</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1260</span>:                       <span class="n">double</span> <span class="n">two_stage</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1261</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1262</span>:                       <span class="n">double</span> <span class="n">a_2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1263</span>:                       <span class="n">double</span> <span class="n">z_2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1264</span>:                       <span class="n">double</span> <span class="n">t_2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1265</span>:                       <span class="n">double</span> <span class="n">v_2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1266</span>:                       <span class="n">double</span> <span class="n">alpha2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1267</span>:                       <span class="n">double</span> <span class="n">w</span><span class="p">,</span> <span class="n">double</span> <span class="n">w2</span><span class="p">,</span> <span class="n">double</span> <span class="n">z_scaler</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1268</span>:                       <span class="n">double</span> <span class="n">z_sigma</span><span class="p">,</span> <span class="n">double</span> <span class="n">z_sigma2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1269</span>:                       <span class="n">double</span> <span class="n">window_start</span><span class="p">,</span> <span class="n">double</span> <span class="n">window_size</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1270</span>:                       <span class="n">double</span> <span class="n">beta_ndt</span><span class="p">,</span> <span class="n">double</span> <span class="n">beta_ndt2</span><span class="p">,</span> <span class="n">double</span> <span class="n">beta_ndt3</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1271</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1272</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1273</span>:                       <span class="c"># double st,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1274</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1275</span>:                       <span class="n">double</span> <span class="n">err</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_st</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_sz</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">use_adaptive</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span> <span class="n">double</span> <span class="n">simps_err</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1276</span>:                       <span class="n">double</span> <span class="n">p_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="n">double</span> <span class="n">w_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1277</span>:                       <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1278</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1279</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1280</span>:     <span class="c"># cdef double a = 1</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1281</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sz</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sz = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1282</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">st</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_st = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1283</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sv</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sv = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1284</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1285</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1286</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">size</span> <span class="o">=</span> <span class="n">x1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_size = (__pyx_v_x1-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">1287</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1288</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">s_size</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1289</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1290</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">p</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1291</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sum_logp</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sum_logp = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1292</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">wp_outlier</span> <span class="o">=</span> <span class="n">w_outlier</span> <span class="o">*</span> <span class="n">p_outlier</span></pre>
<pre class='cython code score-0 '>  __pyx_v_wp_outlier = (__pyx_v_w_outlier * __pyx_v_p_outlier);
</pre><pre class="cython line score-0">&#xA0;<span class="">1293</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">alfa</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1294</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">pos_alfa</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1295</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">alfa2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1296</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1297</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">gamma_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1298</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">gamma__</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1299</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">lambda__</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1300</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1301</span>:     <span class="c"># cdef np.ndarray[double, ndim=1] qs = np.array([q, q])</span></pre>
<pre class="cython line score-69" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1302</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">qs_mf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">comb</span><span class="p">(</span><span class="n">nstates</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="n">exact</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="mf">2</span><span class="p">))</span><span class="o">*</span><span class="n">q</span> <span class="c"># first-stage MF Q-values</span></pre>
<pre class='cython code score-69 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_comb);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_int_2);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_exact, Py_True) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1302, __pyx_L1_error)</span>
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_5, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_int_2);
  __pyx_t_6 = 0;
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 1302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_1, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1302, __pyx_L1_error)</span>
  __pyx_t_7 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_7, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_qs_mf = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1302, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_qs_mf.diminfo[0].strides = __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_qs_mf.diminfo[0].shape = __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_qs_mf.diminfo[1].strides = __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_qs_mf.diminfo[1].shape = __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_7 = 0;
  __pyx_v_qs_mf = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-47" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1303</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">qs_mb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nstates</span><span class="p">,</span> <span class="mf">2</span><span class="p">))</span><span class="o">*</span><span class="n">q</span> <span class="c"># second-stage Q-values</span></pre>
<pre class='cython code score-47 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1303, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1303, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1303, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1303, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_int_2);
  __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_3, __pyx_t_6) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 1303, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1303, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_6 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_4, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1303, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1303, __pyx_L1_error)</span>
  __pyx_t_8 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_8, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_qs_mb = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1303, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_qs_mb.diminfo[0].strides = __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_qs_mb.diminfo[0].shape = __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_qs_mb.diminfo[1].strides = __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_qs_mb.diminfo[1].shape = __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_8 = 0;
  __pyx_v_qs_mb = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1304</span>: </pre>
<pre class="cython line score-57" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1305</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">ndt_counter_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">comb</span><span class="p">(</span><span class="n">nstates</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="n">exact</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="mf">1</span><span class="p">))</span> <span class="c"># first-stage MF Q-values</span></pre>
<pre class='cython code score-57 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1305, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1305, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_comb);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1305, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1305, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1305, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_int_2);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1305, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_exact, Py_True) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1305, __pyx_L1_error)</span>
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_5, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1305, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1305, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_int_1);
  __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_6 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 1305, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1305, __pyx_L1_error)</span>
  __pyx_t_9 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_9, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_ndt_counter_set = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1305, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_ndt_counter_set.diminfo[0].strides = __pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_ndt_counter_set.diminfo[0].shape = __pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_ndt_counter_set.diminfo[1].strides = __pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_ndt_counter_set.diminfo[1].shape = __pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_9 = 0;
  __pyx_v_ndt_counter_set = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-35" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1306</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">ndt_counter_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nstates</span><span class="p">,</span> <span class="mf">1</span><span class="p">))</span> <span class="c"># first-stage MF Q-values</span></pre>
<pre class='cython code score-35 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1306, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1306, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1306, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1306, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_int_1);
  __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_6 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_2) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 1306, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1306, __pyx_L1_error)</span>
  __pyx_t_10 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_10, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_ndt_counter_ind = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1306, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_ndt_counter_ind.diminfo[0].strides = __pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_ndt_counter_ind.diminfo[0].shape = __pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_ndt_counter_ind.diminfo[1].strides = __pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_ndt_counter_ind.diminfo[1].shape = __pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_10 = 0;
  __pyx_v_ndt_counter_ind = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1307</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1308</span>:     <span class="c"># JY added for uncertainty modeling</span></pre>
<pre class="cython line score-35" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1309</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">beta_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nstates</span><span class="p">,</span> <span class="mf">1</span><span class="p">))</span></pre>
<pre class='cython code score-35 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1309, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1309, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1309, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1309, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_int_1);
  __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_6 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 1309, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1309, __pyx_L1_error)</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_beta_n.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_beta_n = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_beta_n.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1309, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_beta_n.diminfo[0].strides = __pyx_pybuffernd_beta_n.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_beta_n.diminfo[0].shape = __pyx_pybuffernd_beta_n.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_beta_n.diminfo[1].strides = __pyx_pybuffernd_beta_n.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_beta_n.diminfo[1].shape = __pyx_pybuffernd_beta_n.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_11 = 0;
  __pyx_v_beta_n = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-35" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1310</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">beta_success</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nstates</span><span class="p">,</span><span class="mf">1</span><span class="p">))</span></pre>
<pre class='cython code score-35 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1310, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1310, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1310, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1310, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_int_1);
  __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_6 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 1310, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1310, __pyx_L1_error)</span>
  __pyx_t_12 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_beta_success.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_12, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_beta_success = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_beta_success.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1310, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_beta_success.diminfo[0].strides = __pyx_pybuffernd_beta_success.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_beta_success.diminfo[0].shape = __pyx_pybuffernd_beta_success.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_beta_success.diminfo[1].strides = __pyx_pybuffernd_beta_success.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_beta_success.diminfo[1].shape = __pyx_pybuffernd_beta_success.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_12 = 0;
  __pyx_v_beta_success = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1311</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1312</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1313</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1314</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dtQ1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1315</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dtQ2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1316</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1317</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dtq_mb</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1318</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dtq_mf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1319</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1320</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">s_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1321</span>:     <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">a_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1322</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">v_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1323</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">z_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1324</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">t_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1325</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sig</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1326</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">v_2_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1327</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">z_2_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1328</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">a_2_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1329</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">t_2_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1330</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1331</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">var1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1332</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">var2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1333</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">entropy1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1334</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">entropy2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1335</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1336</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x1s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1337</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x2s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1338</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">feedbacks</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1339</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">responses1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1340</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">responses2</span></pre>
<pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1341</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">split_by</span><span class="p">)</span></pre>
<pre class='cython code score-24 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1341, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_unique);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1341, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_6 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_v_split_by)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, ((PyObject *)__pyx_v_split_by));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 1341, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1341, __pyx_L1_error)</span>
  __pyx_t_13 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_13, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_unique = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1341, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_unique.diminfo[0].strides = __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_unique.diminfo[0].shape = __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_13 = 0;
  __pyx_v_unique = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1342</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1343</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">s1s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1344</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">s2s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1345</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1346</span>:     <span class="c"># Added by Jungsun Yoo on 2021-11-27 for two-step tasks</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1347</span>:     <span class="c"># parameters added for two-step</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1348</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1349</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1350</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">planets</span></pre>
<pre class="cython line score-49" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1351</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">comb</span><span class="p">(</span><span class="n">nstates</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="n">exact</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span></pre>
<pre class='cython code score-49 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1351, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1351, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_comb);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1351, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1351, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1351, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_int_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1351, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, __pyx_n_s_exact, Py_True) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1351, __pyx_L1_error)</span>
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_5, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1351, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_6 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 1351, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1351, __pyx_L1_error)</span>
  __pyx_t_14 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_14, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_counter = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1351, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_counter.diminfo[0].strides = __pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_counter.diminfo[0].shape = __pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_14 = 0;
  __pyx_v_counter = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1352</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">Qmb</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1353</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dtq</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1354</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">rt</span></pre>
<pre class="cython line score-50" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1355</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">Tm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">]])</span> <span class="c"># transition matrix</span></pre>
<pre class='cython code score-50 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1355, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1355, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1355, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_7);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 0, __pyx_float_0_7);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_3);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 1, __pyx_float_0_3);
  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1355, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_3);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_float_0_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_7);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 1, __pyx_float_0_7);
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1355, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_2);
  __pyx_t_4 = 0;
  __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_6 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 1355, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1355, __pyx_L1_error)</span>
  __pyx_t_15 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_15, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_Tm = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1355, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_Tm.diminfo[0].strides = __pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Tm.diminfo[0].shape = __pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Tm.diminfo[1].strides = __pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Tm.diminfo[1].shape = __pyx_pybuffernd_Tm.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_15 = 0;
  __pyx_v_Tm = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-96" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1356</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">state_combinations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nstates</span><span class="p">),</span><span class="mf">2</span><span class="p">)))</span></pre>
<pre class='cython code score-96 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1356, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1356, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_itertools);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1356, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_combinations);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1356, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1356, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_arange);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 1356, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1356, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_17 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_16))) {
    __pyx_t_17 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_16);
    if (likely(__pyx_t_17)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_16);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_16, function);
    }
  }
  __pyx_t_2 = (__pyx_t_17) ? __Pyx_PyObject_Call2Args(__pyx_t_16, __pyx_t_17, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_16, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 1356, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  __pyx_t_16 = NULL;
  __pyx_t_18 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_16 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_16)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_16);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
      __pyx_t_18 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_16, __pyx_t_2, __pyx_int_2};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_18, 2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1356, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_16, __pyx_t_2, __pyx_int_2};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_18, 2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1356, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  } else
  #endif
  {
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1356, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    if (__pyx_t_16) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_16); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_16); __pyx_t_16 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0+__pyx_t_18, __pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1+__pyx_t_18, __pyx_int_2);
    __pyx_t_2 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1356, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PySequence_List</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1356, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_1)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
    }
  }
  __pyx_t_6 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_1, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 1356, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1356, __pyx_L1_error)</span>
  __pyx_t_19 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_19, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_state_combinations = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1356, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_state_combinations.diminfo[0].strides = __pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_state_combinations.diminfo[0].shape = __pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_state_combinations.diminfo[1].strides = __pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_state_combinations.diminfo[1].shape = __pyx_pybuffernd_state_combinations.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_19 = 0;
  __pyx_v_state_combinations = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1357</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1358</span>:     <span class="k">if</span> <span class="ow">not</span> <span class="n">p_outlier_in_range</span><span class="p">(</span><span class="n">p_outlier</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_20 = ((!(__pyx_f_4wfpt_p_outlier_in_range(__pyx_v_p_outlier) != 0)) != 0);
  if (__pyx_t_20) {
/* … */
  }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1359</span>:         <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-12 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1359, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1359, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1359, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_r = __pyx_t_6;
    __pyx_t_6 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1360</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1361</span>:     <span class="k">if</span> <span class="n">pos_alpha</span><span class="o">==</span><span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_20 = ((__pyx_v_pos_alpha == 100.00) != 0);
  if (__pyx_t_20) {
/* … */
    goto __pyx_L4;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1362</span>:         <span class="n">pos_alfa</span> <span class="o">=</span> <span class="n">alpha</span></pre>
<pre class='cython code score-0 '>    __pyx_v_pos_alfa = __pyx_v_alpha;
</pre><pre class="cython line score-0">&#xA0;<span class="">1363</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1364</span>:         <span class="n">pos_alfa</span> <span class="o">=</span> <span class="n">pos_alpha</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_pos_alfa = __pyx_v_pos_alpha;
  }
  __pyx_L4:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1365</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1366</span>:     <span class="c"># unique represent # of conditions</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1367</span>:     <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">unique</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_21 = (__pyx_v_unique-&gt;dimensions[0]);
  __pyx_t_22 = __pyx_t_21;
  for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
    __pyx_v_j = __pyx_t_23;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1368</span>:         <span class="n">s</span> <span class="o">=</span> <span class="n">unique</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_24 = __pyx_v_j;
    __pyx_v_s = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_unique.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">1369</span>:         <span class="c"># select trials for current condition, identified by the split_by-array</span></pre>
<pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1370</span>:         <span class="n">feedbacks</span> <span class="o">=</span> <span class="n">feedback</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1370, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1370, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_feedback), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1370, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1370, __pyx_L1_error)</span>
    __pyx_t_25 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer);
      __pyx_t_18 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_25, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_18 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_26, &amp;__pyx_t_27, &amp;__pyx_t_28);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_feedbacks, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_27); Py_XDECREF(__pyx_t_28);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_26, __pyx_t_27, __pyx_t_28);
        }
        __pyx_t_26 = __pyx_t_27 = __pyx_t_28 = 0;
      }
      __pyx_pybuffernd_feedbacks.diminfo[0].strides = __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_feedbacks.diminfo[0].shape = __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_18 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1370, __pyx_L1_error)</span>
    }
    __pyx_t_25 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_feedbacks, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1371</span>:         <span class="n">responses1</span> <span class="o">=</span> <span class="n">response1</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1371, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1371, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_response1), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1371, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1371, __pyx_L1_error)</span>
    __pyx_t_29 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer);
      __pyx_t_18 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_29, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_18 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_28, &amp;__pyx_t_27, &amp;__pyx_t_26);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_responses1, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_28); Py_XDECREF(__pyx_t_27); Py_XDECREF(__pyx_t_26);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_28, __pyx_t_27, __pyx_t_26);
        }
        __pyx_t_28 = __pyx_t_27 = __pyx_t_26 = 0;
      }
      __pyx_pybuffernd_responses1.diminfo[0].strides = __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_responses1.diminfo[0].shape = __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_18 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1371, __pyx_L1_error)</span>
    }
    __pyx_t_29 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_responses1, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1372</span>:         <span class="n">responses2</span> <span class="o">=</span> <span class="n">response2</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1372, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1372, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_response2), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1372, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1372, __pyx_L1_error)</span>
    __pyx_t_30 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer);
      __pyx_t_18 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_30, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_18 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_26, &amp;__pyx_t_27, &amp;__pyx_t_28);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_responses2, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_27); Py_XDECREF(__pyx_t_28);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_26, __pyx_t_27, __pyx_t_28);
        }
        __pyx_t_26 = __pyx_t_27 = __pyx_t_28 = 0;
      }
      __pyx_pybuffernd_responses2.diminfo[0].strides = __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_responses2.diminfo[0].shape = __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_18 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1372, __pyx_L1_error)</span>
    }
    __pyx_t_30 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_responses2, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1373</span>:         <span class="n">x1s</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1373, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1373, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_x1), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1373, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1373, __pyx_L1_error)</span>
    __pyx_t_31 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer);
      __pyx_t_18 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_31, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_18 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_28, &amp;__pyx_t_27, &amp;__pyx_t_26);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x1s, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_28); Py_XDECREF(__pyx_t_27); Py_XDECREF(__pyx_t_26);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_28, __pyx_t_27, __pyx_t_26);
        }
        __pyx_t_28 = __pyx_t_27 = __pyx_t_26 = 0;
      }
      __pyx_pybuffernd_x1s.diminfo[0].strides = __pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x1s.diminfo[0].shape = __pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_18 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1373, __pyx_L1_error)</span>
    }
    __pyx_t_31 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_x1s, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1374</span>:         <span class="n">x2s</span> <span class="o">=</span> <span class="n">x2</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1374, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1374, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_x2), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1374, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1374, __pyx_L1_error)</span>
    __pyx_t_32 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer);
      __pyx_t_18 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_32, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_18 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_26, &amp;__pyx_t_27, &amp;__pyx_t_28);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x2s, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_27); Py_XDECREF(__pyx_t_28);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_26, __pyx_t_27, __pyx_t_28);
        }
        __pyx_t_26 = __pyx_t_27 = __pyx_t_28 = 0;
      }
      __pyx_pybuffernd_x2s.diminfo[0].strides = __pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x2s.diminfo[0].shape = __pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_18 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1374, __pyx_L1_error)</span>
    }
    __pyx_t_32 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_x2s, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1375</span>:         <span class="n">s1s</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1375, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1375, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_s1), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1375, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1375, __pyx_L1_error)</span>
    __pyx_t_33 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer);
      __pyx_t_18 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_33, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_18 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_28, &amp;__pyx_t_27, &amp;__pyx_t_26);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_s1s, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_28); Py_XDECREF(__pyx_t_27); Py_XDECREF(__pyx_t_26);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_28, __pyx_t_27, __pyx_t_26);
        }
        __pyx_t_28 = __pyx_t_27 = __pyx_t_26 = 0;
      }
      __pyx_pybuffernd_s1s.diminfo[0].strides = __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_s1s.diminfo[0].shape = __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_18 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1375, __pyx_L1_error)</span>
    }
    __pyx_t_33 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_s1s, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1376</span>:         <span class="n">s2s</span> <span class="o">=</span> <span class="n">s2</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1376, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_6, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1376, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_s2), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1376, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1376, __pyx_L1_error)</span>
    __pyx_t_34 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer);
      __pyx_t_18 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_34, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_18 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_26, &amp;__pyx_t_27, &amp;__pyx_t_28);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_s2s, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_27); Py_XDECREF(__pyx_t_28);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_26, __pyx_t_27, __pyx_t_28);
        }
        __pyx_t_26 = __pyx_t_27 = __pyx_t_28 = 0;
      }
      __pyx_pybuffernd_s2s.diminfo[0].strides = __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_s2s.diminfo[0].shape = __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_18 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1376, __pyx_L1_error)</span>
    }
    __pyx_t_34 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_s2s, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1377</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1378</span>:         <span class="n">s_size</span> <span class="o">=</span> <span class="n">x1s</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_v_s_size = (__pyx_v_x1s-&gt;dimensions[0]);
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1379</span>:         <span class="n">qs_mf</span><span class="p">[:,</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-11 '>    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1379, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_qs_mf), __pyx_tuple__2, __pyx_t_6) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1379, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1380</span>:         <span class="n">qs_mf</span><span class="p">[:,</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-11 '>    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1380, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_qs_mf), __pyx_tuple__3, __pyx_t_6) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1380, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1381</span>: </pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1382</span>:         <span class="n">qs_mb</span><span class="p">[:,</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-11 '>    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1382, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_qs_mb), __pyx_tuple__2, __pyx_t_6) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1382, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1383</span>:         <span class="n">qs_mb</span><span class="p">[:,</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-11 '>    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1383, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_qs_mb), __pyx_tuple__3, __pyx_t_6) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1383, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1384</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1385</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1386</span>:         <span class="n">alfa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_alfa = (pow(2.718281828459, __pyx_v_alpha) / (1.0 + pow(2.718281828459, __pyx_v_alpha)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1387</span>:         <span class="n">gamma_</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">gamma</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">gamma</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_gamma_ = (pow(2.718281828459, __pyx_v_gamma) / (1.0 + pow(2.718281828459, __pyx_v_gamma)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1388</span>:         <span class="k">if</span> <span class="n">gamma2</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_20 = ((__pyx_v_gamma2 != 100.00) != 0);
    if (__pyx_t_20) {
/* … */
      goto __pyx_L7;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1389</span>:             <span class="n">gamma__</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">gamma2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">gamma2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_gamma__ = (pow(2.718281828459, __pyx_v_gamma2) / (1.0 + pow(2.718281828459, __pyx_v_gamma2)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1390</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1391</span>:             <span class="n">gamma__</span> <span class="o">=</span> <span class="n">gamma_</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_gamma__ = __pyx_v_gamma_;
    }
    __pyx_L7:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1392</span>:         <span class="k">if</span> <span class="n">alpha2</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_20 = ((__pyx_v_alpha2 != 100.00) != 0);
    if (__pyx_t_20) {
/* … */
      goto __pyx_L8;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1393</span>:             <span class="n">alfa2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_alfa2 = (pow(2.718281828459, __pyx_v_alpha2) / (1.0 + pow(2.718281828459, __pyx_v_alpha2)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1394</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1395</span>:             <span class="n">alfa2</span> <span class="o">=</span> <span class="n">alfa</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_alfa2 = __pyx_v_alfa;
    }
    __pyx_L8:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1396</span>:         <span class="k">if</span> <span class="n">lambda_</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_20 = ((__pyx_v_lambda_ != 100.00) != 0);
    if (__pyx_t_20) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1397</span>:             <span class="n">lambda__</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">lambda_</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">lambda_</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_lambda__ = (pow(2.718281828459, __pyx_v_lambda_) / (1.0 + pow(2.718281828459, __pyx_v_lambda_)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1398</span>:         <span class="k">if</span> <span class="n">w</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_20 = ((__pyx_v_w != 100.00) != 0);
    if (__pyx_t_20) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1399</span>:             <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">w</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_w = (pow(2.718281828459, __pyx_v_w) / (1.0 + pow(2.718281828459, __pyx_v_w)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1400</span>:         <span class="k">if</span> <span class="n">w2</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_20 = ((__pyx_v_w2 != 100.00) != 0);
    if (__pyx_t_20) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1401</span>:             <span class="n">w2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">w2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">w2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_w2 = (pow(2.718281828459, __pyx_v_w2) / (1.0 + pow(2.718281828459, __pyx_v_w2)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1402</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1403</span>:         <span class="c"># if beta_ndt != 100.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1404</span>:         <span class="c">#     beta_ndt = (2.718281828459**beta_ndt) / (1 + 2.718281828459**beta_ndt)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1405</span>:         <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1406</span>:         <span class="c"># if beta_ndt2 != 100.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1407</span>:         <span class="c">#     beta_ndt2 = (2.718281828459**beta_ndt2) / (1 + 2.718281828459**beta_ndt2)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1408</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1409</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1410</span>:         <span class="c"># don&#39;t calculate pdf for first trial but still update q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1411</span>:         <span class="c"># if feedbacks[0] &gt; qs[responses[0]]:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1412</span>:             <span class="c"># alfa = (2.718281828459**pos_alfa) / (1 + 2.718281828459**pos_alfa)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1413</span>:         <span class="c"># else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1414</span>:             <span class="c"># alfa = (2.718281828459**alpha) / (1 + 2.718281828459**alpha)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1415</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1416</span>:         <span class="c"># # qs[1] is upper bound, qs[0] is lower bound. feedbacks is reward</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1417</span>:         <span class="c"># # received on current trial.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1418</span>:         <span class="c"># qs[responses[0]] = qs[responses[0]] + \</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1419</span>:         <span class="c">#     alfa * (feedbacks[0] - qs[responses[0]])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1420</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1421</span>:         <span class="c"># loop through all trials in current condition</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1422</span>:         <span class="c"># print(window_size, window_start)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1423</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="n">s_size</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_35 = __pyx_v_s_size;
    __pyx_t_36 = __pyx_t_35;
    for (__pyx_t_37 = 0; __pyx_t_37 &lt; __pyx_t_36; __pyx_t_37+=1) {
      __pyx_v_i = __pyx_t_37;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1424</span>:             <span class="k">if</span> <span class="n">window_start</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">window_start</span> <span class="o">+</span> <span class="n">window_size</span><span class="p">:</span>  <span class="c"># and (window_start &lt;= i &lt; window_start+window_size):</span></pre>
<pre class='cython code score-0 '>      __pyx_t_20 = (__pyx_v_window_start &lt;= __pyx_v_i);
      if (__pyx_t_20) {
        __pyx_t_20 = (__pyx_v_i &lt; (__pyx_v_window_start + __pyx_v_window_size));
      }
      __pyx_t_38 = (__pyx_t_20 != 0);
      if (__pyx_t_38) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1425</span>:                 <span class="k">if</span> <span class="n">counter</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">x1s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.15</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_24 = __pyx_v_i;
        __pyx_t_39 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_s1s.diminfo[0].strides));
        __pyx_t_20 = (((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer.buf, __pyx_t_39, __pyx_pybuffernd_counter.diminfo[0].strides)) &gt; 0.0) != 0);
        if (__pyx_t_20) {
        } else {
          __pyx_t_38 = __pyx_t_20;
          goto __pyx_L16_bool_binop_done;
        }
        __pyx_t_24 = __pyx_v_i;
        __pyx_t_20 = (((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_x1s.diminfo[0].strides)) &gt; 0.15) != 0);
        __pyx_t_38 = __pyx_t_20;
        __pyx_L16_bool_binop_done:;
        if (__pyx_t_38) {
/* … */
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">1426</span>:                 <span class="c"># proceed with pdf only if 1) the current 1st-stage state have been updated and 2) &quot;plausible&quot; RT (150 ms)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1427</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1428</span>:                     <span class="c"># 1st stage</span></pre>
<pre class="cython line score-23" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1429</span>:                     <span class="n">planets</span> <span class="o">=</span> <span class="n">state_combinations</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span></pre>
<pre class='cython code score-23 '>          __pyx_t_24 = __pyx_v_i;
          __pyx_t_40 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_s1s.diminfo[0].strides));
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_state_combinations), __pyx_t_40, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1429, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1429, __pyx_L1_error)</span>
          __pyx_t_41 = ((PyArrayObject *)__pyx_t_6);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer);
            __pyx_t_18 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_41, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_18 &lt; 0)) {
              <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_28, &amp;__pyx_t_27, &amp;__pyx_t_26);
              if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_planets, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_28); Py_XDECREF(__pyx_t_27); Py_XDECREF(__pyx_t_26);
                <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
              } else {
                <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_28, __pyx_t_27, __pyx_t_26);
              }
              __pyx_t_28 = __pyx_t_27 = __pyx_t_26 = 0;
            }
            __pyx_pybuffernd_planets.diminfo[0].strides = __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_planets.diminfo[0].shape = __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.shape[0];
            if (unlikely(__pyx_t_18 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1429, __pyx_L1_error)</span>
          }
          __pyx_t_41 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_planets, ((PyArrayObject *)__pyx_t_6));
          __pyx_t_6 = 0;
</pre><pre class="cython line score-137" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1430</span>:                     <span class="n">Qmb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Tm</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">qs_mb</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">0</span><span class="p">],:]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">qs_mb</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">1</span><span class="p">],:])])</span></pre>
<pre class='cython code score-137 '>          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_max);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_24 = 0;
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_planets.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_slice_);
          __pyx_t_1 = 0;
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_qs_mb), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = NULL;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
            __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
            if (likely(__pyx_t_2)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
            }
          }
          __pyx_t_5 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 1430, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_max);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_24 = 1;
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_planets.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          __pyx_t_16 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 0, __pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 1, __pyx_slice_);
          __pyx_t_1 = 0;
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_qs_mb), __pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
          __pyx_t_16 = NULL;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
            __pyx_t_16 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
            if (likely(__pyx_t_16)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_16);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
            }
          }
          __pyx_t_3 = (__pyx_t_16) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_16, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 1430, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
          <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_5);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
          <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_3);
          __pyx_t_5 = 0;
          __pyx_t_3 = 0;
          __pyx_t_3 = NULL;
          __pyx_t_18 = 0;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
            __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
            if (likely(__pyx_t_3)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
              __pyx_t_18 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_4)) {
            PyObject *__pyx_temp[3] = {__pyx_t_3, ((PyObject *)__pyx_v_Tm), __pyx_t_2};
            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_18, 2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_4)) {
            PyObject *__pyx_temp[3] = {__pyx_t_3, ((PyObject *)__pyx_v_Tm), __pyx_t_2};
            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_18, 2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          } else
          #endif
          {
            __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            if (__pyx_t_3) {
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
            }
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_Tm));
            <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_Tm));
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0+__pyx_t_18, ((PyObject *)__pyx_v_Tm));
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1+__pyx_t_18, __pyx_t_2);
            __pyx_t_2 = 0;
            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1430, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1430, __pyx_L1_error)</span>
          __pyx_t_42 = ((PyArrayObject *)__pyx_t_6);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer);
            __pyx_t_18 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_42, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_18 &lt; 0)) {
              <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_26, &amp;__pyx_t_27, &amp;__pyx_t_28);
              if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Qmb, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_27); Py_XDECREF(__pyx_t_28);
                <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
              } else {
                <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_26, __pyx_t_27, __pyx_t_28);
              }
              __pyx_t_26 = __pyx_t_27 = __pyx_t_28 = 0;
            }
            __pyx_pybuffernd_Qmb.diminfo[0].strides = __pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Qmb.diminfo[0].shape = __pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer.shape[0];
            if (unlikely(__pyx_t_18 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1430, __pyx_L1_error)</span>
          }
          __pyx_t_42 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_Qmb, ((PyArrayObject *)__pyx_t_6));
          __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1431</span>:                     <span class="c"># qs = w * Qmb + (1-w) * qs_mf[s1s[i],:] # Update for 1st trial</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1432</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1433</span>:                     <span class="c"># dtq = qs[1] - qs[0]</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1434</span>:                     <span class="n">dtq_mb</span> <span class="o">=</span> <span class="n">Qmb</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Qmb</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="c"># 1 is upper, 0 is lower</span></pre>
<pre class='cython code score-0 '>          __pyx_t_24 = 1;
          __pyx_t_39 = 0;
          __pyx_v_dtq_mb = ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_Qmb.diminfo[0].strides)) - (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_Qmb.rcbuffer-&gt;pybuffer.buf, __pyx_t_39, __pyx_pybuffernd_Qmb.diminfo[0].strides)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1435</span>:                     <span class="n">dtq_mf</span> <span class="o">=</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_39 = __pyx_v_i;
          __pyx_t_24 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_39, __pyx_pybuffernd_s1s.diminfo[0].strides));
          __pyx_t_43 = 1;
          __pyx_t_44 = __pyx_v_i;
          __pyx_t_45 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_s1s.diminfo[0].strides));
          __pyx_t_46 = 0;
          __pyx_v_dtq_mf = ((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_43, __pyx_pybuffernd_qs_mf.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_45, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_46, __pyx_pybuffernd_qs_mf.diminfo[1].strides)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1436</span>:                     <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mf">100.00</span><span class="p">:</span> <span class="c"># if v_reg</span></pre>
<pre class='cython code score-0 '>          __pyx_t_38 = ((__pyx_v_v == 100.00) != 0);
          if (__pyx_t_38) {
/* … */
            goto __pyx_L18;
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1437</span>:                         <span class="n">v_</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">+</span> <span class="p">(</span><span class="n">dtq_mb</span> <span class="o">*</span> <span class="n">v1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dtq_mf</span> <span class="o">*</span> <span class="n">v2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">v_interaction</span> <span class="o">*</span> <span class="n">dtq_mb</span> <span class="o">*</span> <span class="n">dtq_mf</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            __pyx_v_v_ = (((__pyx_v_v0 + (__pyx_v_dtq_mb * __pyx_v_v1)) + (__pyx_v_dtq_mf * __pyx_v_v2)) + ((__pyx_v_v_interaction * __pyx_v_dtq_mb) * __pyx_v_dtq_mf));
</pre><pre class="cython line score-0">&#xA0;<span class="">1438</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1439</span>:                     <span class="k">else</span><span class="p">:</span> <span class="c"># if don&#39;t use v_reg:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1440</span>:                         <span class="c"># if v_qval == 0: # use both qmb and qmf</span></pre>
<pre class="cython line score-44" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1441</span>:                         <span class="n">qs</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">Qmb</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],:]</span> <span class="c"># Update for 1st trial</span></pre>
<pre class='cython code score-44 '>          /*else*/ {
            __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_w);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1441, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            __pyx_t_4 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_6, ((PyObject *)__pyx_v_Qmb));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1441, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((1.0 - __pyx_v_w));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1441, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            __pyx_t_44 = __pyx_v_i;
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_s1s.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1441, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1441, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_slice_);
            __pyx_t_5 = 0;
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_qs_mf), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1441, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
            __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_6, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1441, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_4, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1441, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
            <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_qs, __pyx_t_5);
            __pyx_t_5 = 0;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1442</span>:                         <span class="n">dtq</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-22 '>            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_qs, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1442, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_qs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1442, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            __pyx_t_4 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_5, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1442, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
            __pyx_t_47 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_4); if (unlikely((__pyx_t_47 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1442, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_v_dtq = __pyx_t_47;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1443</span>:                         <span class="n">v_</span> <span class="o">=</span> <span class="n">dtq</span> <span class="o">*</span> <span class="n">v</span></pre>
<pre class='cython code score-0 '>            __pyx_v_v_ = (__pyx_v_dtq * __pyx_v_v);
          }
          __pyx_L18:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1444</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1445</span>:                     <span class="c"># if z == 0.5: # if use z_reg:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1446</span>:                     <span class="k">if</span> <span class="n">w2</span> <span class="o">==</span> <span class="mf">100.00</span><span class="p">:</span> <span class="c"># if use z_reg</span></pre>
<pre class='cython code score-0 '>          __pyx_t_38 = ((__pyx_v_w2 == 100.00) != 0);
          if (__pyx_t_38) {
/* … */
            goto __pyx_L19;
          }
</pre><pre class="cython line score-0">&#xA0;<span class="">1447</span>:                         <span class="c"># Transform regression parameters so that &gt;0</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1448</span>:                         <span class="n">z_</span> <span class="o">=</span> <span class="n">z0</span> <span class="o">+</span> <span class="p">(</span><span class="n">dtq_mb</span> <span class="o">*</span> <span class="n">z1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dtq_mf</span> <span class="o">*</span> <span class="n">z2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">z_interaction</span> <span class="o">*</span> <span class="n">dtq_mb</span> <span class="o">*</span> <span class="n">dtq_mf</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            __pyx_v_z_ = (((__pyx_v_z0 + (__pyx_v_dtq_mb * __pyx_v_z1)) + (__pyx_v_dtq_mf * __pyx_v_z2)) + ((__pyx_v_z_interaction * __pyx_v_dtq_mb) * __pyx_v_dtq_mf));
</pre><pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1449</span>:                         <span class="n">sig</span> <span class="o">=</span> <span class="mf">1</span><span class="o">/</span><span class="p">(</span><span class="mf">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">z_</span><span class="p">))</span></pre>
<pre class='cython code score-42 '>            <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1449, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_exp);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1449, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
            __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((-__pyx_v_z_));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1449, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            __pyx_t_6 = NULL;
            if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
              __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
              if (likely(__pyx_t_6)) {
                PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
              }
            }
            __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_t_2) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_2);
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
            if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 1449, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_AddCObj</span>(__pyx_int_1, __pyx_t_4, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1449, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_int_1, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1449, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_t_47 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_4); if (unlikely((__pyx_t_47 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1449, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_v_sig = __pyx_t_47;
</pre><pre class="cython line score-0">&#xA0;<span class="">1450</span>:                     <span class="k">else</span><span class="p">:</span> <span class="c"># if don&#39;t use z_reg:</span></pre>
<pre class="cython line score-44" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1451</span>:                         <span class="n">qs</span> <span class="o">=</span> <span class="n">w2</span> <span class="o">*</span> <span class="n">Qmb</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">w2</span><span class="p">)</span> <span class="o">*</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],:]</span> <span class="c"># Update for 1st trial</span></pre>
<pre class='cython code score-44 '>          /*else*/ {
            __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_w2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1451, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            __pyx_t_5 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_4, ((PyObject *)__pyx_v_Qmb));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1451, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((1.0 - __pyx_v_w2));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1451, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
            __pyx_t_44 = __pyx_v_i;
            __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_s1s.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1451, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1451, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_2);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_slice_);
            __pyx_t_2 = 0;
            __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_qs_mf), __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1451, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            __pyx_t_6 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_4, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1451, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
            __pyx_t_2 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_5, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1451, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_qs, __pyx_t_2);
            __pyx_t_2 = 0;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1452</span>:                         <span class="n">dtq</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-22 '>            __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_qs, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1452, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_qs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1452, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            __pyx_t_5 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_2, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1452, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            __pyx_t_47 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_5); if (unlikely((__pyx_t_47 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1452, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_v_dtq = __pyx_t_47;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1453</span>:                         <span class="n">z_</span> <span class="o">=</span> <span class="n">dtq</span> <span class="o">*</span> <span class="n">z_scaler</span></pre>
<pre class='cython code score-0 '>            __pyx_v_z_ = (__pyx_v_dtq * __pyx_v_z_scaler);
</pre><pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1454</span>:                         <span class="n">sig</span> <span class="o">=</span> <span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">z_</span><span class="p">))</span></pre>
<pre class='cython code score-42 '>            <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1454, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_exp);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1454, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((-__pyx_v_z_));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1454, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            __pyx_t_4 = NULL;
            if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
              __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
              if (likely(__pyx_t_4)) {
                PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
              }
            }
            __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_6) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_6);
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 1454, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
            __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_AddCObj</span>(__pyx_int_1, __pyx_t_5, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1454, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_int_1, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1454, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
            __pyx_t_47 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_5); if (unlikely((__pyx_t_47 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1454, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_v_sig = __pyx_t_47;
          }
          __pyx_L19:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1455</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1456</span>:                     <span class="n">rt</span> <span class="o">=</span> <span class="n">x1s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_44 = __pyx_v_i;
          __pyx_v_rt = (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_x1s.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">1457</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1458</span>:                     <span class="c"># Modeling ndt</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1459</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1460</span>:                     <span class="c"># 1. Transition uncertainty (common/rare)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1461</span>:                     <span class="c"># variance for beta distribution of lower boundary</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1462</span>:                     <span class="c"># _, var1, _, _ = beta.stats(alphaf(beta_success[planets[0]]), betaf(beta_n[planets[0]], beta_success[planets[0]]), moments=&#39;mvsk&#39;)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1463</span>:                     <span class="c"># # variance for beta distribution of upper boundary</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1464</span>:                     <span class="c"># _, var2, _, _ = beta.stats(alphaf(beta_success[planets[1]]),</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1465</span>:                     <span class="c">#                            betaf(beta_n[planets[1]], beta_success[planets[1]]),</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1466</span>:                     <span class="c">#                            moments=&#39;mvsk&#39;)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1467</span>:                 <span class="c"># def alphaf(int k):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1468</span>:                     <span class="c">#     return k+1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1469</span>:                     <span class="c"># def betaf(int n, int k):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1470</span>:                     <span class="c">#     return n-k+1</span></pre>
<pre class="cython line score-71" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1471</span>:                     <span class="n">var1</span> <span class="o">=</span> <span class="n">var_beta</span><span class="p">(</span><span class="n">beta_success</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">0</span><span class="p">]]</span> <span class="o">+</span> <span class="mf">1</span><span class="p">,</span> <span class="n">beta_n</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">0</span><span class="p">]]</span> <span class="o">-</span> <span class="n">beta_success</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">0</span><span class="p">]]</span> <span class="o">+</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-71 '>          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_var_beta);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1471, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          __pyx_t_44 = 0;
          __pyx_t_40 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_planets.diminfo[0].strides));
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_beta_success), __pyx_t_40, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1471, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_AddObjC</span>(__pyx_t_6, __pyx_int_1, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1471, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_t_44 = 0;
          __pyx_t_40 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_planets.diminfo[0].strides));
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_beta_n), __pyx_t_40, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1471, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          __pyx_t_44 = 0;
          __pyx_t_40 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_planets.diminfo[0].strides));
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_beta_success), __pyx_t_40, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1471, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          __pyx_t_1 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_6, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1471, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_AddObjC</span>(__pyx_t_1, __pyx_int_1, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1471, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = NULL;
          __pyx_t_18 = 0;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
            __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
            if (likely(__pyx_t_1)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
              __pyx_t_18 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
            PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_t_4, __pyx_t_3};
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_18, 2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1471, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
            PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_t_4, __pyx_t_3};
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_18, 2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1471, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          } else
          #endif
          {
            __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1471, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            if (__pyx_t_1) {
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_1); __pyx_t_1 = NULL;
            }
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0+__pyx_t_18, __pyx_t_4);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1+__pyx_t_18, __pyx_t_3);
            __pyx_t_4 = 0;
            __pyx_t_3 = 0;
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1471, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_47 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_5); if (unlikely((__pyx_t_47 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1471, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_v_var1 = __pyx_t_47;
</pre><pre class="cython line score-71" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1472</span>:                     <span class="n">var2</span> <span class="o">=</span> <span class="n">var_beta</span><span class="p">(</span><span class="n">beta_success</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">1</span><span class="p">]]</span> <span class="o">+</span> <span class="mf">1</span><span class="p">,</span> <span class="n">beta_n</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">beta_success</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">1</span><span class="p">]]</span> <span class="o">+</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-71 '>          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_var_beta);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1472, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          __pyx_t_44 = 1;
          __pyx_t_40 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_planets.diminfo[0].strides));
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_beta_success), __pyx_t_40, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1472, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_AddObjC</span>(__pyx_t_6, __pyx_int_1, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1472, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_t_44 = 1;
          __pyx_t_40 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_planets.diminfo[0].strides));
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_beta_n), __pyx_t_40, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1472, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          __pyx_t_44 = 1;
          __pyx_t_40 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_planets.diminfo[0].strides));
          __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_beta_success), __pyx_t_40, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1472, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          __pyx_t_1 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_6, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1472, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_AddObjC</span>(__pyx_t_1, __pyx_int_1, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1472, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = NULL;
          __pyx_t_18 = 0;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
            __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
            if (likely(__pyx_t_1)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
              __pyx_t_18 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
            PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_t_3, __pyx_t_4};
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_18, 2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1472, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
            PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_t_3, __pyx_t_4};
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_18, 2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1472, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          } else
          #endif
          {
            __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1472, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            if (__pyx_t_1) {
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_1); __pyx_t_1 = NULL;
            }
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0+__pyx_t_18, __pyx_t_3);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1+__pyx_t_18, __pyx_t_4);
            __pyx_t_3 = 0;
            __pyx_t_4 = 0;
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1472, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_47 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_5); if (unlikely((__pyx_t_47 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1472, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_v_var2 = __pyx_t_47;
</pre><pre class="cython line score-0">&#xA0;<span class="">1473</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1474</span>:                     <span class="c"># 2. Subjective entropy</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1475</span>:                     <span class="c"># softmax -&gt; entropy of 2nd stage of planet 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1476</span>:                     <span class="c"># or, actually, SIGMOID because two probabilities are independent from each other?</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1477</span>:                     <span class="c"># entropy of two options in lower_boundary_planet stage 2:</span></pre>
<pre class="cython line score-62" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1478</span>:                     <span class="n">entropy1</span> <span class="o">=</span> <span class="n">scientropy</span><span class="p">(</span><span class="n">qs_mb</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="mf">0</span><span class="p">],</span> <span class="n">qs_mb</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span><span class="mf">1</span><span class="p">])</span></pre>
<pre class='cython code score-62 '>          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_scientropy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1478, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          __pyx_t_44 = 0;
          __pyx_t_46 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_planets.diminfo[0].strides));
          __pyx_t_45 = 0;
          __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_46, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_45, __pyx_pybuffernd_qs_mb.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1478, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          __pyx_t_44 = 0;
          __pyx_t_45 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_planets.diminfo[0].strides));
          __pyx_t_46 = 1;
          __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_45, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_46, __pyx_pybuffernd_qs_mb.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1478, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          __pyx_t_3 = NULL;
          __pyx_t_18 = 0;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
            __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
            if (likely(__pyx_t_3)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
              __pyx_t_18 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
            PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_6, __pyx_t_4};
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_18, 2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1478, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
            PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_6, __pyx_t_4};
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_18, 2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1478, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          } else
          #endif
          {
            __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1478, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            if (__pyx_t_3) {
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_3); __pyx_t_3 = NULL;
            }
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0+__pyx_t_18, __pyx_t_6);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1+__pyx_t_18, __pyx_t_4);
            __pyx_t_6 = 0;
            __pyx_t_4 = 0;
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1478, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_47 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_5); if (unlikely((__pyx_t_47 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1478, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_v_entropy1 = __pyx_t_47;
</pre><pre class="cython line score-0">&#xA0;<span class="">1479</span>:                     <span class="c"># entropy of two options in upper_boundary_planet stage 2:</span></pre>
<pre class="cython line score-62" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1480</span>:                     <span class="n">entropy2</span> <span class="o">=</span> <span class="n">scientropy</span><span class="p">(</span><span class="n">qs_mb</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="mf">0</span><span class="p">],</span> <span class="n">qs_mb</span><span class="p">[</span><span class="n">planets</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span><span class="mf">1</span><span class="p">])</span></pre>
<pre class='cython code score-62 '>          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_scientropy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1480, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          __pyx_t_44 = 1;
          __pyx_t_46 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_planets.diminfo[0].strides));
          __pyx_t_45 = 0;
          __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_46, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_45, __pyx_pybuffernd_qs_mb.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1480, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          __pyx_t_44 = 1;
          __pyx_t_45 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_planets.diminfo[0].strides));
          __pyx_t_46 = 1;
          __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_45, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_46, __pyx_pybuffernd_qs_mb.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1480, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          __pyx_t_6 = NULL;
          __pyx_t_18 = 0;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
            __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
            if (likely(__pyx_t_6)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
              __pyx_t_18 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
            PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_1, __pyx_t_4};
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_18, 2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1480, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
            PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_1, __pyx_t_4};
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_18, 2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1480, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          } else
          #endif
          {
            __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1480, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            if (__pyx_t_6) {
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_6); __pyx_t_6 = NULL;
            }
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0+__pyx_t_18, __pyx_t_1);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1+__pyx_t_18, __pyx_t_4);
            __pyx_t_1 = 0;
            __pyx_t_4 = 0;
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1480, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_47 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_5); if (unlikely((__pyx_t_47 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1480, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_v_entropy2 = __pyx_t_47;
</pre><pre class="cython line score-0">&#xA0;<span class="">1481</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1482</span>:                     <span class="c"># 3. add encounterances (set) : beta_ndt3</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1483</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1484</span>:                     <span class="c"># sum together</span></pre>
<pre class="cython line score-72" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1485</span>:                     <span class="n">t_</span> <span class="o">=</span> <span class="n">beta_ndt</span> <span class="o">*</span> <span class="p">(</span><span class="n">var2</span><span class="o">+</span><span class="n">var1</span><span class="p">)</span> <span class="o">+</span> <span class="n">beta_ndt2</span> <span class="o">*</span> <span class="p">(</span><span class="n">entropy1</span> <span class="o">+</span> <span class="n">entropy2</span><span class="p">)</span> <span class="o">+</span> <span class="n">beta_ndt3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ndt_counter_set</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mf">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">t</span></pre>
<pre class='cython code score-72 '>          __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(((__pyx_v_beta_ndt * (__pyx_v_var2 + __pyx_v_var1)) + (__pyx_v_beta_ndt2 * (__pyx_v_entropy1 + __pyx_v_entropy2))));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1485, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_beta_ndt3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1485, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1485, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_log);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1485, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_44 = __pyx_v_i;
          __pyx_t_46 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_s1s.diminfo[0].strides));
          __pyx_t_45 = 0;
          __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer.buf, __pyx_t_46, __pyx_pybuffernd_ndt_counter_set.diminfo[0].strides, __pyx_t_45, __pyx_pybuffernd_ndt_counter_set.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1485, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          __pyx_t_6 = NULL;
          if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
            __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
            if (likely(__pyx_t_6)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
            }
          }
          __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_6, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 1485, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_2, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1485, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_5, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1485, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_t);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1485, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_3, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1485, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_47 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_5); if (unlikely((__pyx_t_47 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1485, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_v_t_ = __pyx_t_47;
</pre><pre class="cython line score-0">&#xA0;<span class="">1486</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1487</span>:                     <span class="c"># t_ = ((np.log(ndt_counter_ind[planets[0],0]) + np.log(ndt_counter_ind[planets[1],0]))/2)*beta_ndt + \</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1488</span>:                     <span class="c">#      np.log(ndt_counter_set[s1s[i],0])*beta_ndt2 + \</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1489</span>:                     <span class="c">#      t</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1490</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1491</span>:                     <span class="n">p</span> <span class="o">=</span> <span class="n">full_pdf</span><span class="p">(</span><span class="n">rt</span><span class="p">,</span> <span class="n">v_</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">sig</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>          __pyx_t_48.__pyx_n = 4;
          __pyx_t_48.n_st = __pyx_v_n_st;
          __pyx_t_48.n_sz = __pyx_v_n_sz;
          __pyx_t_48.use_adaptive = __pyx_v_use_adaptive;
          __pyx_t_48.simps_err = __pyx_v_simps_err;
          __pyx_t_47 = __pyx_f_4wfpt_full_pdf(__pyx_v_rt, __pyx_v_v_, __pyx_v_sv, __pyx_v_a, (__pyx_v_sig * __pyx_v_a), __pyx_v_sz, __pyx_v_t_, __pyx_v_st, __pyx_v_err, 0, &amp;__pyx_t_48); 
          __pyx_v_p = __pyx_t_47;
</pre><pre class="cython line score-0">&#xA0;<span class="">1492</span>:                                  <span class="n">sz</span><span class="p">,</span> <span class="n">t_</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">n_st</span><span class="p">,</span> <span class="n">n_sz</span><span class="p">,</span> <span class="n">use_adaptive</span><span class="p">,</span> <span class="n">simps_err</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1493</span>:                     <span class="c"># If one probability = 0, the log sum will be -Inf</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1494</span>:                     <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">p_outlier</span><span class="p">)</span> <span class="o">+</span> <span class="n">wp_outlier</span></pre>
<pre class='cython code score-0 '>          __pyx_v_p = ((__pyx_v_p * (1.0 - __pyx_v_p_outlier)) + __pyx_v_wp_outlier);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1495</span>:                     <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          __pyx_t_38 = ((__pyx_v_p == 0.0) != 0);
          if (__pyx_t_38) {
/* … */
          }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1496</span>:                         <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-12 '>            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
            <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1496, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1496, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_t_5 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1496, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
            __pyx_r = __pyx_t_5;
            __pyx_t_5 = 0;
            goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1497</span>:                     <span class="n">sum_logp</span> <span class="o">+=</span> <span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_v_sum_logp = (__pyx_v_sum_logp + log(__pyx_v_p));
</pre><pre class="cython line score-0">&#xA0;<span class="">1498</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1499</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1500</span>:                     <span class="c"># # # 2nd stage</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1501</span>:                     <span class="k">if</span> <span class="n">two_stage</span> <span class="o">==</span> <span class="mf">1.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          __pyx_t_38 = ((__pyx_v_two_stage == 1.00) != 0);
          if (__pyx_t_38) {
/* … */
          }
</pre><pre class="cython line score-0">&#xA0;<span class="">1502</span>:                         <span class="c"># Updating encountraces</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1503</span>:                         <span class="n">ndt_counter_set</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>            __pyx_t_44 = __pyx_v_i;
            __pyx_t_45 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_s1s.diminfo[0].strides));
            __pyx_t_46 = 0;
            *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_ndt_counter_set.rcbuffer-&gt;pybuffer.buf, __pyx_t_45, __pyx_pybuffernd_ndt_counter_set.diminfo[0].strides, __pyx_t_46, __pyx_pybuffernd_ndt_counter_set.diminfo[1].strides) += 1.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1504</span>:                         <span class="n">ndt_counter_ind</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>            __pyx_t_44 = __pyx_v_i;
            __pyx_t_46 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_s2s.diminfo[0].strides));
            __pyx_t_45 = 0;
            *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_ndt_counter_ind.rcbuffer-&gt;pybuffer.buf, __pyx_t_46, __pyx_pybuffernd_ndt_counter_ind.diminfo[0].strides, __pyx_t_45, __pyx_pybuffernd_ndt_counter_ind.diminfo[1].strides) += 1.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1505</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1506</span>:                         <span class="c"># Updating common/rare transition uncertainty (beta parameters)</span></pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1507</span>:                         <span class="n">chosen_state</span> <span class="o">=</span> <span class="n">planets</span><span class="p">[</span><span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span></pre>
<pre class='cython code score-3 '>            __pyx_t_44 = __pyx_v_i;
            __pyx_t_45 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_responses1.diminfo[0].strides));
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_planets.rcbuffer-&gt;pybuffer.buf, __pyx_t_45, __pyx_pybuffernd_planets.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1507, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_chosen_state, __pyx_t_5);
            __pyx_t_5 = 0;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1508</span>:                         <span class="n">beta_n</span><span class="p">[</span><span class="n">chosen_state</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-13 '>            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_chosen_state);
            __pyx_t_5 = __pyx_v_chosen_state;
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_beta_n), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1508, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_AddObjC</span>(__pyx_t_1, __pyx_int_1, 1, 1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1508, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
            if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_beta_n), __pyx_t_5, __pyx_t_3) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1508, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1509</span>:                         <span class="k">if</span> <span class="n">chosen_state</span> <span class="o">==</span> <span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span></pre>
<pre class='cython code score-11 '>            __pyx_t_44 = __pyx_v_i;
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_s2s.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1509, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            __pyx_t_3 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_chosen_state, __pyx_t_5, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1509, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_t_38 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_3); if (unlikely(__pyx_t_38 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1509, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            if (__pyx_t_38) {
/* … */
            }
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1510</span>:                             <span class="n">beta_success</span><span class="p">[</span><span class="n">chosen_state</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-13 '>              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_chosen_state);
              __pyx_t_3 = __pyx_v_chosen_state;
              __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_beta_success), __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1510, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
              __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_AddObjC</span>(__pyx_t_5, __pyx_int_1, 1, 1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1510, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
              if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_beta_success), __pyx_t_3, __pyx_t_1) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1510, __pyx_L1_error)</span>
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1511</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1512</span>:                         <span class="n">v_2_</span> <span class="o">=</span> <span class="n">v</span> <span class="k">if</span> <span class="n">v_2</span><span class="o">==</span><span class="mf">100.00</span> <span class="k">else</span> <span class="n">v_2</span></pre>
<pre class='cython code score-0 '>            if (((__pyx_v_v_2 == 100.00) != 0)) {
              __pyx_t_47 = __pyx_v_v;
            } else {
              __pyx_t_47 = __pyx_v_v_2;
            }
            __pyx_v_v_2_ = __pyx_t_47;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1513</span>:                         <span class="n">a_2_</span> <span class="o">=</span> <span class="n">a</span> <span class="k">if</span> <span class="n">a_2</span> <span class="o">==</span> <span class="mf">100.00</span> <span class="k">else</span> <span class="n">a_2</span></pre>
<pre class='cython code score-0 '>            if (((__pyx_v_a_2 == 100.00) != 0)) {
              __pyx_t_47 = __pyx_v_a;
            } else {
              __pyx_t_47 = __pyx_v_a_2;
            }
            __pyx_v_a_2_ = __pyx_t_47;
</pre><pre class="cython line score-0">&#xA0;<span class="">1514</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1515</span>:                         <span class="c"># CONFIGURE Z_2 USING Z_SIGMA AND V HERE!!!</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1516</span>:                         <span class="k">if</span> <span class="n">z_sigma</span> <span class="o">==</span><span class="mf">100.00</span><span class="p">:</span> <span class="c"># if don&#39;t use 1st-stage dependent drift rate</span></pre>
<pre class='cython code score-0 '>            __pyx_t_38 = ((__pyx_v_z_sigma == 100.00) != 0);
            if (__pyx_t_38) {
/* … */
              goto __pyx_L23;
            }
</pre><pre class="cython line score-0">&#xA0;<span class="">1517</span>:                             <span class="c"># z_2_ = z if z_2 == 0.5 else z_2</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1518</span>:                             <span class="n">z_2_</span> <span class="o">=</span> <span class="n">z_2</span></pre>
<pre class='cython code score-0 '>              __pyx_v_z_2_ = __pyx_v_z_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">1519</span>:                         <span class="k">else</span><span class="p">:</span> <span class="c"># if use 1st-stage dependent dr</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1520</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1521</span>:                             <span class="k">if</span> <span class="n">z_sigma2</span> <span class="o">==</span> <span class="mf">100.00</span><span class="p">:</span> <span class="c"># don&#39;t use baseline</span></pre>
<pre class='cython code score-0 '>            /*else*/ {
              __pyx_t_38 = ((__pyx_v_z_sigma2 == 100.00) != 0);
              if (__pyx_t_38) {
/* … */
                goto __pyx_L24;
              }
</pre><pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1522</span>:                                 <span class="n">z_2_</span> <span class="o">=</span> <span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">v_</span><span class="o">*</span><span class="n">z_sigma</span><span class="p">))</span></pre>
<pre class='cython code score-42 '>                <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1522, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_exp);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1522, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(((-__pyx_v_v_) * __pyx_v_z_sigma));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1522, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                __pyx_t_2 = NULL;
                if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
                  __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
                  if (likely(__pyx_t_2)) {
                    PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
                  }
                }
                __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_2, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_1);
                <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 1522, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
                __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_AddCObj</span>(__pyx_int_1, __pyx_t_3, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1522, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
                __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_int_1, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1522, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
                __pyx_t_47 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_47 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1522, __pyx_L1_error)</span>
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
                __pyx_v_z_2_ = __pyx_t_47;
</pre><pre class="cython line score-0">&#xA0;<span class="">1523</span>:                             <span class="k">else</span><span class="p">:</span> <span class="c"># use baseline</span></pre>
<pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1524</span>:                                 <span class="n">z_2_</span> <span class="o">=</span> <span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">v_</span> <span class="o">*</span> <span class="n">z_sigma</span> <span class="o">+</span> <span class="n">z_sigma2</span><span class="p">)))</span></pre>
<pre class='cython code score-42 '>              /*else*/ {
                <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1524, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
                __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_exp);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1524, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
                __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>((-((__pyx_v_v_ * __pyx_v_z_sigma) + __pyx_v_z_sigma2)));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1524, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
                __pyx_t_2 = NULL;
                if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
                  __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
                  if (likely(__pyx_t_2)) {
                    PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
                    <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
                  }
                }
                __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_5);
                <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
                if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 1524, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_AddCObj</span>(__pyx_int_1, __pyx_t_3, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1524, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
                __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_int_1, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1524, __pyx_L1_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                __pyx_t_47 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_47 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1524, __pyx_L1_error)</span>
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
                __pyx_v_z_2_ = __pyx_t_47;
              }
              __pyx_L24:;
            }
            __pyx_L23:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1525</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1526</span>:                         <span class="n">t_2_</span> <span class="o">=</span> <span class="n">t</span> <span class="k">if</span> <span class="n">t_2</span> <span class="o">==</span> <span class="mf">100.00</span> <span class="k">else</span> <span class="n">t_2</span></pre>
<pre class='cython code score-0 '>            if (((__pyx_v_t_2 == 100.00) != 0)) {
              __pyx_t_47 = __pyx_v_t;
            } else {
              __pyx_t_47 = __pyx_v_t_2;
            }
            __pyx_v_t_2_ = __pyx_t_47;
</pre><pre class="cython line score-0">&#xA0;<span class="">1527</span>: </pre>
<pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1528</span>:                         <span class="n">qs</span> <span class="o">=</span> <span class="n">qs_mb</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],:]</span></pre>
<pre class='cython code score-14 '>            __pyx_t_44 = __pyx_v_i;
            __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_s2s.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1528, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1528, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_3);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_slice_);
            __pyx_t_3 = 0;
            __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_qs_mb), __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1528, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
            <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_qs, __pyx_t_3);
            __pyx_t_3 = 0;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1529</span>:                         <span class="n">dtq</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-22 '>            __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_qs, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1529, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_qs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1529, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            __pyx_t_5 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_3, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1529, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
            __pyx_t_47 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_5); if (unlikely((__pyx_t_47 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1529, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_v_dtq = __pyx_t_47;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1530</span>:                         <span class="n">rt</span> <span class="o">=</span> <span class="n">x2s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            __pyx_t_44 = __pyx_v_i;
            __pyx_v_rt = (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_x2s.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">1531</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1532</span>:                         <span class="n">p</span> <span class="o">=</span> <span class="n">full_pdf</span><span class="p">(</span><span class="n">rt</span><span class="p">,</span> <span class="p">(</span><span class="n">dtq</span> <span class="o">*</span> <span class="n">v_2_</span><span class="p">),</span> <span class="n">sv</span><span class="p">,</span> <span class="n">a_2_</span><span class="p">,</span> <span class="n">z_2_</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">t_2_</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">n_st</span><span class="p">,</span> <span class="n">n_sz</span><span class="p">,</span> <span class="n">use_adaptive</span><span class="p">,</span> <span class="n">simps_err</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            __pyx_t_48.__pyx_n = 4;
            __pyx_t_48.n_st = __pyx_v_n_st;
            __pyx_t_48.n_sz = __pyx_v_n_sz;
            __pyx_t_48.use_adaptive = __pyx_v_use_adaptive;
            __pyx_t_48.simps_err = __pyx_v_simps_err;
            __pyx_t_47 = __pyx_f_4wfpt_full_pdf(__pyx_v_rt, (__pyx_v_dtq * __pyx_v_v_2_), __pyx_v_sv, __pyx_v_a_2_, __pyx_v_z_2_, __pyx_v_sz, __pyx_v_t_2_, __pyx_v_st, __pyx_v_err, 0, &amp;__pyx_t_48); 
            __pyx_v_p = __pyx_t_47;
</pre><pre class="cython line score-0">&#xA0;<span class="">1533</span>:                         <span class="c"># If one probability = 0, the log sum will be -Inf</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1534</span>:                         <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">p_outlier</span><span class="p">)</span> <span class="o">+</span> <span class="n">wp_outlier</span></pre>
<pre class='cython code score-0 '>            __pyx_v_p = ((__pyx_v_p * (1.0 - __pyx_v_p_outlier)) + __pyx_v_wp_outlier);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1535</span>:                         <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>            __pyx_t_38 = ((__pyx_v_p == 0.0) != 0);
            if (__pyx_t_38) {
/* … */
            }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1536</span>:                             <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-12 '>              <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
              <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1536, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
              __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1536, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
              __pyx_t_5 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1536, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
              __pyx_r = __pyx_t_5;
              __pyx_t_5 = 0;
              goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1537</span>:                         <span class="n">sum_logp</span> <span class="o">+=</span> <span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            __pyx_v_sum_logp = (__pyx_v_sum_logp + log(__pyx_v_p));
</pre><pre class="cython line score-0">&#xA0;<span class="">1538</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1539</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1540</span>:             <span class="c"># update Q values, regardless of pdf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1541</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1542</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1543</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1544</span>:             <span class="c"># just update 1st-stage MF values if estimating</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1545</span>:             <span class="n">dtQ1</span> <span class="o">=</span> <span class="n">qs_mb</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">responses2</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">-</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="c"># delta stage 1</span></pre>
<pre class='cython code score-0 '>      __pyx_t_44 = __pyx_v_i;
      __pyx_t_45 = __pyx_v_i;
      __pyx_t_46 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_s2s.diminfo[0].strides));
      __pyx_t_39 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.buf, __pyx_t_45, __pyx_pybuffernd_responses2.diminfo[0].strides));
      __pyx_t_43 = __pyx_v_i;
      __pyx_t_24 = __pyx_v_i;
      __pyx_t_49 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_s1s.diminfo[0].strides));
      __pyx_t_50 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_responses1.diminfo[0].strides));
      __pyx_v_dtQ1 = ((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_46, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_39, __pyx_pybuffernd_qs_mb.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_49, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_50, __pyx_pybuffernd_qs_mf.diminfo[1].strides)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1546</span>:             <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">alfa</span> <span class="o">*</span> <span class="n">dtQ1</span> <span class="c"># delta update for qmf</span></pre>
<pre class='cython code score-0 '>      __pyx_t_24 = __pyx_v_i;
      __pyx_t_43 = __pyx_v_i;
      __pyx_t_50 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_s1s.diminfo[0].strides));
      __pyx_t_49 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_responses1.diminfo[0].strides));
      __pyx_t_45 = __pyx_v_i;
      __pyx_t_44 = __pyx_v_i;
      __pyx_t_39 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_45, __pyx_pybuffernd_s1s.diminfo[0].strides));
      __pyx_t_46 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_responses1.diminfo[0].strides));
      *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_39, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_46, __pyx_pybuffernd_qs_mf.diminfo[1].strides) = ((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_50, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_49, __pyx_pybuffernd_qs_mf.diminfo[1].strides)) + (__pyx_v_alfa * __pyx_v_dtQ1));
</pre><pre class="cython line score-0">&#xA0;<span class="">1547</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1548</span>:             <span class="n">dtQ2</span> <span class="o">=</span> <span class="n">feedbacks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs_mb</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">responses2</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="c"># delta stage 2</span></pre>
<pre class='cython code score-0 '>      __pyx_t_43 = __pyx_v_i;
      __pyx_t_24 = __pyx_v_i;
      __pyx_t_49 = __pyx_v_i;
      __pyx_t_50 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_s2s.diminfo[0].strides));
      __pyx_t_44 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.buf, __pyx_t_49, __pyx_pybuffernd_responses2.diminfo[0].strides));
      __pyx_v_dtQ2 = ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_feedbacks.diminfo[0].strides)) - (*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_50, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_44, __pyx_pybuffernd_qs_mb.diminfo[1].strides)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1549</span>:             <span class="n">qs_mb</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses2</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">qs_mb</span><span class="p">[</span><span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">responses2</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">alfa2</span> <span class="o">*</span> <span class="n">dtQ2</span> <span class="c"># delta update for qmb</span></pre>
<pre class='cython code score-0 '>      __pyx_t_49 = __pyx_v_i;
      __pyx_t_24 = __pyx_v_i;
      __pyx_t_44 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_49, __pyx_pybuffernd_s2s.diminfo[0].strides));
      __pyx_t_50 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_responses2.diminfo[0].strides));
      __pyx_t_43 = __pyx_v_i;
      __pyx_t_45 = __pyx_v_i;
      __pyx_t_46 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_s2s.diminfo[0].strides));
      __pyx_t_39 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.buf, __pyx_t_45, __pyx_pybuffernd_responses2.diminfo[0].strides));
      *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_46, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_39, __pyx_pybuffernd_qs_mb.diminfo[1].strides) = ((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_50, __pyx_pybuffernd_qs_mb.diminfo[1].strides)) + (__pyx_v_alfa2 * __pyx_v_dtQ2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1550</span>:             <span class="k">if</span> <span class="n">lambda_</span> <span class="o">!=</span> <span class="mf">100.00</span><span class="p">:</span> <span class="c"># if using eligibility trace</span></pre>
<pre class='cython code score-0 '>      __pyx_t_38 = ((__pyx_v_lambda_ != 100.00) != 0);
      if (__pyx_t_38) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1551</span>:                 <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">qs_mf</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">lambda__</span> <span class="o">*</span> <span class="n">dtQ2</span> <span class="c"># eligibility trace</span></pre>
<pre class='cython code score-0 '>        __pyx_t_24 = __pyx_v_i;
        __pyx_t_49 = __pyx_v_i;
        __pyx_t_50 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_s1s.diminfo[0].strides));
        __pyx_t_44 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_49, __pyx_pybuffernd_responses1.diminfo[0].strides));
        __pyx_t_45 = __pyx_v_i;
        __pyx_t_43 = __pyx_v_i;
        __pyx_t_39 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_45, __pyx_pybuffernd_s1s.diminfo[0].strides));
        __pyx_t_46 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_responses1.diminfo[0].strides));
        *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_39, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_46, __pyx_pybuffernd_qs_mf.diminfo[1].strides) = ((*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_50, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_44, __pyx_pybuffernd_qs_mf.diminfo[1].strides)) + (__pyx_v_lambda__ * __pyx_v_dtQ2));
</pre><pre class="cython line score-0">&#xA0;<span class="">1552</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1553</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1554</span>:             <span class="c"># memory decay for unexperienced options in this trial</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1555</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1556</span>:             <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstates</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>      __pyx_t_18 = __pyx_v_nstates;
      __pyx_t_51 = __pyx_t_18;
      for (__pyx_t_40 = 0; __pyx_t_40 &lt; __pyx_t_51; __pyx_t_40+=1) {
        __pyx_v_s_ = __pyx_t_40;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1557</span>:                 <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">2</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>        for (__pyx_t_52 = 0; __pyx_t_52 &lt; 2; __pyx_t_52+=1) {
          __pyx_v_a_ = __pyx_t_52;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1558</span>:                     <span class="k">if</span> <span class="p">(</span><span class="n">s_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">s2s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">a_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">responses2</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>          __pyx_t_49 = __pyx_v_i;
          __pyx_t_20 = ((__pyx_v_s_ != (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s2s.rcbuffer-&gt;pybuffer.buf, __pyx_t_49, __pyx_pybuffernd_s2s.diminfo[0].strides))) != 0);
          if (!__pyx_t_20) {
          } else {
            __pyx_t_38 = __pyx_t_20;
            goto __pyx_L32_bool_binop_done;
          }
          __pyx_t_49 = __pyx_v_i;
          __pyx_t_20 = ((__pyx_v_a_ != (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses2.rcbuffer-&gt;pybuffer.buf, __pyx_t_49, __pyx_pybuffernd_responses2.diminfo[0].strides))) != 0);
          __pyx_t_38 = __pyx_t_20;
          __pyx_L32_bool_binop_done:;
          if (__pyx_t_38) {
/* … */
          }
        }
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1559</span>:                         <span class="c"># qs_mb[s_, a_] = qs_mb[s_, a_] * (1-gamma)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1560</span>:                         <span class="n">qs_mb</span><span class="p">[</span><span class="n">s_</span><span class="p">,</span><span class="n">a_</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">gamma__</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            __pyx_t_49 = __pyx_v_s_;
            __pyx_t_24 = __pyx_v_a_;
            *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mb.rcbuffer-&gt;pybuffer.buf, __pyx_t_49, __pyx_pybuffernd_qs_mb.diminfo[0].strides, __pyx_t_24, __pyx_pybuffernd_qs_mb.diminfo[1].strides) *= (1.0 - __pyx_v_gamma__);
</pre><pre class="cython line score-0">&#xA0;<span class="">1561</span>: </pre>
<pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1562</span>:             <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">comb</span><span class="p">(</span><span class="n">nstates</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="n">exact</span><span class="o">=</span><span class="bp">True</span><span class="p">)):</span></pre>
<pre class='cython code score-32 '>      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_comb);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1562, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_nstates);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1562, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1562, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_int_2);
      __pyx_t_1 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1562, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_exact, Py_True) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1562, __pyx_L1_error)</span>
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_3, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1562, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_40 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_40 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1562, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_52 = __pyx_t_40;
      for (__pyx_t_53 = 0; __pyx_t_53 &lt; __pyx_t_52; __pyx_t_53+=1) {
        __pyx_v_s_ = __pyx_t_53;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1563</span>:                 <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">2</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>        for (__pyx_t_54 = 0; __pyx_t_54 &lt; 2; __pyx_t_54+=1) {
          __pyx_v_a_ = __pyx_t_54;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1564</span>:                     <span class="k">if</span> <span class="p">(</span><span class="n">s_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">a_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">responses1</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>          __pyx_t_24 = __pyx_v_i;
          __pyx_t_20 = ((__pyx_v_s_ != (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_s1s.diminfo[0].strides))) != 0);
          if (!__pyx_t_20) {
          } else {
            __pyx_t_38 = __pyx_t_20;
            goto __pyx_L39_bool_binop_done;
          }
          __pyx_t_24 = __pyx_v_i;
          __pyx_t_20 = ((__pyx_v_a_ != (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses1.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_responses1.diminfo[0].strides))) != 0);
          __pyx_t_38 = __pyx_t_20;
          __pyx_L39_bool_binop_done:;
          if (__pyx_t_38) {
/* … */
          }
        }
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1565</span>:                         <span class="n">qs_mf</span><span class="p">[</span><span class="n">s_</span><span class="p">,</span><span class="n">a_</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">gamma_</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            __pyx_t_24 = __pyx_v_s_;
            __pyx_t_49 = __pyx_v_a_;
            *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_qs_mf.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_qs_mf.diminfo[0].strides, __pyx_t_49, __pyx_pybuffernd_qs_mf.diminfo[1].strides) *= (1.0 - __pyx_v_gamma_);
</pre><pre class="cython line score-0">&#xA0;<span class="">1566</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1567</span>:             <span class="n">counter</span><span class="p">[</span><span class="n">s1s</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>      __pyx_t_49 = __pyx_v_i;
      __pyx_t_24 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_s1s.rcbuffer-&gt;pybuffer.buf, __pyx_t_49, __pyx_pybuffernd_s1s.diminfo[0].strides));
      *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_counter.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_counter.diminfo[0].strides) += 1.0;
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">1568</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1569</span>:     <span class="k">return</span> <span class="n">sum_logp</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_sum_logp);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1569, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1570</span>: <span class="c"># # JY added on 2022-01-03 for simultaneous regression on two-step tasks</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1571</span>: <span class="c"># def wiener_like_rlddm_2step_thinkact(np.ndarray[double, ndim=1] x1, # 1st-stage RT                      </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1572</span>: <span class="c">#                       np.ndarray[double, ndim=1] x2, # 2nd-stage RT                     </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1573</span>: <span class="c">#                       np.ndarray[long, ndim=1] isleft1, # whether left response 1st-stage, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1574</span>: <span class="c">#                       np.ndarray[long, ndim=1] isleft2, # whether left response 2nd-stage  </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1575</span>: <span class="c">#                       np.ndarray[long,ndim=1] s1, # 1st-stage state</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1576</span>: <span class="c">#                       np.ndarray[long,ndim=1] s2, # 2nd-stage state</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1577</span>: <span class="c">#                       np.ndarray[long, ndim=1] response1,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1578</span>: <span class="c">#                       np.ndarray[long, ndim=1] response2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1579</span>: <span class="c">#                       np.ndarray[double, ndim=1] feedback,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1580</span>: <span class="c">#                       np.ndarray[long, ndim=1] split_by,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1581</span>: <span class="c">#                       double q, double alpha, double pos_alpha, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1582</span>: <span class="c">#                       double gamma, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1583</span>: <span class="c">#                       double lambda_, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1584</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1585</span>: <span class="c">#                       double v0, double v1, double v2, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1586</span>: <span class="c">#                       double v, # don&#39;t use second stage</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1587</span>: <span class="c">#                       # double sv, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1588</span>: <span class="c">#                       double a, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1589</span>: <span class="c">#                       double z0, double z1, double z2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1590</span>: <span class="c">#                       double z, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1591</span>: <span class="c">#                       # double sz, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1592</span>: <span class="c">#                       double t,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1593</span>: <span class="c">#                       int nstates,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1594</span>: <span class="c">#                       double qval,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1595</span>: <span class="c">#                       double two_stage,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1596</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1597</span>: <span class="c">#                       double a_2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1598</span>: <span class="c">#                       double z_2, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1599</span>: <span class="c">#                       double t_2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1600</span>: <span class="c">#                       double v_2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1601</span>: <span class="c">#                       double alpha2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1602</span>: <span class="c">#                       double w,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1603</span>: <span class="c">#                       # double st, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1604</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1605</span>: <span class="c">#                       double err, int n_st=10, int n_sz=10, bint use_adaptive=1, double simps_err=1e-8,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1606</span>: <span class="c">#                       double p_outlier=0, double w_outlier=0,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1607</span>: <span class="c">#                       ):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1608</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1609</span>: <span class="c">#     if a==100.00: # if fixed threshold</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1610</span>: <span class="c">#         a = 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1611</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1612</span>: <span class="c">#     cdef double sz = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1613</span>: <span class="c">#     cdef double st = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1614</span>: <span class="c">#     cdef double sv = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1615</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1616</span>: <span class="c">#     cdef Py_ssize_t size = x1.shape[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1617</span>: <span class="c">#     cdef Py_ssize_t i, j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1618</span>: <span class="c">#     cdef Py_ssize_t s_size</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1619</span>: <span class="c">#     cdef int s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1620</span>: <span class="c">#     cdef double p</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1621</span>: <span class="c">#     cdef double sum_logp = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1622</span>: <span class="c">#     cdef double wp_outlier = w_outlier * p_outlier</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1623</span>: <span class="c">#     cdef double alfa</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1624</span>: <span class="c">#     cdef double pos_alfa</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1625</span>: <span class="c">#     cdef double alfa2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1626</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1627</span>: <span class="c">#     cdef double gamma_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1628</span>: <span class="c">#     cdef double lambda__</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1629</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1630</span>: <span class="c">#     # cdef np.ndarray[double, ndim=1] qs = np.array([q, q])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1631</span>: <span class="c">#     cdef np.ndarray[double, ndim=2] qs_mf = np.ones((comb(nstates,2,exact=True),2))*q # first-stage MF Q-values</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1632</span>: <span class="c">#     cdef np.ndarray[double, ndim=2] qs_mb = np.ones((nstates, 2))*q # second-stage Q-values</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1633</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1634</span>: <span class="c">#     cdef double dtQ1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1635</span>: <span class="c">#     cdef double dtQ2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1636</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1637</span>: <span class="c">#     cdef double dtq_mb</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1638</span>: <span class="c">#     cdef double dtq_mf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1639</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1640</span>: <span class="c">#     cdef long s_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1641</span>: <span class="c">#     cdef long a_ </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1642</span>: <span class="c">#     cdef double v_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1643</span>: <span class="c">#     cdef double z_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1644</span>: <span class="c">#     cdef double sig</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1645</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1646</span>: <span class="c">#     cdef np.ndarray[double, ndim=1] x1s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1647</span>: <span class="c">#     cdef np.ndarray[double, ndim=1] x2s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1648</span>: <span class="c">#     cdef np.ndarray[double, ndim=1] feedbacks</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1649</span>: <span class="c">#     cdef np.ndarray[long, ndim=1] responses1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1650</span>: <span class="c">#     cdef np.ndarray[long, ndim=1] responses2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1651</span>: <span class="c">#     cdef np.ndarray[long, ndim=1] unique = np.unique(split_by)    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1652</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1653</span>: <span class="c">#     cdef np.ndarray[long, ndim=1] s1s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1654</span>: <span class="c">#     cdef np.ndarray[long, ndim=1] s2s   </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1655</span>: <span class="c">#     cdef np.ndarray[long, ndim=1] isleft1s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1656</span>: <span class="c">#     cdef np.ndarray[long, ndim=1] isleft2s        </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1657</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1658</span>: <span class="c">#     # Added by Jungsun Yoo on 2021-11-27 for two-step tasks</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1659</span>: <span class="c">#     # parameters added for two-step</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1660</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1661</span>: <span class="c">#     cdef np.ndarray[long, ndim=1] planets</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1662</span>: <span class="c">#     cdef np.ndarray[double, ndim=1] counter = np.zeros(comb(nstates,2,exact=True))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1663</span>: <span class="c">#     cdef np.ndarray[double, ndim=1] Qmb</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1664</span>: <span class="c">#     cdef double dtq</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1665</span>: <span class="c">#     cdef double rt</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1666</span>: <span class="c">#     cdef np.ndarray[double, ndim=2] Tm = np.array([[0.7, 0.3], [0.3, 0.7]]) # transition matrix</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1667</span>: <span class="c">#     cdef np.ndarray[long, ndim=2] state_combinations = np.array(list(itertools.combinations(np.arange(nstates),2)))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1668</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1669</span>: <span class="c">#     float delta_t = 0.001, # timesteps fraction of seconds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1670</span>: <span class="c">#     # cdef float thinking_t</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1671</span>: <span class="c">#     cdef float t_particle</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1672</span>: <span class="c">#     cdef float max_t    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1673</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1674</span>: <span class="c">#     t_particle = 0.0 # reset time</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1675</span>: <span class="c">#     while t_particle &lt;= max_t:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1676</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1677</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1678</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1679</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1680</span>: <span class="c">#         t_particle += delta_t</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1681</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1682</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1683</span>: <span class="c">#     if not p_outlier_in_range(p_outlier):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1684</span>: <span class="c">#         return -np.inf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1685</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1686</span>: <span class="c">#     if pos_alpha==100.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1687</span>: <span class="c">#         pos_alfa = alpha</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1688</span>: <span class="c">#     else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1689</span>: <span class="c">#         pos_alfa = pos_alpha</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1690</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1691</span>: <span class="c">#     # unique represent # of conditions</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1692</span>: <span class="c">#     for j in range(unique.shape[0]):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1693</span>: <span class="c">#         s = unique[j]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1694</span>: <span class="c">#         # select trials for current condition, identified by the split_by-array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1695</span>: <span class="c">#         feedbacks = feedback[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1696</span>: <span class="c">#         responses1 = response1[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1697</span>: <span class="c">#         responses2 = response2[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1698</span>: <span class="c">#         x1s = x1[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1699</span>: <span class="c">#         x2s = x2[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1700</span>: <span class="c">#         s1s = s1[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1701</span>: <span class="c">#         s2s = s2[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1702</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1703</span>: <span class="c">#         isleft1s = isleft1[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1704</span>: <span class="c">#         isleft2s = isleft2[split_by == s]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1705</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1706</span>: <span class="c">#         s_size = x1s.shape[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1707</span>: <span class="c">#         qs_mf[:,0] = q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1708</span>: <span class="c">#         qs_mf[:,1] = q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1709</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1710</span>: <span class="c">#         qs_mb[:,0] = q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1711</span>: <span class="c">#         qs_mb[:,1] = q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1712</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1713</span>: <span class="c">#         alfa = (2.718281828459**alpha) / (1 + 2.718281828459**alpha)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1714</span>: <span class="c">#         gamma_ = (2.718281828459**gamma) / (1 + 2.718281828459**gamma)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1715</span>: <span class="c">#         if alpha2 != 100.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1716</span>: <span class="c">#             alfa2 = (2.718281828459**alpha2) / (1 + 2.718281828459**alpha2)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1717</span>: <span class="c">#         else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1718</span>: <span class="c">#             alfa2 = alfa            </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1719</span>: <span class="c">#         if lambda_ != 100.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1720</span>: <span class="c">#             lambda__ = (2.718281828459**lambda_) / (1 + 2.718281828459**lambda_)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1721</span>: <span class="c">#         if w != 100.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1722</span>: <span class="c">#             w = (2.718281828459**w) / (1 + 2.718281828459**w)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1723</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1724</span>: <span class="c">#         # loop through all trials in current condition</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1725</span>: <span class="c">#         for i in range(0, s_size):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1726</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1727</span>: <span class="c">#             if counter[s1s[i]] &gt; 0 and x1s[i]&gt;0.15: </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1728</span>: <span class="c">#             # proceed with pdf only if 1) the current 1st-stage state have been updated and 2) &quot;plausible&quot; RT (150 ms)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1729</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1730</span>: <span class="c">#                 for </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1731</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1732</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1733</span>: <span class="c">#                 # 1st stage</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1734</span>: <span class="c">#                 planets = state_combinations[s1s[i]]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1735</span>: <span class="c">#                 Qmb = np.dot(Tm, [np.max(qs_mb[planets[0],:]), np.max(qs_mb[planets[1],:])])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1736</span>: <span class="c">#                 # qs = w * Qmb + (1-w) * qs_mf[s1s[i],:] # Update for 1st trial </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1737</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1738</span>: <span class="c">#                 # dtq = qs[1] - qs[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1739</span>: <span class="c">#                 dtq_mb = Qmb[0] - Qmb[1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1740</span>: <span class="c">#                 dtq_mf = qs_mf[s1s[i],0] - qs_mf[s1s[i],1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1741</span>: <span class="c">#                 if v == 100.00: # if v_reg</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1742</span>: <span class="c">#                     if qval == 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1743</span>: <span class="c">#                         v_ = v0 + (dtq_mb * v1) + (dtq_mf * v2) # use both Qvals</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1744</span>: <span class="c">#                     elif qval == 1: # just mb</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1745</span>: <span class="c">#                         v_ = v0 + (dtq_mb * v1)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1746</span>: <span class="c">#                     elif qval == 2: </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1747</span>: <span class="c">#                         v_ = v0 + (dtq_mf * v2) # just qmf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1748</span>: <span class="c">#                 else: # if don&#39;t use v_reg:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1749</span>: <span class="c">#                     if qval == 0: # use both qmb and qmf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1750</span>: <span class="c">#                         qs = w * Qmb + (1-w) * qs_mf[s1s[i],:] # Update for 1st trial </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1751</span>: <span class="c">#                         dtq = qs[1] - qs[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1752</span>: <span class="c">#                         v_ = dtq * v</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1753</span>: <span class="c">#                     elif qval == 1:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1754</span>: <span class="c">#                         v_ = dtq_mb * v</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1755</span>: <span class="c">#                     elif qval==2:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1756</span>: <span class="c">#                         v_ = dtq_mf * v </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1757</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1758</span>: <span class="c">#                 if z0 != 100.00: # if use z_reg:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1759</span>: <span class="c">#                     if qval == 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1760</span>: <span class="c">#                         z_ = z0 + (dtq_mb * z1) + (dtq_mf * z2) # use both Qvals</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1761</span>: <span class="c">#                     elif qval == 1: # just mb</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1762</span>: <span class="c">#                         z_ = z0 + (dtq_mb * z1)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1763</span>: <span class="c">#                     elif qval == 2: </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1764</span>: <span class="c">#                         z_ = z0 + (dtq_mf * z2) # just qmf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1765</span>: <span class="c">#                     sig = 1/(1+np.exp(-z_))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1766</span>: <span class="c">#                 else: # if don&#39;t use z_reg:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1767</span>: <span class="c">#                     sig = z</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1768</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1769</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1770</span>: <span class="c">#                 # z_ = z0 + (dtq_mb * z1) + (dtq_mf * z2)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1771</span>: <span class="c">#                 # sig =  np.where(z_&lt;0, np.exp(z_)/(1+np.exp(z_)), 1/(1+np.exp(-z_))) # perform sigmoid on z to bound it [0,1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1772</span>: <span class="c">#                 # sig = 1/(1+np.exp(-z_))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1773</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1774</span>: <span class="c">#                 rt = x1s[i]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1775</span>: <span class="c">#                 # if qs[0] &gt; qs[1]:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1776</span>: <span class="c">#                 #     dtq = -dtq</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1777</span>: <span class="c">#                 #     rt = -rt</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1778</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1779</span>: <span class="c">#                 if isleft1s[i] == 0: # if chosen right</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1780</span>: <span class="c">#                     rt = -rt</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1781</span>: <span class="c">#                     v_ = -v_</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1782</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1783</span>: <span class="c">#                 # p = full_pdf(rt, (dtq * v), sv, a, z,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1784</span>: <span class="c">#                 #              sz, t, st, err, n_st, n_sz, use_adaptive, simps_err)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1785</span>: <span class="c">#                 p = full_pdf(rt, v_, sv, a, sig,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1786</span>: <span class="c">#                              sz, t, st, err, n_st, n_sz, use_adaptive, simps_err)                </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1787</span>: <span class="c">#                 # If one probability = 0, the log sum will be -Inf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1788</span>: <span class="c">#                 p = p * (1 - p_outlier) + wp_outlier</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1789</span>: <span class="c">#                 if p == 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1790</span>: <span class="c">#                     return -np.inf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1791</span>: <span class="c">#                 sum_logp += log(p)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1792</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1793</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1794</span>: <span class="c">#                 # # # 2nd stage</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1795</span>: <span class="c">#                 if two_stage == 1.00:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1796</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1797</span>: <span class="c">#                     v_2_ = v if v_2==100.00 else v_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1798</span>: <span class="c">#                     a_2_ = a if a_2 == 100.00 else a_2 </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1799</span>: <span class="c">#                     z_2_ = z if z_2 == 0.5 else z_2 </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1800</span>: <span class="c">#                     t_2_ = t if t_2 == 100.00 else t_2                                        </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1801</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1802</span>: <span class="c">#                     qs = qs_mb[s2s[i],:]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1803</span>: <span class="c">#                     dtq = qs[1] - qs[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1804</span>: <span class="c">#                     rt = x2s[i]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1805</span>: <span class="c">#                     if isleft2s[i] == 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1806</span>: <span class="c">#                     # if qs[0] &gt; qs[1]:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1807</span>: <span class="c">#                         dtq = -dtq</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1808</span>: <span class="c">#                         rt = -rt           </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1809</span>: <span class="c">#                     p = full_pdf(rt, (dtq * v_2_), sv, a_2_, z_2_, sz, t_2_, st, err, n_st, n_sz, use_adaptive, simps_err)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1810</span>: <span class="c">#                     # If one probability = 0, the log sum will be -Inf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1811</span>: <span class="c">#                     p = p * (1 - p_outlier) + wp_outlier</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1812</span>: <span class="c">#                     if p == 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1813</span>: <span class="c">#                         return -np.inf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1814</span>: <span class="c">#                     sum_logp += log(p)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1815</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1816</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1817</span>: <span class="c">#             # update Q values, regardless of pdf    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1818</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1819</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1820</span>: <span class="c">#             # get learning rate for current trial. if pos_alpha is not in</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1821</span>: <span class="c">#             # include it will be same as alpha so can still use this</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1822</span>: <span class="c">#             # calculation:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1823</span>: <span class="c">#             # if feedbacks[i] &gt; qs[responses[i]]:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1824</span>: <span class="c">#             #     alfa = (2.718281828459**pos_alfa) / (1 + 2.718281828459**pos_alfa)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1825</span>: <span class="c">#             # else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1826</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1827</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1828</span>: <span class="c">#             # qs[1] is upper bound, qs[0] is lower bound. feedbacks is reward</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1829</span>: <span class="c">#             # received on current trial.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1830</span>: <span class="c">#             # qs[responses[i]] = qs[responses[i]] + \</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1831</span>: <span class="c">#             #     alfa * (feedbacks[i] - qs[responses[i]])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1832</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1833</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1834</span>: <span class="c">#             dtQ1 = qs_mb[s2s[i],responses2[i]] - qs_mf[s1s[i], responses1[i]] # delta stage 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1835</span>: <span class="c">#             qs_mf[s1s[i], responses1[i]] = qs_mf[s1s[i], responses1[i]] + alfa * dtQ1 # delta update for qmf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1836</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1837</span>: <span class="c">#             dtQ2 = feedbacks[i] - qs_mb[s2s[i],responses2[i]] # delta stage 2 </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1838</span>: <span class="c">#             qs_mb[s2s[i], responses2[i]] = qs_mb[s2s[i],responses2[i]] + alfa2 * dtQ2 # delta update for qmb</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1839</span>: <span class="c">#             if lambda_ != 100.00: # if using eligibility trace</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1840</span>: <span class="c">#                 qs_mf[s1s[i], responses1[i]] = qs_mf[s1s[i], responses1[i]] + lambda__ * dtQ2 # eligibility trace        </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1841</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1842</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1843</span>: <span class="c">#             # memory decay for unexperienced options in this trial</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1844</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1845</span>: <span class="c">#             for s_ in range(nstates):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1846</span>: <span class="c">#                 for a_ in range(2):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1847</span>: <span class="c">#                     if (s_ is not s2s[i]) or (a_ is not responses2[i]):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1848</span>: <span class="c">#                         # qs_mb[s_, a_] = qs_mb[s_, a_] * (1-gamma)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1849</span>: <span class="c">#                         qs_mb[s_,a_] *= (1-gamma_)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1850</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1851</span>: <span class="c">#             for s_ in range(comb(nstates,2,exact=True)):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1852</span>: <span class="c">#                 for a_ in range(2):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1853</span>: <span class="c">#                     if (s_ is not s1s[i]) or (a_ is not responses1[i]):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1854</span>: <span class="c">#                         qs_mf[s_,a_] *= (1-gamma_)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1855</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1856</span>: <span class="c">#             counter[s1s[i]] += 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1857</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1858</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1859</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1860</span>: <span class="c">#     return sum_logp</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1861</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1862</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1863</span>: </pre>
<pre class="cython line score-267" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1864</span>: <span class="k">def</span> <span class="nf">wiener_like_rl</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">response</span><span class="p">,</span></pre>
<pre class='cython code score-267 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_17wiener_like_rl(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_16wiener_like_rl[] = "wiener_like_rl(ndarray response, ndarray feedback, ndarray split_by, double q, double alpha, double pos_alpha, double v, double z, double err=1e-4, int n_st=10, int n_sz=10, bool use_adaptive=1, double simps_err=1e-8, double p_outlier=0, double w_outlier=0)";
static PyMethodDef __pyx_mdef_4wfpt_17wiener_like_rl = {"wiener_like_rl", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_17wiener_like_rl, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_16wiener_like_rl};
static PyObject *__pyx_pw_4wfpt_17wiener_like_rl(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_response = 0;
  PyArrayObject *__pyx_v_feedback = 0;
  PyArrayObject *__pyx_v_split_by = 0;
  double __pyx_v_q;
  double __pyx_v_alpha;
  double __pyx_v_pos_alpha;
  double __pyx_v_v;
  double __pyx_v_z;
  CYTHON_UNUSED double __pyx_v_err;
  CYTHON_UNUSED int __pyx_v_n_st;
  CYTHON_UNUSED int __pyx_v_n_sz;
  CYTHON_UNUSED int __pyx_v_use_adaptive;
  CYTHON_UNUSED double __pyx_v_simps_err;
  double __pyx_v_p_outlier;
  double __pyx_v_w_outlier;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_rl (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_response,&amp;__pyx_n_s_feedback,&amp;__pyx_n_s_split_by,&amp;__pyx_n_s_q,&amp;__pyx_n_s_alpha,&amp;__pyx_n_s_pos_alpha,&amp;__pyx_n_s_v,&amp;__pyx_n_s_z,&amp;__pyx_n_s_err,&amp;__pyx_n_s_n_st,&amp;__pyx_n_s_n_sz,&amp;__pyx_n_s_use_adaptive,&amp;__pyx_n_s_simps_err,&amp;__pyx_n_s_p_outlier,&amp;__pyx_n_s_w_outlier,0};
    PyObject* values[15] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_response)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_feedback)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl", 0, 8, 15, 1); <span class='error_goto'>__PYX_ERR(0, 1864, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_split_by)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl", 0, 8, 15, 2); <span class='error_goto'>__PYX_ERR(0, 1864, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_q)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl", 0, 8, 15, 3); <span class='error_goto'>__PYX_ERR(0, 1864, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_alpha)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl", 0, 8, 15, 4); <span class='error_goto'>__PYX_ERR(0, 1864, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_pos_alpha)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl", 0, 8, 15, 5); <span class='error_goto'>__PYX_ERR(0, 1864, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl", 0, 8, 15, 6); <span class='error_goto'>__PYX_ERR(0, 1864, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl", 0, 8, 15, 7); <span class='error_goto'>__PYX_ERR(0, 1864, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_err);
          if (value) { values[8] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_st);
          if (value) { values[9] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_sz);
          if (value) { values[10] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_use_adaptive);
          if (value) { values[11] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_simps_err);
          if (value) { values[12] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_p_outlier);
          if (value) { values[13] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w_outlier);
          if (value) { values[14] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "wiener_like_rl") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1864, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_response = ((PyArrayObject *)values[0]);
    __pyx_v_feedback = ((PyArrayObject *)values[1]);
    __pyx_v_split_by = ((PyArrayObject *)values[2]);
    __pyx_v_q = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_q == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1867, __pyx_L3_error)</span>
    __pyx_v_alpha = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_alpha == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1867, __pyx_L3_error)</span>
    __pyx_v_pos_alpha = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[5]); if (unlikely((__pyx_v_pos_alpha == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1867, __pyx_L3_error)</span>
    __pyx_v_v = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]); if (unlikely((__pyx_v_v == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1867, __pyx_L3_error)</span>
    __pyx_v_z = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[7]); if (unlikely((__pyx_v_z == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1867, __pyx_L3_error)</span>
    if (values[8]) {
      __pyx_v_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]); if (unlikely((__pyx_v_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1868, __pyx_L3_error)</span>
    } else {
      __pyx_v_err = ((double)1e-4);
    }
    if (values[9]) {
      __pyx_v_n_st = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[9]); if (unlikely((__pyx_v_n_st == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1868, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_st = ((int)10);
    }
    if (values[10]) {
      __pyx_v_n_sz = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[10]); if (unlikely((__pyx_v_n_sz == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1868, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_sz = ((int)10);
    }
    if (values[11]) {
      __pyx_v_use_adaptive = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[11]); if (unlikely((__pyx_v_use_adaptive == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1868, __pyx_L3_error)</span>
    } else {
      __pyx_v_use_adaptive = ((int)1);
    }
    if (values[12]) {
      __pyx_v_simps_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[12]); if (unlikely((__pyx_v_simps_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1868, __pyx_L3_error)</span>
    } else {
      __pyx_v_simps_err = ((double)1e-8);
    }
    if (values[13]) {
      __pyx_v_p_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[13]); if (unlikely((__pyx_v_p_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1869, __pyx_L3_error)</span>
    } else {
      __pyx_v_p_outlier = ((double)0.0);
    }
    if (values[14]) {
      __pyx_v_w_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[14]); if (unlikely((__pyx_v_w_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1869, __pyx_L3_error)</span>
    } else {
      __pyx_v_w_outlier = ((double)0.0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_rl", 0, 8, 15, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 1864, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_rl", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_response), __pyx_ptype_5numpy_ndarray, 1, "response", 0))) <span class='error_goto'>__PYX_ERR(0, 1864, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_feedback), __pyx_ptype_5numpy_ndarray, 1, "feedback", 0))) <span class='error_goto'>__PYX_ERR(0, 1865, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_split_by), __pyx_ptype_5numpy_ndarray, 1, "split_by", 0))) <span class='error_goto'>__PYX_ERR(0, 1866, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4wfpt_16wiener_like_rl(__pyx_self, __pyx_v_response, __pyx_v_feedback, __pyx_v_split_by, __pyx_v_q, __pyx_v_alpha, __pyx_v_pos_alpha, __pyx_v_v, __pyx_v_z, __pyx_v_err, __pyx_v_n_st, __pyx_v_n_sz, __pyx_v_use_adaptive, __pyx_v_simps_err, __pyx_v_p_outlier, __pyx_v_w_outlier);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_16wiener_like_rl(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_response, PyArrayObject *__pyx_v_feedback, PyArrayObject *__pyx_v_split_by, double __pyx_v_q, double __pyx_v_alpha, double __pyx_v_pos_alpha, double __pyx_v_v, double __pyx_v_z, CYTHON_UNUSED double __pyx_v_err, CYTHON_UNUSED int __pyx_v_n_st, CYTHON_UNUSED int __pyx_v_n_sz, CYTHON_UNUSED int __pyx_v_use_adaptive, CYTHON_UNUSED double __pyx_v_simps_err, double __pyx_v_p_outlier, double __pyx_v_w_outlier) {
  CYTHON_UNUSED Py_ssize_t __pyx_v_size;
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_j;
  Py_ssize_t __pyx_v_s_size;
  int __pyx_v_s;
  double __pyx_v_drift;
  double __pyx_v_p;
  double __pyx_v_sum_logp;
  double __pyx_v_wp_outlier;
  double __pyx_v_alfa;
  double __pyx_v_pos_alfa;
  PyArrayObject *__pyx_v_qs = 0;
  PyArrayObject *__pyx_v_feedbacks = 0;
  PyArrayObject *__pyx_v_responses = 0;
  PyArrayObject *__pyx_v_unique = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_feedback;
  __Pyx_Buffer __pyx_pybuffer_feedback;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_feedbacks;
  __Pyx_Buffer __pyx_pybuffer_feedbacks;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_qs;
  __Pyx_Buffer __pyx_pybuffer_qs;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_response;
  __Pyx_Buffer __pyx_pybuffer_response;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_responses;
  __Pyx_Buffer __pyx_pybuffer_responses;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_split_by;
  __Pyx_Buffer __pyx_pybuffer_split_by;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_unique;
  __Pyx_Buffer __pyx_pybuffer_unique;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_rl", 0);
  __pyx_pybuffer_qs.pybuffer.buf = NULL;
  __pyx_pybuffer_qs.refcount = 0;
  __pyx_pybuffernd_qs.data = NULL;
  __pyx_pybuffernd_qs.rcbuffer = &amp;__pyx_pybuffer_qs;
  __pyx_pybuffer_feedbacks.pybuffer.buf = NULL;
  __pyx_pybuffer_feedbacks.refcount = 0;
  __pyx_pybuffernd_feedbacks.data = NULL;
  __pyx_pybuffernd_feedbacks.rcbuffer = &amp;__pyx_pybuffer_feedbacks;
  __pyx_pybuffer_responses.pybuffer.buf = NULL;
  __pyx_pybuffer_responses.refcount = 0;
  __pyx_pybuffernd_responses.data = NULL;
  __pyx_pybuffernd_responses.rcbuffer = &amp;__pyx_pybuffer_responses;
  __pyx_pybuffer_unique.pybuffer.buf = NULL;
  __pyx_pybuffer_unique.refcount = 0;
  __pyx_pybuffernd_unique.data = NULL;
  __pyx_pybuffernd_unique.rcbuffer = &amp;__pyx_pybuffer_unique;
  __pyx_pybuffer_response.pybuffer.buf = NULL;
  __pyx_pybuffer_response.refcount = 0;
  __pyx_pybuffernd_response.data = NULL;
  __pyx_pybuffernd_response.rcbuffer = &amp;__pyx_pybuffer_response;
  __pyx_pybuffer_feedback.pybuffer.buf = NULL;
  __pyx_pybuffer_feedback.refcount = 0;
  __pyx_pybuffernd_feedback.data = NULL;
  __pyx_pybuffernd_feedback.rcbuffer = &amp;__pyx_pybuffer_feedback;
  __pyx_pybuffer_split_by.pybuffer.buf = NULL;
  __pyx_pybuffer_split_by.refcount = 0;
  __pyx_pybuffernd_split_by.data = NULL;
  __pyx_pybuffernd_split_by.rcbuffer = &amp;__pyx_pybuffer_split_by;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_response.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_response, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1864, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_response.diminfo[0].strides = __pyx_pybuffernd_response.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_response.diminfo[0].shape = __pyx_pybuffernd_response.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_feedback, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1864, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_feedback.diminfo[0].strides = __pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_feedback.diminfo[0].shape = __pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_split_by, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1864, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_split_by.diminfo[0].strides = __pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_split_by.diminfo[0].shape = __pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_rl", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_qs);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_feedbacks);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_responses);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_unique);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__25 = <span class='py_c_api'>PyTuple_Pack</span>(30, __pyx_n_s_response, __pyx_n_s_feedback, __pyx_n_s_split_by, __pyx_n_s_q, __pyx_n_s_alpha, __pyx_n_s_pos_alpha, __pyx_n_s_v, __pyx_n_s_z, __pyx_n_s_err, __pyx_n_s_n_st, __pyx_n_s_n_sz, __pyx_n_s_use_adaptive, __pyx_n_s_simps_err, __pyx_n_s_p_outlier, __pyx_n_s_w_outlier, __pyx_n_s_size, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_s_size, __pyx_n_s_s, __pyx_n_s_drift, __pyx_n_s_p, __pyx_n_s_sum_logp, __pyx_n_s_wp_outlier, __pyx_n_s_alfa, __pyx_n_s_pos_alfa, __pyx_n_s_qs, __pyx_n_s_feedbacks, __pyx_n_s_responses, __pyx_n_s_unique);<span class='error_goto'> if (unlikely(!__pyx_tuple__25)) __PYX_ERR(0, 1864, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__25);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__25);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_17wiener_like_rl, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1864, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_wiener_like_rl, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1864, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__26 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(15, 0, 30, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__25, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_wiener_like_rl, 1864, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__26)) __PYX_ERR(0, 1864, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">1865</span>:                    <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">feedback</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1866</span>:                    <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">split_by</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1867</span>:                    <span class="n">double</span> <span class="n">q</span><span class="p">,</span> <span class="n">double</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">double</span> <span class="n">pos_alpha</span><span class="p">,</span> <span class="n">double</span> <span class="n">v</span><span class="p">,</span> <span class="n">double</span> <span class="n">z</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1868</span>:                    <span class="n">double</span> <span class="n">err</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_st</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_sz</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">use_adaptive</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span> <span class="n">double</span> <span class="n">simps_err</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1869</span>:                    <span class="n">double</span> <span class="n">p_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="n">double</span> <span class="n">w_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">):</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1870</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">size</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_size = (__pyx_v_response-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">1871</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1872</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">s_size</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1873</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1874</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">drift</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1875</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">p</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1876</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sum_logp</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sum_logp = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1877</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">wp_outlier</span> <span class="o">=</span> <span class="n">w_outlier</span> <span class="o">*</span> <span class="n">p_outlier</span></pre>
<pre class='cython code score-0 '>  __pyx_v_wp_outlier = (__pyx_v_w_outlier * __pyx_v_p_outlier);
</pre><pre class="cython line score-0">&#xA0;<span class="">1878</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">alfa</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1879</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">pos_alfa</span></pre>
<pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1880</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span></pre>
<pre class='cython code score-42 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1880, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1880, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1880, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1880, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1880, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4);
  __pyx_t_2 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 1880, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1880, __pyx_L1_error)</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_qs = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1880, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_qs.diminfo[0].strides = __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_qs.diminfo[0].shape = __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_qs = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1881</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">feedbacks</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1882</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">responses</span></pre>
<pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1883</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">long</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">split_by</span><span class="p">)</span></pre>
<pre class='cython code score-24 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1883, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_unique);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1883, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_3, ((PyObject *)__pyx_v_split_by)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, ((PyObject *)__pyx_v_split_by));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 1883, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1883, __pyx_L1_error)</span>
  __pyx_t_7 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_7, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_unique = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1883, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_unique.diminfo[0].strides = __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_unique.diminfo[0].shape = __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_7 = 0;
  __pyx_v_unique = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1884</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1885</span>:     <span class="k">if</span> <span class="ow">not</span> <span class="n">p_outlier_in_range</span><span class="p">(</span><span class="n">p_outlier</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_8 = ((!(__pyx_f_4wfpt_p_outlier_in_range(__pyx_v_p_outlier) != 0)) != 0);
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1886</span>:         <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-12 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1886, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1886, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1886, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1887</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1888</span>:     <span class="k">if</span> <span class="n">pos_alpha</span><span class="o">==</span><span class="mf">100.00</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_8 = ((__pyx_v_pos_alpha == 100.00) != 0);
  if (__pyx_t_8) {
/* … */
    goto __pyx_L4;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1889</span>:         <span class="n">pos_alfa</span> <span class="o">=</span> <span class="n">alpha</span></pre>
<pre class='cython code score-0 '>    __pyx_v_pos_alfa = __pyx_v_alpha;
</pre><pre class="cython line score-0">&#xA0;<span class="">1890</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1891</span>:         <span class="n">pos_alfa</span> <span class="o">=</span> <span class="n">pos_alpha</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_pos_alfa = __pyx_v_pos_alpha;
  }
  __pyx_L4:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1892</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1893</span>:     <span class="c"># unique represent # of conditions</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1894</span>:     <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">unique</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_9 = (__pyx_v_unique-&gt;dimensions[0]);
  __pyx_t_10 = __pyx_t_9;
  for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_10; __pyx_t_11+=1) {
    __pyx_v_j = __pyx_t_11;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1895</span>:         <span class="n">s</span> <span class="o">=</span> <span class="n">unique</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = __pyx_v_j;
    __pyx_v_s = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_unique.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_unique.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">1896</span>:         <span class="c"># select trials for current condition, identified by the split_by-array</span></pre>
<pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1897</span>:         <span class="n">feedbacks</span> <span class="o">=</span> <span class="n">feedback</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1897, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_1, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1897, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_feedback), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1897, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1897, __pyx_L1_error)</span>
    __pyx_t_13 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer);
      __pyx_t_14 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_13, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_14 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_15, &amp;__pyx_t_16, &amp;__pyx_t_17);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_feedbacks, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_17);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_15, __pyx_t_16, __pyx_t_17);
        }
        __pyx_t_15 = __pyx_t_16 = __pyx_t_17 = 0;
      }
      __pyx_pybuffernd_feedbacks.diminfo[0].strides = __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_feedbacks.diminfo[0].shape = __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_14 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1897, __pyx_L1_error)</span>
    }
    __pyx_t_13 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_feedbacks, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1898</span>:         <span class="n">responses</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="n">split_by</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1898, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_split_by), __pyx_t_1, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1898, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_response), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1898, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1898, __pyx_L1_error)</span>
    __pyx_t_18 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer);
      __pyx_t_14 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_18, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_14 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_17, &amp;__pyx_t_16, &amp;__pyx_t_15);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_responses, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_17); Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_15);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_17, __pyx_t_16, __pyx_t_15);
        }
        __pyx_t_17 = __pyx_t_16 = __pyx_t_15 = 0;
      }
      __pyx_pybuffernd_responses.diminfo[0].strides = __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_responses.diminfo[0].shape = __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_14 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1898, __pyx_L1_error)</span>
    }
    __pyx_t_18 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_responses, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1899</span>:         <span class="n">s_size</span> <span class="o">=</span> <span class="n">responses</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_v_s_size = (__pyx_v_responses-&gt;dimensions[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1900</span>:         <span class="n">qs</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = 0;
    *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_qs.diminfo[0].strides) = __pyx_v_q;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1901</span>:         <span class="n">qs</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = 1;
    *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_qs.diminfo[0].strides) = __pyx_v_q;
</pre><pre class="cython line score-0">&#xA0;<span class="">1902</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1903</span>:         <span class="c"># don&#39;t calculate pdf for first trial but still update q</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1904</span>:         <span class="k">if</span> <span class="n">feedbacks</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">qs</span><span class="p">[</span><span class="n">responses</span><span class="p">[</span><span class="mf">0</span><span class="p">]]:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = 0;
    __pyx_t_19 = 0;
    __pyx_t_20 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_responses.diminfo[0].strides));
    __pyx_t_8 = (((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_feedbacks.diminfo[0].strides)) &gt; (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_qs.diminfo[0].strides))) != 0);
    if (__pyx_t_8) {
/* … */
      goto __pyx_L7;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1905</span>:             <span class="n">alfa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">pos_alfa</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">pos_alfa</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_alfa = (pow(2.718281828459, __pyx_v_pos_alfa) / (1.0 + pow(2.718281828459, __pyx_v_pos_alfa)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1906</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1907</span>:             <span class="n">alfa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_alfa = (pow(2.718281828459, __pyx_v_alpha) / (1.0 + pow(2.718281828459, __pyx_v_alpha)));
    }
    __pyx_L7:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1908</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1909</span>:         <span class="c"># qs[1] is upper bound, qs[0] is lower bound. feedbacks is reward</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1910</span>:         <span class="c"># received on current trial.</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1911</span>:         <span class="n">qs</span><span class="p">[</span><span class="n">responses</span><span class="p">[</span><span class="mf">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="n">responses</span><span class="p">[</span><span class="mf">0</span><span class="p">]]</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>    __pyx_t_19 = 0;
    __pyx_t_20 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_responses.diminfo[0].strides));
/* … */
    __pyx_t_23 = 0;
    __pyx_t_24 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_23, __pyx_pybuffernd_responses.diminfo[0].strides));
    *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_qs.diminfo[0].strides) = ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_qs.diminfo[0].strides)) + (__pyx_v_alfa * ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_feedbacks.diminfo[0].strides)) - (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_qs.diminfo[0].strides)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1912</span>:             <span class="n">alfa</span> <span class="o">*</span> <span class="p">(</span><span class="n">feedbacks</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs</span><span class="p">[</span><span class="n">responses</span><span class="p">[</span><span class="mf">0</span><span class="p">]])</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = 0;
    __pyx_t_21 = 0;
    __pyx_t_22 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_responses.diminfo[0].strides));
</pre><pre class="cython line score-0">&#xA0;<span class="">1913</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1914</span>:         <span class="c"># loop through all trials in current condition</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1915</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span> <span class="n">s_size</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_25 = __pyx_v_s_size;
    __pyx_t_26 = __pyx_t_25;
    for (__pyx_t_27 = 1; __pyx_t_27 &lt; __pyx_t_26; __pyx_t_27+=1) {
      __pyx_v_i = __pyx_t_27;
</pre><pre class="cython line score-0">&#xA0;<span class="">1916</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1917</span>:             <span class="n">drift</span> <span class="o">=</span> <span class="p">(</span><span class="n">qs</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">v</span></pre>
<pre class='cython code score-0 '>      __pyx_t_21 = 1;
      __pyx_t_22 = 0;
      __pyx_v_drift = (((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_qs.diminfo[0].strides)) - (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_qs.diminfo[0].strides))) * __pyx_v_v);
</pre><pre class="cython line score-0">&#xA0;<span class="">1918</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1919</span>:             <span class="k">if</span> <span class="n">drift</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_8 = ((__pyx_v_drift == 0.0) != 0);
      if (__pyx_t_8) {
/* … */
        goto __pyx_L10;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1920</span>:                 <span class="n">p</span> <span class="o">=</span> <span class="mf">0.5</span></pre>
<pre class='cython code score-0 '>        __pyx_v_p = 0.5;
</pre><pre class="cython line score-0">&#xA0;<span class="">1921</span>:             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1922</span>:                 <span class="k">if</span> <span class="n">responses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      /*else*/ {
        __pyx_t_22 = __pyx_v_i;
        __pyx_t_8 = (((*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_responses.diminfo[0].strides)) == 1) != 0);
        if (__pyx_t_8) {
/* … */
          goto __pyx_L11;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1923</span>:                     <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">drift</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span> <span class="o">/</span> \</pre>
<pre class='cython code score-0 '>          __pyx_v_p = ((pow(2.718281828459, ((-2.0 * __pyx_v_z) * __pyx_v_drift)) - 1.0) / (pow(2.718281828459, (-2.0 * __pyx_v_drift)) - 1.0));
</pre><pre class="cython line score-0">&#xA0;<span class="">1924</span>:                         <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">drift</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1925</span>:                 <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1926</span>:                     <span class="n">p</span> <span class="o">=</span> <span class="mf">1</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">drift</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span> <span class="o">/</span> \</pre>
<pre class='cython code score-0 '>        /*else*/ {
/* … */
          __pyx_v_p = (1.0 - ((pow(2.718281828459, ((-2.0 * __pyx_v_z) * __pyx_v_drift)) - 1.0) / (pow(2.718281828459, (-2.0 * __pyx_v_drift)) - 1.0)));
        }
        __pyx_L11:;
      }
      __pyx_L10:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1927</span>:                         <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">drift</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1928</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1929</span>:             <span class="c"># If one probability = 0, the log sum will be -Inf</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1930</span>:             <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">p_outlier</span><span class="p">)</span> <span class="o">+</span> <span class="n">wp_outlier</span></pre>
<pre class='cython code score-0 '>      __pyx_v_p = ((__pyx_v_p * (1.0 - __pyx_v_p_outlier)) + __pyx_v_wp_outlier);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1931</span>:             <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_8 = ((__pyx_v_p == 0.0) != 0);
      if (__pyx_t_8) {
/* … */
      }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1932</span>:                 <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-12 '>        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
        <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1932, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1932, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1932, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_r = __pyx_t_1;
        __pyx_t_1 = 0;
        goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1933</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1934</span>:             <span class="n">sum_logp</span> <span class="o">+=</span> <span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_sum_logp = (__pyx_v_sum_logp + log(__pyx_v_p));
</pre><pre class="cython line score-0">&#xA0;<span class="">1935</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1936</span>:             <span class="c"># get learning rate for current trial. if pos_alpha is not in</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1937</span>:             <span class="c"># include it will be same as alpha so can still use this</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1938</span>:             <span class="c"># calculation:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1939</span>:             <span class="k">if</span> <span class="n">feedbacks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">qs</span><span class="p">[</span><span class="n">responses</span><span class="p">[</span><span class="n">i</span><span class="p">]]:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_22 = __pyx_v_i;
      __pyx_t_21 = __pyx_v_i;
      __pyx_t_12 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_responses.diminfo[0].strides));
      __pyx_t_8 = (((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_feedbacks.diminfo[0].strides)) &gt; (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_qs.diminfo[0].strides))) != 0);
      if (__pyx_t_8) {
/* … */
        goto __pyx_L13;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1940</span>:                 <span class="n">alfa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">pos_alfa</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">pos_alfa</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_v_alfa = (pow(2.718281828459, __pyx_v_pos_alfa) / (1.0 + pow(2.718281828459, __pyx_v_pos_alfa)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1941</span>:             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1942</span>:                 <span class="n">alfa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">alpha</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      /*else*/ {
        __pyx_v_alfa = (pow(2.718281828459, __pyx_v_alpha) / (1.0 + pow(2.718281828459, __pyx_v_alpha)));
      }
      __pyx_L13:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1943</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1944</span>:             <span class="c"># qs[1] is upper bound, qs[0] is lower bound. feedbacks is reward</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1945</span>:             <span class="c"># received on current trial.</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1946</span>:             <span class="n">qs</span><span class="p">[</span><span class="n">responses</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="n">responses</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>      __pyx_t_21 = __pyx_v_i;
      __pyx_t_12 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_responses.diminfo[0].strides));
/* … */
      __pyx_t_23 = __pyx_v_i;
      __pyx_t_24 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_23, __pyx_pybuffernd_responses.diminfo[0].strides));
      *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_qs.diminfo[0].strides) = ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_qs.diminfo[0].strides)) + (__pyx_v_alfa * ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_feedbacks.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_feedbacks.diminfo[0].strides)) - (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_qs.diminfo[0].strides)))));
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1947</span>:                 <span class="n">alfa</span> <span class="o">*</span> <span class="p">(</span><span class="n">feedbacks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs</span><span class="p">[</span><span class="n">responses</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span></pre>
<pre class='cython code score-0 '>      __pyx_t_22 = __pyx_v_i;
      __pyx_t_19 = __pyx_v_i;
      __pyx_t_20 = (*__Pyx_BufPtrStrided1d(long *, __pyx_pybuffernd_responses.rcbuffer-&gt;pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_responses.diminfo[0].strides));
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1948</span>:     <span class="k">return</span> <span class="n">sum_logp</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_sum_logp);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1948, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1949</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1950</span>: </pre>
<pre class="cython line score-188" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1951</span>: <span class="k">def</span> <span class="nf">wiener_like_multi</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">double</span> <span class="n">err</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span></pre>
<pre class='cython code score-188 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_19wiener_like_multi(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_18wiener_like_multi[] = "wiener_like_multi(ndarray x, v, sv, a, z, sz, t, st, double err, multi=None, int n_st=10, int n_sz=10, bool use_adaptive=1, double simps_err=1e-3, double p_outlier=0, double w_outlier=0)";
static PyMethodDef __pyx_mdef_4wfpt_19wiener_like_multi = {"wiener_like_multi", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_19wiener_like_multi, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_18wiener_like_multi};
static PyObject *__pyx_pw_4wfpt_19wiener_like_multi(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_x = 0;
  PyObject *__pyx_v_v = 0;
  PyObject *__pyx_v_sv = 0;
  PyObject *__pyx_v_a = 0;
  PyObject *__pyx_v_z = 0;
  PyObject *__pyx_v_sz = 0;
  PyObject *__pyx_v_t = 0;
  PyObject *__pyx_v_st = 0;
  double __pyx_v_err;
  PyObject *__pyx_v_multi = 0;
  int __pyx_v_n_st;
  int __pyx_v_n_sz;
  int __pyx_v_use_adaptive;
  double __pyx_v_simps_err;
  double __pyx_v_p_outlier;
  double __pyx_v_w_outlier;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_multi (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_x,&amp;__pyx_n_s_v,&amp;__pyx_n_s_sv,&amp;__pyx_n_s_a,&amp;__pyx_n_s_z,&amp;__pyx_n_s_sz,&amp;__pyx_n_s_t,&amp;__pyx_n_s_st,&amp;__pyx_n_s_err,&amp;__pyx_n_s_multi,&amp;__pyx_n_s_n_st,&amp;__pyx_n_s_n_sz,&amp;__pyx_n_s_use_adaptive,&amp;__pyx_n_s_simps_err,&amp;__pyx_n_s_p_outlier,&amp;__pyx_n_s_w_outlier,0};
    PyObject* values[16] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    values[9] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi", 0, 9, 16, 1); <span class='error_goto'>__PYX_ERR(0, 1951, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sv)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi", 0, 9, 16, 2); <span class='error_goto'>__PYX_ERR(0, 1951, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi", 0, 9, 16, 3); <span class='error_goto'>__PYX_ERR(0, 1951, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi", 0, 9, 16, 4); <span class='error_goto'>__PYX_ERR(0, 1951, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi", 0, 9, 16, 5); <span class='error_goto'>__PYX_ERR(0, 1951, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_t)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi", 0, 9, 16, 6); <span class='error_goto'>__PYX_ERR(0, 1951, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_st)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi", 0, 9, 16, 7); <span class='error_goto'>__PYX_ERR(0, 1951, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_err)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi", 0, 9, 16, 8); <span class='error_goto'>__PYX_ERR(0, 1951, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_multi);
          if (value) { values[9] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_st);
          if (value) { values[10] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_sz);
          if (value) { values[11] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_use_adaptive);
          if (value) { values[12] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_simps_err);
          if (value) { values[13] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_p_outlier);
          if (value) { values[14] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w_outlier);
          if (value) { values[15] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "wiener_like_multi") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1951, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_x = ((PyArrayObject *)values[0]);
    __pyx_v_v = values[1];
    __pyx_v_sv = values[2];
    __pyx_v_a = values[3];
    __pyx_v_z = values[4];
    __pyx_v_sz = values[5];
    __pyx_v_t = values[6];
    __pyx_v_st = values[7];
    __pyx_v_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]); if (unlikely((__pyx_v_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1951, __pyx_L3_error)</span>
    __pyx_v_multi = values[9];
    if (values[10]) {
      __pyx_v_n_st = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[10]); if (unlikely((__pyx_v_n_st == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1952, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_st = ((int)10);
    }
    if (values[11]) {
      __pyx_v_n_sz = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[11]); if (unlikely((__pyx_v_n_sz == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1952, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_sz = ((int)10);
    }
    if (values[12]) {
      __pyx_v_use_adaptive = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[12]); if (unlikely((__pyx_v_use_adaptive == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1952, __pyx_L3_error)</span>
    } else {
      __pyx_v_use_adaptive = ((int)1);
    }
    if (values[13]) {
      __pyx_v_simps_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[13]); if (unlikely((__pyx_v_simps_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1952, __pyx_L3_error)</span>
    } else {
      __pyx_v_simps_err = ((double)1e-3);
    }
    if (values[14]) {
      __pyx_v_p_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[14]); if (unlikely((__pyx_v_p_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1953, __pyx_L3_error)</span>
    } else {
      __pyx_v_p_outlier = ((double)0.0);
    }
    if (values[15]) {
      __pyx_v_w_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[15]); if (unlikely((__pyx_v_w_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1953, __pyx_L3_error)</span>
    } else {
      __pyx_v_w_outlier = ((double)0.0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi", 0, 9, 16, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 1951, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_multi", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x), __pyx_ptype_5numpy_ndarray, 1, "x", 0))) <span class='error_goto'>__PYX_ERR(0, 1951, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4wfpt_18wiener_like_multi(__pyx_self, __pyx_v_x, __pyx_v_v, __pyx_v_sv, __pyx_v_a, __pyx_v_z, __pyx_v_sz, __pyx_v_t, __pyx_v_st, __pyx_v_err, __pyx_v_multi, __pyx_v_n_st, __pyx_v_n_sz, __pyx_v_use_adaptive, __pyx_v_simps_err, __pyx_v_p_outlier, __pyx_v_w_outlier);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_18wiener_like_multi(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_x, PyObject *__pyx_v_v, PyObject *__pyx_v_sv, PyObject *__pyx_v_a, PyObject *__pyx_v_z, PyObject *__pyx_v_sz, PyObject *__pyx_v_t, PyObject *__pyx_v_st, double __pyx_v_err, PyObject *__pyx_v_multi, int __pyx_v_n_st, int __pyx_v_n_sz, int __pyx_v_use_adaptive, double __pyx_v_simps_err, double __pyx_v_p_outlier, double __pyx_v_w_outlier) {
  Py_ssize_t __pyx_v_size;
  Py_ssize_t __pyx_v_i;
  double __pyx_v_p;
  double __pyx_v_sum_logp;
  double __pyx_v_wp_outlier;
  PyObject *__pyx_v_params = NULL;
  PyObject *__pyx_v_params_iter = NULL;
  PyObject *__pyx_v_param = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x;
  __Pyx_Buffer __pyx_pybuffer_x;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_multi", 0);
  __pyx_pybuffer_x.pybuffer.buf = NULL;
  __pyx_pybuffer_x.refcount = 0;
  __pyx_pybuffernd_x.data = NULL;
  __pyx_pybuffernd_x.rcbuffer = &amp;__pyx_pybuffer_x;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1951, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_x.diminfo[0].strides = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x.diminfo[0].shape = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_multi", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_params);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_params_iter);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_param);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__27 = <span class='py_c_api'>PyTuple_Pack</span>(24, __pyx_n_s_x, __pyx_n_s_v, __pyx_n_s_sv, __pyx_n_s_a, __pyx_n_s_z, __pyx_n_s_sz, __pyx_n_s_t, __pyx_n_s_st, __pyx_n_s_err, __pyx_n_s_multi, __pyx_n_s_n_st, __pyx_n_s_n_sz, __pyx_n_s_use_adaptive, __pyx_n_s_simps_err, __pyx_n_s_p_outlier, __pyx_n_s_w_outlier, __pyx_n_s_size, __pyx_n_s_i, __pyx_n_s_p, __pyx_n_s_sum_logp, __pyx_n_s_wp_outlier, __pyx_n_s_params, __pyx_n_s_params_iter, __pyx_n_s_param);<span class='error_goto'> if (unlikely(!__pyx_tuple__27)) __PYX_ERR(0, 1951, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__27);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__27);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_19wiener_like_multi, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1951, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_wiener_like_multi, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1951, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__28 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(16, 0, 24, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__27, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_wiener_like_multi, 1951, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__28)) __PYX_ERR(0, 1951, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">1952</span>:                       <span class="nb">int</span> <span class="n">n_st</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_sz</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">use_adaptive</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span> <span class="n">double</span> <span class="n">simps_err</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1953</span>:                       <span class="n">double</span> <span class="n">p_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="n">double</span> <span class="n">w_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">):</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1954</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">size</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_size = (__pyx_v_x-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">1955</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1956</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">p</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_p = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1957</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sum_logp</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sum_logp = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1958</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">wp_outlier</span> <span class="o">=</span> <span class="n">w_outlier</span> <span class="o">*</span> <span class="n">p_outlier</span></pre>
<pre class='cython code score-0 '>  __pyx_v_wp_outlier = (__pyx_v_w_outlier * __pyx_v_p_outlier);
</pre><pre class="cython line score-0">&#xA0;<span class="">1959</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1960</span>:     <span class="k">if</span> <span class="n">multi</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_multi == Py_None);
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-86" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1961</span>:         <span class="k">return</span> <span class="n">full_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span></pre>
<pre class='cython code score-86 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(((PyObject *)__pyx_v_x)); if (unlikely((__pyx_t_3 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1961, __pyx_L1_error)</span>
    __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_v); if (unlikely((__pyx_t_4 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1961, __pyx_L1_error)</span>
    __pyx_t_5 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_sv); if (unlikely((__pyx_t_5 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1961, __pyx_L1_error)</span>
    __pyx_t_6 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_a); if (unlikely((__pyx_t_6 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1961, __pyx_L1_error)</span>
    __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_z); if (unlikely((__pyx_t_7 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1961, __pyx_L1_error)</span>
    __pyx_t_8 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_sz); if (unlikely((__pyx_t_8 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1961, __pyx_L1_error)</span>
    __pyx_t_9 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_t); if (unlikely((__pyx_t_9 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1961, __pyx_L1_error)</span>
    __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_st); if (unlikely((__pyx_t_10 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1961, __pyx_L1_error)</span>
    __pyx_t_11 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_4wfpt_full_pdf(__pyx_t_3, __pyx_t_4, __pyx_t_5, __pyx_t_6, __pyx_t_7, __pyx_t_8, __pyx_t_9, __pyx_t_10, __pyx_v_err, 0, NULL));<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1961, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    __pyx_r = __pyx_t_11;
    __pyx_t_11 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1962</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-37" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1963</span>:         <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;v&#39;</span><span class="p">:</span> <span class="n">v</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span> <span class="s">&#39;t&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="s">&#39;sv&#39;</span><span class="p">:</span> <span class="n">sv</span><span class="p">,</span> <span class="s">&#39;sz&#39;</span><span class="p">:</span> <span class="n">sz</span><span class="p">,</span> <span class="s">&#39;st&#39;</span><span class="p">:</span> <span class="n">st</span><span class="p">}</span></pre>
<pre class='cython code score-37 '>  /*else*/ {
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(7);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1963, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_11, __pyx_n_s_v, __pyx_v_v) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1963, __pyx_L1_error)</span>
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_11, __pyx_n_s_z, __pyx_v_z) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1963, __pyx_L1_error)</span>
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_11, __pyx_n_s_t, __pyx_v_t) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1963, __pyx_L1_error)</span>
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_11, __pyx_n_s_a, __pyx_v_a) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1963, __pyx_L1_error)</span>
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_11, __pyx_n_s_sv, __pyx_v_sv) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1963, __pyx_L1_error)</span>
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_11, __pyx_n_s_sz, __pyx_v_sz) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1963, __pyx_L1_error)</span>
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_11, __pyx_n_s_st, __pyx_v_st) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1963, __pyx_L1_error)</span>
    __pyx_v_params = ((PyObject*)__pyx_t_11);
    __pyx_t_11 = 0;
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1964</span>:         <span class="n">params_iter</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></pre>
<pre class='cython code score-16 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_12, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1964, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    __pyx_t_13 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_12))) {
      __pyx_t_13 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_12);
      if (likely(__pyx_t_13)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_12);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_12, function);
      }
    }
    __pyx_t_11 = (__pyx_t_13) ? __Pyx_PyObject_Call2Args(__pyx_t_12, __pyx_t_13, __pyx_v_params) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_12, __pyx_v_params);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    if (unlikely(!__pyx_t_11)) <span class='error_goto'>__PYX_ERR(0, 1964, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    __pyx_v_params_iter = __pyx_t_11;
    __pyx_t_11 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1965</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_14 = __pyx_v_size;
    __pyx_t_15 = __pyx_t_14;
    for (__pyx_t_16 = 0; __pyx_t_16 &lt; __pyx_t_15; __pyx_t_16+=1) {
      __pyx_v_i = __pyx_t_16;
</pre><pre class="cython line score-43" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1966</span>:             <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">multi</span><span class="p">:</span></pre>
<pre class='cython code score-43 '>      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_multi)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_multi)) {
        __pyx_t_11 = __pyx_v_multi; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11); __pyx_t_17 = 0;
        __pyx_t_18 = NULL;
      } else {
        __pyx_t_17 = -1; __pyx_t_11 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_multi);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1966, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        __pyx_t_18 = Py_TYPE(__pyx_t_11)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 1966, __pyx_L1_error)</span>
      }
      for (;;) {
        if (likely(!__pyx_t_18)) {
          if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_11))) {
            if (__pyx_t_17 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_11)) break;
            #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_12 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_11, __pyx_t_17); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12); __pyx_t_17++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1966, __pyx_L1_error)</span>
            #else
            __pyx_t_12 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_11, __pyx_t_17); __pyx_t_17++;<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1966, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
            #endif
          } else {
            if (__pyx_t_17 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_11)) break;
            #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_12 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_11, __pyx_t_17); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12); __pyx_t_17++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1966, __pyx_L1_error)</span>
            #else
            __pyx_t_12 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_11, __pyx_t_17); __pyx_t_17++;<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1966, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
            #endif
          }
        } else {
          __pyx_t_12 = __pyx_t_18(__pyx_t_11);
          if (unlikely(!__pyx_t_12)) {
            PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
            if (exc_type) {
              if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
              else <span class='error_goto'>__PYX_ERR(0, 1966, __pyx_L1_error)</span>
            }
            break;
          }
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
        }
        <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_param, __pyx_t_12);
        __pyx_t_12 = 0;
/* … */
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1967</span>:                 <span class="n">params_iter</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-11 '>        __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_v_params, __pyx_v_param);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1967, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
        __pyx_t_13 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_12, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1967, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_params_iter, __pyx_v_param, __pyx_t_13) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1967, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1968</span>:             <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">!=</span> <span class="mf">999.</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_19 = __pyx_v_i;
      __pyx_t_2 = ((fabs((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_x.diminfo[0].strides))) != 999.) != 0);
      if (__pyx_t_2) {
/* … */
        goto __pyx_L8;
      }
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1969</span>:                 <span class="n">p</span> <span class="o">=</span> <span class="n">full_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">],</span></pre>
<pre class='cython code score-13 '>        __pyx_t_19 = __pyx_v_i;
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_v);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1969, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_11); if (unlikely((__pyx_t_10 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1969, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
/* … */
        __pyx_t_20.__pyx_n = 4;
        __pyx_t_20.n_st = __pyx_v_n_st;
        __pyx_t_20.n_sz = __pyx_v_n_sz;
        __pyx_t_20.use_adaptive = __pyx_v_use_adaptive;
        __pyx_t_20.simps_err = __pyx_v_simps_err;
        __pyx_t_3 = __pyx_f_4wfpt_full_pdf((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_x.diminfo[0].strides)), __pyx_t_10, __pyx_t_9, __pyx_t_8, __pyx_t_7, __pyx_t_6, __pyx_t_5, __pyx_t_4, __pyx_v_err, 0, &amp;__pyx_t_20); 
        __pyx_v_p = __pyx_t_3;
</pre><pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1970</span>:                              <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;sv&#39;</span><span class="p">],</span> <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">],</span> <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">],</span></pre>
<pre class='cython code score-39 '>        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_sv);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1970, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        __pyx_t_9 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_11); if (unlikely((__pyx_t_9 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1970, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_a);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1970, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        __pyx_t_8 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_11); if (unlikely((__pyx_t_8 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1970, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_z);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1970, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        __pyx_t_7 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_11); if (unlikely((__pyx_t_7 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1970, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
</pre><pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1971</span>:                              <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;sz&#39;</span><span class="p">],</span> <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">],</span> <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;st&#39;</span><span class="p">],</span></pre>
<pre class='cython code score-39 '>        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_sz);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1971, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        __pyx_t_6 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_11); if (unlikely((__pyx_t_6 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1971, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_t);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1971, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        __pyx_t_5 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_11); if (unlikely((__pyx_t_5 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1971, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_st);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1971, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_11); if (unlikely((__pyx_t_4 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1971, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1972</span>:                              <span class="n">err</span><span class="p">,</span> <span class="n">n_st</span><span class="p">,</span> <span class="n">n_sz</span><span class="p">,</span> <span class="n">use_adaptive</span><span class="p">,</span> <span class="n">simps_err</span><span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1973</span>:                 <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">p_outlier</span><span class="p">)</span> <span class="o">+</span> <span class="n">wp_outlier</span></pre>
<pre class='cython code score-0 '>        __pyx_v_p = ((__pyx_v_p * (1.0 - __pyx_v_p_outlier)) + __pyx_v_wp_outlier);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1974</span>:             <span class="k">elif</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mf">999.</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_19 = __pyx_v_i;
      __pyx_t_2 = (((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_x.diminfo[0].strides)) == 999.) != 0);
      if (__pyx_t_2) {
/* … */
        goto __pyx_L8;
      }
</pre><pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1975</span>:                 <span class="n">p</span> <span class="o">=</span> <span class="n">prob_ub</span><span class="p">(</span><span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">],</span> <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">],</span> <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">])</span></pre>
<pre class='cython code score-39 '>        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_v);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1975, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_11); if (unlikely((__pyx_t_3 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1975, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_a);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1975, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_11); if (unlikely((__pyx_t_4 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1975, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_z);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1975, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        __pyx_t_5 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_11); if (unlikely((__pyx_t_5 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1975, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_v_p = __pyx_f_4wfpt_prob_ub(__pyx_t_3, __pyx_t_4, __pyx_t_5);
</pre><pre class="cython line score-0">&#xA0;<span class="">1976</span>:             <span class="k">else</span><span class="p">:</span> <span class="c"># x[i] == -999.</span></pre>
<pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1977</span>:                 <span class="n">p</span> <span class="o">=</span> <span class="mf">1</span> <span class="o">-</span> <span class="n">prob_ub</span><span class="p">(</span><span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">],</span> <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">],</span> <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">])</span></pre>
<pre class='cython code score-39 '>      /*else*/ {
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_v);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1977, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        __pyx_t_5 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_11); if (unlikely((__pyx_t_5 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1977, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_a);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1977, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_11); if (unlikely((__pyx_t_4 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1977, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_z);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1977, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_11); if (unlikely((__pyx_t_3 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1977, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_v_p = (1.0 - __pyx_f_4wfpt_prob_ub(__pyx_t_5, __pyx_t_4, __pyx_t_3));
      }
      __pyx_L8:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1978</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1979</span>:             <span class="n">sum_logp</span> <span class="o">+=</span> <span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_sum_logp = (__pyx_v_sum_logp + log(__pyx_v_p));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">1980</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1981</span>:         <span class="k">return</span> <span class="n">sum_logp</span></pre>
<pre class='cython code score-6 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_11 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_sum_logp);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1981, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    __pyx_r = __pyx_t_11;
    __pyx_t_11 = 0;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">1982</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1983</span>: </pre>
<pre class="cython line score-58" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1984</span>: <span class="k">def</span> <span class="nf">wiener_like_multi_rlddm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x</span><span class="p">,</span></pre>
<pre class='cython code score-58 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_21wiener_like_multi_rlddm(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_20wiener_like_multi_rlddm[] = "wiener_like_multi_rlddm(ndarray x, ndarray response, ndarray feedback, ndarray split_by, double q, v, sv, a, z, sz, t, st, alpha, double err, multi=None, int n_st=10, int n_sz=10, bool use_adaptive=1, double simps_err=1e-3, double p_outlier=0, double w_outlier=0)";
static PyMethodDef __pyx_mdef_4wfpt_21wiener_like_multi_rlddm = {"wiener_like_multi_rlddm", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_21wiener_like_multi_rlddm, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_20wiener_like_multi_rlddm};
static PyObject *__pyx_pw_4wfpt_21wiener_like_multi_rlddm(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_x = 0;
  PyArrayObject *__pyx_v_response = 0;
  PyArrayObject *__pyx_v_feedback = 0;
  PyArrayObject *__pyx_v_split_by = 0;
  double __pyx_v_q;
  PyObject *__pyx_v_v = 0;
  PyObject *__pyx_v_sv = 0;
  PyObject *__pyx_v_a = 0;
  PyObject *__pyx_v_z = 0;
  PyObject *__pyx_v_sz = 0;
  PyObject *__pyx_v_t = 0;
  PyObject *__pyx_v_st = 0;
  PyObject *__pyx_v_alpha = 0;
  double __pyx_v_err;
  PyObject *__pyx_v_multi = 0;
  int __pyx_v_n_st;
  int __pyx_v_n_sz;
  int __pyx_v_use_adaptive;
  double __pyx_v_simps_err;
  double __pyx_v_p_outlier;
  double __pyx_v_w_outlier;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_multi_rlddm (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_x,&amp;__pyx_n_s_response,&amp;__pyx_n_s_feedback,&amp;__pyx_n_s_split_by,&amp;__pyx_n_s_q,&amp;__pyx_n_s_v,&amp;__pyx_n_s_sv,&amp;__pyx_n_s_a,&amp;__pyx_n_s_z,&amp;__pyx_n_s_sz,&amp;__pyx_n_s_t,&amp;__pyx_n_s_st,&amp;__pyx_n_s_alpha,&amp;__pyx_n_s_err,&amp;__pyx_n_s_multi,&amp;__pyx_n_s_n_st,&amp;__pyx_n_s_n_sz,&amp;__pyx_n_s_use_adaptive,&amp;__pyx_n_s_simps_err,&amp;__pyx_n_s_p_outlier,&amp;__pyx_n_s_w_outlier,0};
    PyObject* values[21] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_20wiener_like_multi_rlddm(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_x, PyArrayObject *__pyx_v_response, PyArrayObject *__pyx_v_feedback, PyArrayObject *__pyx_v_split_by, double __pyx_v_q, PyObject *__pyx_v_v, PyObject *__pyx_v_sv, PyObject *__pyx_v_a, PyObject *__pyx_v_z, PyObject *__pyx_v_sz, PyObject *__pyx_v_t, PyObject *__pyx_v_st, PyObject *__pyx_v_alpha, double __pyx_v_err, PyObject *__pyx_v_multi, int __pyx_v_n_st, int __pyx_v_n_sz, int __pyx_v_use_adaptive, double __pyx_v_simps_err, double __pyx_v_p_outlier, double __pyx_v_w_outlier) {
  Py_ssize_t __pyx_v_size;
  double __pyx_v_p;
  double __pyx_v_sum_logp;
  double __pyx_v_wp_outlier;
  PyArrayObject *__pyx_v_qs = 0;
  PyObject *__pyx_v_params = NULL;
  PyObject *__pyx_v_params_iter = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_param = NULL;
  PyObject *__pyx_v_alfa = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_feedback;
  __Pyx_Buffer __pyx_pybuffer_feedback;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_qs;
  __Pyx_Buffer __pyx_pybuffer_qs;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_response;
  __Pyx_Buffer __pyx_pybuffer_response;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_split_by;
  __Pyx_Buffer __pyx_pybuffer_split_by;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x;
  __Pyx_Buffer __pyx_pybuffer_x;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_multi_rlddm", 0);
  __pyx_pybuffer_qs.pybuffer.buf = NULL;
  __pyx_pybuffer_qs.refcount = 0;
  __pyx_pybuffernd_qs.data = NULL;
  __pyx_pybuffernd_qs.rcbuffer = &amp;__pyx_pybuffer_qs;
  __pyx_pybuffer_x.pybuffer.buf = NULL;
  __pyx_pybuffer_x.refcount = 0;
  __pyx_pybuffernd_x.data = NULL;
  __pyx_pybuffernd_x.rcbuffer = &amp;__pyx_pybuffer_x;
  __pyx_pybuffer_response.pybuffer.buf = NULL;
  __pyx_pybuffer_response.refcount = 0;
  __pyx_pybuffernd_response.data = NULL;
  __pyx_pybuffernd_response.rcbuffer = &amp;__pyx_pybuffer_response;
  __pyx_pybuffer_feedback.pybuffer.buf = NULL;
  __pyx_pybuffer_feedback.refcount = 0;
  __pyx_pybuffernd_feedback.data = NULL;
  __pyx_pybuffernd_feedback.rcbuffer = &amp;__pyx_pybuffer_feedback;
  __pyx_pybuffer_split_by.pybuffer.buf = NULL;
  __pyx_pybuffer_split_by.refcount = 0;
  __pyx_pybuffernd_split_by.data = NULL;
  __pyx_pybuffernd_split_by.rcbuffer = &amp;__pyx_pybuffer_split_by;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_x.diminfo[0].strides = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x.diminfo[0].shape = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_response.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_response, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_response.diminfo[0].strides = __pyx_pybuffernd_response.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_response.diminfo[0].shape = __pyx_pybuffernd_response.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_feedback, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_feedback.diminfo[0].strides = __pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_feedback.diminfo[0].shape = __pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_split_by, &amp;__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_split_by.diminfo[0].strides = __pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_split_by.diminfo[0].shape = __pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_multi_rlddm", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_feedback.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_split_by.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_qs);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_params);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_params_iter);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_param);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_alfa);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__29 = <span class='py_c_api'>PyTuple_Pack</span>(34, __pyx_n_s_x, __pyx_n_s_response, __pyx_n_s_feedback, __pyx_n_s_split_by, __pyx_n_s_q, __pyx_n_s_v, __pyx_n_s_sv, __pyx_n_s_a, __pyx_n_s_z, __pyx_n_s_sz, __pyx_n_s_t, __pyx_n_s_st, __pyx_n_s_alpha, __pyx_n_s_err, __pyx_n_s_multi, __pyx_n_s_n_st, __pyx_n_s_n_sz, __pyx_n_s_use_adaptive, __pyx_n_s_simps_err, __pyx_n_s_p_outlier, __pyx_n_s_w_outlier, __pyx_n_s_size, __pyx_n_s_ij, __pyx_n_s_s_size, __pyx_n_s_p, __pyx_n_s_sum_logp, __pyx_n_s_wp_outlier, __pyx_n_s_s, __pyx_n_s_qs, __pyx_n_s_params, __pyx_n_s_params_iter, __pyx_n_s_i, __pyx_n_s_param, __pyx_n_s_alfa);<span class='error_goto'> if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 1984, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__29);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__29);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_21wiener_like_multi_rlddm, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1984, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_wiener_like_multi_rlddm, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__30 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(21, 0, 34, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__29, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_wiener_like_multi_rlddm, 1984, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__30)) __PYX_ERR(0, 1984, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">1985</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">response</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1986</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">feedback</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1987</span>:                       <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">long</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">split_by</span><span class="p">,</span></pre>
<pre class="cython line score-203" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1988</span>:                       <span class="n">double</span> <span class="n">q</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">double</span> <span class="n">err</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span></pre>
<pre class='cython code score-203 '>    values[14] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 21: values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_response)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi_rlddm", 0, 14, 21, 1); <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_feedback)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi_rlddm", 0, 14, 21, 2); <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_split_by)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi_rlddm", 0, 14, 21, 3); <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_q)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi_rlddm", 0, 14, 21, 4); <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi_rlddm", 0, 14, 21, 5); <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sv)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi_rlddm", 0, 14, 21, 6); <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi_rlddm", 0, 14, 21, 7); <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi_rlddm", 0, 14, 21, 8); <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi_rlddm", 0, 14, 21, 9); <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_t)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi_rlddm", 0, 14, 21, 10); <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_st)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi_rlddm", 0, 14, 21, 11); <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (likely((values[12] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_alpha)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi_rlddm", 0, 14, 21, 12); <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (likely((values[13] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_err)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi_rlddm", 0, 14, 21, 13); <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_multi);
          if (value) { values[14] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_st);
          if (value) { values[15] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_sz);
          if (value) { values[16] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_use_adaptive);
          if (value) { values[17] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 18:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_simps_err);
          if (value) { values[18] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 19:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_p_outlier);
          if (value) { values[19] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 20:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w_outlier);
          if (value) { values[20] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "wiener_like_multi_rlddm") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 21: values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_x = ((PyArrayObject *)values[0]);
    __pyx_v_response = ((PyArrayObject *)values[1]);
    __pyx_v_feedback = ((PyArrayObject *)values[2]);
    __pyx_v_split_by = ((PyArrayObject *)values[3]);
    __pyx_v_q = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_q == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1988, __pyx_L3_error)</span>
    __pyx_v_v = values[5];
    __pyx_v_sv = values[6];
    __pyx_v_a = values[7];
    __pyx_v_z = values[8];
    __pyx_v_sz = values[9];
    __pyx_v_t = values[10];
    __pyx_v_st = values[11];
    __pyx_v_alpha = values[12];
    __pyx_v_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[13]); if (unlikely((__pyx_v_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1988, __pyx_L3_error)</span>
    __pyx_v_multi = values[14];
    if (values[15]) {
      __pyx_v_n_st = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[15]); if (unlikely((__pyx_v_n_st == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1989, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_st = ((int)10);
    }
    if (values[16]) {
      __pyx_v_n_sz = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[16]); if (unlikely((__pyx_v_n_sz == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1989, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_sz = ((int)10);
    }
    if (values[17]) {
      __pyx_v_use_adaptive = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[17]); if (unlikely((__pyx_v_use_adaptive == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1989, __pyx_L3_error)</span>
    } else {
      __pyx_v_use_adaptive = ((int)1);
    }
    if (values[18]) {
      __pyx_v_simps_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[18]); if (unlikely((__pyx_v_simps_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1989, __pyx_L3_error)</span>
    } else {
      __pyx_v_simps_err = ((double)1e-3);
    }
    if (values[19]) {
      __pyx_v_p_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[19]); if (unlikely((__pyx_v_p_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1990, __pyx_L3_error)</span>
    } else {
      __pyx_v_p_outlier = ((double)0.0);
    }
    if (values[20]) {
      __pyx_v_w_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[20]); if (unlikely((__pyx_v_w_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1990, __pyx_L3_error)</span>
    } else {
      __pyx_v_w_outlier = ((double)0.0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi_rlddm", 0, 14, 21, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_multi_rlddm", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x), __pyx_ptype_5numpy_ndarray, 1, "x", 0))) <span class='error_goto'>__PYX_ERR(0, 1984, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_response), __pyx_ptype_5numpy_ndarray, 1, "response", 0))) <span class='error_goto'>__PYX_ERR(0, 1985, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_feedback), __pyx_ptype_5numpy_ndarray, 1, "feedback", 0))) <span class='error_goto'>__PYX_ERR(0, 1986, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_split_by), __pyx_ptype_5numpy_ndarray, 1, "split_by", 0))) <span class='error_goto'>__PYX_ERR(0, 1987, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4wfpt_20wiener_like_multi_rlddm(__pyx_self, __pyx_v_x, __pyx_v_response, __pyx_v_feedback, __pyx_v_split_by, __pyx_v_q, __pyx_v_v, __pyx_v_sv, __pyx_v_a, __pyx_v_z, __pyx_v_sz, __pyx_v_t, __pyx_v_st, __pyx_v_alpha, __pyx_v_err, __pyx_v_multi, __pyx_v_n_st, __pyx_v_n_sz, __pyx_v_use_adaptive, __pyx_v_simps_err, __pyx_v_p_outlier, __pyx_v_w_outlier);
</pre><pre class="cython line score-0">&#xA0;<span class="">1989</span>:                       <span class="nb">int</span> <span class="n">n_st</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_sz</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">use_adaptive</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span> <span class="n">double</span> <span class="n">simps_err</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1990</span>:                       <span class="n">double</span> <span class="n">p_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="n">double</span> <span class="n">w_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">):</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1991</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">size</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_size = (__pyx_v_x-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">1992</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">ij</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1993</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">s_size</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1994</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">p</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_p = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1995</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sum_logp</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sum_logp = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1996</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">wp_outlier</span> <span class="o">=</span> <span class="n">w_outlier</span> <span class="o">*</span> <span class="n">p_outlier</span></pre>
<pre class='cython code score-0 '>  __pyx_v_wp_outlier = (__pyx_v_w_outlier * __pyx_v_p_outlier);
</pre><pre class="cython line score-0">&#xA0;<span class="">1997</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">s</span></pre>
<pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1998</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span></pre>
<pre class='cython code score-42 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1998, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1998, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1998, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1998, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1998, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4);
  __pyx_t_2 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 1998, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 1998, __pyx_L1_error)</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_qs = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 1998, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_qs.diminfo[0].strides = __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_qs.diminfo[0].shape = __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_qs = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1999</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2000</span>:     <span class="k">if</span> <span class="n">multi</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_7 = (__pyx_v_multi == Py_None);
  __pyx_t_8 = (__pyx_t_7 != 0);
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-86" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2001</span>:         <span class="k">return</span> <span class="n">full_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span></pre>
<pre class='cython code score-86 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_9 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(((PyObject *)__pyx_v_x)); if (unlikely((__pyx_t_9 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2001, __pyx_L1_error)</span>
    __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_v); if (unlikely((__pyx_t_10 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2001, __pyx_L1_error)</span>
    __pyx_t_11 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_sv); if (unlikely((__pyx_t_11 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2001, __pyx_L1_error)</span>
    __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_a); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2001, __pyx_L1_error)</span>
    __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_z); if (unlikely((__pyx_t_13 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2001, __pyx_L1_error)</span>
    __pyx_t_14 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_sz); if (unlikely((__pyx_t_14 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2001, __pyx_L1_error)</span>
    __pyx_t_15 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_t); if (unlikely((__pyx_t_15 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2001, __pyx_L1_error)</span>
    __pyx_t_16 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_st); if (unlikely((__pyx_t_16 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2001, __pyx_L1_error)</span>
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_4wfpt_full_pdf(__pyx_t_9, __pyx_t_10, __pyx_t_11, __pyx_t_12, __pyx_t_13, __pyx_t_14, __pyx_t_15, __pyx_t_16, __pyx_v_err, 0, NULL));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2001, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2002</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2003</span>:         <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;v&#39;</span><span class="p">:</span> <span class="n">v</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span> <span class="s">&#39;t&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="s">&#39;sv&#39;</span><span class="p">:</span> <span class="n">sv</span><span class="p">,</span> <span class="s">&#39;sz&#39;</span><span class="p">:</span> <span class="n">sz</span><span class="p">,</span> <span class="s">&#39;st&#39;</span><span class="p">:</span> <span class="n">st</span><span class="p">,</span> <span class="s">&#39;alpha&#39;</span><span class="p">:</span><span class="n">alpha</span><span class="p">}</span></pre>
<pre class='cython code score-42 '>  /*else*/ {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(8);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2003, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_v, __pyx_v_v) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2003, __pyx_L1_error)</span>
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_z, __pyx_v_z) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2003, __pyx_L1_error)</span>
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_t, __pyx_v_t) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2003, __pyx_L1_error)</span>
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_a, __pyx_v_a) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2003, __pyx_L1_error)</span>
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_sv, __pyx_v_sv) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2003, __pyx_L1_error)</span>
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_sz, __pyx_v_sz) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2003, __pyx_L1_error)</span>
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_st, __pyx_v_st) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2003, __pyx_L1_error)</span>
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_alpha, __pyx_v_alpha) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2003, __pyx_L1_error)</span>
    __pyx_v_params = ((PyObject*)__pyx_t_1);
    __pyx_t_1 = 0;
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2004</span>:         <span class="n">params_iter</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></pre>
<pre class='cython code score-16 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2004, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_5)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_v_params) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_v_params);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 2004, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_params_iter = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2005</span>:         <span class="n">qs</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-0 '>    __pyx_t_17 = 0;
    *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_qs.diminfo[0].strides) = __pyx_v_q;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2006</span>:         <span class="n">qs</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-0 '>    __pyx_t_17 = 1;
    *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_qs.diminfo[0].strides) = __pyx_v_q;
</pre><pre class="cython line score-52" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2007</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span></pre>
<pre class='cython code score-52 '>    __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_size);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2007, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_range, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2007, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3)) {
      __pyx_t_1 = __pyx_t_3; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_18 = 0;
      __pyx_t_19 = NULL;
    } else {
      __pyx_t_18 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2007, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_19 = Py_TYPE(__pyx_t_1)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 2007, __pyx_L1_error)</span>
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    for (;;) {
      if (likely(!__pyx_t_19)) {
        if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1))) {
          if (__pyx_t_18 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
          #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_18); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_18++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2007, __pyx_L1_error)</span>
          #else
          __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_18); __pyx_t_18++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2007, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          #endif
        } else {
          if (__pyx_t_18 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_1)) break;
          #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_18); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_18++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2007, __pyx_L1_error)</span>
          #else
          __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_18); __pyx_t_18++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2007, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          #endif
        }
      } else {
        __pyx_t_3 = __pyx_t_19(__pyx_t_1);
        if (unlikely(!__pyx_t_3)) {
          PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
          if (exc_type) {
            if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else <span class='error_goto'>__PYX_ERR(0, 2007, __pyx_L1_error)</span>
          }
          break;
        }
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_i, __pyx_t_3);
      __pyx_t_3 = 0;
/* … */
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-43" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2008</span>:             <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">multi</span><span class="p">:</span></pre>
<pre class='cython code score-43 '>      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_multi)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_multi)) {
        __pyx_t_3 = __pyx_v_multi; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_20 = 0;
        __pyx_t_21 = NULL;
      } else {
        __pyx_t_20 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_multi);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2008, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        __pyx_t_21 = Py_TYPE(__pyx_t_3)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 2008, __pyx_L1_error)</span>
      }
      for (;;) {
        if (likely(!__pyx_t_21)) {
          if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3))) {
            if (__pyx_t_20 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
            #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_20); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_20++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2008, __pyx_L1_error)</span>
            #else
            __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_20); __pyx_t_20++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2008, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            #endif
          } else {
            if (__pyx_t_20 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
            #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_20); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_20++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2008, __pyx_L1_error)</span>
            #else
            __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_20); __pyx_t_20++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2008, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            #endif
          }
        } else {
          __pyx_t_5 = __pyx_t_21(__pyx_t_3);
          if (unlikely(!__pyx_t_5)) {
            PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
            if (exc_type) {
              if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
              else <span class='error_goto'>__PYX_ERR(0, 2008, __pyx_L1_error)</span>
            }
            break;
          }
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        }
        <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_param, __pyx_t_5);
        __pyx_t_5 = 0;
/* … */
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2009</span>:                 <span class="n">params_iter</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-11 '>        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_v_params, __pyx_v_param);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2009, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_t_5, __pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2009, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_params_iter, __pyx_v_param, __pyx_t_4) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2009, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2010</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2011</span>:             <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="mf">0</span><span class="p">):</span></pre>
<pre class='cython code score-5 '>      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_NeObjC</span>(__pyx_v_i, __pyx_int_0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2011, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_3); if (unlikely(__pyx_t_8 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2011, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_8) {
/* … */
      }
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2012</span>:                 <span class="k">if</span> <span class="p">(</span><span class="n">split_by</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">split_by</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mf">1</span><span class="p">]):</span></pre>
<pre class='cython code score-17 '>        __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_split_by), __pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2012, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_SubtractObjC</span>(__pyx_v_i, __pyx_int_1, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2012, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_split_by), __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2012, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_4 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_3, __pyx_t_5, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2012, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_4); if (unlikely(__pyx_t_8 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2012, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        if (__pyx_t_8) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2013</span>:                     <span class="n">qs</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-0 '>          __pyx_t_17 = 0;
          *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_qs.diminfo[0].strides) = __pyx_v_q;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2014</span>:                     <span class="n">qs</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span></pre>
<pre class='cython code score-0 '>          __pyx_t_17 = 1;
          *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_qs.diminfo[0].strides) = __pyx_v_q;
</pre><pre class="cython line score-0">&#xA0;<span class="">2015</span>: </pre>
<pre class="cython line score-38" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2016</span>:             <span class="n">p</span> <span class="o">=</span> <span class="n">full_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">qs</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs</span><span class="p">[</span><span class="mf">0</span><span class="p">]),</span></pre>
<pre class='cython code score-38 '>      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_x), __pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2016, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_16 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_4); if (unlikely((__pyx_t_16 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2016, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_v);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2016, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_17 = 1;
      __pyx_t_22 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_qs.diminfo[0].strides)) - (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_qs.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_qs.diminfo[0].strides))));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2016, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_4, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2016, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_15 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_15 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2016, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
/* … */
      __pyx_t_24.__pyx_n = 4;
      __pyx_t_24.n_st = __pyx_v_n_st;
      __pyx_t_24.n_sz = __pyx_v_n_sz;
      __pyx_t_24.use_adaptive = __pyx_v_use_adaptive;
      __pyx_t_24.simps_err = __pyx_v_simps_err;
      __pyx_t_23 = __pyx_f_4wfpt_full_pdf(__pyx_t_16, __pyx_t_15, __pyx_t_14, __pyx_t_13, __pyx_t_12, __pyx_t_11, __pyx_t_10, __pyx_t_9, __pyx_v_err, 0, &amp;__pyx_t_24); 
      __pyx_v_p = __pyx_t_23;
</pre><pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2017</span>:                          <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;sv&#39;</span><span class="p">],</span> <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">],</span> <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">],</span></pre>
<pre class='cython code score-39 '>      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_sv);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2017, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_14 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_14 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2017, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_a);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2017, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_13 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_13 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2017, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_z);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2017, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2017, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2018</span>:                          <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;sz&#39;</span><span class="p">],</span> <span class="n">params_iter</span><span class="p">[</span></pre>
<pre class='cython code score-26 '>      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_sz);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2018, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_11 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_11 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2018, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_t);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2018, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_10 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2018, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2019</span>:                              <span class="s">&#39;t&#39;</span><span class="p">],</span> <span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;st&#39;</span><span class="p">],</span></pre>
<pre class='cython code score-13 '>      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_st);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2019, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_9 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_9 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2019, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2020</span>:                          <span class="n">err</span><span class="p">,</span> <span class="n">n_st</span><span class="p">,</span> <span class="n">n_sz</span><span class="p">,</span> <span class="n">use_adaptive</span><span class="p">,</span> <span class="n">simps_err</span><span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2021</span>:             <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">p_outlier</span><span class="p">)</span> <span class="o">+</span> <span class="n">wp_outlier</span></pre>
<pre class='cython code score-0 '>      __pyx_v_p = ((__pyx_v_p * (1.0 - __pyx_v_p_outlier)) + __pyx_v_wp_outlier);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2022</span>:             <span class="n">sum_logp</span> <span class="o">+=</span> <span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_sum_logp = (__pyx_v_sum_logp + log(__pyx_v_p));
</pre><pre class="cython line score-0">&#xA0;<span class="">2023</span>: </pre>
<pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2024</span>:             <span class="n">alfa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.718281828459</span><span class="o">**</span><span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="mf">2.718281828459</span><span class="o">**</span><span class="n">params_iter</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">])</span></pre>
<pre class='cython code score-24 '>      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_alpha);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2024, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_5 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_float_2_718281828459, __pyx_t_3, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2024, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_params_iter, __pyx_n_s_alpha);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2024, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_4 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_float_2_718281828459, __pyx_t_3, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2024, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_AddCObj</span>(__pyx_int_1, __pyx_t_4, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2024, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_t_5, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2024, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_alfa, __pyx_t_4);
      __pyx_t_4 = 0;
</pre><pre class="cython line score-41" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2025</span>:             <span class="n">qs</span><span class="p">[</span><span class="n">response</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="n">response</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">alfa</span> <span class="o">*</span> <span class="p">(</span><span class="n">feedback</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">qs</span><span class="p">[</span><span class="n">response</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span></pre>
<pre class='cython code score-41 '>      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_response), __pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2025, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_qs), __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2025, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_feedback), __pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2025, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_response), __pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2025, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_qs), __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2025, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_4, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2025, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_alfa, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2025, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_3, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2025, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_response), __pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2025, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_qs), __pyx_t_2, __pyx_t_5) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2025, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2026</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2027</span>:         <span class="k">return</span> <span class="n">sum_logp</span></pre>
<pre class='cython code score-6 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_sum_logp);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2027, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">2028</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2029</span>: </pre>
<pre class="cython line score-228" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2030</span>: <span class="k">def</span> <span class="nf">gen_rts_from_cdf</span><span class="p">(</span><span class="n">double</span> <span class="n">v</span><span class="p">,</span> <span class="n">double</span> <span class="n">sv</span><span class="p">,</span> <span class="n">double</span> <span class="n">a</span><span class="p">,</span> <span class="n">double</span> <span class="n">z</span><span class="p">,</span> <span class="n">double</span> <span class="n">sz</span><span class="p">,</span> <span class="n">double</span> <span class="n">t</span><span class="p">,</span></pre>
<pre class='cython code score-228 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_23gen_rts_from_cdf(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_22gen_rts_from_cdf[] = "gen_rts_from_cdf(double v, double sv, double a, double z, double sz, double t, double st, int samples=1000, double cdf_lb=-6, double cdf_ub=6, double dt=1e-2)";
static PyMethodDef __pyx_mdef_4wfpt_23gen_rts_from_cdf = {"gen_rts_from_cdf", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_23gen_rts_from_cdf, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_22gen_rts_from_cdf};
static PyObject *__pyx_pw_4wfpt_23gen_rts_from_cdf(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_v;
  double __pyx_v_sv;
  double __pyx_v_a;
  double __pyx_v_z;
  double __pyx_v_sz;
  double __pyx_v_t;
  double __pyx_v_st;
  int __pyx_v_samples;
  double __pyx_v_cdf_lb;
  double __pyx_v_cdf_ub;
  double __pyx_v_dt;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("gen_rts_from_cdf (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_v,&amp;__pyx_n_s_sv,&amp;__pyx_n_s_a,&amp;__pyx_n_s_z,&amp;__pyx_n_s_sz,&amp;__pyx_n_s_t,&amp;__pyx_n_s_st,&amp;__pyx_n_s_samples,&amp;__pyx_n_s_cdf_lb,&amp;__pyx_n_s_cdf_ub,&amp;__pyx_n_s_dt,0};
    PyObject* values[11] = {0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sv)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf", 0, 7, 11, 1); <span class='error_goto'>__PYX_ERR(0, 2030, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf", 0, 7, 11, 2); <span class='error_goto'>__PYX_ERR(0, 2030, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf", 0, 7, 11, 3); <span class='error_goto'>__PYX_ERR(0, 2030, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf", 0, 7, 11, 4); <span class='error_goto'>__PYX_ERR(0, 2030, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_t)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf", 0, 7, 11, 5); <span class='error_goto'>__PYX_ERR(0, 2030, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_st)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf", 0, 7, 11, 6); <span class='error_goto'>__PYX_ERR(0, 2030, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_samples);
          if (value) { values[7] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_cdf_lb);
          if (value) { values[8] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_cdf_ub);
          if (value) { values[9] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dt);
          if (value) { values[10] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gen_rts_from_cdf") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2030, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_v = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]); if (unlikely((__pyx_v_v == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2030, __pyx_L3_error)</span>
    __pyx_v_sv = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_sv == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2030, __pyx_L3_error)</span>
    __pyx_v_a = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_a == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2030, __pyx_L3_error)</span>
    __pyx_v_z = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_z == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2030, __pyx_L3_error)</span>
    __pyx_v_sz = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_sz == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2030, __pyx_L3_error)</span>
    __pyx_v_t = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[5]); if (unlikely((__pyx_v_t == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2030, __pyx_L3_error)</span>
    __pyx_v_st = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]); if (unlikely((__pyx_v_st == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2031, __pyx_L3_error)</span>
    if (values[7]) {
      __pyx_v_samples = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[7]); if (unlikely((__pyx_v_samples == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2031, __pyx_L3_error)</span>
    } else {
      __pyx_v_samples = ((int)0x3E8);
    }
    if (values[8]) {
      __pyx_v_cdf_lb = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]); if (unlikely((__pyx_v_cdf_lb == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2031, __pyx_L3_error)</span>
    } else {
      __pyx_v_cdf_lb = ((double)-6.0);
    }
    if (values[9]) {
      __pyx_v_cdf_ub = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[9]); if (unlikely((__pyx_v_cdf_ub == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2031, __pyx_L3_error)</span>
    } else {
      __pyx_v_cdf_ub = ((double)6.0);
    }
    if (values[10]) {
      __pyx_v_dt = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[10]); if (unlikely((__pyx_v_dt == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2031, __pyx_L3_error)</span>
    } else {
      __pyx_v_dt = ((double)1e-2);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf", 0, 7, 11, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 2030, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.gen_rts_from_cdf", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4wfpt_22gen_rts_from_cdf(__pyx_self, __pyx_v_v, __pyx_v_sv, __pyx_v_a, __pyx_v_z, __pyx_v_sz, __pyx_v_t, __pyx_v_st, __pyx_v_samples, __pyx_v_cdf_lb, __pyx_v_cdf_ub, __pyx_v_dt);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_22gen_rts_from_cdf(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_v, double __pyx_v_sv, double __pyx_v_a, double __pyx_v_z, double __pyx_v_sz, double __pyx_v_t, double __pyx_v_st, int __pyx_v_samples, double __pyx_v_cdf_lb, double __pyx_v_cdf_ub, double __pyx_v_dt) {
  PyArrayObject *__pyx_v_x = 0;
  PyArrayObject *__pyx_v_l_cdf = 0;
  double __pyx_v_pdf;
  double __pyx_v_rt;
  Py_ssize_t __pyx_v_size;
  Py_ssize_t __pyx_v_i;
  int __pyx_v_idx;
  PyArrayObject *__pyx_v_rts = 0;
  PyArrayObject *__pyx_v_f = 0;
  PyArrayObject *__pyx_v_delay = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_delay;
  __Pyx_Buffer __pyx_pybuffer_delay;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_f;
  __Pyx_Buffer __pyx_pybuffer_f;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_l_cdf;
  __Pyx_Buffer __pyx_pybuffer_l_cdf;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_rts;
  __Pyx_Buffer __pyx_pybuffer_rts;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x;
  __Pyx_Buffer __pyx_pybuffer_x;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("gen_rts_from_cdf", 0);
  __pyx_pybuffer_x.pybuffer.buf = NULL;
  __pyx_pybuffer_x.refcount = 0;
  __pyx_pybuffernd_x.data = NULL;
  __pyx_pybuffernd_x.rcbuffer = &amp;__pyx_pybuffer_x;
  __pyx_pybuffer_l_cdf.pybuffer.buf = NULL;
  __pyx_pybuffer_l_cdf.refcount = 0;
  __pyx_pybuffernd_l_cdf.data = NULL;
  __pyx_pybuffernd_l_cdf.rcbuffer = &amp;__pyx_pybuffer_l_cdf;
  __pyx_pybuffer_rts.pybuffer.buf = NULL;
  __pyx_pybuffer_rts.refcount = 0;
  __pyx_pybuffernd_rts.data = NULL;
  __pyx_pybuffernd_rts.rcbuffer = &amp;__pyx_pybuffer_rts;
  __pyx_pybuffer_f.pybuffer.buf = NULL;
  __pyx_pybuffer_f.refcount = 0;
  __pyx_pybuffernd_f.data = NULL;
  __pyx_pybuffernd_f.rcbuffer = &amp;__pyx_pybuffer_f;
  __pyx_pybuffer_delay.pybuffer.buf = NULL;
  __pyx_pybuffer_delay.refcount = 0;
  __pyx_pybuffernd_delay.data = NULL;
  __pyx_pybuffernd_delay.rcbuffer = &amp;__pyx_pybuffer_delay;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_delay.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_f.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_rts.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.gen_rts_from_cdf", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_delay.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_f.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_rts.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_x);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_l_cdf);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_rts);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_f);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_delay);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__31 = <span class='py_c_api'>PyTuple_Pack</span>(22, __pyx_n_s_v, __pyx_n_s_sv, __pyx_n_s_a, __pyx_n_s_z, __pyx_n_s_sz, __pyx_n_s_t, __pyx_n_s_st, __pyx_n_s_samples, __pyx_n_s_cdf_lb, __pyx_n_s_cdf_ub, __pyx_n_s_dt, __pyx_n_s_x, __pyx_n_s_l_cdf, __pyx_n_s_pdf, __pyx_n_s_rt, __pyx_n_s_size, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_idx, __pyx_n_s_rts, __pyx_n_s_f, __pyx_n_s_delay);<span class='error_goto'> if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 2030, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__31);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__31);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_23gen_rts_from_cdf, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2030, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_gen_rts_from_cdf, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2030, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__32 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(11, 0, 22, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__31, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_gen_rts_from_cdf, 2030, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__32)) __PYX_ERR(0, 2030, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">2031</span>:                      <span class="n">double</span> <span class="n">st</span><span class="p">,</span> <span class="nb">int</span> <span class="n">samples</span><span class="o">=</span><span class="mf">1000</span><span class="p">,</span> <span class="n">double</span> <span class="n">cdf_lb</span><span class="o">=-</span><span class="mf">6</span><span class="p">,</span> <span class="n">double</span> <span class="n">cdf_ub</span><span class="o">=</span><span class="mf">6</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2032</span>: </pre>
<pre class="cython line score-67" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2033</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cdf_lb</span><span class="p">,</span> <span class="n">cdf_ub</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span></pre>
<pre class='cython code score-67 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2033, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_arange);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2033, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_cdf_lb);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2033, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_cdf_ub);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2033, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_dt);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2033, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
    PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_t_2, __pyx_t_4, __pyx_t_5};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2033, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
    PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_t_2, __pyx_t_4, __pyx_t_5};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2033, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  {
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(3+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2033, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    if (__pyx_t_6) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+__pyx_t_7, __pyx_t_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1+__pyx_t_7, __pyx_t_4);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 2+__pyx_t_7, __pyx_t_5);
    __pyx_t_2 = 0;
    __pyx_t_4 = 0;
    __pyx_t_5 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2033, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2033, __pyx_L1_error)</span>
  __pyx_t_9 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_9, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_x = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2033, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_x.diminfo[0].strides = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x.diminfo[0].shape = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_9 = 0;
  __pyx_v_x = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-36" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2034</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">l_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span></pre>
<pre class='cython code score-36 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2034, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2034, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_Py_intptr_t</span>((__pyx_v_x-&gt;dimensions[0]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2034, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2034, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2034, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2034, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_double);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2034, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2034, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_8, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2034, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2034, __pyx_L1_error)</span>
  __pyx_t_10 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_10, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_l_cdf = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2034, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_l_cdf.diminfo[0].strides = __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_l_cdf.diminfo[0].shape = __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_10 = 0;
  __pyx_v_l_cdf = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2035</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">pdf</span><span class="p">,</span> <span class="nf">rt</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2036</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">size</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_size = (__pyx_v_x-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">2037</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2038</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">idx</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2039</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2040</span>:     <span class="n">l_cdf</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_t_11 = 0;
  *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_l_cdf.diminfo[0].strides) = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2041</span>:     <span class="k">for</span> <span class="n">i</span> <span class="k">from</span> <span class="mf">1</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_12 = __pyx_v_size;
  for (__pyx_v_i = 1; __pyx_v_i &lt; __pyx_t_12; __pyx_v_i++) {
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2042</span>:         <span class="n">pdf</span> <span class="o">=</span> <span class="n">full_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    __pyx_v_pdf = __pyx_f_4wfpt_full_pdf((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_x.diminfo[0].strides)), __pyx_v_v, __pyx_v_sv, __pyx_v_a, __pyx_v_z, __pyx_v_sz, 0.0, 0.0, 1e-4, 0, NULL);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2043</span>:         <span class="n">l_cdf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l_cdf</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pdf</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = (__pyx_v_i - 1);
    __pyx_t_13 = __pyx_v_i;
    *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_l_cdf.diminfo[0].strides) = ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_l_cdf.diminfo[0].strides)) + __pyx_v_pdf);
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">2044</span>: </pre>
<pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2045</span>:     <span class="n">l_cdf</span> <span class="o">/=</span> <span class="n">l_cdf</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-29 '>  __pyx_t_11 = ((__pyx_v_x-&gt;dimensions[0]) - 1);
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_l_cdf.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2045, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyNumber_InPlaceDivide</span>(((PyObject *)__pyx_v_l_cdf), __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2045, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2045, __pyx_L1_error)</span>
  __pyx_t_10 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_10, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_14, &amp;__pyx_t_15, &amp;__pyx_t_16);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_l_cdf, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_16);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_14, __pyx_t_15, __pyx_t_16);
      }
      __pyx_t_14 = __pyx_t_15 = __pyx_t_16 = 0;
    }
    __pyx_pybuffernd_l_cdf.diminfo[0].strides = __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_l_cdf.diminfo[0].shape = __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2045, __pyx_L1_error)</span>
  }
  __pyx_t_10 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_l_cdf, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2046</span>: </pre>
<pre class="cython line score-36" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2047</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">rts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span></pre>
<pre class='cython code score-36 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2047, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2047, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_samples);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2047, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2047, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2047, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2047, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_double);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2047, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2047, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_8, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2047, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2047, __pyx_L1_error)</span>
  __pyx_t_17 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_rts.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_17, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_rts = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_rts.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2047, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_rts.diminfo[0].strides = __pyx_pybuffernd_rts.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_rts.diminfo[0].shape = __pyx_pybuffernd_rts.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_17 = 0;
  __pyx_v_rts = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2048</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span></pre>
<pre class='cython code score-30 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2048, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2048, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_rand);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2048, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_samples);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2048, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_4, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 2048, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2048, __pyx_L1_error)</span>
  __pyx_t_18 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_f.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_18, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_f = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_f.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2048, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_f.diminfo[0].strides = __pyx_pybuffernd_f.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_f.diminfo[0].shape = __pyx_pybuffernd_f.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_18 = 0;
  __pyx_v_f = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2049</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">delay</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2050</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2051</span>:     <span class="k">if</span> <span class="n">st</span> <span class="o">!=</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_19 = ((__pyx_v_st != 0.0) != 0);
  if (__pyx_t_19) {
/* … */
  }
</pre><pre class="cython line score-69" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2052</span>:         <span class="n">delay</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="o">*</span> <span class="n">st</span> <span class="o">+</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">st</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span></pre>
<pre class='cython code score-69 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2052, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2052, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_rand);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2052, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_samples);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2052, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
      __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
      if (likely(__pyx_t_4)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
      }
    }
    __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_4, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 2052, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_st);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2052, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_8 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_5, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2052, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_t - (__pyx_v_st / 2.)));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2052, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_8, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2052, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2052, __pyx_L1_error)</span>
    __pyx_t_20 = ((PyArrayObject *)__pyx_t_5);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_delay.rcbuffer-&gt;pybuffer);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_delay.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_20, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_7 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_16, &amp;__pyx_t_15, &amp;__pyx_t_14);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_delay.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_delay, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_14);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_16, __pyx_t_15, __pyx_t_14);
        }
        __pyx_t_16 = __pyx_t_15 = __pyx_t_14 = 0;
      }
      __pyx_pybuffernd_delay.diminfo[0].strides = __pyx_pybuffernd_delay.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_delay.diminfo[0].shape = __pyx_pybuffernd_delay.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2052, __pyx_L1_error)</span>
    }
    __pyx_t_20 = 0;
    __pyx_v_delay = ((PyArrayObject *)__pyx_t_5);
    __pyx_t_5 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2053</span>:     <span class="k">for</span> <span class="n">i</span> <span class="k">from</span> <span class="mf">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">samples</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_7 = __pyx_v_samples;
  for (__pyx_v_i = 0; __pyx_v_i &lt; __pyx_t_7; __pyx_v_i++) {
</pre><pre class="cython line score-56" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2054</span>:         <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">l_cdf</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">])</span></pre>
<pre class='cython code score-56 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2054, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_searchsorted);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2054, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_11 = __pyx_v_i;
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_f.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_f.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2054, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_4 = NULL;
    __pyx_t_21 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
      __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
      if (likely(__pyx_t_4)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
        __pyx_t_21 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_8)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, ((PyObject *)__pyx_v_l_cdf), __pyx_t_1};
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-__pyx_t_21, 2+__pyx_t_21);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2054, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_8)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, ((PyObject *)__pyx_v_l_cdf), __pyx_t_1};
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-__pyx_t_21, 2+__pyx_t_21);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2054, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    } else
    #endif
    {
      __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_21);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2054, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      if (__pyx_t_4) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4); __pyx_t_4 = NULL;
      }
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_l_cdf));
      <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_l_cdf));
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0+__pyx_t_21, ((PyObject *)__pyx_v_l_cdf));
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1+__pyx_t_21, __pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2054, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_21 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_5); if (unlikely((__pyx_t_21 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2054, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_v_idx = __pyx_t_21;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2055</span>:         <span class="n">rt</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_idx;
    __pyx_v_rt = (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_x.diminfo[0].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2056</span>:         <span class="k">if</span> <span class="n">st</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_19 = ((__pyx_v_st == 0.0) != 0);
    if (__pyx_t_19) {
/* … */
      goto __pyx_L8;
    }
</pre><pre class="cython line score-60" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2057</span>:             <span class="n">rt</span> <span class="o">=</span> <span class="n">rt</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">rt</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span></pre>
<pre class='cython code score-60 '>      __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_rt);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2057, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2057, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_sign);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2057, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_rt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2057, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_4 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
        __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
        if (likely(__pyx_t_4)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
        }
      }
      __pyx_t_8 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_4, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_8)) <span class='error_goto'>__PYX_ERR(0, 2057, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_t);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2057, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_8, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2057, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_5, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2057, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_22 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1); if (unlikely((__pyx_t_22 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2057, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_rt = __pyx_t_22;
</pre><pre class="cython line score-0">&#xA0;<span class="">2058</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-60" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2059</span>:             <span class="n">rt</span> <span class="o">=</span> <span class="n">rt</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">rt</span><span class="p">)</span> <span class="o">*</span> <span class="n">delay</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-60 '>    /*else*/ {
      __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_rt);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2059, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2059, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_sign);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2059, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_rt);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2059, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_4 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
        __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
        if (likely(__pyx_t_4)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
        }
      }
      __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_4, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, __pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 2059, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_11 = __pyx_v_i;
      __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_delay.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_delay.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2059, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_5 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_3, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2059, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2059, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_22 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_8); if (unlikely((__pyx_t_22 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2059, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_v_rt = __pyx_t_22;
    }
    __pyx_L8:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2060</span>:         <span class="n">rts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rt</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_rts.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_rts.diminfo[0].strides) = __pyx_v_rt;
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2061</span>:     <span class="k">return</span> <span class="n">rts</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_rts));
  __pyx_r = ((PyObject *)__pyx_v_rts);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2062</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2063</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2064</span>: <span class="c"># JY added for simulation with factorial design</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2065</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2066</span>:         <span class="c"># rts = hddm.wfpt.gen_rts_from_cdf_factorial(            </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2067</span>:         <span class="c">#     params[&quot;v&quot;],</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2068</span>:         <span class="c">#     params[&quot;sv&quot;],</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2069</span>:         <span class="c">#     params[&quot;a&quot;],</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2070</span>:         <span class="c">#     params[&quot;z&quot;],</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2071</span>:         <span class="c">#     params[&quot;sz&quot;],</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2072</span>:         <span class="c">#     params[&quot;t&quot;],</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2073</span>:         <span class="c">#     params[&quot;st&quot;],</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2074</span>:         <span class="c">#     # JY added on 2022-02-17 for factorial</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2075</span>:         <span class="c">#     params[&quot;a2&quot;], </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2076</span>:         <span class="c">#     params[&quot;t2&quot;], </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2077</span>:         <span class="c">#     params[&quot;z0&quot;], </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2078</span>:         <span class="c">#     params[&quot;z1&quot;], </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2079</span>:         <span class="c">#     params[&quot;z2&quot;], </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2080</span>:         <span class="c">#     params[&quot;v0&quot;], </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2081</span>:         <span class="c">#     params[&quot;v1&quot;], </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2082</span>:         <span class="c">#     params[&quot;v2&quot;],</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2083</span>:         <span class="c">#     # ===========</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2084</span>:         <span class="c">#     size,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2085</span>:         <span class="c">#     range_[0],</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2086</span>:         <span class="c">#     range_[1],</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2087</span>:         <span class="c">#     dt,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2088</span>:         <span class="c">#     )</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2089</span>: </pre>
<pre class="cython line score-356" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2090</span>: <span class="k">def</span> <span class="nf">gen_rts_from_cdf_factorial</span><span class="p">(</span><span class="n">double</span> <span class="n">v</span><span class="p">,</span> <span class="n">double</span> <span class="n">sv</span><span class="p">,</span> <span class="n">double</span> <span class="n">a</span><span class="p">,</span> <span class="n">double</span> <span class="n">z</span><span class="p">,</span> <span class="n">double</span> <span class="n">sz</span><span class="p">,</span> <span class="n">double</span> <span class="n">t</span><span class="p">,</span></pre>
<pre class='cython code score-356 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_25gen_rts_from_cdf_factorial(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_24gen_rts_from_cdf_factorial[] = "gen_rts_from_cdf_factorial(double v, double sv, double a, double z, double sz, double t, double st, double a2, double t2, double z0, double z1, double z2, double v0, double v1, double v2, int samples=1000, double cdf_lb=-6, double cdf_ub=6, double dt=1e-2)";
static PyMethodDef __pyx_mdef_4wfpt_25gen_rts_from_cdf_factorial = {"gen_rts_from_cdf_factorial", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_25gen_rts_from_cdf_factorial, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_24gen_rts_from_cdf_factorial};
static PyObject *__pyx_pw_4wfpt_25gen_rts_from_cdf_factorial(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_v;
  double __pyx_v_sv;
  double __pyx_v_a;
  double __pyx_v_z;
  double __pyx_v_sz;
  double __pyx_v_t;
  double __pyx_v_st;
  CYTHON_UNUSED double __pyx_v_a2;
  CYTHON_UNUSED double __pyx_v_t2;
  CYTHON_UNUSED double __pyx_v_z0;
  CYTHON_UNUSED double __pyx_v_z1;
  CYTHON_UNUSED double __pyx_v_z2;
  CYTHON_UNUSED double __pyx_v_v0;
  CYTHON_UNUSED double __pyx_v_v1;
  CYTHON_UNUSED double __pyx_v_v2;
  int __pyx_v_samples;
  double __pyx_v_cdf_lb;
  double __pyx_v_cdf_ub;
  double __pyx_v_dt;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("gen_rts_from_cdf_factorial (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_v,&amp;__pyx_n_s_sv,&amp;__pyx_n_s_a,&amp;__pyx_n_s_z,&amp;__pyx_n_s_sz,&amp;__pyx_n_s_t,&amp;__pyx_n_s_st,&amp;__pyx_n_s_a2,&amp;__pyx_n_s_t2,&amp;__pyx_n_s_z0,&amp;__pyx_n_s_z1,&amp;__pyx_n_s_z2,&amp;__pyx_n_s_v0,&amp;__pyx_n_s_v1,&amp;__pyx_n_s_v2,&amp;__pyx_n_s_samples,&amp;__pyx_n_s_cdf_lb,&amp;__pyx_n_s_cdf_ub,&amp;__pyx_n_s_dt,0};
    PyObject* values[19] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sv)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf_factorial", 0, 15, 19, 1); <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf_factorial", 0, 15, 19, 2); <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf_factorial", 0, 15, 19, 3); <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf_factorial", 0, 15, 19, 4); <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_t)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf_factorial", 0, 15, 19, 5); <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_st)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf_factorial", 0, 15, 19, 6); <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_a2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf_factorial", 0, 15, 19, 7); <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_t2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf_factorial", 0, 15, 19, 8); <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z0)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf_factorial", 0, 15, 19, 9); <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf_factorial", 0, 15, 19, 10); <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf_factorial", 0, 15, 19, 11); <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (likely((values[12] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v0)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf_factorial", 0, 15, 19, 12); <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (likely((values[13] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf_factorial", 0, 15, 19, 13); <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (likely((values[14] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf_factorial", 0, 15, 19, 14); <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_samples);
          if (value) { values[15] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_cdf_lb);
          if (value) { values[16] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_cdf_ub);
          if (value) { values[17] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 18:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dt);
          if (value) { values[18] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gen_rts_from_cdf_factorial") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_v = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]); if (unlikely((__pyx_v_v == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
    __pyx_v_sv = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_sv == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
    __pyx_v_a = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_a == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
    __pyx_v_z = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_z == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
    __pyx_v_sz = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_sz == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
    __pyx_v_t = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[5]); if (unlikely((__pyx_v_t == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
    __pyx_v_st = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]); if (unlikely((__pyx_v_st == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2091, __pyx_L3_error)</span>
    __pyx_v_a2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[7]); if (unlikely((__pyx_v_a2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2092, __pyx_L3_error)</span>
    __pyx_v_t2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]); if (unlikely((__pyx_v_t2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2092, __pyx_L3_error)</span>
    __pyx_v_z0 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[9]); if (unlikely((__pyx_v_z0 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2093, __pyx_L3_error)</span>
    __pyx_v_z1 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[10]); if (unlikely((__pyx_v_z1 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2093, __pyx_L3_error)</span>
    __pyx_v_z2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[11]); if (unlikely((__pyx_v_z2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2093, __pyx_L3_error)</span>
    __pyx_v_v0 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[12]); if (unlikely((__pyx_v_v0 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2094, __pyx_L3_error)</span>
    __pyx_v_v1 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[13]); if (unlikely((__pyx_v_v1 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2094, __pyx_L3_error)</span>
    __pyx_v_v2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[14]); if (unlikely((__pyx_v_v2 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2094, __pyx_L3_error)</span>
    if (values[15]) {
      __pyx_v_samples = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[15]); if (unlikely((__pyx_v_samples == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2095, __pyx_L3_error)</span>
    } else {
      __pyx_v_samples = ((int)0x3E8);
    }
    if (values[16]) {
      __pyx_v_cdf_lb = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[16]); if (unlikely((__pyx_v_cdf_lb == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2095, __pyx_L3_error)</span>
    } else {
      __pyx_v_cdf_lb = ((double)-6.0);
    }
    if (values[17]) {
      __pyx_v_cdf_ub = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[17]); if (unlikely((__pyx_v_cdf_ub == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2095, __pyx_L3_error)</span>
    } else {
      __pyx_v_cdf_ub = ((double)6.0);
    }
    if (values[18]) {
      __pyx_v_dt = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[18]); if (unlikely((__pyx_v_dt == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2095, __pyx_L3_error)</span>
    } else {
      __pyx_v_dt = ((double)1e-2);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_rts_from_cdf_factorial", 0, 15, 19, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.gen_rts_from_cdf_factorial", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4wfpt_24gen_rts_from_cdf_factorial(__pyx_self, __pyx_v_v, __pyx_v_sv, __pyx_v_a, __pyx_v_z, __pyx_v_sz, __pyx_v_t, __pyx_v_st, __pyx_v_a2, __pyx_v_t2, __pyx_v_z0, __pyx_v_z1, __pyx_v_z2, __pyx_v_v0, __pyx_v_v1, __pyx_v_v2, __pyx_v_samples, __pyx_v_cdf_lb, __pyx_v_cdf_ub, __pyx_v_dt);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_24gen_rts_from_cdf_factorial(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_v, double __pyx_v_sv, double __pyx_v_a, double __pyx_v_z, double __pyx_v_sz, double __pyx_v_t, double __pyx_v_st, CYTHON_UNUSED double __pyx_v_a2, CYTHON_UNUSED double __pyx_v_t2, CYTHON_UNUSED double __pyx_v_z0, CYTHON_UNUSED double __pyx_v_z1, CYTHON_UNUSED double __pyx_v_z2, CYTHON_UNUSED double __pyx_v_v0, CYTHON_UNUSED double __pyx_v_v1, CYTHON_UNUSED double __pyx_v_v2, int __pyx_v_samples, double __pyx_v_cdf_lb, double __pyx_v_cdf_ub, double __pyx_v_dt) {
  PyArrayObject *__pyx_v_x = 0;
  PyArrayObject *__pyx_v_l_cdf = 0;
  double __pyx_v_pdf;
  double __pyx_v_rt;
  Py_ssize_t __pyx_v_size;
  Py_ssize_t __pyx_v_i;
  int __pyx_v_idx;
  PyArrayObject *__pyx_v_rts = 0;
  PyArrayObject *__pyx_v_f = 0;
  PyArrayObject *__pyx_v_delay = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_delay;
  __Pyx_Buffer __pyx_pybuffer_delay;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_f;
  __Pyx_Buffer __pyx_pybuffer_f;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_l_cdf;
  __Pyx_Buffer __pyx_pybuffer_l_cdf;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_rts;
  __Pyx_Buffer __pyx_pybuffer_rts;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x;
  __Pyx_Buffer __pyx_pybuffer_x;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("gen_rts_from_cdf_factorial", 0);
  __pyx_pybuffer_x.pybuffer.buf = NULL;
  __pyx_pybuffer_x.refcount = 0;
  __pyx_pybuffernd_x.data = NULL;
  __pyx_pybuffernd_x.rcbuffer = &amp;__pyx_pybuffer_x;
  __pyx_pybuffer_l_cdf.pybuffer.buf = NULL;
  __pyx_pybuffer_l_cdf.refcount = 0;
  __pyx_pybuffernd_l_cdf.data = NULL;
  __pyx_pybuffernd_l_cdf.rcbuffer = &amp;__pyx_pybuffer_l_cdf;
  __pyx_pybuffer_rts.pybuffer.buf = NULL;
  __pyx_pybuffer_rts.refcount = 0;
  __pyx_pybuffernd_rts.data = NULL;
  __pyx_pybuffernd_rts.rcbuffer = &amp;__pyx_pybuffer_rts;
  __pyx_pybuffer_f.pybuffer.buf = NULL;
  __pyx_pybuffer_f.refcount = 0;
  __pyx_pybuffernd_f.data = NULL;
  __pyx_pybuffernd_f.rcbuffer = &amp;__pyx_pybuffer_f;
  __pyx_pybuffer_delay.pybuffer.buf = NULL;
  __pyx_pybuffer_delay.refcount = 0;
  __pyx_pybuffernd_delay.data = NULL;
  __pyx_pybuffernd_delay.rcbuffer = &amp;__pyx_pybuffer_delay;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_delay.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_f.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_rts.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.gen_rts_from_cdf_factorial", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_delay.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_f.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_rts.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_x);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_l_cdf);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_rts);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_f);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_delay);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__33 = <span class='py_c_api'>PyTuple_Pack</span>(30, __pyx_n_s_v, __pyx_n_s_sv, __pyx_n_s_a, __pyx_n_s_z, __pyx_n_s_sz, __pyx_n_s_t, __pyx_n_s_st, __pyx_n_s_a2, __pyx_n_s_t2, __pyx_n_s_z0, __pyx_n_s_z1, __pyx_n_s_z2, __pyx_n_s_v0, __pyx_n_s_v1, __pyx_n_s_v2, __pyx_n_s_samples, __pyx_n_s_cdf_lb, __pyx_n_s_cdf_ub, __pyx_n_s_dt, __pyx_n_s_x, __pyx_n_s_l_cdf, __pyx_n_s_pdf, __pyx_n_s_rt, __pyx_n_s_size, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_idx, __pyx_n_s_rts, __pyx_n_s_f, __pyx_n_s_delay);<span class='error_goto'> if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 2090, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__33);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__33);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_25gen_rts_from_cdf_factorial, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2090, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_gen_rts_from_cdf_factorial, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2090, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__34 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(19, 0, 30, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_gen_rts_from_cdf_factorial, 2090, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__34)) __PYX_ERR(0, 2090, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">2091</span>:                      <span class="n">double</span> <span class="n">st</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2092</span>:                      <span class="n">double</span> <span class="n">a2</span><span class="p">,</span> <span class="n">double</span> <span class="n">t2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2093</span>:                      <span class="n">double</span> <span class="n">z0</span><span class="p">,</span> <span class="n">double</span> <span class="n">z1</span><span class="p">,</span> <span class="n">double</span> <span class="n">z2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2094</span>:                      <span class="n">double</span> <span class="n">v0</span><span class="p">,</span> <span class="n">double</span> <span class="n">v1</span><span class="p">,</span> <span class="n">double</span> <span class="n">v2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2095</span>:                      <span class="nb">int</span> <span class="n">samples</span><span class="o">=</span><span class="mf">1000</span><span class="p">,</span> <span class="n">double</span> <span class="n">cdf_lb</span><span class="o">=-</span><span class="mf">6</span><span class="p">,</span> <span class="n">double</span> <span class="n">cdf_ub</span><span class="o">=</span><span class="mf">6</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2096</span>: </pre>
<pre class="cython line score-67" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2097</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cdf_lb</span><span class="p">,</span> <span class="n">cdf_ub</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span></pre>
<pre class='cython code score-67 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2097, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_arange);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2097, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_cdf_lb);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2097, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_cdf_ub);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2097, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_dt);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2097, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
    PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_t_2, __pyx_t_4, __pyx_t_5};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2097, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
    PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_t_2, __pyx_t_4, __pyx_t_5};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2097, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  {
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(3+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2097, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    if (__pyx_t_6) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+__pyx_t_7, __pyx_t_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1+__pyx_t_7, __pyx_t_4);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 2+__pyx_t_7, __pyx_t_5);
    __pyx_t_2 = 0;
    __pyx_t_4 = 0;
    __pyx_t_5 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2097, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2097, __pyx_L1_error)</span>
  __pyx_t_9 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_9, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_x = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2097, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_x.diminfo[0].strides = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x.diminfo[0].shape = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_9 = 0;
  __pyx_v_x = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-36" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2098</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">l_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span></pre>
<pre class='cython code score-36 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2098, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2098, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_Py_intptr_t</span>((__pyx_v_x-&gt;dimensions[0]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2098, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2098, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2098, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2098, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_double);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2098, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2098, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_8, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2098, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2098, __pyx_L1_error)</span>
  __pyx_t_10 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_10, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_l_cdf = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2098, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_l_cdf.diminfo[0].strides = __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_l_cdf.diminfo[0].shape = __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_10 = 0;
  __pyx_v_l_cdf = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2099</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">pdf</span><span class="p">,</span> <span class="nf">rt</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2100</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">size</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_size = (__pyx_v_x-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">2101</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2102</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">idx</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2103</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2104</span>:     <span class="n">l_cdf</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_t_11 = 0;
  *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_l_cdf.diminfo[0].strides) = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2105</span>:     <span class="k">for</span> <span class="n">i</span> <span class="k">from</span> <span class="mf">1</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_12 = __pyx_v_size;
  for (__pyx_v_i = 1; __pyx_v_i &lt; __pyx_t_12; __pyx_v_i++) {
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2106</span>:         <span class="n">pdf</span> <span class="o">=</span> <span class="n">full_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    __pyx_v_pdf = __pyx_f_4wfpt_full_pdf((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_x.diminfo[0].strides)), __pyx_v_v, __pyx_v_sv, __pyx_v_a, __pyx_v_z, __pyx_v_sz, 0.0, 0.0, 1e-4, 0, NULL);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2107</span>:         <span class="n">l_cdf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l_cdf</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pdf</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = (__pyx_v_i - 1);
    __pyx_t_13 = __pyx_v_i;
    *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_l_cdf.diminfo[0].strides) = ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_l_cdf.diminfo[0].strides)) + __pyx_v_pdf);
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">2108</span>: </pre>
<pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2109</span>:     <span class="n">l_cdf</span> <span class="o">/=</span> <span class="n">l_cdf</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-29 '>  __pyx_t_11 = ((__pyx_v_x-&gt;dimensions[0]) - 1);
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_l_cdf.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2109, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyNumber_InPlaceDivide</span>(((PyObject *)__pyx_v_l_cdf), __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2109, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2109, __pyx_L1_error)</span>
  __pyx_t_10 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_10, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_14, &amp;__pyx_t_15, &amp;__pyx_t_16);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_l_cdf, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_16);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_14, __pyx_t_15, __pyx_t_16);
      }
      __pyx_t_14 = __pyx_t_15 = __pyx_t_16 = 0;
    }
    __pyx_pybuffernd_l_cdf.diminfo[0].strides = __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_l_cdf.diminfo[0].shape = __pyx_pybuffernd_l_cdf.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2109, __pyx_L1_error)</span>
  }
  __pyx_t_10 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_l_cdf, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2110</span>: </pre>
<pre class="cython line score-36" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2111</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">rts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span></pre>
<pre class='cython code score-36 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_samples);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_double);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2111, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_8, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2111, __pyx_L1_error)</span>
  __pyx_t_17 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_rts.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_17, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_rts = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_rts.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2111, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_rts.diminfo[0].strides = __pyx_pybuffernd_rts.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_rts.diminfo[0].shape = __pyx_pybuffernd_rts.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_17 = 0;
  __pyx_v_rts = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2112</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span></pre>
<pre class='cython code score-30 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_rand);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_samples);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_4, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 2112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2112, __pyx_L1_error)</span>
  __pyx_t_18 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_f.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_18, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_f = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_f.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2112, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_f.diminfo[0].strides = __pyx_pybuffernd_f.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_f.diminfo[0].shape = __pyx_pybuffernd_f.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_18 = 0;
  __pyx_v_f = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2113</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">delay</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2114</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2115</span>:     <span class="k">if</span> <span class="n">st</span> <span class="o">!=</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_19 = ((__pyx_v_st != 0.0) != 0);
  if (__pyx_t_19) {
/* … */
  }
</pre><pre class="cython line score-69" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2116</span>:         <span class="n">delay</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="o">*</span> <span class="n">st</span> <span class="o">+</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">st</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span></pre>
<pre class='cython code score-69 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2116, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_random);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2116, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_rand);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2116, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_samples);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2116, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
      __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
      if (likely(__pyx_t_4)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
      }
    }
    __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_4, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 2116, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_st);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2116, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_8 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_5, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2116, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_t - (__pyx_v_st / 2.)));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2116, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_8, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2116, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2116, __pyx_L1_error)</span>
    __pyx_t_20 = ((PyArrayObject *)__pyx_t_5);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_delay.rcbuffer-&gt;pybuffer);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_delay.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_20, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_7 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_16, &amp;__pyx_t_15, &amp;__pyx_t_14);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_delay.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_delay, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_14);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_16, __pyx_t_15, __pyx_t_14);
        }
        __pyx_t_16 = __pyx_t_15 = __pyx_t_14 = 0;
      }
      __pyx_pybuffernd_delay.diminfo[0].strides = __pyx_pybuffernd_delay.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_delay.diminfo[0].shape = __pyx_pybuffernd_delay.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2116, __pyx_L1_error)</span>
    }
    __pyx_t_20 = 0;
    __pyx_v_delay = ((PyArrayObject *)__pyx_t_5);
    __pyx_t_5 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2117</span>:     <span class="k">for</span> <span class="n">i</span> <span class="k">from</span> <span class="mf">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">samples</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_7 = __pyx_v_samples;
  for (__pyx_v_i = 0; __pyx_v_i &lt; __pyx_t_7; __pyx_v_i++) {
</pre><pre class="cython line score-56" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2118</span>:         <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">l_cdf</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">])</span></pre>
<pre class='cython code score-56 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2118, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_searchsorted);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2118, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_11 = __pyx_v_i;
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_f.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_f.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2118, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_4 = NULL;
    __pyx_t_21 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
      __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
      if (likely(__pyx_t_4)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
        __pyx_t_21 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_8)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, ((PyObject *)__pyx_v_l_cdf), __pyx_t_1};
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-__pyx_t_21, 2+__pyx_t_21);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2118, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_8)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, ((PyObject *)__pyx_v_l_cdf), __pyx_t_1};
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_8, __pyx_temp+1-__pyx_t_21, 2+__pyx_t_21);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2118, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    } else
    #endif
    {
      __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_21);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2118, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      if (__pyx_t_4) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4); __pyx_t_4 = NULL;
      }
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_l_cdf));
      <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_l_cdf));
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0+__pyx_t_21, ((PyObject *)__pyx_v_l_cdf));
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1+__pyx_t_21, __pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2118, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_21 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_5); if (unlikely((__pyx_t_21 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2118, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_v_idx = __pyx_t_21;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2119</span>:         <span class="n">rt</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_idx;
    __pyx_v_rt = (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_x.diminfo[0].strides));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2120</span>:         <span class="k">if</span> <span class="n">st</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_19 = ((__pyx_v_st == 0.0) != 0);
    if (__pyx_t_19) {
/* … */
      goto __pyx_L8;
    }
</pre><pre class="cython line score-60" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2121</span>:             <span class="n">rt</span> <span class="o">=</span> <span class="n">rt</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">rt</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span></pre>
<pre class='cython code score-60 '>      __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_rt);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2121, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2121, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_sign);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2121, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_rt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2121, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_4 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
        __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
        if (likely(__pyx_t_4)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
        }
      }
      __pyx_t_8 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_4, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_8)) <span class='error_goto'>__PYX_ERR(0, 2121, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_t);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2121, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_8, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2121, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_5, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2121, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_22 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1); if (unlikely((__pyx_t_22 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2121, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_rt = __pyx_t_22;
</pre><pre class="cython line score-0">&#xA0;<span class="">2122</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-60" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2123</span>:             <span class="n">rt</span> <span class="o">=</span> <span class="n">rt</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">rt</span><span class="p">)</span> <span class="o">*</span> <span class="n">delay</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-60 '>    /*else*/ {
      __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_rt);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2123, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2123, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_sign);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2123, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_rt);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2123, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_4 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
        __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
        if (likely(__pyx_t_4)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
        }
      }
      __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_4, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, __pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 2123, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_11 = __pyx_v_i;
      __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_delay.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_delay.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2123, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_5 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_3, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2123, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2123, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_22 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_8); if (unlikely((__pyx_t_22 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2123, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_v_rt = __pyx_t_22;
    }
    __pyx_L8:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2124</span>:         <span class="n">rts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rt</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    *__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_rts.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_rts.diminfo[0].strides) = __pyx_v_rt;
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2125</span>:     <span class="k">return</span> <span class="n">rts</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_rts));
  __pyx_r = ((PyObject *)__pyx_v_rts);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2126</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2127</span>: </pre>
<pre class="cython line score-269" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2128</span>: <span class="k">def</span> <span class="nf">wiener_like_contaminant</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">cont_x</span><span class="p">,</span> <span class="n">double</span> <span class="n">v</span><span class="p">,</span></pre>
<pre class='cython code score-269 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_27wiener_like_contaminant(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_26wiener_like_contaminant[] = "wiener_like_contaminant(ndarray x, ndarray cont_x, double v, double sv, double a, double z, double sz, double t, double st, double t_min, double t_max, double err, int n_st=10, int n_sz=10, bool use_adaptive=1, double simps_err=1e-8)\nWiener likelihood function where RTs could come from a\n    separate, uniform contaminant distribution.\n\n    Reference: Lee, Vandekerckhove, Navarro, &amp; Tuernlinckx (2007)\n    ";
static PyMethodDef __pyx_mdef_4wfpt_27wiener_like_contaminant = {"wiener_like_contaminant", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_27wiener_like_contaminant, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_26wiener_like_contaminant};
static PyObject *__pyx_pw_4wfpt_27wiener_like_contaminant(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_x = 0;
  PyArrayObject *__pyx_v_cont_x = 0;
  double __pyx_v_v;
  double __pyx_v_sv;
  double __pyx_v_a;
  double __pyx_v_z;
  double __pyx_v_sz;
  double __pyx_v_t;
  double __pyx_v_st;
  double __pyx_v_t_min;
  double __pyx_v_t_max;
  double __pyx_v_err;
  int __pyx_v_n_st;
  int __pyx_v_n_sz;
  int __pyx_v_use_adaptive;
  double __pyx_v_simps_err;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_contaminant (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_x,&amp;__pyx_n_s_cont_x,&amp;__pyx_n_s_v,&amp;__pyx_n_s_sv,&amp;__pyx_n_s_a,&amp;__pyx_n_s_z,&amp;__pyx_n_s_sz,&amp;__pyx_n_s_t,&amp;__pyx_n_s_st,&amp;__pyx_n_s_t_min,&amp;__pyx_n_s_t_max,&amp;__pyx_n_s_err,&amp;__pyx_n_s_n_st,&amp;__pyx_n_s_n_sz,&amp;__pyx_n_s_use_adaptive,&amp;__pyx_n_s_simps_err,0};
    PyObject* values[16] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_cont_x)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_contaminant", 0, 12, 16, 1); <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_contaminant", 0, 12, 16, 2); <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sv)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_contaminant", 0, 12, 16, 3); <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_contaminant", 0, 12, 16, 4); <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_contaminant", 0, 12, 16, 5); <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_contaminant", 0, 12, 16, 6); <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_t)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_contaminant", 0, 12, 16, 7); <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_st)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_contaminant", 0, 12, 16, 8); <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_t_min)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_contaminant", 0, 12, 16, 9); <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_t_max)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_contaminant", 0, 12, 16, 10); <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_err)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_contaminant", 0, 12, 16, 11); <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_st);
          if (value) { values[12] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_sz);
          if (value) { values[13] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_use_adaptive);
          if (value) { values[14] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_simps_err);
          if (value) { values[15] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "wiener_like_contaminant") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_x = ((PyArrayObject *)values[0]);
    __pyx_v_cont_x = ((PyArrayObject *)values[1]);
    __pyx_v_v = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_v == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L3_error)</span>
    __pyx_v_sv = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_sv == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2129, __pyx_L3_error)</span>
    __pyx_v_a = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_a == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2129, __pyx_L3_error)</span>
    __pyx_v_z = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[5]); if (unlikely((__pyx_v_z == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2129, __pyx_L3_error)</span>
    __pyx_v_sz = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]); if (unlikely((__pyx_v_sz == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2129, __pyx_L3_error)</span>
    __pyx_v_t = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[7]); if (unlikely((__pyx_v_t == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2129, __pyx_L3_error)</span>
    __pyx_v_st = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]); if (unlikely((__pyx_v_st == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2129, __pyx_L3_error)</span>
    __pyx_v_t_min = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[9]); if (unlikely((__pyx_v_t_min == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2129, __pyx_L3_error)</span>
    __pyx_v_t_max = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[10]); if (unlikely((__pyx_v_t_max == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2130, __pyx_L3_error)</span>
    __pyx_v_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[11]); if (unlikely((__pyx_v_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2130, __pyx_L3_error)</span>
    if (values[12]) {
      __pyx_v_n_st = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[12]); if (unlikely((__pyx_v_n_st == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2130, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_st = ((int)10);
    }
    if (values[13]) {
      __pyx_v_n_sz = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[13]); if (unlikely((__pyx_v_n_sz == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2130, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_sz = ((int)10);
    }
    if (values[14]) {
      __pyx_v_use_adaptive = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[14]); if (unlikely((__pyx_v_use_adaptive == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2130, __pyx_L3_error)</span>
    } else {
      __pyx_v_use_adaptive = ((int)1);
    }
    if (values[15]) {
      __pyx_v_simps_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[15]); if (unlikely((__pyx_v_simps_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2131, __pyx_L3_error)</span>
    } else {
      __pyx_v_simps_err = ((double)1e-8);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_contaminant", 0, 12, 16, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_contaminant", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x), __pyx_ptype_5numpy_ndarray, 1, "x", 0))) <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_cont_x), __pyx_ptype_5numpy_ndarray, 1, "cont_x", 0))) <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4wfpt_26wiener_like_contaminant(__pyx_self, __pyx_v_x, __pyx_v_cont_x, __pyx_v_v, __pyx_v_sv, __pyx_v_a, __pyx_v_z, __pyx_v_sz, __pyx_v_t, __pyx_v_st, __pyx_v_t_min, __pyx_v_t_max, __pyx_v_err, __pyx_v_n_st, __pyx_v_n_sz, __pyx_v_use_adaptive, __pyx_v_simps_err);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_26wiener_like_contaminant(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_x, PyArrayObject *__pyx_v_cont_x, double __pyx_v_v, double __pyx_v_sv, double __pyx_v_a, double __pyx_v_z, double __pyx_v_sz, double __pyx_v_t, double __pyx_v_st, double __pyx_v_t_min, double __pyx_v_t_max, double __pyx_v_err, int __pyx_v_n_st, int __pyx_v_n_sz, int __pyx_v_use_adaptive, double __pyx_v_simps_err) {
  CYTHON_UNUSED Py_ssize_t __pyx_v_size;
  Py_ssize_t __pyx_v_i;
  double __pyx_v_p;
  double __pyx_v_sum_logp;
  int __pyx_v_n_cont;
  CYTHON_UNUSED int __pyx_v_pos_cont;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_cont_x;
  __Pyx_Buffer __pyx_pybuffer_cont_x;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x;
  __Pyx_Buffer __pyx_pybuffer_x;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_contaminant", 0);
  __pyx_pybuffer_x.pybuffer.buf = NULL;
  __pyx_pybuffer_x.refcount = 0;
  __pyx_pybuffernd_x.data = NULL;
  __pyx_pybuffernd_x.rcbuffer = &amp;__pyx_pybuffer_x;
  __pyx_pybuffer_cont_x.pybuffer.buf = NULL;
  __pyx_pybuffer_cont_x.refcount = 0;
  __pyx_pybuffernd_cont_x.data = NULL;
  __pyx_pybuffernd_cont_x.rcbuffer = &amp;__pyx_pybuffer_cont_x;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_x.diminfo[0].strides = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x.diminfo[0].shape = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_cont_x.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_cont_x, &amp;__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_cont_x.diminfo[0].strides = __pyx_pybuffernd_cont_x.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_cont_x.diminfo[0].shape = __pyx_pybuffernd_cont_x.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cont_x.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_contaminant", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cont_x.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__35 = <span class='py_c_api'>PyTuple_Pack</span>(22, __pyx_n_s_x, __pyx_n_s_cont_x, __pyx_n_s_v, __pyx_n_s_sv, __pyx_n_s_a, __pyx_n_s_z, __pyx_n_s_sz, __pyx_n_s_t, __pyx_n_s_st, __pyx_n_s_t_min, __pyx_n_s_t_max, __pyx_n_s_err, __pyx_n_s_n_st, __pyx_n_s_n_sz, __pyx_n_s_use_adaptive, __pyx_n_s_simps_err, __pyx_n_s_size, __pyx_n_s_i, __pyx_n_s_p, __pyx_n_s_sum_logp, __pyx_n_s_n_cont, __pyx_n_s_pos_cont);<span class='error_goto'> if (unlikely(!__pyx_tuple__35)) __PYX_ERR(0, 2128, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__35);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__35);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_27wiener_like_contaminant, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2128, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_wiener_like_contaminant, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2128, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__36 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(16, 0, 22, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__35, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_wiener_like_contaminant, 2128, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__36)) __PYX_ERR(0, 2128, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">2129</span>:                             <span class="n">double</span> <span class="n">sv</span><span class="p">,</span> <span class="n">double</span> <span class="n">a</span><span class="p">,</span> <span class="n">double</span> <span class="n">z</span><span class="p">,</span> <span class="n">double</span> <span class="n">sz</span><span class="p">,</span> <span class="n">double</span> <span class="n">t</span><span class="p">,</span> <span class="n">double</span> <span class="n">st</span><span class="p">,</span> <span class="n">double</span> <span class="n">t_min</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2130</span>:                             <span class="n">double</span> <span class="n">t_max</span><span class="p">,</span> <span class="n">double</span> <span class="n">err</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_st</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_sz</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">use_adaptive</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2131</span>:                             <span class="n">double</span> <span class="n">simps_err</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2132</span>:     <span class="sd">&quot;&quot;&quot;Wiener likelihood function where RTs could come from a</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2133</span>: <span class="sd">    separate, uniform contaminant distribution.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2134</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2135</span>: <span class="sd">    Reference: Lee, Vandekerckhove, Navarro, &amp; Tuernlinckx (2007)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2136</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2137</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">size</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_size = (__pyx_v_x-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">2138</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2139</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">p</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2140</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sum_logp</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sum_logp = 0.0;
</pre><pre class="cython line score-27" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2141</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">n_cont</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cont_x</span><span class="p">)</span></pre>
<pre class='cython code score-27 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2141, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2141, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, ((PyObject *)__pyx_v_cont_x)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, ((PyObject *)__pyx_v_cont_x));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 2141, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2141, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_n_cont = __pyx_t_4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2142</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">pos_cont</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_pos_cont = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2143</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2144</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="k">nogil</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span></pre>
<pre class='cython code score-6 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
        __pyx_t_5 = __pyx_v_size;
        if ((1 == 0)) abort();
        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            __pyx_t_7 = (__pyx_t_5 - 0 + 1 - 1/abs(1)) / 1;
            if (__pyx_t_7 &gt; 0)
            {
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for firstprivate(__pyx_v_i) lastprivate(__pyx_v_i) lastprivate(__pyx_v_p) reduction(+:__pyx_v_sum_logp)
                    #endif /* _OPENMP */
                    for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_7; __pyx_t_6++){
                        {
                            __pyx_v_i = (Py_ssize_t)(0 + 1 * __pyx_t_6);
                            /* Initialize private variables to invalid values */
                            __pyx_v_p = ((double)__PYX_NAN());
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L5;
        }
        __pyx_L4_error: {
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L1_error;
        }
        __pyx_L5:;
      }
  }
</pre><pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2145</span>:         <span class="k">if</span> <span class="n">cont_x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-18 '>                            __pyx_t_8 = __pyx_v_i;
                            __pyx_t_9 = (((*__Pyx_BufPtrStrided1d(int *, __pyx_pybuffernd_cont_x.rcbuffer-&gt;pybuffer.buf, __pyx_t_8, __pyx_pybuffernd_cont_x.diminfo[0].strides)) == 0) != 0);
                            if (__pyx_t_9) {
/* … */
                            }
                            goto __pyx_L18;
                            __pyx_L9_return:;
                            __pyx_parallel_why = 3;
                            goto __pyx_L17;
                            __pyx_L8_error:;
                            {
                                #ifdef WITH_THREAD
                                PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                #endif
                                #ifdef _OPENMP
                                #pragma omp flush(__pyx_parallel_exc_type)
                                #endif /* _OPENMP */
                                if (!__pyx_parallel_exc_type) {
                                  <span class='pyx_c_api'>__Pyx_ErrFetchWithState</span>(&amp;__pyx_parallel_exc_type, &amp;__pyx_parallel_exc_value, &amp;__pyx_parallel_exc_tb);
                                  __pyx_parallel_filename = __pyx_filename; __pyx_parallel_lineno = __pyx_lineno; __pyx_parallel_clineno = __pyx_clineno;
                                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_parallel_exc_type);
                                }
                                #ifdef WITH_THREAD
                                <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                #endif
                            }
                            __pyx_parallel_why = 4;
                            goto __pyx_L17;
                            __pyx_L17:;
                            #ifdef _OPENMP
                            #pragma omp critical(__pyx_parallel_lastprivates0)
                            #endif /* _OPENMP */
                            {
                                __pyx_parallel_temp0 = __pyx_v_i;
                                __pyx_parallel_temp1 = __pyx_v_p;
                                __pyx_parallel_temp2 = __pyx_v_sum_logp;
                            }
                            __pyx_L18:;
                            #ifdef _OPENMP
                            #pragma omp flush(__pyx_parallel_why)
                            #endif /* _OPENMP */
                        }
                    }
                    #ifdef _OPENMP
                    Py_END_ALLOW_THREADS
                    #else
{
#ifdef WITH_THREAD
                    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                    #endif
                    #endif /* _OPENMP */
                    /* Clean up any temporaries */
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
                    __pyx_t_1 = NULL;
                    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
                    __pyx_t_3 = NULL;
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                    #ifndef _OPENMP
}
#endif /* _OPENMP */
                }
            }
            if (__pyx_parallel_exc_type) {
              /* This may have been overridden by a continue, break or return in another thread. Prefer the error. */
              __pyx_parallel_why = 4;
            }
            if (__pyx_parallel_why) {
              __pyx_v_i = __pyx_parallel_temp0;
              __pyx_v_p = __pyx_parallel_temp1;
              __pyx_v_sum_logp = __pyx_parallel_temp2;
              switch (__pyx_parallel_why) {
                    case 4:
                {
                    #ifdef WITH_THREAD
                    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                    #endif
                    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_parallel_exc_type);
                    <span class='pyx_c_api'>__Pyx_ErrRestoreWithState</span>(__pyx_parallel_exc_type, __pyx_parallel_exc_value, __pyx_parallel_exc_tb);
                    __pyx_filename = __pyx_parallel_filename; __pyx_lineno = __pyx_parallel_lineno; __pyx_clineno = __pyx_parallel_clineno;
                    #ifdef WITH_THREAD
                    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                    #endif
                }
                goto __pyx_L4_error;
              }
            }
        }
        #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
            #undef likely
            #undef unlikely
            #define likely(x)   __builtin_expect(!!(x), 1)
            #define unlikely(x) __builtin_expect(!!(x), 0)
        #endif
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2146</span>:             <span class="n">p</span> <span class="o">=</span> <span class="n">full_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>                              __pyx_t_8 = __pyx_v_i;
/* … */
                              __pyx_t_11.__pyx_n = 4;
                              __pyx_t_11.n_st = __pyx_v_n_st;
                              __pyx_t_11.n_sz = __pyx_v_n_sz;
                              __pyx_t_11.use_adaptive = __pyx_v_use_adaptive;
                              __pyx_t_11.simps_err = __pyx_v_simps_err;
                              __pyx_t_10 = __pyx_f_4wfpt_full_pdf((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.buf, __pyx_t_8, __pyx_pybuffernd_x.diminfo[0].strides)), __pyx_v_v, __pyx_v_sv, __pyx_v_a, __pyx_v_z, __pyx_v_sz, __pyx_v_t, __pyx_v_st, __pyx_v_err, 0, &amp;__pyx_t_11); 
                              __pyx_v_p = __pyx_t_10;
</pre><pre class="cython line score-0">&#xA0;<span class="">2147</span>:                          <span class="n">n_st</span><span class="p">,</span> <span class="n">n_sz</span><span class="p">,</span> <span class="n">use_adaptive</span><span class="p">,</span> <span class="n">simps_err</span><span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2148</span>:             <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>                              __pyx_t_9 = ((__pyx_v_p == 0.0) != 0);
                              if (__pyx_t_9) {
/* … */
                              }
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2149</span>:                 <span class="k">with</span> <span class="k">gil</span><span class="p">:</span></pre>
<pre class='cython code score-6 '>                                {
                                    #ifdef WITH_THREAD
                                    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
                                    #endif
                                    /*try:*/ {
/* … */
                                    /*finally:*/ {
                                      __pyx_L14_return: {
                                        #ifdef WITH_THREAD
                                        <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                        #endif
                                        goto __pyx_L9_return;
                                      }
                                      __pyx_L15_error: {
                                        #ifdef WITH_THREAD
                                        <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
                                        #endif
                                        goto __pyx_L8_error;
                                      }
                                    }
                                }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2150</span>:                     <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-12 '>                                      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
                                      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2150, __pyx_L15_error)</span>
                                      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                                      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2150, __pyx_L15_error)</span>
                                      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
                                      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
                                      __pyx_t_1 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2150, __pyx_L15_error)</span>
                                      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
                                      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
                                      __pyx_r = __pyx_t_1;
                                      __pyx_t_1 = 0;
                                      goto __pyx_L14_return;
                                    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2151</span>:             <span class="n">sum_logp</span> <span class="o">+=</span> <span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>                              __pyx_v_sum_logp = (__pyx_v_sum_logp + log(__pyx_v_p));
</pre><pre class="cython line score-0">&#xA0;<span class="">2152</span>:         <span class="c"># If one probability = 0, the log sum will be -Inf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2153</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2154</span>:     <span class="c"># add the log likelihood of the contaminations</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2155</span>:     <span class="n">sum_logp</span> <span class="o">+=</span> <span class="n">n_cont</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">t_max</span> <span class="o">-</span> <span class="n">t_min</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sum_logp = (__pyx_v_sum_logp + (__pyx_v_n_cont * log(((0.5 * 1.) / (__pyx_v_t_max - __pyx_v_t_min)))));
</pre><pre class="cython line score-0">&#xA0;<span class="">2156</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2157</span>:     <span class="k">return</span> <span class="n">sum_logp</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_sum_logp);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2157, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2158</span>: </pre>
<pre class="cython line score-287" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2159</span>: <span class="k">def</span> <span class="nf">gen_cdf_using_pdf</span><span class="p">(</span><span class="n">double</span> <span class="n">v</span><span class="p">,</span> <span class="n">double</span> <span class="n">sv</span><span class="p">,</span> <span class="n">double</span> <span class="n">a</span><span class="p">,</span> <span class="n">double</span> <span class="n">z</span><span class="p">,</span> <span class="n">double</span> <span class="n">sz</span><span class="p">,</span> <span class="n">double</span> <span class="n">t</span><span class="p">,</span> <span class="n">double</span> <span class="n">st</span><span class="p">,</span> <span class="n">double</span> <span class="n">err</span><span class="p">,</span></pre>
<pre class='cython code score-287 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_29gen_cdf_using_pdf(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_28gen_cdf_using_pdf[] = "gen_cdf_using_pdf(double v, double sv, double a, double z, double sz, double t, double st, double err, int N=500, double time=5., int n_st=2, int n_sz=2, bool use_adaptive=1, double simps_err=1e-3, double p_outlier=0, double w_outlier=0)\n\n    generate cdf vector using the pdf\n    ";
static PyMethodDef __pyx_mdef_4wfpt_29gen_cdf_using_pdf = {"gen_cdf_using_pdf", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_29gen_cdf_using_pdf, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_28gen_cdf_using_pdf};
static PyObject *__pyx_pw_4wfpt_29gen_cdf_using_pdf(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_v;
  double __pyx_v_sv;
  double __pyx_v_a;
  double __pyx_v_z;
  double __pyx_v_sz;
  double __pyx_v_t;
  double __pyx_v_st;
  double __pyx_v_err;
  int __pyx_v_N;
  double __pyx_v_time;
  int __pyx_v_n_st;
  int __pyx_v_n_sz;
  int __pyx_v_use_adaptive;
  double __pyx_v_simps_err;
  double __pyx_v_p_outlier;
  double __pyx_v_w_outlier;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("gen_cdf_using_pdf (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_v,&amp;__pyx_n_s_sv,&amp;__pyx_n_s_a,&amp;__pyx_n_s_z,&amp;__pyx_n_s_sz,&amp;__pyx_n_s_t,&amp;__pyx_n_s_st,&amp;__pyx_n_s_err,&amp;__pyx_n_s_N,&amp;__pyx_n_s_time,&amp;__pyx_n_s_n_st,&amp;__pyx_n_s_n_sz,&amp;__pyx_n_s_use_adaptive,&amp;__pyx_n_s_simps_err,&amp;__pyx_n_s_p_outlier,&amp;__pyx_n_s_w_outlier,0};
    PyObject* values[16] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sv)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_cdf_using_pdf", 0, 8, 16, 1); <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_cdf_using_pdf", 0, 8, 16, 2); <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_cdf_using_pdf", 0, 8, 16, 3); <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_cdf_using_pdf", 0, 8, 16, 4); <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_t)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_cdf_using_pdf", 0, 8, 16, 5); <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_st)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_cdf_using_pdf", 0, 8, 16, 6); <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_err)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_cdf_using_pdf", 0, 8, 16, 7); <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_N);
          if (value) { values[8] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_time);
          if (value) { values[9] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_st);
          if (value) { values[10] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_n_sz);
          if (value) { values[11] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_use_adaptive);
          if (value) { values[12] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_simps_err);
          if (value) { values[13] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_p_outlier);
          if (value) { values[14] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w_outlier);
          if (value) { values[15] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gen_cdf_using_pdf") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_v = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]); if (unlikely((__pyx_v_v == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
    __pyx_v_sv = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_sv == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
    __pyx_v_a = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_a == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
    __pyx_v_z = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_z == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
    __pyx_v_sz = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_sz == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
    __pyx_v_t = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[5]); if (unlikely((__pyx_v_t == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
    __pyx_v_st = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]); if (unlikely((__pyx_v_st == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
    __pyx_v_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[7]); if (unlikely((__pyx_v_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
    if (values[8]) {
      __pyx_v_N = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[8]); if (unlikely((__pyx_v_N == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2160, __pyx_L3_error)</span>
    } else {
      __pyx_v_N = ((int)0x1F4);
    }
    if (values[9]) {
      __pyx_v_time = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[9]); if (unlikely((__pyx_v_time == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2160, __pyx_L3_error)</span>
    } else {
      __pyx_v_time = ((double)5.);
    }
    if (values[10]) {
      __pyx_v_n_st = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[10]); if (unlikely((__pyx_v_n_st == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2160, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_st = ((int)2);
    }
    if (values[11]) {
      __pyx_v_n_sz = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[11]); if (unlikely((__pyx_v_n_sz == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2160, __pyx_L3_error)</span>
    } else {
      __pyx_v_n_sz = ((int)2);
    }
    if (values[12]) {
      __pyx_v_use_adaptive = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[12]); if (unlikely((__pyx_v_use_adaptive == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2160, __pyx_L3_error)</span>
    } else {
      __pyx_v_use_adaptive = ((int)1);
    }
    if (values[13]) {
      __pyx_v_simps_err = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[13]); if (unlikely((__pyx_v_simps_err == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2160, __pyx_L3_error)</span>
    } else {
      __pyx_v_simps_err = ((double)1e-3);
    }
    if (values[14]) {
      __pyx_v_p_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[14]); if (unlikely((__pyx_v_p_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2161, __pyx_L3_error)</span>
    } else {
      __pyx_v_p_outlier = ((double)0.0);
    }
    if (values[15]) {
      __pyx_v_w_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[15]); if (unlikely((__pyx_v_w_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2161, __pyx_L3_error)</span>
    } else {
      __pyx_v_w_outlier = ((double)0.0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gen_cdf_using_pdf", 0, 8, 16, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.gen_cdf_using_pdf", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4wfpt_28gen_cdf_using_pdf(__pyx_self, __pyx_v_v, __pyx_v_sv, __pyx_v_a, __pyx_v_z, __pyx_v_sz, __pyx_v_t, __pyx_v_st, __pyx_v_err, __pyx_v_N, __pyx_v_time, __pyx_v_n_st, __pyx_v_n_sz, __pyx_v_use_adaptive, __pyx_v_simps_err, __pyx_v_p_outlier, __pyx_v_w_outlier);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_28gen_cdf_using_pdf(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_v, double __pyx_v_sv, double __pyx_v_a, double __pyx_v_z, double __pyx_v_sz, double __pyx_v_t, double __pyx_v_st, double __pyx_v_err, int __pyx_v_N, double __pyx_v_time, int __pyx_v_n_st, int __pyx_v_n_sz, int __pyx_v_use_adaptive, double __pyx_v_simps_err, double __pyx_v_p_outlier, double __pyx_v_w_outlier) {
  PyArrayObject *__pyx_v_x = 0;
  PyArrayObject *__pyx_v_cdf_array = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_cdf_array;
  __Pyx_Buffer __pyx_pybuffer_cdf_array;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x;
  __Pyx_Buffer __pyx_pybuffer_x;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("gen_cdf_using_pdf", 0);
  __pyx_pybuffer_x.pybuffer.buf = NULL;
  __pyx_pybuffer_x.refcount = 0;
  __pyx_pybuffernd_x.data = NULL;
  __pyx_pybuffernd_x.rcbuffer = &amp;__pyx_pybuffer_x;
  __pyx_pybuffer_cdf_array.pybuffer.buf = NULL;
  __pyx_pybuffer_cdf_array.refcount = 0;
  __pyx_pybuffernd_cdf_array.data = NULL;
  __pyx_pybuffernd_cdf_array.rcbuffer = &amp;__pyx_pybuffer_cdf_array;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_19);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_20);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_21);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_22);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_23);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.gen_cdf_using_pdf", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_x);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_cdf_array);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__37 = <span class='py_c_api'>PyTuple_Pack</span>(19, __pyx_n_s_v, __pyx_n_s_sv, __pyx_n_s_a, __pyx_n_s_z, __pyx_n_s_sz, __pyx_n_s_t, __pyx_n_s_st, __pyx_n_s_err, __pyx_n_s_N, __pyx_n_s_time, __pyx_n_s_n_st, __pyx_n_s_n_sz, __pyx_n_s_use_adaptive, __pyx_n_s_simps_err, __pyx_n_s_p_outlier, __pyx_n_s_w_outlier, __pyx_n_s_x, __pyx_n_s_cdf_array, __pyx_n_s_idx);<span class='error_goto'> if (unlikely(!__pyx_tuple__37)) __PYX_ERR(0, 2159, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__37);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__37);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_29gen_cdf_using_pdf, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2159, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_gen_cdf_using_pdf, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2159, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__38 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(16, 0, 19, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__37, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_gen_cdf_using_pdf, 2159, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__38)) __PYX_ERR(0, 2159, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">2160</span>:                       <span class="nb">int</span> <span class="n">N</span><span class="o">=</span><span class="mf">500</span><span class="p">,</span> <span class="n">double</span> <span class="n">time</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_st</span><span class="o">=</span><span class="mf">2</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n_sz</span><span class="o">=</span><span class="mf">2</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">use_adaptive</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span> <span class="n">double</span> <span class="n">simps_err</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2161</span>:                       <span class="n">double</span> <span class="n">p_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="n">double</span> <span class="n">w_outlier</span><span class="o">=</span><span class="mf">0</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2162</span>:     <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2163</span>: <span class="sd">    generate cdf vector using the pdf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2164</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2165</span>:     <span class="k">if</span> <span class="p">(</span><span class="n">sv</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="mf">0</span> <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">z</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">z</span> <span class="o">&gt;</span> <span class="mf">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sz</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sz</span> <span class="o">&gt;</span> <span class="mf">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">&gt;</span> <span class="mf">1</span><span class="p">)</span> <span class="ow">or</span> \</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_sv &lt; 0.0) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_a &lt;= 0.0) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_z &lt; 0.0) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_z &gt; 1.0) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_sz &lt; 0.0) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_sz &gt; 1.0) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = (((__pyx_v_z + (__pyx_v_sz / 2.)) &gt; 1.0) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
/* … */
  if (unlikely(__pyx_t_1)) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2166</span>:             <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">sz</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">st</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">st</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">p_outlier_in_range</span><span class="p">(</span><span class="n">p_outlier</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = (((__pyx_v_z - (__pyx_v_sz / 2.)) &lt; 0.0) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = (((__pyx_v_t - (__pyx_v_st / 2.)) &lt; 0.0) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_t &lt; 0.0) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_st &lt; 0.0) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = ((!(__pyx_f_4wfpt_p_outlier_in_range(__pyx_v_p_outlier) != 0)) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L4_bool_binop_done:;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2167</span>:         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span></pre>
<pre class='cython code score-10 '>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ValueError, __pyx_tuple__4, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2167, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='error_goto'>__PYX_ERR(0, 2167, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__4 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_at_least_one_of_the_parameters_i);<span class='error_goto'> if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 2167, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__4);
</pre><pre class="cython line score-0">&#xA0;<span class="">2168</span>:             <span class="s">&quot;at least one of the parameters is out of the support&quot;</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2169</span>: </pre>
<pre class="cython line score-64" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2170</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">time</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">N</span> <span class="o">+</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-64 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_linspace);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((-__pyx_v_time));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_time);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(((2 * __pyx_v_N) + 1));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_8 = NULL;
  __pyx_t_9 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_8)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
      __pyx_t_9 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_5)) {
    PyObject *__pyx_temp[4] = {__pyx_t_8, __pyx_t_4, __pyx_t_6, __pyx_t_7};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2170, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_5)) {
    PyObject *__pyx_temp[4] = {__pyx_t_8, __pyx_t_4, __pyx_t_6, __pyx_t_7};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2170, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  } else
  #endif
  {
    __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(3+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2170, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    if (__pyx_t_8) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_t_8); __pyx_t_8 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0+__pyx_t_9, __pyx_t_4);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1+__pyx_t_9, __pyx_t_6);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 2+__pyx_t_9, __pyx_t_7);
    __pyx_t_4 = 0;
    __pyx_t_6 = 0;
    __pyx_t_7 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_10, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2170, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2170, __pyx_L1_error)</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_x = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2170, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_x.diminfo[0].strides = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x.diminfo[0].shape = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_11 = 0;
  __pyx_v_x = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-36" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2171</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">cdf_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span></pre>
<pre class='cython code score-36 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_Py_intptr_t</span>((__pyx_v_x-&gt;dimensions[0]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_double);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2171, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_10, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2171, __pyx_L1_error)</span>
  __pyx_t_12 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_12, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_cdf_array = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2171, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_cdf_array.diminfo[0].strides = __pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_cdf_array.diminfo[0].shape = __pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_12 = 0;
  __pyx_v_cdf_array = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2172</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">idx</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2173</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2174</span>:     <span class="c"># compute pdf on the real line</span></pre>
<pre class="cython line score-63" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2175</span>:     <span class="n">cdf_array</span> <span class="o">=</span> <span class="n">pdf_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span></pre>
<pre class='cython code score-63 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_pdf_array);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2175, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_v);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2175, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_sv);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2175, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_a);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2175, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_z);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2175, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_sz);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2175, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_13 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_t);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 2175, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  __pyx_t_14 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_st);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 2175, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  __pyx_t_15 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_err);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 2175, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
/* … */
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2175, __pyx_L1_error)</span>
  __pyx_t_12 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer);
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_12, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_9 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_24, &amp;__pyx_t_25, &amp;__pyx_t_26);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_cdf_array, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_26);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_24, __pyx_t_25, __pyx_t_26);
      }
      __pyx_t_24 = __pyx_t_25 = __pyx_t_26 = 0;
    }
    __pyx_pybuffernd_cdf_array.diminfo[0].strides = __pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_cdf_array.diminfo[0].shape = __pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_9 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2175, __pyx_L1_error)</span>
  }
  __pyx_t_12 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_cdf_array, ((PyArrayObject *)__pyx_t_6));
  __pyx_t_6 = 0;
</pre><pre class="cython line score-100" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2176</span>:                           <span class="n">n_st</span><span class="p">,</span> <span class="n">n_sz</span><span class="p">,</span> <span class="n">use_adaptive</span><span class="p">,</span> <span class="n">simps_err</span><span class="p">,</span> <span class="n">p_outlier</span><span class="p">,</span> <span class="n">w_outlier</span><span class="p">)</span></pre>
<pre class='cython code score-100 '>  __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_n_st);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 2176, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_n_sz);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 2176, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(__pyx_v_use_adaptive);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 2176, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
  __pyx_t_19 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_simps_err);<span class='error_goto'> if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 2176, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
  __pyx_t_20 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_p_outlier);<span class='error_goto'> if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 2176, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_20);
  __pyx_t_21 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_w_outlier);<span class='error_goto'> if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 2176, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_21);
  __pyx_t_22 = NULL;
  __pyx_t_9 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_22 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_22)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_22);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_9 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
    PyObject *__pyx_temp[17] = {__pyx_t_22, ((PyObject *)__pyx_v_x), __pyx_t_10, __pyx_t_5, __pyx_t_7, __pyx_t_4, __pyx_t_8, __pyx_t_13, __pyx_t_14, __pyx_t_15, __pyx_int_0, __pyx_t_16, __pyx_t_17, __pyx_t_18, __pyx_t_19, __pyx_t_20, __pyx_t_21};
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_9, 16+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2175, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_20); __pyx_t_20 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_21); __pyx_t_21 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
    PyObject *__pyx_temp[17] = {__pyx_t_22, ((PyObject *)__pyx_v_x), __pyx_t_10, __pyx_t_5, __pyx_t_7, __pyx_t_4, __pyx_t_8, __pyx_t_13, __pyx_t_14, __pyx_t_15, __pyx_int_0, __pyx_t_16, __pyx_t_17, __pyx_t_18, __pyx_t_19, __pyx_t_20, __pyx_t_21};
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_9, 16+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2175, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_20); __pyx_t_20 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_21); __pyx_t_21 = 0;
  } else
  #endif
  {
    __pyx_t_23 = <span class='py_c_api'>PyTuple_New</span>(16+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 2175, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_23);
    if (__pyx_t_22) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_22); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 0, __pyx_t_22); __pyx_t_22 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_x));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_x));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 0+__pyx_t_9, ((PyObject *)__pyx_v_x));
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 1+__pyx_t_9, __pyx_t_10);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 2+__pyx_t_9, __pyx_t_5);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 3+__pyx_t_9, __pyx_t_7);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 4+__pyx_t_9, __pyx_t_4);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 5+__pyx_t_9, __pyx_t_8);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 6+__pyx_t_9, __pyx_t_13);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 7+__pyx_t_9, __pyx_t_14);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 8+__pyx_t_9, __pyx_t_15);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 9+__pyx_t_9, __pyx_int_0);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_16);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 10+__pyx_t_9, __pyx_t_16);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 11+__pyx_t_9, __pyx_t_17);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_18);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 12+__pyx_t_9, __pyx_t_18);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 13+__pyx_t_9, __pyx_t_19);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_20);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 14+__pyx_t_9, __pyx_t_20);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_21);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 15+__pyx_t_9, __pyx_t_21);
    __pyx_t_10 = 0;
    __pyx_t_5 = 0;
    __pyx_t_7 = 0;
    __pyx_t_4 = 0;
    __pyx_t_8 = 0;
    __pyx_t_13 = 0;
    __pyx_t_14 = 0;
    __pyx_t_15 = 0;
    __pyx_t_16 = 0;
    __pyx_t_17 = 0;
    __pyx_t_18 = 0;
    __pyx_t_19 = 0;
    __pyx_t_20 = 0;
    __pyx_t_21 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_23, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2175, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_23); __pyx_t_23 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2177</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2178</span>:     <span class="c"># integrate</span></pre>
<pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2179</span>:     <span class="n">cdf_array</span><span class="p">[</span><span class="mf">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">cumtrapz</span><span class="p">(</span><span class="n">cdf_array</span><span class="p">)</span></pre>
<pre class='cython code score-30 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_integrate);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2179, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_23 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_cumtrapz);<span class='error_goto'> if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 2179, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_23);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_23))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_23);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_23);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_23, function);
    }
  }
  __pyx_t_6 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_23, __pyx_t_3, ((PyObject *)__pyx_v_cdf_array)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_23, ((PyObject *)__pyx_v_cdf_array));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 2179, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_23); __pyx_t_23 = 0;
  if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_cdf_array), __pyx_slice__5, __pyx_t_6) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2179, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
/* … */
  __pyx_slice__5 = <span class='py_c_api'>PySlice_New</span>(__pyx_int_1, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__5)) __PYX_ERR(0, 2179, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__5);
</pre><pre class="cython line score-0">&#xA0;<span class="">2180</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2181</span>:     <span class="c"># normalize</span></pre>
<pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2182</span>:     <span class="n">cdf_array</span> <span class="o">/=</span> <span class="n">cdf_array</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-29 '>  __pyx_t_27 = ((__pyx_v_x-&gt;dimensions[0]) - 1);
  __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer.buf, __pyx_t_27, __pyx_pybuffernd_cdf_array.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2182, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_23 = <span class='pyx_c_api'>__Pyx_PyNumber_InPlaceDivide</span>(((PyObject *)__pyx_v_cdf_array), __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 2182, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_23);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (!(likely(((__pyx_t_23) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_23, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2182, __pyx_L1_error)</span>
  __pyx_t_12 = ((PyArrayObject *)__pyx_t_23);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer);
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_12, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_9 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_26, &amp;__pyx_t_25, &amp;__pyx_t_24);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_cdf_array, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_26, __pyx_t_25, __pyx_t_24);
      }
      __pyx_t_26 = __pyx_t_25 = __pyx_t_24 = 0;
    }
    __pyx_pybuffernd_cdf_array.diminfo[0].strides = __pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_cdf_array.diminfo[0].shape = __pyx_pybuffernd_cdf_array.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_9 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2182, __pyx_L1_error)</span>
  }
  __pyx_t_12 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_cdf_array, ((PyArrayObject *)__pyx_t_23));
  __pyx_t_23 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2183</span>: </pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2184</span>:     <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">cdf_array</span></pre>
<pre class='cython code score-10 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_23 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 2184, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_23);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_x));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_x));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 0, ((PyObject *)__pyx_v_x));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_cdf_array));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_cdf_array));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 1, ((PyObject *)__pyx_v_cdf_array));
  __pyx_r = __pyx_t_23;
  __pyx_t_23 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2185</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2186</span>: </pre>
<pre class="cython line score-87" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2187</span>: <span class="k">def</span> <span class="nf">split_cdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">data</span><span class="p">):</span></pre>
<pre class='cython code score-87 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_31split_cdf(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_30split_cdf[] = "split_cdf(ndarray x, ndarray data)";
static PyMethodDef __pyx_mdef_4wfpt_31split_cdf = {"split_cdf", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_31split_cdf, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_30split_cdf};
static PyObject *__pyx_pw_4wfpt_31split_cdf(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_x = 0;
  PyArrayObject *__pyx_v_data = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("split_cdf (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_x,&amp;__pyx_n_s_data,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_x)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_data)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("split_cdf", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 2187, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "split_cdf") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2187, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_x = ((PyArrayObject *)values[0]);
    __pyx_v_data = ((PyArrayObject *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("split_cdf", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 2187, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.split_cdf", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x), __pyx_ptype_5numpy_ndarray, 1, "x", 0))) <span class='error_goto'>__PYX_ERR(0, 2187, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_data), __pyx_ptype_5numpy_ndarray, 1, "data", 0))) <span class='error_goto'>__PYX_ERR(0, 2187, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4wfpt_30split_cdf(__pyx_self, __pyx_v_x, __pyx_v_data);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_30split_cdf(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_x, PyArrayObject *__pyx_v_data) {
  int __pyx_v_N;
  PyArrayObject *__pyx_v_x_lb = 0;
  PyArrayObject *__pyx_v_lb = 0;
  PyArrayObject *__pyx_v_x_ub = 0;
  PyArrayObject *__pyx_v_ub = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_data;
  __Pyx_Buffer __pyx_pybuffer_data;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_lb;
  __Pyx_Buffer __pyx_pybuffer_lb;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ub;
  __Pyx_Buffer __pyx_pybuffer_ub;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x;
  __Pyx_Buffer __pyx_pybuffer_x;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x_lb;
  __Pyx_Buffer __pyx_pybuffer_x_lb;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x_ub;
  __Pyx_Buffer __pyx_pybuffer_x_ub;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("split_cdf", 0);
  __pyx_pybuffer_x_lb.pybuffer.buf = NULL;
  __pyx_pybuffer_x_lb.refcount = 0;
  __pyx_pybuffernd_x_lb.data = NULL;
  __pyx_pybuffernd_x_lb.rcbuffer = &amp;__pyx_pybuffer_x_lb;
  __pyx_pybuffer_lb.pybuffer.buf = NULL;
  __pyx_pybuffer_lb.refcount = 0;
  __pyx_pybuffernd_lb.data = NULL;
  __pyx_pybuffernd_lb.rcbuffer = &amp;__pyx_pybuffer_lb;
  __pyx_pybuffer_x_ub.pybuffer.buf = NULL;
  __pyx_pybuffer_x_ub.refcount = 0;
  __pyx_pybuffernd_x_ub.data = NULL;
  __pyx_pybuffernd_x_ub.rcbuffer = &amp;__pyx_pybuffer_x_ub;
  __pyx_pybuffer_ub.pybuffer.buf = NULL;
  __pyx_pybuffer_ub.refcount = 0;
  __pyx_pybuffernd_ub.data = NULL;
  __pyx_pybuffernd_ub.rcbuffer = &amp;__pyx_pybuffer_ub;
  __pyx_pybuffer_x.pybuffer.buf = NULL;
  __pyx_pybuffer_x.refcount = 0;
  __pyx_pybuffernd_x.data = NULL;
  __pyx_pybuffernd_x.rcbuffer = &amp;__pyx_pybuffer_x;
  __pyx_pybuffer_data.pybuffer.buf = NULL;
  __pyx_pybuffer_data.refcount = 0;
  __pyx_pybuffernd_data.data = NULL;
  __pyx_pybuffernd_data.rcbuffer = &amp;__pyx_pybuffer_data;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_x, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 2187, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_x.diminfo[0].strides = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x.diminfo[0].shape = __pyx_pybuffernd_x.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_data, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 2187, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_data.diminfo[0].strides = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_data.diminfo[0].shape = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_lb.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ub.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x_lb.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x_ub.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.split_cdf", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_lb.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ub.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x_lb.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_x_ub.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_x_lb);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_lb);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_x_ub);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_ub);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__39 = <span class='py_c_api'>PyTuple_Pack</span>(7, __pyx_n_s_x, __pyx_n_s_data, __pyx_n_s_N, __pyx_n_s_x_lb, __pyx_n_s_lb, __pyx_n_s_x_ub, __pyx_n_s_ub);<span class='error_goto'> if (unlikely(!__pyx_tuple__39)) __PYX_ERR(0, 2187, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__39);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__39);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_31split_cdf, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2187, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_split_cdf, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2187, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__40 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_split_cdf, 2187, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__40)) __PYX_ERR(0, 2187, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">2188</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2189</span>:     <span class="c"># get length of data</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2190</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">N</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2</span></pre>
<pre class='cython code score-5 '>  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_data));<span class='error_goto'> if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 2190, __pyx_L1_error)</span>
  __pyx_v_N = ((__pyx_t_1 - 1) / 2);
</pre><pre class="cython line score-0">&#xA0;<span class="">2191</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2192</span>:     <span class="c"># lower bound is reversed</span></pre>
<pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2193</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">x_lb</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span><span class="p">[:</span><span class="n">N</span><span class="p">][::</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-30 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PySlice_New</span>(Py_None, __pyx_t_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_x), __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_t_2, __pyx_slice__6);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2193, __pyx_L1_error)</span>
  __pyx_t_4 = ((PyArrayObject *)__pyx_t_2);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x_lb.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_4, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_x_lb = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_x_lb.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2193, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_x_lb.diminfo[0].strides = __pyx_pybuffernd_x_lb.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x_lb.diminfo[0].shape = __pyx_pybuffernd_x_lb.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_4 = 0;
  __pyx_v_x_lb = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
/* … */
  __pyx_slice__6 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, __pyx_int_neg_1);<span class='error_goto'> if (unlikely(!__pyx_slice__6)) __PYX_ERR(0, 2193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__6);
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2194</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">lb</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">N</span><span class="p">][::</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2194, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PySlice_New</span>(Py_None, __pyx_t_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2194, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_data), __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2194, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_t_2, __pyx_slice__6);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2194, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2194, __pyx_L1_error)</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_lb.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_lb = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_lb.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2194, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_lb.diminfo[0].strides = __pyx_pybuffernd_lb.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_lb.diminfo[0].shape = __pyx_pybuffernd_lb.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_lb = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2195</span>:     <span class="c"># lower bound is cumulative in the wrong direction</span></pre>
<pre class="cython line score-120" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2196</span>:     <span class="n">lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0</span><span class="p">]),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">lb</span><span class="p">)]))</span></pre>
<pre class='cython code score-120 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2196, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_cumsum);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2196, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2196, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_concatenate);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2196, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_9, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2196, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2196, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2196, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 0, __pyx_int_0);
  __pyx_t_11 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_10))) {
    __pyx_t_11 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_10);
    if (likely(__pyx_t_11)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_10, function);
    }
  }
  __pyx_t_7 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_11, __pyx_t_9) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_10, __pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  if (unlikely(!__pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 2196, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_9, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2196, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_diff);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2196, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_11))) {
    __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_11);
    if (likely(__pyx_t_9)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_11, function);
    }
  }
  __pyx_t_10 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_9, ((PyObject *)__pyx_v_lb)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_11, ((PyObject *)__pyx_v_lb));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  if (unlikely(!__pyx_t_10)) <span class='error_goto'>__PYX_ERR(0, 2196, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2196, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2196, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_10, 0, __pyx_t_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_10, 1, __pyx_t_11);
  __pyx_t_7 = 0;
  __pyx_t_11 = 0;
  __pyx_t_11 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
    __pyx_t_11 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
    if (likely(__pyx_t_11)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
    }
  }
  __pyx_t_2 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_11, __pyx_t_10) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, __pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 2196, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
    __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
    if (likely(__pyx_t_8)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
    }
  }
  __pyx_t_3 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_8, __pyx_t_2) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 2196, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2196, __pyx_L1_error)</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_lb.rcbuffer-&gt;pybuffer);
    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_lb.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_12 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_13, &amp;__pyx_t_14, &amp;__pyx_t_15);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_lb.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_lb, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_13, __pyx_t_14, __pyx_t_15);
      }
      __pyx_t_13 = __pyx_t_14 = __pyx_t_15 = 0;
    }
    __pyx_pybuffernd_lb.diminfo[0].strides = __pyx_pybuffernd_lb.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_lb.diminfo[0].shape = __pyx_pybuffernd_lb.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_12 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2196, __pyx_L1_error)</span>
  }
  __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_lb, ((PyArrayObject *)__pyx_t_3));
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2197</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2198</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">x_ub</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">N</span> <span class="o">+</span> <span class="mf">1</span><span class="p">:]</span></pre>
<pre class='cython code score-16 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_N + 1));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2198, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_6 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_3, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2198, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_x), __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2198, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2198, __pyx_L1_error)</span>
  __pyx_t_16 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_x_ub.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_16, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_x_ub = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_x_ub.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2198, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_x_ub.diminfo[0].strides = __pyx_pybuffernd_x_ub.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_x_ub.diminfo[0].shape = __pyx_pybuffernd_x_ub.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_16 = 0;
  __pyx_v_x_ub = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2199</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">N</span> <span class="o">+</span> <span class="mf">1</span><span class="p">:]</span></pre>
<pre class='cython code score-16 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_N + 1));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2199, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_6 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_3, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2199, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_data), __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2199, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2199, __pyx_L1_error)</span>
  __pyx_t_17 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_ub.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_17, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_ub = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_ub.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2199, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_ub.diminfo[0].strides = __pyx_pybuffernd_ub.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_ub.diminfo[0].shape = __pyx_pybuffernd_ub.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_17 = 0;
  __pyx_v_ub = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2200</span>:     <span class="c"># ub does not start at 0</span></pre>
<pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2201</span>:     <span class="n">ub</span> <span class="o">-=</span> <span class="n">ub</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-32 '>  __pyx_t_18 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_ub.rcbuffer-&gt;pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_ub.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2201, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_6 = <span class='py_c_api'>PyNumber_InPlaceSubtract</span>(((PyObject *)__pyx_v_ub), __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2201, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2201, __pyx_L1_error)</span>
  __pyx_t_17 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_ub.rcbuffer-&gt;pybuffer);
    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_ub.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_17, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_12 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_15, &amp;__pyx_t_14, &amp;__pyx_t_13);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_ub.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_ub, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_15, __pyx_t_14, __pyx_t_13);
      }
      __pyx_t_15 = __pyx_t_14 = __pyx_t_13 = 0;
    }
    __pyx_pybuffernd_ub.diminfo[0].strides = __pyx_pybuffernd_ub.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_ub.diminfo[0].shape = __pyx_pybuffernd_ub.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_12 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2201, __pyx_L1_error)</span>
  }
  __pyx_t_17 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_ub, ((PyArrayObject *)__pyx_t_6));
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2202</span>: </pre>
<pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2203</span>:     <span class="k">return</span> <span class="p">(</span><span class="n">x_lb</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">x_ub</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span></pre>
<pre class='cython code score-14 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2203, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_x_lb));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_x_lb));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, ((PyObject *)__pyx_v_x_lb));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_lb));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_lb));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, ((PyObject *)__pyx_v_lb));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_x_ub));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_x_ub));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 2, ((PyObject *)__pyx_v_x_ub));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_ub));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_ub));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 3, ((PyObject *)__pyx_v_ub));
  __pyx_r = __pyx_t_6;
  __pyx_t_6 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2204</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2205</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2206</span>: <span class="c"># NEW WITH NN-EXTENSION</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2207</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2208</span>: <span class="c">#############</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2209</span>: <span class="c"># Basic MLP Likelihoods</span></pre>
<pre class="cython line score-54" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2210</span>: <span class="k">def</span> <span class="nf">wiener_like_nn_mlp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">rt</span><span class="p">,</span></pre>
<pre class='cython code score-54 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_33wiener_like_nn_mlp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_32wiener_like_nn_mlp[] = "wiener_like_nn_mlp(ndarray rt, ndarray response, ndarray params, double p_outlier=0, double w_outlier=0, network=None)";
static PyMethodDef __pyx_mdef_4wfpt_33wiener_like_nn_mlp = {"wiener_like_nn_mlp", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_33wiener_like_nn_mlp, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_32wiener_like_nn_mlp};
static PyObject *__pyx_pw_4wfpt_33wiener_like_nn_mlp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_rt = 0;
  PyArrayObject *__pyx_v_response = 0;
  PyArrayObject *__pyx_v_params = 0;
  double __pyx_v_p_outlier;
  double __pyx_v_w_outlier;
  PyObject *__pyx_v_network = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_nn_mlp (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_rt,&amp;__pyx_n_s_response,&amp;__pyx_n_s_params,&amp;__pyx_n_s_p_outlier,&amp;__pyx_n_s_w_outlier,&amp;__pyx_n_s_network,0};
    PyObject* values[6] = {0,0,0,0,0,0};
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_32wiener_like_nn_mlp(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_rt, PyArrayObject *__pyx_v_response, PyArrayObject *__pyx_v_params, double __pyx_v_p_outlier, double __pyx_v_w_outlier, PyObject *__pyx_v_network) {
  Py_ssize_t __pyx_v_size;
  Py_ssize_t __pyx_v_n_params;
  float __pyx_v_log_p;
  float __pyx_v_ll_min;
  PyArrayObject *__pyx_v_data = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_data;
  __Pyx_Buffer __pyx_pybuffer_data;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_params;
  __Pyx_Buffer __pyx_pybuffer_params;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_response;
  __Pyx_Buffer __pyx_pybuffer_response;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_rt;
  __Pyx_Buffer __pyx_pybuffer_rt;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_nn_mlp", 0);
  __pyx_pybuffer_data.pybuffer.buf = NULL;
  __pyx_pybuffer_data.refcount = 0;
  __pyx_pybuffernd_data.data = NULL;
  __pyx_pybuffernd_data.rcbuffer = &amp;__pyx_pybuffer_data;
  __pyx_pybuffer_rt.pybuffer.buf = NULL;
  __pyx_pybuffer_rt.refcount = 0;
  __pyx_pybuffernd_rt.data = NULL;
  __pyx_pybuffernd_rt.rcbuffer = &amp;__pyx_pybuffer_rt;
  __pyx_pybuffer_response.pybuffer.buf = NULL;
  __pyx_pybuffer_response.refcount = 0;
  __pyx_pybuffernd_response.data = NULL;
  __pyx_pybuffernd_response.rcbuffer = &amp;__pyx_pybuffer_response;
  __pyx_pybuffer_params.pybuffer.buf = NULL;
  __pyx_pybuffer_params.refcount = 0;
  __pyx_pybuffernd_params.data = NULL;
  __pyx_pybuffernd_params.rcbuffer = &amp;__pyx_pybuffer_params;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_rt.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_rt, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 2210, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_rt.diminfo[0].strides = __pyx_pybuffernd_rt.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_rt.diminfo[0].shape = __pyx_pybuffernd_rt.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_response.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_response, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 2210, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_response.diminfo[0].strides = __pyx_pybuffernd_response.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_response.diminfo[0].shape = __pyx_pybuffernd_response.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_params.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_params, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 2210, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_params.diminfo[0].strides = __pyx_pybuffernd_params.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_params.diminfo[0].shape = __pyx_pybuffernd_params.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_params.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_rt.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_nn_mlp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_params.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_rt.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_data);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__41 = <span class='py_c_api'>PyTuple_Pack</span>(11, __pyx_n_s_rt, __pyx_n_s_response, __pyx_n_s_params, __pyx_n_s_p_outlier, __pyx_n_s_w_outlier, __pyx_n_s_network, __pyx_n_s_size, __pyx_n_s_n_params, __pyx_n_s_log_p, __pyx_n_s_ll_min, __pyx_n_s_data);<span class='error_goto'> if (unlikely(!__pyx_tuple__41)) __PYX_ERR(0, 2210, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__41);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__41);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_33wiener_like_nn_mlp, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2210, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_wiener_like_nn_mlp, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2210, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__42 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(6, 0, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__41, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_wiener_like_nn_mlp, 2210, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__42)) __PYX_ERR(0, 2210, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">2211</span>:                        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">response</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2212</span>:                        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">params</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2213</span>:                        <span class="n">double</span> <span class="n">p_outlier</span> <span class="o">=</span> <span class="mf">0</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2214</span>:                        <span class="n">double</span> <span class="n">w_outlier</span> <span class="o">=</span> <span class="mf">0</span><span class="p">,</span></pre>
<pre class="cython line score-68" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2215</span>:                        <span class="n">network</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span></pre>
<pre class='cython code score-68 '>    values[5] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_rt)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_response)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_nn_mlp", 0, 3, 6, 1); <span class='error_goto'>__PYX_ERR(0, 2210, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_params)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_nn_mlp", 0, 3, 6, 2); <span class='error_goto'>__PYX_ERR(0, 2210, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_p_outlier);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w_outlier);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_network);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "wiener_like_nn_mlp") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2210, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_rt = ((PyArrayObject *)values[0]);
    __pyx_v_response = ((PyArrayObject *)values[1]);
    __pyx_v_params = ((PyArrayObject *)values[2]);
    if (values[3]) {
      __pyx_v_p_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_p_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2213, __pyx_L3_error)</span>
    } else {
      __pyx_v_p_outlier = ((double)0.0);
    }
    if (values[4]) {
      __pyx_v_w_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_w_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2214, __pyx_L3_error)</span>
    } else {
      __pyx_v_w_outlier = ((double)0.0);
    }
    __pyx_v_network = values[5];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_nn_mlp", 0, 3, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 2210, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_nn_mlp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_rt), __pyx_ptype_5numpy_ndarray, 1, "rt", 0))) <span class='error_goto'>__PYX_ERR(0, 2210, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_response), __pyx_ptype_5numpy_ndarray, 1, "response", 0))) <span class='error_goto'>__PYX_ERR(0, 2211, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_params), __pyx_ptype_5numpy_ndarray, 1, "params", 0))) <span class='error_goto'>__PYX_ERR(0, 2212, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4wfpt_32wiener_like_nn_mlp(__pyx_self, __pyx_v_rt, __pyx_v_response, __pyx_v_params, __pyx_v_p_outlier, __pyx_v_w_outlier, __pyx_v_network);
</pre><pre class="cython line score-0">&#xA0;<span class="">2216</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2217</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">size</span> <span class="o">=</span> <span class="n">rt</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_size = (__pyx_v_rt-&gt;dimensions[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2218</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">n_params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_n_params = (__pyx_v_params-&gt;dimensions[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2219</span>:     <span class="k">cdef</span> <span class="kt">float</span> <span class="nf">log_p</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_log_p = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2220</span>:     <span class="k">cdef</span> <span class="kt">float</span> <span class="nf">ll_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">16.11809</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ll_min = -16.11809;
</pre><pre class="cython line score-0">&#xA0;<span class="">2221</span>: </pre>
<pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2222</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">float</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">2</span><span class="p">]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="n">n_params</span> <span class="o">+</span> <span class="mf">2</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span></pre>
<pre class='cython code score-51 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2222, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2222, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_size);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2222, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_n_params + 2));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2222, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2222, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_3);
  __pyx_t_1 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2222, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2222, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2222, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2222, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2222, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2222, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2222, __pyx_L1_error)</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_data = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2222, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_data.diminfo[0].strides = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_data.diminfo[0].shape = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_data.diminfo[1].strides = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_data.diminfo[1].shape = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_data = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class="cython line score-105" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2223</span>:     <span class="n">data</span><span class="p">[:,</span> <span class="p">:</span><span class="n">n_params</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mf">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span></pre>
<pre class='cython code score-105 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2223, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_tile);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2223, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_size);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2223, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2223, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_int_1);
  __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, ((PyObject *)__pyx_v_params), __pyx_t_1};
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2223, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, ((PyObject *)__pyx_v_params), __pyx_t_1};
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2223, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  } else
  #endif
  {
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2223, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    if (__pyx_t_3) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_params));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_params));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+__pyx_t_7, ((PyObject *)__pyx_v_params));
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1+__pyx_t_7, __pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2223, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2223, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2223, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2223, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 2223, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_n_params);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2223, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_8 = <span class='py_c_api'>PySlice_New</span>(Py_None, __pyx_t_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2223, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2223, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_slice_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_8);
  __pyx_t_8 = 0;
  if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_data), __pyx_t_2, __pyx_t_5) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2223, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-58" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2224</span>:     <span class="n">data</span><span class="p">[:,</span> <span class="n">n_params</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">rt</span><span class="p">,</span> <span class="n">response</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-58 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_stack);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_rt));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_rt));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, ((PyObject *)__pyx_v_rt));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_response));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_response));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, ((PyObject *)__pyx_v_response));
  __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_axis, __pyx_int_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2224, __pyx_L1_error)</span>
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_8, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_n_params);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_8 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_5, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_slice_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_8);
  __pyx_t_8 = 0;
  if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_data), __pyx_t_5, __pyx_t_4) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2224, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2225</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2226</span>:     <span class="c"># Call to network:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2227</span>:     <span class="k">if</span> <span class="n">p_outlier</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_9 = ((__pyx_v_p_outlier == 0.0) != 0);
  if (__pyx_t_9) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-102" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2228</span>:         <span class="n">log_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">umath</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">predict_on_batch</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">ll_min</span><span class="p">))</span></pre>
<pre class='cython code score-102 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2228, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2228, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2228, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_core);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2228, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_umath);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2228, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_maximum);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2228, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_predict_on_batch);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2228, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_10)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    __pyx_t_2 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_10, ((PyObject *)__pyx_v_data)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, ((PyObject *)__pyx_v_data));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 2228, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_ll_min);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2228, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_10 = NULL;
    __pyx_t_7 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
      __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
      if (likely(__pyx_t_10)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
        __pyx_t_7 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_1)) {
      PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_2, __pyx_t_3};
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2228, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_1)) {
      PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_2, __pyx_t_3};
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2228, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    {
      __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2228, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      if (__pyx_t_10) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_t_10); __pyx_t_10 = NULL;
      }
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0+__pyx_t_7, __pyx_t_2);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 1+__pyx_t_7, __pyx_t_3);
      __pyx_t_2 = 0;
      __pyx_t_3 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_11, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2228, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
      __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
      if (likely(__pyx_t_1)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
      }
    }
    __pyx_t_4 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_1, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, __pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 2228, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_4); if (unlikely((__pyx_t_12 == (float)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2228, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_log_p = __pyx_t_12;
</pre><pre class="cython line score-0">&#xA0;<span class="">2229</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-166" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2230</span>:         <span class="n">log_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">umath</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">predict_on_batch</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">ll_min</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">p_outlier</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">w_outlier</span> <span class="o">*</span> <span class="n">p_outlier</span><span class="p">)))</span></pre>
<pre class='cython code score-166 '>  /*else*/ {
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_log);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_exp);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_core);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_13, __pyx_n_s_umath);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_maximum);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_predict_on_batch);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    __pyx_t_15 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_14))) {
      __pyx_t_15 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_14);
      if (likely(__pyx_t_15)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_14);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_15);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_14, function);
      }
    }
    __pyx_t_10 = (__pyx_t_15) ? __Pyx_PyObject_Call2Args(__pyx_t_14, __pyx_t_15, ((PyObject *)__pyx_v_data)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_14, ((PyObject *)__pyx_v_data));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    if (unlikely(!__pyx_t_10)) <span class='error_goto'>__PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
    __pyx_t_14 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_ll_min);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    __pyx_t_15 = NULL;
    __pyx_t_7 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
      __pyx_t_15 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
      if (likely(__pyx_t_15)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_15);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
        __pyx_t_7 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_13)) {
      PyObject *__pyx_temp[3] = {__pyx_t_15, __pyx_t_10, __pyx_t_14};
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_13, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_13)) {
      PyObject *__pyx_temp[3] = {__pyx_t_15, __pyx_t_10, __pyx_t_14};
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_13, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
    } else
    #endif
    {
      __pyx_t_16 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
      if (__pyx_t_15) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 0, __pyx_t_15); __pyx_t_15 = NULL;
      }
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 0+__pyx_t_7, __pyx_t_10);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 1+__pyx_t_7, __pyx_t_14);
      __pyx_t_10 = 0;
      __pyx_t_14 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_13, __pyx_t_16, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    __pyx_t_13 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
      __pyx_t_13 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
      if (likely(__pyx_t_13)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_13) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_13, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((1.0 - __pyx_v_p_outlier));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_1, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_w_outlier * __pyx_v_p_outlier));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_1 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_3, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_11))) {
      __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_11);
      if (likely(__pyx_t_2)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_11, function);
      }
    }
    __pyx_t_8 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_2, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_11, __pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_8)) <span class='error_goto'>__PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_11 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
      __pyx_t_11 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
      if (likely(__pyx_t_11)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
      }
    }
    __pyx_t_4 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_11, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_4); if (unlikely((__pyx_t_12 == (float)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2230, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_log_p = __pyx_t_12;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">2231</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2232</span>:     <span class="k">return</span> <span class="n">log_p</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_log_p);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2232, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2233</span>: </pre>
<pre class="cython line score-59" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2234</span>: <span class="k">def</span> <span class="nf">wiener_like_nn_mlp_pdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">rt</span><span class="p">,</span></pre>
<pre class='cython code score-59 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_35wiener_like_nn_mlp_pdf(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_34wiener_like_nn_mlp_pdf[] = "wiener_like_nn_mlp_pdf(ndarray rt, ndarray response, ndarray params, double p_outlier=0, double w_outlier=0, bool logp=0, network=None)";
static PyMethodDef __pyx_mdef_4wfpt_35wiener_like_nn_mlp_pdf = {"wiener_like_nn_mlp_pdf", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_35wiener_like_nn_mlp_pdf, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_34wiener_like_nn_mlp_pdf};
static PyObject *__pyx_pw_4wfpt_35wiener_like_nn_mlp_pdf(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_rt = 0;
  PyArrayObject *__pyx_v_response = 0;
  PyArrayObject *__pyx_v_params = 0;
  double __pyx_v_p_outlier;
  double __pyx_v_w_outlier;
  int __pyx_v_logp;
  PyObject *__pyx_v_network = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_nn_mlp_pdf (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_rt,&amp;__pyx_n_s_response,&amp;__pyx_n_s_params,&amp;__pyx_n_s_p_outlier,&amp;__pyx_n_s_w_outlier,&amp;__pyx_n_s_logp,&amp;__pyx_n_s_network,0};
    PyObject* values[7] = {0,0,0,0,0,0,0};
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_34wiener_like_nn_mlp_pdf(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_rt, PyArrayObject *__pyx_v_response, PyArrayObject *__pyx_v_params, double __pyx_v_p_outlier, double __pyx_v_w_outlier, int __pyx_v_logp, PyObject *__pyx_v_network) {
  Py_ssize_t __pyx_v_size;
  Py_ssize_t __pyx_v_n_params;
  PyArrayObject *__pyx_v_log_p = 0;
  float __pyx_v_ll_min;
  PyArrayObject *__pyx_v_data = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_data;
  __Pyx_Buffer __pyx_pybuffer_data;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_log_p;
  __Pyx_Buffer __pyx_pybuffer_log_p;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_params;
  __Pyx_Buffer __pyx_pybuffer_params;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_response;
  __Pyx_Buffer __pyx_pybuffer_response;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_rt;
  __Pyx_Buffer __pyx_pybuffer_rt;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_nn_mlp_pdf", 0);
  __pyx_pybuffer_log_p.pybuffer.buf = NULL;
  __pyx_pybuffer_log_p.refcount = 0;
  __pyx_pybuffernd_log_p.data = NULL;
  __pyx_pybuffernd_log_p.rcbuffer = &amp;__pyx_pybuffer_log_p;
  __pyx_pybuffer_data.pybuffer.buf = NULL;
  __pyx_pybuffer_data.refcount = 0;
  __pyx_pybuffernd_data.data = NULL;
  __pyx_pybuffernd_data.rcbuffer = &amp;__pyx_pybuffer_data;
  __pyx_pybuffer_rt.pybuffer.buf = NULL;
  __pyx_pybuffer_rt.refcount = 0;
  __pyx_pybuffernd_rt.data = NULL;
  __pyx_pybuffernd_rt.rcbuffer = &amp;__pyx_pybuffer_rt;
  __pyx_pybuffer_response.pybuffer.buf = NULL;
  __pyx_pybuffer_response.refcount = 0;
  __pyx_pybuffernd_response.data = NULL;
  __pyx_pybuffernd_response.rcbuffer = &amp;__pyx_pybuffer_response;
  __pyx_pybuffer_params.pybuffer.buf = NULL;
  __pyx_pybuffer_params.refcount = 0;
  __pyx_pybuffernd_params.data = NULL;
  __pyx_pybuffernd_params.rcbuffer = &amp;__pyx_pybuffer_params;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_rt.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_rt, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 2234, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_rt.diminfo[0].strides = __pyx_pybuffernd_rt.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_rt.diminfo[0].shape = __pyx_pybuffernd_rt.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_response.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_response, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 2234, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_response.diminfo[0].strides = __pyx_pybuffernd_response.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_response.diminfo[0].shape = __pyx_pybuffernd_response.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_params.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_params, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 2234, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_params.diminfo[0].strides = __pyx_pybuffernd_params.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_params.diminfo[0].shape = __pyx_pybuffernd_params.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_19);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_params.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_rt.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_nn_mlp_pdf", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_params.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_response.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_rt.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_log_p);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_data);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__43 = <span class='py_c_api'>PyTuple_Pack</span>(12, __pyx_n_s_rt, __pyx_n_s_response, __pyx_n_s_params, __pyx_n_s_p_outlier, __pyx_n_s_w_outlier, __pyx_n_s_logp, __pyx_n_s_network, __pyx_n_s_size, __pyx_n_s_n_params, __pyx_n_s_log_p, __pyx_n_s_ll_min, __pyx_n_s_data);<span class='error_goto'> if (unlikely(!__pyx_tuple__43)) __PYX_ERR(0, 2234, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__43);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__43);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_35wiener_like_nn_mlp_pdf, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2234, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_wiener_like_nn_mlp_pdf, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2234, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__44 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(7, 0, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__43, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_wiener_like_nn_mlp_pdf, 2234, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__44)) __PYX_ERR(0, 2234, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">2235</span>:                             <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">response</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2236</span>:                             <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">params</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2237</span>:                             <span class="n">double</span> <span class="n">p_outlier</span> <span class="o">=</span> <span class="mf">0</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2238</span>:                             <span class="n">double</span> <span class="n">w_outlier</span> <span class="o">=</span> <span class="mf">0</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2239</span>:                             <span class="nb">bint</span> <span class="n">logp</span> <span class="o">=</span> <span class="mf">0</span><span class="p">,</span></pre>
<pre class="cython line score-79" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2240</span>:                             <span class="n">network</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span></pre>
<pre class='cython code score-79 '>    values[6] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_rt)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_response)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_nn_mlp_pdf", 0, 3, 7, 1); <span class='error_goto'>__PYX_ERR(0, 2234, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_params)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_nn_mlp_pdf", 0, 3, 7, 2); <span class='error_goto'>__PYX_ERR(0, 2234, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_p_outlier);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w_outlier);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_logp);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_network);
          if (value) { values[6] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "wiener_like_nn_mlp_pdf") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2234, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_rt = ((PyArrayObject *)values[0]);
    __pyx_v_response = ((PyArrayObject *)values[1]);
    __pyx_v_params = ((PyArrayObject *)values[2]);
    if (values[3]) {
      __pyx_v_p_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_p_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2237, __pyx_L3_error)</span>
    } else {
      __pyx_v_p_outlier = ((double)0.0);
    }
    if (values[4]) {
      __pyx_v_w_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_w_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2238, __pyx_L3_error)</span>
    } else {
      __pyx_v_w_outlier = ((double)0.0);
    }
    if (values[5]) {
      __pyx_v_logp = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[5]); if (unlikely((__pyx_v_logp == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2239, __pyx_L3_error)</span>
    } else {
      __pyx_v_logp = ((int)0);
    }
    __pyx_v_network = values[6];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_nn_mlp_pdf", 0, 3, 7, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 2234, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_nn_mlp_pdf", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_rt), __pyx_ptype_5numpy_ndarray, 1, "rt", 0))) <span class='error_goto'>__PYX_ERR(0, 2234, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_response), __pyx_ptype_5numpy_ndarray, 1, "response", 0))) <span class='error_goto'>__PYX_ERR(0, 2235, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_params), __pyx_ptype_5numpy_ndarray, 1, "params", 0))) <span class='error_goto'>__PYX_ERR(0, 2236, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4wfpt_34wiener_like_nn_mlp_pdf(__pyx_self, __pyx_v_rt, __pyx_v_response, __pyx_v_params, __pyx_v_p_outlier, __pyx_v_w_outlier, __pyx_v_logp, __pyx_v_network);
</pre><pre class="cython line score-0">&#xA0;<span class="">2241</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2242</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">size</span> <span class="o">=</span> <span class="n">rt</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_size = (__pyx_v_rt-&gt;dimensions[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2243</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">n_params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_n_params = (__pyx_v_params-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">2244</span>: </pre>
<pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2245</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">float</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">1</span><span class="p">]</span> <span class="n">log_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span></pre>
<pre class='cython code score-39 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2245, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2245, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_size);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2245, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2245, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2245, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2245, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2245, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2245, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2245, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2245, __pyx_L1_error)</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_log_p = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2245, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_log_p.diminfo[0].strides = __pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_log_p.diminfo[0].shape = __pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_log_p = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2246</span>:     <span class="k">cdef</span> <span class="kt">float</span> <span class="nf">ll_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">16.11809</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ll_min = -16.11809;
</pre><pre class="cython line score-0">&#xA0;<span class="">2247</span>: </pre>
<pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2248</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">float</span><span class="p">,</span> <span class="nf">ndim</span> <span class="o">=</span> <span class="mf">2</span><span class="p">]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="n">n_params</span> <span class="o">+</span> <span class="mf">2</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span></pre>
<pre class='cython code score-51 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2248, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2248, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_size);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2248, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_3 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_n_params + 2));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2248, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2248, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_3);
  __pyx_t_5 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2248, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2248, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2248, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2248, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2248, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_3, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2248, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2248, __pyx_L1_error)</span>
  __pyx_t_7 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_7, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_data = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 2248, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_data.diminfo[0].strides = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_data.diminfo[0].shape = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_data.diminfo[1].strides = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_data.diminfo[1].shape = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_7 = 0;
  __pyx_v_data = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-105" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2249</span>:     <span class="n">data</span><span class="p">[:,</span> <span class="p">:</span><span class="n">n_params</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mf">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span></pre>
<pre class='cython code score-105 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2249, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_tile);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2249, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_size);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2249, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2249, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_int_1);
  __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
      __pyx_t_8 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_1)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, ((PyObject *)__pyx_v_params), __pyx_t_5};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2249, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_1)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, ((PyObject *)__pyx_v_params), __pyx_t_5};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2249, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  {
    __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2249, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    if (__pyx_t_3) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_params));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_params));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0+__pyx_t_8, ((PyObject *)__pyx_v_params));
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 1+__pyx_t_8, __pyx_t_5);
    __pyx_t_5 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2249, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2249, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2249, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2249, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_t_9) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 2249, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_n_params);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2249, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_9 = <span class='py_c_api'>PySlice_New</span>(Py_None, __pyx_t_1, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2249, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2249, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_slice_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_9);
  __pyx_t_9 = 0;
  if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_data), __pyx_t_1, __pyx_t_4) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2249, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-58" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2250</span>:     <span class="n">data</span><span class="p">[:,</span> <span class="n">n_params</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">rt</span><span class="p">,</span> <span class="n">response</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-58 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_stack);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_rt));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_rt));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_v_rt));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_response));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_response));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 1, ((PyObject *)__pyx_v_response));
  __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_axis, __pyx_int_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2250, __pyx_L1_error)</span>
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_9, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_n_params);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_9 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_4, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_slice_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_9);
  __pyx_t_9 = 0;
  if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_data), __pyx_t_4, __pyx_t_2) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2250, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2251</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2252</span>:     <span class="c"># Call to network:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2253</span>:     <span class="k">if</span> <span class="n">p_outlier</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span> <span class="c"># ddm_model</span></pre>
<pre class='cython code score-0 '>  __pyx_t_10 = ((__pyx_v_p_outlier == 0.0) != 0);
  if (__pyx_t_10) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-112" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2254</span>:         <span class="n">log_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">umath</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">predict_on_batch</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">ll_min</span><span class="p">))</span></pre>
<pre class='cython code score-112 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2254, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_squeeze);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2254, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2254, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_core);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2254, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_umath);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2254, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_maximum);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2254, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_predict_on_batch);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2254, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_11 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_11 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_11)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_11, ((PyObject *)__pyx_v_data)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, ((PyObject *)__pyx_v_data));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 2254, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_ll_min);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2254, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_11 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
      __pyx_t_11 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
      if (likely(__pyx_t_11)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_5)) {
      PyObject *__pyx_temp[3] = {__pyx_t_11, __pyx_t_1, __pyx_t_3};
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2254, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_5)) {
      PyObject *__pyx_temp[3] = {__pyx_t_11, __pyx_t_1, __pyx_t_3};
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2254, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    {
      __pyx_t_12 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2254, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      if (__pyx_t_11) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0, __pyx_t_11); __pyx_t_11 = NULL;
      }
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0+__pyx_t_8, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 1+__pyx_t_8, __pyx_t_3);
      __pyx_t_1 = 0;
      __pyx_t_3 = 0;
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_12, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2254, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_9))) {
      __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_9);
      if (likely(__pyx_t_5)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_9);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_9, function);
      }
    }
    __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_5, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_9, __pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 2254, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2254, __pyx_L1_error)</span>
    __pyx_t_6 = ((PyArrayObject *)__pyx_t_2);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_13, &amp;__pyx_t_14, &amp;__pyx_t_15);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_log_p, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_13, __pyx_t_14, __pyx_t_15);
        }
        __pyx_t_13 = __pyx_t_14 = __pyx_t_15 = 0;
      }
      __pyx_pybuffernd_log_p.diminfo[0].strides = __pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_log_p.diminfo[0].shape = __pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_8 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2254, __pyx_L1_error)</span>
    }
    __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_log_p, ((PyArrayObject *)__pyx_t_2));
    __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2255</span>:     <span class="k">else</span><span class="p">:</span> <span class="c"># ddm_model</span></pre>
<pre class="cython line score-176" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2256</span>:         <span class="n">log_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">umath</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">predict_on_batch</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">ll_min</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">p_outlier</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">w_outlier</span> <span class="o">*</span> <span class="n">p_outlier</span><span class="p">)))</span></pre>
<pre class='cython code score-176 '>  /*else*/ {
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_9, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_squeeze);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_log);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_exp);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_11, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_11, __pyx_n_s_core);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_16, __pyx_n_s_umath);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_11, __pyx_n_s_maximum);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_predict_on_batch);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
    __pyx_t_18 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_17))) {
      __pyx_t_18 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_17);
      if (likely(__pyx_t_18)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_17);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_18);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_17, function);
      }
    }
    __pyx_t_11 = (__pyx_t_18) ? __Pyx_PyObject_Call2Args(__pyx_t_17, __pyx_t_18, ((PyObject *)__pyx_v_data)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_17, ((PyObject *)__pyx_v_data));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
    if (unlikely(!__pyx_t_11)) <span class='error_goto'>__PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
    __pyx_t_17 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_ll_min);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
    __pyx_t_18 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_16))) {
      __pyx_t_18 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_16);
      if (likely(__pyx_t_18)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_16);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_18);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_16, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_16)) {
      PyObject *__pyx_temp[3] = {__pyx_t_18, __pyx_t_11, __pyx_t_17};
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_16, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_16)) {
      PyObject *__pyx_temp[3] = {__pyx_t_18, __pyx_t_11, __pyx_t_17};
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_16, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
    } else
    #endif
    {
      __pyx_t_19 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
      if (__pyx_t_18) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_18); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 0, __pyx_t_18); __pyx_t_18 = NULL;
      }
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 0+__pyx_t_8, __pyx_t_11);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 1+__pyx_t_8, __pyx_t_17);
      __pyx_t_11 = 0;
      __pyx_t_17 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_16, __pyx_t_19, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    __pyx_t_16 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
      __pyx_t_16 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
      if (likely(__pyx_t_16)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_16);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
      }
    }
    __pyx_t_5 = (__pyx_t_16) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_16, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((1.0 - __pyx_v_p_outlier));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_5, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_w_outlier * __pyx_v_p_outlier));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_3, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_12))) {
      __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_12);
      if (likely(__pyx_t_1)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_12);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_12, function);
      }
    }
    __pyx_t_9 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_12, __pyx_t_1, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_12, __pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_9)) <span class='error_goto'>__PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    __pyx_t_12 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
      __pyx_t_12 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
      if (likely(__pyx_t_12)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
      }
    }
    __pyx_t_2 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_12, __pyx_t_9) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 2256, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2256, __pyx_L1_error)</span>
    __pyx_t_6 = ((PyArrayObject *)__pyx_t_2);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_15, &amp;__pyx_t_14, &amp;__pyx_t_13);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_log_p, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_15, __pyx_t_14, __pyx_t_13);
        }
        __pyx_t_15 = __pyx_t_14 = __pyx_t_13 = 0;
      }
      __pyx_pybuffernd_log_p.diminfo[0].strides = __pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_log_p.diminfo[0].shape = __pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_8 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2256, __pyx_L1_error)</span>
    }
    __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_log_p, ((PyArrayObject *)__pyx_t_2));
    __pyx_t_2 = 0;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2257</span>:     <span class="k">if</span> <span class="n">logp</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_10 = ((__pyx_v_logp == 0) != 0);
  if (__pyx_t_10) {
/* … */
  }
</pre><pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2258</span>:         <span class="n">log_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_p</span><span class="p">)</span> <span class="c"># shouldn&#39;t be called log_p anymore but no need for an extra array here</span></pre>
<pre class='cython code score-40 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2258, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_exp);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2258, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_9))) {
      __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_9);
      if (likely(__pyx_t_4)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_9);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_9, function);
      }
    }
    __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_4, ((PyObject *)__pyx_v_log_p)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_9, ((PyObject *)__pyx_v_log_p));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 2258, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 2258, __pyx_L1_error)</span>
    __pyx_t_6 = ((PyArrayObject *)__pyx_t_2);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_13, &amp;__pyx_t_14, &amp;__pyx_t_15);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_log_p, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_13, __pyx_t_14, __pyx_t_15);
        }
        __pyx_t_13 = __pyx_t_14 = __pyx_t_15 = 0;
      }
      __pyx_pybuffernd_log_p.diminfo[0].strides = __pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_log_p.diminfo[0].shape = __pyx_pybuffernd_log_p.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_8 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2258, __pyx_L1_error)</span>
    }
    __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_log_p, ((PyArrayObject *)__pyx_t_2));
    __pyx_t_2 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2259</span>:     <span class="k">return</span> <span class="n">log_p</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_log_p));
  __pyx_r = ((PyObject *)__pyx_v_log_p);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2260</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2261</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2262</span>: <span class="c">################</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2263</span>: <span class="c"># Regression style likelihoods: (Can prob simplify and make all mlp likelihoods of this form)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2264</span>: </pre>
<pre class="cython line score-37" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2265</span>: <span class="k">def</span> <span class="nf">wiener_like_multi_nn_mlp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">=</span> <span class="mf">2</span><span class="p">]</span> <span class="n">data</span><span class="p">,</span></pre>
<pre class='cython code score-37 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_37wiener_like_multi_nn_mlp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_36wiener_like_multi_nn_mlp[] = "wiener_like_multi_nn_mlp(ndarray data, double p_outlier=0, double w_outlier=0, network=None)";
static PyMethodDef __pyx_mdef_4wfpt_37wiener_like_multi_nn_mlp = {"wiener_like_multi_nn_mlp", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_37wiener_like_multi_nn_mlp, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_36wiener_like_multi_nn_mlp};
static PyObject *__pyx_pw_4wfpt_37wiener_like_multi_nn_mlp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_data = 0;
  double __pyx_v_p_outlier;
  double __pyx_v_w_outlier;
  PyObject *__pyx_v_network = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_multi_nn_mlp (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_data,&amp;__pyx_n_s_p_outlier,&amp;__pyx_n_s_w_outlier,&amp;__pyx_n_s_network,0};
    PyObject* values[4] = {0,0,0,0};
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_36wiener_like_multi_nn_mlp(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_data, double __pyx_v_p_outlier, double __pyx_v_w_outlier, PyObject *__pyx_v_network) {
  float __pyx_v_ll_min;
  float __pyx_v_log_p;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_data;
  __Pyx_Buffer __pyx_pybuffer_data;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_multi_nn_mlp", 0);
  __pyx_pybuffer_data.pybuffer.buf = NULL;
  __pyx_pybuffer_data.refcount = 0;
  __pyx_pybuffernd_data.data = NULL;
  __pyx_pybuffernd_data.rcbuffer = &amp;__pyx_pybuffer_data;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_data, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 2265, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_data.diminfo[0].strides = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_data.diminfo[0].shape = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_data.diminfo[1].strides = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_data.diminfo[1].shape = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.shape[1];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_multi_nn_mlp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__45 = <span class='py_c_api'>PyTuple_Pack</span>(6, __pyx_n_s_data, __pyx_n_s_p_outlier, __pyx_n_s_w_outlier, __pyx_n_s_network, __pyx_n_s_ll_min, __pyx_n_s_log_p);<span class='error_goto'> if (unlikely(!__pyx_tuple__45)) __PYX_ERR(0, 2265, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__45);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__45);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_37wiener_like_multi_nn_mlp, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2265, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_wiener_like_multi_nn_mlp, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2265, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__46 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__45, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_wfpt_pyx, __pyx_n_s_wiener_like_multi_nn_mlp, 2265, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__46)) __PYX_ERR(0, 2265, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">2266</span>:                              <span class="n">double</span> <span class="n">p_outlier</span> <span class="o">=</span> <span class="mf">0</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2267</span>:                              <span class="n">double</span> <span class="n">w_outlier</span> <span class="o">=</span> <span class="mf">0</span><span class="p">,</span></pre>
<pre class="cython line score-52" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2268</span>:                              <span class="n">network</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span></pre>
<pre class='cython code score-52 '>    values[3] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_data)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_p_outlier);
          if (value) { values[1] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w_outlier);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_network);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "wiener_like_multi_nn_mlp") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2265, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_data = ((PyArrayObject *)values[0]);
    if (values[1]) {
      __pyx_v_p_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_p_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2266, __pyx_L3_error)</span>
    } else {
      __pyx_v_p_outlier = ((double)0.0);
    }
    if (values[2]) {
      __pyx_v_w_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_w_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2267, __pyx_L3_error)</span>
    } else {
      __pyx_v_w_outlier = ((double)0.0);
    }
    __pyx_v_network = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi_nn_mlp", 0, 1, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 2265, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_multi_nn_mlp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_data), __pyx_ptype_5numpy_ndarray, 1, "data", 0))) <span class='error_goto'>__PYX_ERR(0, 2265, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4wfpt_36wiener_like_multi_nn_mlp(__pyx_self, __pyx_v_data, __pyx_v_p_outlier, __pyx_v_w_outlier, __pyx_v_network);
</pre><pre class="cython line score-0">&#xA0;<span class="">2269</span>:                              <span class="c">#**kwargs):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2270</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2271</span>:     <span class="k">cdef</span> <span class="kt">float</span> <span class="nf">ll_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">16.11809</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ll_min = -16.11809;
</pre><pre class="cython line score-0">&#xA0;<span class="">2272</span>:     <span class="k">cdef</span> <span class="kt">float</span> <span class="nf">log_p</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2273</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2274</span>:     <span class="c"># Call to network:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2275</span>:     <span class="k">if</span> <span class="n">p_outlier</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span> <span class="c"># previous ddm_model</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_p_outlier == 0.0) != 0);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-102" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2276</span>:         <span class="n">log_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">umath</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">predict_on_batch</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">ll_min</span><span class="p">))</span></pre>
<pre class='cython code score-102 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2276, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2276, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2276, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_core);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2276, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_umath);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2276, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_maximum);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2276, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_predict_on_batch);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2276, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
      __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
      if (likely(__pyx_t_8)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
      }
    }
    __pyx_t_5 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_8, ((PyObject *)__pyx_v_data)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_7, ((PyObject *)__pyx_v_data));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 2276, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_ll_min);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2276, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_8 = NULL;
    __pyx_t_9 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
      __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
      if (likely(__pyx_t_8)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
        __pyx_t_9 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_6)) {
      PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_t_5, __pyx_t_7};
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2276, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_6)) {
      PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_t_5, __pyx_t_7};
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2276, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    } else
    #endif
    {
      __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2276, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      if (__pyx_t_8) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_t_8); __pyx_t_8 = NULL;
      }
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0+__pyx_t_9, __pyx_t_5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1+__pyx_t_9, __pyx_t_7);
      __pyx_t_5 = 0;
      __pyx_t_7 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_10, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2276, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
      __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
      }
    }
    __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 2276, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_11 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_2); if (unlikely((__pyx_t_11 == (float)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2276, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_log_p = __pyx_t_11;
</pre><pre class="cython line score-0">&#xA0;<span class="">2277</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-166" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2278</span>:         <span class="n">log_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">umath</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">predict_on_batch</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">ll_min</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">p_outlier</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">w_outlier</span> <span class="o">*</span> <span class="n">p_outlier</span><span class="p">)))</span></pre>
<pre class='cython code score-166 '>  /*else*/ {
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_log);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_exp);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_core);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_12, __pyx_n_s_umath);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_maximum);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_predict_on_batch);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    __pyx_t_14 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
      __pyx_t_14 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
      if (likely(__pyx_t_14)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
      }
    }
    __pyx_t_8 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, ((PyObject *)__pyx_v_data)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_13, ((PyObject *)__pyx_v_data));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
    if (unlikely(!__pyx_t_8)) <span class='error_goto'>__PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    __pyx_t_13 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_ll_min);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    __pyx_t_14 = NULL;
    __pyx_t_9 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_12))) {
      __pyx_t_14 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_12);
      if (likely(__pyx_t_14)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_12);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_12, function);
        __pyx_t_9 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_12)) {
      PyObject *__pyx_temp[3] = {__pyx_t_14, __pyx_t_8, __pyx_t_13};
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_12, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_12)) {
      PyObject *__pyx_temp[3] = {__pyx_t_14, __pyx_t_8, __pyx_t_13};
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_12, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    } else
    #endif
    {
      __pyx_t_15 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
      if (__pyx_t_14) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0, __pyx_t_14); __pyx_t_14 = NULL;
      }
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0+__pyx_t_9, __pyx_t_8);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 1+__pyx_t_9, __pyx_t_13);
      __pyx_t_8 = 0;
      __pyx_t_13 = 0;
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_12, __pyx_t_15, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    __pyx_t_12 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
      __pyx_t_12 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
      if (likely(__pyx_t_12)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
      }
    }
    __pyx_t_6 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_12, __pyx_t_7) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>((1.0 - __pyx_v_p_outlier));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_7 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_6, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_w_outlier * __pyx_v_p_outlier));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_7, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_10))) {
      __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_10);
      if (likely(__pyx_t_5)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_10, function);
      }
    }
    __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_5, __pyx_t_6) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_10, __pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_10)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    __pyx_t_2 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_10, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_11 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_2); if (unlikely((__pyx_t_11 == (float)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2278, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_log_p = __pyx_t_11;
  }
  __pyx_L3:;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2279</span>:     <span class="k">return</span> <span class="n">log_p</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_log_p);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2279, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2280</span>: </pre>
<pre class="cython line score-35" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2281</span>: <span class="k">def</span> <span class="nf">wiener_like_multi_nn_mlp_pdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">=</span> <span class="mf">2</span><span class="p">]</span> <span class="n">data</span><span class="p">,</span></pre>
<pre class='cython code score-35 '>/* Python wrapper */
static PyObject *__pyx_pw_4wfpt_39wiener_like_multi_nn_mlp_pdf(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4wfpt_38wiener_like_multi_nn_mlp_pdf[] = "wiener_like_multi_nn_mlp_pdf(ndarray data, double p_outlier=0, double w_outlier=0, network=None)";
static PyMethodDef __pyx_mdef_4wfpt_39wiener_like_multi_nn_mlp_pdf = {"wiener_like_multi_nn_mlp_pdf", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4wfpt_39wiener_like_multi_nn_mlp_pdf, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4wfpt_38wiener_like_multi_nn_mlp_pdf};
static PyObject *__pyx_pw_4wfpt_39wiener_like_multi_nn_mlp_pdf(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_data = 0;
  double __pyx_v_p_outlier;
  double __pyx_v_w_outlier;
  PyObject *__pyx_v_network = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_multi_nn_mlp_pdf (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_data,&amp;__pyx_n_s_p_outlier,&amp;__pyx_n_s_w_outlier,&amp;__pyx_n_s_network,0};
    PyObject* values[4] = {0,0,0,0};
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4wfpt_38wiener_like_multi_nn_mlp_pdf(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_data, double __pyx_v_p_outlier, double __pyx_v_w_outlier, PyObject *__pyx_v_network) {
  float __pyx_v_ll_min;
  float __pyx_v_log_p;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_data;
  __Pyx_Buffer __pyx_pybuffer_data;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("wiener_like_multi_nn_mlp_pdf", 0);
  __pyx_pybuffer_data.pybuffer.buf = NULL;
  __pyx_pybuffer_data.refcount = 0;
  __pyx_pybuffernd_data.data = NULL;
  __pyx_pybuffernd_data.rcbuffer = &amp;__pyx_pybuffer_data;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_data, &amp;__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>__PYX_ERR(0, 2281, __pyx_L1_error)</span>
  }
  __pyx_pybuffernd_data.diminfo[0].strides = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_data.diminfo[0].shape = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_data.diminfo[1].strides = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_data.diminfo[1].shape = __pyx_pybuffernd_data.rcbuffer-&gt;pybuffer.shape[1];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_multi_nn_mlp_pdf", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_data.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__47 = <span class='py_c_api'>PyTuple_Pack</span>(6, __pyx_n_s_data, __pyx_n_s_p_outlier, __pyx_n_s_w_outlier, __pyx_n_s_network, __pyx_n_s_ll_min, __pyx_n_s_log_p);<span class='error_goto'> if (unlikely(!__pyx_tuple__47)) __PYX_ERR(0, 2281, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__47);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__47);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4wfpt_39wiener_like_multi_nn_mlp_pdf, NULL, __pyx_n_s_wfpt);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2281, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_wiener_like_multi_nn_mlp_pdf, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2281, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2282</span>:                                  <span class="n">double</span> <span class="n">p_outlier</span> <span class="o">=</span> <span class="mf">0</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2283</span>:                                  <span class="n">double</span> <span class="n">w_outlier</span> <span class="o">=</span> <span class="mf">0</span><span class="p">,</span></pre>
<pre class="cython line score-52" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2284</span>:                                  <span class="n">network</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span></pre>
<pre class='cython code score-52 '>    values[3] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_data)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_p_outlier);
          if (value) { values[1] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_w_outlier);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_network);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "wiener_like_multi_nn_mlp_pdf") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 2281, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_data = ((PyArrayObject *)values[0]);
    if (values[1]) {
      __pyx_v_p_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_p_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2282, __pyx_L3_error)</span>
    } else {
      __pyx_v_p_outlier = ((double)0.0);
    }
    if (values[2]) {
      __pyx_v_w_outlier = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_w_outlier == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2283, __pyx_L3_error)</span>
    } else {
      __pyx_v_w_outlier = ((double)0.0);
    }
    __pyx_v_network = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("wiener_like_multi_nn_mlp_pdf", 0, 1, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 2281, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("wfpt.wiener_like_multi_nn_mlp_pdf", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_data), __pyx_ptype_5numpy_ndarray, 1, "data", 0))) <span class='error_goto'>__PYX_ERR(0, 2281, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4wfpt_38wiener_like_multi_nn_mlp_pdf(__pyx_self, __pyx_v_data, __pyx_v_p_outlier, __pyx_v_w_outlier, __pyx_v_network);
</pre><pre class="cython line score-0">&#xA0;<span class="">2285</span>:                                  <span class="c">#**kwargs):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2286</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2287</span>:     <span class="k">cdef</span> <span class="kt">float</span> <span class="nf">ll_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">16.11809</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ll_min = -16.11809;
</pre><pre class="cython line score-0">&#xA0;<span class="">2288</span>:     <span class="k">cdef</span> <span class="kt">float</span> <span class="nf">log_p</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2289</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2290</span>:     <span class="c"># Call to network:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2291</span>:     <span class="k">if</span> <span class="n">p_outlier</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span> <span class="c"># previous ddm_model</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_p_outlier == 0.0) != 0);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-102" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2292</span>:         <span class="n">log_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">umath</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">predict_on_batch</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">ll_min</span><span class="p">))</span></pre>
<pre class='cython code score-102 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2292, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_squeeze);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2292, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2292, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_core);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2292, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_umath);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2292, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_maximum);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2292, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_predict_on_batch);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2292, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
      __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
      if (likely(__pyx_t_8)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
      }
    }
    __pyx_t_5 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_8, ((PyObject *)__pyx_v_data)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_7, ((PyObject *)__pyx_v_data));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 2292, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_ll_min);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2292, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_8 = NULL;
    __pyx_t_9 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
      __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
      if (likely(__pyx_t_8)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
        __pyx_t_9 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_6)) {
      PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_t_5, __pyx_t_7};
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2292, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_6)) {
      PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_t_5, __pyx_t_7};
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2292, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    } else
    #endif
    {
      __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2292, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      if (__pyx_t_8) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_t_8); __pyx_t_8 = NULL;
      }
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0+__pyx_t_9, __pyx_t_5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1+__pyx_t_9, __pyx_t_7);
      __pyx_t_5 = 0;
      __pyx_t_7 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_10, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2292, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
      __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
      }
    }
    __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 2292, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_11 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_2); if (unlikely((__pyx_t_11 == (float)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2292, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_log_p = __pyx_t_11;
</pre><pre class="cython line score-0">&#xA0;<span class="">2293</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-166" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2294</span>:         <span class="n">log_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">umath</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">predict_on_batch</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">ll_min</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">p_outlier</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">w_outlier</span> <span class="o">*</span> <span class="n">p_outlier</span><span class="p">)))</span></pre>
<pre class='cython code score-166 '>  /*else*/ {
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_squeeze);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_log);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_exp);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_core);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_12, __pyx_n_s_umath);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_maximum);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_predict_on_batch);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    __pyx_t_14 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
      __pyx_t_14 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
      if (likely(__pyx_t_14)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
      }
    }
    __pyx_t_8 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, ((PyObject *)__pyx_v_data)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_13, ((PyObject *)__pyx_v_data));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
    if (unlikely(!__pyx_t_8)) <span class='error_goto'>__PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    __pyx_t_13 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_ll_min);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    __pyx_t_14 = NULL;
    __pyx_t_9 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_12))) {
      __pyx_t_14 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_12);
      if (likely(__pyx_t_14)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_12);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_12, function);
        __pyx_t_9 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_12)) {
      PyObject *__pyx_temp[3] = {__pyx_t_14, __pyx_t_8, __pyx_t_13};
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_12, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_12)) {
      PyObject *__pyx_temp[3] = {__pyx_t_14, __pyx_t_8, __pyx_t_13};
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_12, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    } else
    #endif
    {
      __pyx_t_15 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
      if (__pyx_t_14) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0, __pyx_t_14); __pyx_t_14 = NULL;
      }
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0+__pyx_t_9, __pyx_t_8);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 1+__pyx_t_9, __pyx_t_13);
      __pyx_t_8 = 0;
      __pyx_t_13 = 0;
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_12, __pyx_t_15, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    __pyx_t_12 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
      __pyx_t_12 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
      if (likely(__pyx_t_12)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
      }
    }
    __pyx_t_6 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_12, __pyx_t_7) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>((1.0 - __pyx_v_p_outlier));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_7 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_6, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_w_outlier * __pyx_v_p_outlier));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_7, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_10))) {
      __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_10);
      if (likely(__pyx_t_5)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_10, function);
      }
    }
    __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_5, __pyx_t_6) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_10, __pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_10)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    __pyx_t_2 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_10, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_11 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_2); if (unlikely((__pyx_t_11 == (float)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 2294, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_log_p = __pyx_t_11;
  }
  __pyx_L3:;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">2295</span>:     <span class="k">return</span> <span class="n">log_p</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_log_p);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2295, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">2296</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2297</span>: <span class="c">###########</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2298</span>: <span class="c"># Basic CNN likelihoods</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2299</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">2300</span>: <span class="c">#def wiener_like_cnn_2(np.ndarray[long, ndim = 1] x, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2301</span>: <span class="c">#                      np.ndarray[long, ndim = 1] response, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2302</span>: <span class="c">#                      np.ndarray[float, ndim = 1] parameters,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2303</span>: <span class="c">#                      double p_outlier = 0, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2304</span>: <span class="c">#                      double w_outlier = 0,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2305</span>: <span class="c">#                      **kwargs):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2306</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2307</span>: <span class="c">#    cdef Py_ssize_t size = x.shape[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2308</span>: <span class="c">#    cdef Py_ssize_t i </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2309</span>: <span class="c">#    cdef float log_p = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2310</span>: <span class="c">#    cdef np.ndarray[float, ndim = 2] pred = kwargs[&#39;network&#39;](parameters)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2311</span>: <span class="c">#    #log_p = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2312</span>: <span class="c">#    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2313</span>: <span class="c">#    for i in range(size):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2314</span>: <span class="c">#        if response[i] == 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2315</span>: <span class="c">#            log_p += np.log(pred[0, 2 * x[i]] * (1 - p_outlier) + w_outlier * p_outlier)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2316</span>: <span class="c">#        else: </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2317</span>: <span class="c">#            log_p += np.log(pred[0, 2 * x[i] + 1] * (1 - p_outlier) + w_outlier * p_outlier)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2318</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2319</span>: <span class="c">#    # Call to network:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2320</span>: <span class="c">#    return log_p</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2321</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2322</span>: <span class="c">#def wiener_pdf_cnn_2(np.ndarray[long, ndim = 1] x, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2323</span>: <span class="c">#                     np.ndarray[long, ndim = 1] response, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2324</span>: <span class="c">#                     np.ndarray[float, ndim = 1] parameters,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2325</span>: <span class="c">#                     double p_outlier = 0, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2326</span>: <span class="c">#                     double w_outlier = 0,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2327</span>: <span class="c">#                     bint logp = 0,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2328</span>: <span class="c">#                     **kwargs):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2329</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2330</span>: <span class="c">#    cdef Py_ssize_t size = x.shape[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2331</span>: <span class="c">#    cdef Py_ssize_t i</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2332</span>: <span class="c">#    cdef np.ndarray[float, ndim = 1] log_p = np.zeros(size, dtype = np.float32)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2333</span>: <span class="c">#    cdef np.ndarray[float, ndim = 2] pred = kwargs[&#39;network&#39;](parameters)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2334</span>: <span class="c">#    #print(pred.shape)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2335</span>: <span class="c">#    #log_p = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2336</span>: <span class="c">#    for i in range(size):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2337</span>: <span class="c">#        if response[i] == 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2338</span>: <span class="c">#            log_p[i] += np.log(pred[0, 2 * x[i]] * (1 - p_outlier) + w_outlier * p_outlier)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2339</span>: <span class="c">#        else: </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2340</span>: <span class="c">#            log_p[i] += np.log(pred[0, 2 * x[i] + 1] * (1 - p_outlier) + w_outlier * p_outlier)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2341</span>: <span class="c">#    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2342</span>: <span class="c">#    if logp == 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2343</span>: <span class="c">#        log_p = np.exp(log_p)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2344</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2345</span>: <span class="c">#    # Call to network:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2346</span>: <span class="c">#    return log_p</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2347</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2348</span>: <span class="c">#def wiener_like_reg_cnn_2(np.ndarray[long, ndim = 1] x, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2349</span>: <span class="c">#                          np.ndarray[long, ndim = 1] response, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2350</span>: <span class="c">#                          np.ndarray[float, ndim = 2] parameters,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2351</span>: <span class="c">#                          double p_outlier = 0, </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2352</span>: <span class="c">#                          double w_outlier = 0,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2353</span>: <span class="c">#                          bint logp = 0,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2354</span>: <span class="c">#                          **kwargs):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2355</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2356</span>: <span class="c">#    cdef Py_ssize_t size = x.shape[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2357</span>: <span class="c">#    cdef Py_ssize_t i</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2358</span>: <span class="c">#    cdef float log_p = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2359</span>: <span class="c">#    cdef np.ndarray[float, ndim = 2] pred = kwargs[&#39;network&#39;](parameters)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2360</span>: <span class="c">#    #log_p = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2361</span>: <span class="c">#    #print(pred.shape)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2362</span>: <span class="c">#    #print(pred)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2363</span>: <span class="c">#    for i in range(size):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2364</span>: <span class="c">#        if response[i] == 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2365</span>: <span class="c">#            log_p += np.log(pred[i, 2 * x[i]] * (1 - p_outlier) + w_outlier * p_outlier)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2366</span>: <span class="c">#        else: </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2367</span>: <span class="c">#            log_p += np.log(pred[i, 2 * x[i] + 1] * (1 - p_outlier) + w_outlier * p_outlier)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2368</span>: <span class="c">#    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2369</span>: <span class="c">#    # Call to network:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2370</span>: <span class="c">#    return log_p</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2371</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">2372</span>: <span class="c">#</span></pre>
</div></body></html>
